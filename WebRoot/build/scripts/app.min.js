"use strict";var versionAIO="AIO Version 1.4 25/07/2018\n----------------------------\nmejoras reingreso gp",app=angular.module("aioApp",["ngCookies","ngResource","ngSanitize","ngRoute","LocalStorageModule","ngICheck","ui.utils","platanus.rut","ui.bootstrap","cgBusy","infinite-scroll","angularMoment","ui.sortable","ngTextTruncate","textAngular","angularjs-dropdown-multiselect","badwing.autoselect","ngFileUpload","ngWebSocket"]);app.config(["$routeProvider","$compileProvider",function(a,b){b.aHrefSanitizationWhitelist(/^\s*(https?|ftp|cbrsvisor):/),a.when("/repertorio",{templateUrl:"views/repertorio.html",controller:"RepertorioCtrl"}).when("/auditoria",{templateUrl:"views/auditoria.html",controller:"AuditoriaCtrl"}).when("/gponline",{templateUrl:"views/gponline.html",controller:"GponlineCtrl"}).when("/gponline/:borrador/:folio",{templateUrl:"views/gponline.html",controller:"GponlineCtrl"}).when("/estado",{templateUrl:"views/estado.html",controller:"EstadoCtrl"}).when("/estado/:caratula",{templateUrl:"views/estado.html",controller:"EstadoCtrl"}).when("/home",{templateUrl:"views/home.html",controller:"HomeCtrl"}).when("/home/:tipo",{templateUrl:"views/home.html",controller:"HomeCtrl"}).when("/indice",{templateUrl:"views/indice.html",controller:"IndiceCtrl"}).when("/reingreso",{templateUrl:"views/reingreso.html",controller:"ReingresoCtrl"}).when("/bodega",{templateUrl:"views/bodega.html",controller:"BodegaCtrl"}).when("/desbloqueo",{templateUrl:"views/desbloqueo.html",controller:"DesbloqueoCtrl"}).when("/urgencia",{templateUrl:"views/urgencia.html",controller:"UrgenciaCtrl"}).when("/documentos",{templateUrl:"views/documentos.html",controller:"DocumentosCtrl"}).when("/anexos",{templateUrl:"views/anexos.html",controller:"AnexosCtrl"}).when("/distribucion",{templateUrl:"views/distribucion.html",controller:"DistribucionCtrl"}).when("/distribucion/:caratula",{templateUrl:"views/distribucion.html",controller:"DistribucionCtrl"}).when("/solicitudes",{templateUrl:"views/solicitudes.html",controller:"SolicitudesCtrl"}).when("/verInscripcion/:registro/:foja/:numero/:ano/:bis/:origen/:estado?",{templateUrl:"views/verInscripcion.html",controller:"VerInscripcionCtrl"}).when("/verInscripcion/:registro/:foja/:numero/:ano/:bis/:origen/:estado/:caratula/:borrador/:folio?",{templateUrl:"views/verInscripcion.html",controller:"VerInscripcionCtrl"}).when("/verInscripcionReg/:registro/:foja/:numero/:ano/:bis/:origen?",{templateUrl:"views/verInscripcionReg.html",controller:"VerInscripcionRegCtrl"}).when("/verInscripcionCertificar/:registro/:caratula/:foja/:numero/:ano/:bis/:fechaDoc/:rehaceImagen/:idtipoFormulario/:origen",{templateUrl:"views/verInscripcionCertificar.html",controller:"VerInscripcionCertificarCtrl"}).when("/verInscripcionCertificarHipo/:registro/:caratula/:foja/:numero/:ano/:bis/:fechaDoc/:rehaceImagen/:idtipoFormulario/:origen",{templateUrl:"views/verInscripcionCertificarHipo.html",controller:"VerInscripcionCertificarHipoCtrl"}).when("/verInscripcionCertificarProh/:registro/:caratula/:foja/:numero/:ano/:bis/:fechaDoc/:rehaceImagen/:idtipoFormulario/:origen",{templateUrl:"views/verInscripcionCertificarProh.html",controller:"VerInscripcionCertificarProhCtrl"}).when("/verVistaPreviaPlantilla/:caratula/:prefijo/:origen",{templateUrl:"views/verVistaPreviaPlantilla.html",controller:"VerVistaPreviaPlantillaCtrl"}).when("/digital",{templateUrl:"views/digital.html",controller:"DigitalCtrl"}).when("/digitalHipotecas",{templateUrl:"views/digitalHipotecas.html",controller:"DigitalHipotecasCtrl"}).when("/digitalProhibiciones",{templateUrl:"views/digitalProhibiciones.html",controller:"DigitalProhibicionesCtrl"}).when("/liquidacion",{templateUrl:"views/liquidacion.html",controller:"LiquidacionCtrl"}).when("/carteles",{templateUrl:"views/carteles/carteles.html",controller:"CartelesCtrl"}).when("/verEscritura/:caratula/:origen",{templateUrl:"views/verEscritura.html",controller:"VerEscrituraCtrl"}).when("/verEscrituraEstudio/:caratula/:version/:origen",{templateUrl:"views/verEscrituraEstudio.html",controller:"VerEscrituraEstudioCtrl"}).when("/verGP/:codigoAlpha/:origen",{templateUrl:"views/verGP.html",controller:"VerGPCtrl",resolve:{codigoAlphap:function(){return""},origenp:function(){return""}}}).when("/verCartel/:numero/:mes/:ano/:registro/:bis/:tipo/:origen/:rehacer?",{templateUrl:"views/carteles/verCartel.html",controller:"VerCartelCtrl"}).when("/mantenedorDistribucion",{templateUrl:"views/mantenedorCertifica.html",controller:"MantenedorCertificaCtrl"}).when("/certificacion",{templateUrl:"views/certificacion.html",controller:"CertificacionCtrl"}).when("/certificacionHipotecas",{templateUrl:"views/certificacionHipotecas.html",controller:"CertificacionHipotecasCtrl"}).when("/certificacionProhibiciones",{templateUrl:"views/certificacionProhibiciones.html",controller:"CertificacionProhibicionesCtrl"}).when("/certificacionenparte",{templateUrl:"views/certificacionenparte.html",controller:"CertificacionEnParteCtrl"}).when("/perfiles",{templateUrl:"views/perfiles.html",controller:"PerfilesCtrl"}).when("/tareas",{templateUrl:"views/tareas.html",controller:"TareasCtrl"}).when("/uaf",{templateUrl:"views/uaf.html",controller:"UAFCtrl"}).when("/uaf1",{templateUrl:"views/UAFPersonas.html",controller:"UAFCtrl"}).when("/uaf2",{templateUrl:"views/UAFBienes.html",controller:"UAFCtrl"}).when("/listadorepertorio",{templateUrl:"views/listadorepertorio.html",controller:"ListadoRepertorioCtrl"}).when("/listadoctacte",{templateUrl:"views/listadoctacte.html",controller:"ListadoCtaCteCtrl"}).when("/revisionNotas",{templateUrl:"views/revisionNotas.html",controller:"RevisionNotasCtrl"}).when("/nominactacte",{templateUrl:"views/nominactacte.html",controller:"NominaCtaCteCtrl"}).when("/consultadiablito/:caratula/:borrador/:folio?",{templateUrl:"views/consultadiablito.html",controller:"ConsultaDiablitoCtrl"}).when("/info",{templateUrl:"views/info.html",controller:"InfoCtrl"}).when("/reingresoEscritura",{templateUrl:"views/reingresoescritura.html",controller:"ReingresoEscrituraCtrl"}).when("/oficio",{templateUrl:"views/oficio/oficio.html",controller:"OficioCtrl"}).when("/mantenedorCtasCtes",{templateUrl:"views/mantenedorCtasCtes.html",controller:"MantenedorCtasCtesCtrl"}).when("/recepcionPlanos",{templateUrl:"views/recepcionPlanos.html",controller:"RecepcionPlanosCtrl"}).when("/plantillero",{templateUrl:"views/plantillero.html",controller:"PlantilleroCtrl"}).when("/listadoCuadernillo",{templateUrl:"views/listadoCuadernillo.html",controller:"DespachoCuadernilloCtrl"}).otherwise({redirectTo:"/home",controller:"HomeCtrl"})}]),app.run(["$rootScope","$location","Usuario","$log","$modalStack","amMoment","$window","socketService","$timeout",function(a,b,c,d,e,f,g,h,i){f.changeLanguage("es"),console.log(versionAIO),a.go=function(a){"back"===a?g.history.back():b.path(a)};var j=null;a.init=function(){i.cancel(j),j=i(a.onTimeout,1e3),a.openedContador=!0},a.onTimeout=function(){a.countdown--,j=i(a.onTimeout,1e3),0==a.countdown&&(i.cancel(j),a.openedContador=!1)},a.stopTimeout=function(){i.cancel(j)},a.quitaPadding=function(){return b.path().indexOf("verInscripcion")>0||b.path().indexOf("verCartel")>0||b.path().indexOf("consultadiablito")>0||b.path().indexOf("verVistaPreviaPlantilla")>0},a.$on("$routeChangeSuccess",function(){var a=e.getTop();a&&e.dismiss(a.key)}),a.$on("$locationChangeStart",function(d){var e=b.path();null!=a.permisos&&(c.tienePermiso(e,a.permisos)||b.path("/home/sa")),c.setSessionActiva(e,a.perfil).then(function(a){null==a.estado?g.location.href=g.location.protocol+"//"+g.location.host+g.location.pathname:a.estado||(g.location.href=g.location.protocol+"//"+g.location.host+g.location.pathname)},function(a){alert("No se ha podido establecer comunicacion con el servidor.")})});var k=c.getSessionAttribute("perfil");k.then(function(d){if(null==d.estado)g.location.href=g.location.protocol+"//"+g.location.host+g.location.pathname;else if(d.estado){a.perfil=d.value;var e=c.getPermisosUsuario(a.perfil);e.then(function(d){if(null==d.status)g.location.href=g.location.protocol+"//"+g.location.host+g.location.pathname;else if(d.status){a.permisos=d.permisosUsuario,a.subPermisos=c.getAllSubPermisos(a.permisos),a.activoAtencion=d.activoAtencion,a.modulo=d.modulo,a.grupo=d.grupo,a.userIpAddress=d.userIpAddress,a.ipSocket=d.ipSocket,a.puertoSocket=d.puertoSocket,a.nombreCliente="",a.idPerfil=d.idPerfil,h.conexion();var e=Math.ceil(parseFloat(a.permisos.length/4));a.misFilas=[];for(var f=0;f<e;f++){var i=4*f,j=4*(f+1);a.misFilas[f]=a.permisos.slice(i,j)}var k=b.path();c.tienePermiso(k,a.permisos)||b.path("/home/sa")}else alert(d.msg)},function(a){g.location.href=g.location.protocol+"//"+g.location.host+g.location.pathname});var e=c.getSessionAttribute("perfilesUsuario");e.then(function(b){null==b.estado||b.estado&&(a.perfiles=b.value.split(","))},function(a){g.location.href=g.location.protocol+"//"+g.location.host+g.location.pathname})}else{var e=c.getPerfilesUsuario();e.then(function(d){if(null==d.status)g.location.href=g.location.protocol+"//"+g.location.host+g.location.pathname;else if(d.status)if(a.perfiles=d.perfilesUsuario,c.setSessionAttribute("perfilesUsuario",d.perfilesUsuario.toString()),1==d.perfilesUsuario.length){a.perfil=d.perfilesUsuario[0].perfil.trim(),a.idPerfil=d.perfilesUsuario[0].idPerfil,c.setSessionAttribute("idPerfil",d.perfilesUsuario[0].idPerfil);var e=c.setSessionAttribute("perfil",a.perfil);e.then(function(a){null==a.estado?g.location.href=g.location.protocol+"//"+g.location.host+g.location.pathname:a.estado||alert(a.msg)},function(a){alert("No se ha podido establecer comunicacion con el servidor.")});var e=c.getPermisosUsuario(a.perfil);e.then(function(d){if(null==d.status)g.location.href=g.location.protocol+"//"+g.location.host+g.location.pathname;else if(d.status){a.permisos=d.permisosUsuario,a.subPermisos=c.getAllSubPermisos(a.permisos),a.activoAtencion=d.activoAtencion,a.modulo=d.modulo,a.grupo=d.grupo,a.userIpAddress=d.userIpAddress,a.ipSocket=d.ipSocket,a.puertoSocket=d.puertoSocket,a.nombreCliente="",h.conexion();var e=Math.ceil(parseFloat(a.permisos.length/4));a.misFilas=[];for(var f=0;f<e;f++){var i=4*f,j=4*(f+1);a.misFilas[f]=a.permisos.slice(i,j)}var k=b.path();c.tienePermiso(k,a.permisos)||b.path("/home/sa")}else alert(d.msg),g.location.href=g.location.protocol+"//"+g.location.host+g.location.pathname},function(a){g.location.href=g.location.protocol+"//"+g.location.host+g.location.pathname})}else d.perfilesUsuario<1&&(alert(d.msg),g.location.href=g.location.protocol+"//"+g.location.host+g.location.pathname);else alert(d.msg),g.location.href=g.location.protocol+"//"+g.location.host+g.location.pathname},function(a){g.location.href=g.location.protocol+"//"+g.location.host+g.location.pathname})}},function(a){alert("No se ha podido establecer comunicacion con el servidor.")});var k=c.getUsuario();k.then(function(c){if(null==c.estado)g.location.href=g.location.protocol+"//"+g.location.host+g.location.pathname;else if(c.estado){a.userLogin=c.nombreUsuario;var d=c.nombreUsuario.replace("CBRS\\","");a.userLoginSinCBRS=d.trim(),a.modulo=c.modulo,a.grupo=c.grupo,a.activoAtencion=c.activoAtencion,a.userIpAddress=c.userIpAddress,a.moduloDisponible=0,a.ipSocket=c.ipSocket,a.puertoSocket=c.puertoSocket,a.nombreCliente="",a.aioParametros={sistema:c.sistema,anoArchivoNacional:c.anoArchivoNacional,anoDigitalPropiedades:c.anoDigitalPropiedades,anoDigitalHipotecas:c.anoDigitalHipotecas,anoDigitalProhibiciones:c.anoDigitalProhibiciones,fojasDigitalProhibiciones:c.fojasDigitalProhibiciones}}else b.path("/home/sa")},function(a){alert("No se ha podido establecer comunicacion con el servidor.")})}]),app.controller("AnexosCtrl",["$scope","$timeout","localStorageService","$log","anexoService","$modal","$modalStack","$routeParams","anexoModel",function(a,b,c,d,e,f,g,h,i){e.getAnexos().then(function(b){null===b.estado||(b.estado?a.data=b:a.raiseErr(b.msg))},function(b){a.raiseErr("No se ha podido establecer comunicacion con el servidor.")}),a.editar=function(b){a.anexoEditar=b},a.submitted=!1,a.guardarAnexo=function(){a.formEditar.$valid?e.guardarAnexo(a.anexoEditar).then(function(b){null===b.status||($("#edit-anexo").modal("hide"),b.estado||a.raiseErr(b.msg))},function(b){a.raiseErr("No se ha podido establecer comunicacion con el servidor.")}):a.formEditar.submitted=!0},a.raiseErr=function(b){a.openMensajeModal("error",b,"",!1,null)},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openMensajeModal=function(c,d,e,g,h){f.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return c},titulo:function(){return d},detalle:function(){return e}}}),g&&b(function(){a.closeModal()},1e3*h)},a.openLoadingModal=function(a,b){f.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.openSolicitar=function(){a.$broadcast("sfojaIsFocused")},a.openRechazoModal=function(){var b={numeroCaratula:a.req.numeroCaratula};f.open({templateUrl:"rechazoModal.html",backdrop:"static",keyboard:!1,windowClass:"modal",controller:"RechazoModalCtrl",resolve:{dataRechazo:function(){return b}}})},a.closeModal=function(){var a=g.getTop();a&&g.dismiss(a.key)},a.stringIsNumber=function(a){return(+a).toString()===a}}]),app.controller("AnotacionModalCtrl",["$rootScope","$scope","$modalInstance","$timeout","$window","$modalStack","$filter","anotacionTipoModel","inscripcionDigitalService","inscripcionDigitalHipotecasService","inscripcionDigitalProhibicionesService","AnotacionService","AnotacionHipotecasService","AnotacionProhibicionesService","borradorService","Usuario","anotaciones","notas","inscripcionDigitalDTO","origen","paginacionNotas","$routeParams","$modal","solicitudService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){b.savingAnotacion=!1,b.nuevaInscripcion={},b.puedeGuardar=!0,b.enProceso=!1,b.anotacionStatus={ok:!1,error:!1,msg:null},b.parametros={registro:v.registro,foja:v.foja,numero:v.numero,ano:v.ano,bis:v.bis,origen:v.origen,estado:v.estado,caratula:v.caratula,borrador:v.borrador,folio:v.folio},b.solicita={foja:null,numero:null,ano:null,bis:!1,origen:"digital",consultaDocumentoDTO:{},estado:{},solicitudDTO:null},b.servicioAnotacion="prop"==b.parametros.registro?l:"hip"==b.parametros.registro?m:n,b.servicioInscripcion="prop"==b.parametros.registro?i:"hip"==b.parametros.registro?j:k,b.getTiposAnotacion=function(){b.servicioAnotacion.getTipos().then(function(c){if(null===c.status);else if(c.status){b.tipos=c.listaTiposAnotaciones,b.cambioTipo();var d={usuario:a.userLogin,tipos:c.listaTiposAnotaciones};h.setData(d)}else b.savingAnotacion=!1,b.anotacionStatus.error=!0,b.anotacionStatus.msg=c.msg},function(a){b.savingAnotacion=!1,b.anotacionStatus.error=!0,b.anotacionStatus.msg="No se ha podido establecer comunicacion con el servidor."})},b.anotacion={selectedTipo:{nombreAnotacion:"Texto Libre",valorAnotacion:"0",tipoAnotacion:"libre"},caratula:null,repertorio:null,borrador:null,repertorioNotarial:null,fechaNotario:null,foja:null,numero:null,ano:null,texto:null,fecha:null,version:null,anotacionMasiva:!1},b.paginacionMaster={currentPage:1,numPerPage:10,maxSize:2,totalpaginas:0,filteredTodos:[],todos:[],filterExprNotas:""},b.loaders={borradores:{isLoading:!1,error:!1},enProceso:{isLoading:!1,error:!1},terminadas:{isLoading:!1,error:!1},anotaciones:{isLoading:!1,error:!1},notas:{isLoading:!1,error:!1},titulosanteriores:{isLoading:!1,error:!1}},b.idInscripcion=s.idInscripcion,b.doFocus=function(a,c){a?d(function(){b.$broadcast(c+"IsFocused")},100):b.$broadcast(c+"IsFocused")},b.cambioTipo=function(){b.anotacion.caratula=null,b.anotacion.repertorio=null,b.anotacion.repertorioNotarial=null,b.anotacion.borrador=null,b.anotacion.fechaNotario=null,b.anotacion.foja=null,b.anotacion.numero=null,b.anotacion.ano=null,b.anotacion.texto=null,b.anotacion.version=null,0==b.anotacion.selectedTipo.valorAnotacion||20==b.anotacion.selectedTipo.valorAnotacion?(b.doFocus(!0,"texto"),b.soloTexto=!0):(b.doFocus(!0,"caratula"),b.soloTexto=!1)},b.closeAnotacion=function(){f.getTop()&&c.dismiss("cancel")},b.guardaAnotacion=function(){b.anotacion.anotacionMasiva?b.saveAnotacionMasiva():b.saveAnotacion()},b.saveAnotacion=function(){var a=b.anotacion.selectedTipo.nombreAnotacion;if(b.soloTexto)"Texto Libre"==a&&(a="Anotación"),b.agregaAnotacion(b.idInscripcion,a,b.anotacion.texto,null,null,null,null,null);else{var c=moment(b.anotacion.fecha,"YYYY-MM-DD").format("LL"),d=a+"<br>C: "+b.anotacion.caratula+"<br>REP. CBRS: "+b.anotacion.repertorio;if("proh"==b.parametros.registro){if(null!=b.anotacion.borrador&&(d+="<br>B.: "+b.anotacion.borrador),null!=b.anotacion.repertorioNotarial&&(d+="<br>REP. NOT.: "+b.anotacion.repertorioNotarial),null!=b.anotacion.fechaNotario){d+="<br>FECHA NOT.: "+moment(b.anotacion.fechaNotario,"YYYY-MM-DD").format("LL")}null!=b.anotacion.foja&&null!=b.anotacion.numero&&null!=b.anotacion.ano&&(d+="<br>F:"+b.anotacion.foja+" N:"+b.anotacion.numero+" A:"+b.anotacion.ano)}null!=b.anotacion.texto&&""!=b.anotacion.texto&&(d+="<br>"+b.anotacion.texto),d+="<br>FECHA: "+c+".<br><label></label>",b.agregaAnotacion(b.idInscripcion,a,d,b.anotacion.caratula,b.anotacion.repertorio,b.anotacion.version,b.anotacion.fecha,b.anotacion.borrador)}},b.agregaAnotacion=function(a,c,d,f,g,h,i,j){b.savingAnotacion=!0,b.anotacionStatus={ok:!1,error:!1,msg:null},b.servicioAnotacion.addAnotacion(a,c,d,f,g,h,i,j).then(function(a){if(null===a.status)e.location.href=e.location.protocol+"//"+e.location.host+e.location.pathname;else if(a.status){if(b.anotacionStatus.ok=!0,"digital"==t)b.buscaNotas();else{var c=b.servicioInscripcion.getInscripcion(s.foja,s.numero,s.ano,s.bis);c.then(function(a){q.length=0,r.length=0,angular.forEach(a.inscripcionDigitalDTO.anotacionsForIdInscripcionDestino,function(a){3===a.tipoAnotacionDTO.idTipoAnotacion?q.push(a):1!==a.tipoAnotacionDTO.idTipoAnotacion&&2!==a.tipoAnotacionDTO.idTipoAnotacion||7===a.estadoAnotacionDTO.idEstado||r.push(a)})},function(a){}),b.makeTodos()}b.salirSave()}else b.savingAnotacion=!1,b.anotacionStatus.error=!0,b.anotacionStatus.msg=a.msg},function(a){b.savingAnotacion=!1,b.anotacionStatus.error=!0,b.anotacionStatus.msg="Problemas contactando al servidor."})},b.saveAnotacionMasiva=function(){var a=b.anotacion.selectedTipo.nombreAnotacion;for(var c in b.titulos)!function(c){if(b.titulos[c].Selected){if(0==b.anotacion.selectedTipo.valorAnotacion)b.agregaAnotacionMasiva(b.titulos[c].idInscripcion,"Anotación",b.anotacion.texto,null,null,null,b.titulos[c].vigente,b.anotacion.fecha);else{var d=moment(b.anotacion.fecha,"YYYY-MM-DD").format("LL"),e=a+"<br>C: "+b.anotacion.caratula+"<br>REP.: "+b.anotacion.repertorio;null!=b.anotacion.texto&&""!=b.anotacion.texto&&(e+="<br>"+b.anotacion.texto),e+="<br>FECHA: "+d+".<br><label></label>",b.agregaAnotacionMasiva(b.titulos[c].idInscripcion,a,e,b.anotacion.caratula,b.anotacion.repertorio,b.anotacion.version,b.titulos[c].vigente,b.anotacion.fecha)}b.anotacionStatus.error?b.titulos[c].flag=!1:b.titulos[c].flag=!0}}(c);b.salirSaveMasivo()},b.agregaAnotacionMasiva=function(a,c,d,f,g,h,i,j){b.savingAnotacion=!0,b.anotacionStatus={ok:!1,error:!1,msg:null},b.servicioAnotacion.addAnotacion(a,c,d,f,g,h,j).then(function(a){if(null===a.status)e.location.href=e.location.protocol+"//"+e.location.host+e.location.pathname;else if(a.status){if(b.anotacionStatus.ok=!0,i)if("digital"==t)b.buscaNotas();else{var c=b.servicioInscripcion.getInscripcion(s.foja,s.numero,s.ano,s.bis);c.then(function(a){q.length=0,r.length=0,angular.forEach(a.inscripcionDigitalDTO.anotacionsForIdInscripcionDestino,function(a){3===a.tipoAnotacionDTO.idTipoAnotacion?q.push(a):1!==a.tipoAnotacionDTO.idTipoAnotacion&&2!==a.tipoAnotacionDTO.idTipoAnotacion||7===a.estadoAnotacionDTO.idEstado||r.push(a)})},function(a){}),b.makeTodos()}}else b.savingAnotacion=!1,b.anotacionStatus.error=!0,b.anotacionStatus.msg=a.msg},function(a){b.savingAnotacion=!1,b.anotacionStatus.error=!0,b.anotacionStatus.msg="Problemas contactando al servidor."})},b.getRepertorioCaratula=function(){b.servicioAnotacion.getRepertorioCaratula(b.anotacion.caratula).then(function(a){if(null===a.status);else if(a.status)if(0!=a.repertorio){b.anotacion.repertorio=a.repertorio;var c=new Date(a.fechaIngresoRepertorio),d=("0"+c.getDate()).slice(-2),e=("0"+(c.getMonth()+1)).slice(-2),f=c.getFullYear()+"-"+e+"-"+d;b.anotacion.fecha=f}else b.anotacion.repertorio="",b.anotacion.fecha="";else b.savingAnotacion=!1,b.anotacionStatus.error=!0,b.anotacionStatus.msg=a.msg},function(a){b.savingAnotacion=!1,b.anotacionStatus.error=!0,b.anotacionStatus.msg="No se ha podido establecer comunicacion con el servidor."})},b.salirSave=function(){d(function(){b.savingAnotacion=!1,b.closeAnotacion()},2e3)},b.salirSaveMasivo=function(){d(function(){b.savingAnotacion=!1,b.closeAnotacion()},2e3)},b.buscaNotas=function(){b.loaders.anotaciones.isLoading=!0,b.loaders.notas.isLoading=!0;var a=s.foja,c=s.numero,d=s.ano,e=s.bis;b.servicioInscripcion.getNotas(a,c,d,e).then(function(a){null==a.status||(a.status?(q.length=0,r.length=0,angular.forEach(a.anotaciones,function(a){1!==a.tipoAnotacionDTO.idTipoAnotacion&&2!==a.tipoAnotacionDTO.idTipoAnotacion||7===a.estadoAnotacionDTO.idEstado?3===a.tipoAnotacionDTO.idTipoAnotacion&&q.push(a):r.push(a)}),b.makeTodos()):(b.raiseErr("error","Error Obteniendo Notas.",a.msg),b.loaders.anotaciones.error=!0,b.loaders.notas.error=!0)),b.loaders.anotaciones.isLoading=!1,b.loaders.notas.isLoading=!1},function(a){b.loaders.anotaciones.isLoading=!1,b.loaders.notas.isLoading=!1,b.loaders.anotaciones.error=!0,b.loaders.notas.error=!0,b.raiseErr("error","Error detectado.","No se ha podido establecer comunicación.")})},b.makeTodos=function(){u=angular.copy(b.paginacionMaster),u.todos=r;var a=(u.currentPage-1)*u.numPerPage,c=a+u.numPerPage;u.filteredTodos=u.todos.slice(a,c),u.totalpaginas=Math.round(u.todos.length/u.numPerPage)},b.titulosanteriores=function(){if(!b.anotacion.anotacionMasiva){b.titulos=[],b.loaders.titulosanteriores.isLoading=!0,b.puedeGuardar=!0,b.enProceso=!0;o.obtenerTitulosAnteriores(b.parametros.foja,b.parametros.numero,b.parametros.ano,b.parametros.bis).then(function(a){if(null===a.status);else if(a.status)if(b.totalTitulosAnteriores=a.totalTitulosAnteriores,a.listaTitulosAnteriores.length>0)for(var c=0;c<a.listaTitulosAnteriores.length;c++)8!=a.listaTitulosAnteriores[c].consultaDocumentoDTO.tipoDocumento&&(b.puedeGuardar=!1),b.titulos.push({Selected:a.listaTitulosAnteriores[c].vigente,foja:a.listaTitulosAnteriores[c].foja,numero:a.listaTitulosAnteriores[c].numero,anio:a.listaTitulosAnteriores[c].ano,vigente:a.listaTitulosAnteriores[c].vigente,id:b.titulos.length+1,idInscripcion:a.listaTitulosAnteriores[c].idInscripcion,flag:"",consultaDocumentoDTO:a.listaTitulosAnteriores[c].consultaDocumentoDTO});else b.titulos.push({Selected:!0,foja:b.foja,numero:b.numero,anio:b.anio,vigente:!1,id:1,idInscripcion:b.idInscripcion,flag:""});else b.setErr("data.msg",a.msg),b.loaders.titulosanteriores.error=!0;b.loaders.titulosanteriores.isLoading=!1,b.enProceso=!1},function(a){b.setErr("Problema contactando al servidor.",""),b.loaders.titulosanteriores.isLoading=!1,b.loaders.titulosanteriores.error=!0})}},b.selectTitulo=function(){b.puedeGuardar=!0,angular.forEach(b.titulos,function(a){8!=a.consultaDocumentoDTO.tipoDocumento&&1==a.Selected&&(b.puedeGuardar=!1)})},b.refrescarDocumentosInscripciones=function(){b.enProceso=!0,b.puedeGuardar=!0,angular.forEach(b.titulos,function(a){b.enProceso=!0,i.getInscripcionParaDigital(a.foja,a.numero,a.anio,!1).then(function(c){null===c.status||c.status&&(a.consultaDocumentoDTO=c.consultaDocumentoDTO,a.estado=c.estado,a.inscripcionDigitalDTO=c.inscripcionDigitalDTO,c.estado.tieneRechazo&&(a.Selected=!1),1==a.Selected&&8!=a.consultaDocumentoDTO.tipoDocumento&&(b.puedeGuardar=!1)),b.enProceso=!1},function(a){b.openMensajeModal("error","Problema detectado","No se ha podido establecer comunicación con el servidor.")})})},b.agregarInscripcion=function(){for(var a=b.nuevaInscripcion.fojas,c=b.nuevaInscripcion.numero,d=b.nuevaInscripcion.ano,e=!1,f=0;f<b.titulos.length;f++)if(b.titulos[f].foja===a&&b.titulos[f].numero===c&&b.titulos[f].anio===d)return b.nuevaInscripcion.fojas="",b.nuevaInscripcion.numero="",void(b.nuevaInscripcion.ano="");b.openLoadingModal("Buscando...",""),i.getInscripcionParaDigital(a,c,d,e).then(function(e){b.closeModal(),null===e.status||(e.status?(b.nuevaInscripcion.fojas="",b.nuevaInscripcion.numero="",b.nuevaInscripcion.ano="",e.estado.tieneRechazo?b.openSolicitar(e):e.consultaDocumentoDTO.hayDocumento&&(!e.consultaDocumentoDTO.hayDocumento||9!==e.consultaDocumentoDTO.tipoDocumento&&10!==e.consultaDocumentoDTO.tipoDocumento)?e.consultaDocumentoDTO.hayDocumento&&e.consultaDocumentoDTO.tipoDocumento:b.openSolicitar(e),b.titulos.push({Selected:!e.estado.tieneRechazo,foja:a,numero:c,anio:d,vigente:!1,id:b.titulos.length+1,idInscripcion:e.inscripcionDigitalDTO.idInscripcion,flag:"",consultaDocumentoDTO:e.consultaDocumentoDTO,inscripcionDigitalDTO:e.inscripcionDigitalDTO,estado:e.estado}),e.estado.tieneRechazo||8==e.consultaDocumentoDTO.tipoDocumento||(b.puedeGuardar=!1)):b.raiseErr("titulo","Problema detectado",e.msg))},function(a){b.openMensajeModal("error","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.setErr=function(a,c){b.anotacionStatus.error=!0,b.setStatusMsg(a,c)},b.setStatusMsg=function(a,c){b.anotacionStatus.msgTitle=a,b.anotacionStatus.msg=c},b.checkAll=function(){b.selectedAll?b.selectedAll=!1:b.selectedAll=!0,b.puedeGuardar=!0,angular.forEach(b.titulos,function(a){a.vigente||(!a.estado||a.estado.tieneRechazo)&&a.estado||(a.Selected=b.selectedAll),8!=a.consultaDocumentoDTO.tipoDocumento&&1==a.Selected&&(b.puedeGuardar=!1)})},b.openLoadingModal=function(a,b){w.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},b.openSolicitar=function(a){b.solicita.foja=a.inscripcionDigitalDTO.foja,b.solicita.numero=a.inscripcionDigitalDTO.numero,b.solicita.ano=a.inscripcionDigitalDTO.ano,b.solicita.bis=a.inscripcionDigitalDTO.bis,b.solicita.consultaDocumentoDTO=a.consultaDocumentoDTO,b.solicita.estado=a.estado,a.estado.tieneRechazo&&(b.solicita.solicitudDTO=a.solicitudDTO),b.$broadcast("sfojaIsFocused"),w.open({templateUrl:"digitalModal.html",backdrop:!0,windowClass:"modal",controller:"DigitalModalCtrl",resolve:{solicita:function(){return b.solicita},servicio:function(){return x},origen:function(){return b.solicita.origen}}})},b.closeModal=function(){var a=f.getTop();a&&f.dismiss(a.key)},b.verInscripcionDesdePreCaratula=function(c){a.go("/verInscripcion/"+b.parametros.registro+"/"+c.foja+"/"+c.numero+"/"+c.anio+"/"+!1+"/"+b.parametros.origen)},b.verInscripcion=function(a){e.open("/aio/index.html#/verInscripcion/"+b.parametros.registro+"/"+a.foja+"/"+a.numero+"/"+a.anio+"/"+!1+"/"+b.parametros.origen,"popup","width=800,height=600")},b.verPdfInscripcion=function(a){console.log(a),e.open("../do/service/pdf?metodo=getInscripcion&registro="+b.parametros.registro+"&foja="+a.foja+"&numero="+a.numero+"&ano="+a.anio+"&bis="+!1+"&estado=8","popup","width=800,height=600")},b.archivoNacional=function(b){return!(b<a.aioParametros.anoArchivoNacional)},b.anoActual=function(a){return!(moment(new Date).year()<a)},b.getTiposAnotacion()}]),app.controller("AtencionModalCtrl",["$modalStack","$scope",function(a,b){b.closeModal=function(){var b=a.getTop();b&&a.dismiss(b.key)}}]),app.controller("AuditoriaCtrl",["$rootScope","$scope","$timeout","$location","$filter","$modal","$modalStack","$routeParams","gponlineModel","gponlineService",function(a,b,c,d,e,f,g,h,i,j){b.fechahoy=(new Date).toJSON().split("T")[0],b.tab=i.getTab(),b.mostrar=i.getMostrar(),b.busquedaGponline=i.getBusquedaGponline(),b.busquedaCaratula=i.getBusquedaCaratula(),b.busquedaInscripcion=i.getBusquedaInscripcion(),b.busquedaPlanos=i.getBusquedaPlanos(),b.states=i.getStates(),b.req={simpleMode:!1},b.isActiveParent=function(a){return b.tab.parentActive===a},b.activateParent=function(a){b.tab.parentActive=a,i.setTab(b.tab),1===b.tab.parentActive?c(function(){b.doFocus("borrador")},200):2===b.tab.parentActive?c(function(){b.doFocus("caratula")},200):3===b.tab.parentActive&&c(function(){b.doFocus("foja")},200)},b.buscarFolio=function(){j.buscarFolios(b.busquedaGponline.borrador).then(function(a){b.closeModal(),null===a.status||(a.status?1==a.resultado.length?(b.busquedaGponline.folio=a.resultado[0].folio,b.buscarPorBorrador()):(b.busquedaGponline.folios=a.resultado,b.openfolioModal()):b.raiseErr("borrador","Problema detectado",a.msg))},function(a){b.raiseErr("borrador","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.buscarPorBorrador=function(){var a=b.busquedaGponline.borrador,c=b.busquedaGponline.folio,d=b.busquedaGponline.fechaHoy,e=b.busquedaGponline.anos;if(b.resetResultadoBorrador(),b.states.borrador.isLoading=!0,b.openLoadingModal("Realizando Busqueda...",""),""===c||null==c)b.buscarFolio();else{j.buscarBorrador(a,c,d,e).then(function(a){b.closeModal(),null===a.status||(a.status?(b.busquedaGponline.duenyos=a.duenyos,b.busquedaGponline.datosPropiedad=a.datosPropiedad,b.busquedaGponline.hipoteca=a.hipotecasVigentes,b.busquedaGponline.prohibicion=a.prohibicionesVigentes,b.busquedaGponline.roles=a.listaRoles,b.busquedaGponline.fechaUltimoGP=a.fechaUltimoGP,a.gp.length>0&&(b.busquedaGponline.codigoAlpha=a.gp[0].codigoAlpha),b.busquedaGponline.gp=a.gp,b.busquedaGponline.data=a,b.busquedaGponline.eventos=a.eventos,b.busquedaGponline.numeroEventos=a.numeroEventos,b.busquedaGponline.tieneNoVigenteProp=a.tieneNoVigenteProp,b.busquedaGponline.tieneNoVigenteProh=a.tieneNoVigenteProh,b.busquedaGponline.tieneNoVigenteHipo=a.tieneNoVigenteHipo):b.raiseErr("borrador","Problema detectado",a.msg))},function(a){b.raiseErr("borrador","Problema detectado","No se ha podido establecer comunicación con el servidor.")})}},b.buscarCaratula=function(){var a=b.busquedaCaratula.caratula;b.resetResultadoBorrador(),b.states.borrador.isLoading=!0,b.openLoadingModal("Realizando Busqueda...",""),j.buscarBorradorPorCaratula(a).then(function(a){b.closeModal(),null===a.status||(a.status?1==a.listaBorradores.length?(b.busquedaGponline.borrador=a.listaBorradores[0].borrador,b.busquedaGponline.folio=a.listaBorradores[0].folio,b.buscarPorBorrador()):(b.busquedaGponline.folios=a.listaBorradores,b.openfolioModal()):b.raiseErr("borrador","Problema detectado",a.msg))},function(a){b.raiseErr("borrador","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.buscarBorradorPorInscripcion=function(){var a=b.busquedaInscripcion.fojas,c=b.busquedaInscripcion.numero,d=b.busquedaInscripcion.ano;b.resetResultadoBorrador(),b.states.borrador.isLoading=!0,b.openLoadingModal("Realizando Busqueda...",""),j.buscarBorradorPorInscripcion(a,c,d).then(function(a){b.closeModal(),null===a.status||(a.status?1==a.listaBorradores.length?(b.busquedaGponline.borrador=a.listaBorradores[0].borrador,b.busquedaGponline.folio=a.listaBorradores[0].folio,b.buscarPorBorrador()):(b.busquedaGponline.folios=a.listaBorradores,b.openfolioModal()):b.raiseErr("borrador","Problema detectado",a.msg))},function(a){b.raiseErr("borrador","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.buscarPlanos=function(){b.busquedaGponline.urls="";for(var a="[",c=0;c<b.busquedaGponline.duenyos.length;c++)a+='{"fojasProp":"'+b.busquedaGponline.duenyos[c].fojas+'", "numeroProp":"'+b.busquedaGponline.duenyos[c].numero+'", "anyoProp":"'+b.busquedaGponline.duenyos[c].anyo+'", "bisProp":"'+b.busquedaGponline.duenyos[c].bis+'"}';a+="]",b.busquedaGponline.res=a,j.buscarPlano(b.busquedaGponline.res).then(function(a){null===a.status||(a.status?(a.tienePlanos&&(b.busquedaGponline.urls=a.urls),b.busquedaPlanos.tienePlanos=a.tienePlanos,b.busquedaPlanos.data=a):b.raiseErr("borrador","Problema detectado",a.msg))},function(a){b.raiseErr("borrador","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.buscarSegunFolio=function(a){b.busquedaGponline.borrador=a.borrador,b.busquedaGponline.folio=a.folio,b.buscarPorBorrador(),b.cancel()},b.verTitulo=function(b){var c=1==b.bis;a.go("/verInscripcion/prop/"+b.fojas+"/"+b.numero+"/"+b.anyo+"/"+c+"/gponline/0")},b.resetResultadoBorrador=function(){b.busquedaGponline.data=null,b.busquedaGponline.datosPropiedad=null,void 0!==b.busquedaGponline.duenyos&&(b.busquedaGponline.duenyos.length=0),void 0!==b.busquedaGponline.hipoteca&&(b.busquedaGponline.hipoteca.length=0),void 0!==b.busquedaGponline.prohibicion&&(b.busquedaGponline.prohibicion.length=0),void 0!==b.busquedaGponline.roles&&(b.busquedaGponline.roles.length=0),b.busquedaGponline.urls="",b.busquedaPlanos.data=null,b.busquedaPlanos.tienePlanos=null,b.mostrar.mostrarInactivosProp=!1,b.mostrar.mostrarInactivosProh=!1,b.mostrar.mostrarInactivosHipo=!1,b.cleanErr("borrador")},b.limpiarBorrador=function(){b.resetResultadoBorrador(),b.busquedaGponline.borrador=null,b.busquedaGponline.folio="",b.busquedaGponline.fecha=null,b.busquedaGponline.anos=null,b.myform.$setPristine(!0),b.doFocus("borrador")},b.limpiarCaratula=function(){b.resetResultadoBorrador(),b.busquedaCaratula.caratula=null,b.myform.$setPristine(!0),b.doFocus("caratula")},b.limpiarInscripcion=function(){b.resetResultadoBorrador(),b.busquedaInscripcion.fojas=null,b.busquedaInscripcion.numero=null,b.busquedaInscripcion.ano=null,b.myform.$setPristine(!0),b.doFocus("foja")},b.doFocus=function(a){b.$broadcast(a+"IsFocused")},b.raiseErr=function(a,c,d){b.closeModal(),b.states[a].isError=!0,b.states[a].title=c,b.states[a].msg=d},b.cleanErr=function(a){b.states[a].isError=!1,b.states[a].title="",b.states[a].msg=""},b.openMensajeModal=function(a,d,e,g,h){f.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return d},detalle:function(){return e}}}),g&&c(function(){b.closeModal()},1e3*h)},b.openLoadingModal=function(a,b){f.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},b.openfolioModal=function(){f.open({templateUrl:"foliosModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"GponlineCtrl",resolve:{busquedaGponline:function(){return b.busquedaGponline}}})},b.openGpCertfEmitModal=function(){f.open({templateUrl:"gpCertificadoEmitidoModal.html",backdrop:"static",keyboard:!1,size:"lg",windowClass:"modal",controller:"GponlineCtrl",resolve:{busquedaGponline:function(){return b.busquedaGponline}}})},b.openEventosModal=function(){f.open({templateUrl:"gpEventosModal.html",backdrop:"static",keyboard:!1,size:"lg",windowClass:"modal",controller:"GponlineCtrl",resolve:{busquedaGponline:function(){return b.busquedaGponline}}})},b.openCaratulasModal=function(){f.open({templateUrl:"gpCaratulasModal.html",backdrop:"static",keyboard:!1,size:"lg",windowClass:"modal",controller:"GponlineCtrl",resolve:{busquedaGponline:function(){return b.busquedaGponline}}})},b.verEstadoCaratula=function(a){f.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})},b.closeModal=function(){var a=g.getTop();a&&g.dismiss(a.key)},b.anos=function(a){return!(a>80)},c(function(){1===b.tab.parentActive?b.doFocus("borrador"):2===b.tab.parentActive?b.doFocus("caratula"):3===b.tab.parentActive&&b.doFocus("foja")},200),b.archivoNacional=function(b){return!(b<a.aioParametros.anoArchivoNacional)},b.anoActual=function(a){return!(moment(new Date).year()<a)},b.cancel=function(){var a=g.getTop();a&&g.dismiss(a.key)},b.vertodoProp=function(){b.mostrar.mostrarInactivosProp?b.mostrar.mostrarInactivosProp=!1:b.mostrar.mostrarInactivosProp=!0},b.vertodoProh=function(){b.mostrar.mostrarInactivosProh?b.mostrar.mostrarInactivosProh=!1:b.mostrar.mostrarInactivosProh=!0},b.vertodoHipo=function(){b.mostrar.mostrarInactivosHipo?b.mostrar.mostrarInactivosHipo=!1:b.mostrar.mostrarInactivosHipo=!0},b.verGP=function(){var c=b.busquedaGponline.codigoAlpha;a.go("/verGP/"+c+"/gponline")},b.verGPModal=function(a){f.open({templateUrl:"views/verGP.html",backdrop:"static",keyboard:!1,size:"lg",windowClass:"modal modal-dialog-xl",controller:"VerGPCtrl",resolve:{codigoAlphap:function(){return a.codigoAlpha},origenp:function(){return"gponline"}}})},b.buscarCaratulas=function(){var a="[";angular.forEach(b.busquedaGponline.duenyos,function(b,c){console.log(b.fojas),a+='{"fojasProp":"'+b.fojas+'", "numeroProp":"'+b.numero+'", "anyoProp":"'+b.anyo+'", "bisProp":"'+b.bis+'"}'}),a+="]",j.buscarCaratulas(b.busquedaGponline.borrador,b.busquedaGponline.folio,a).then(function(a){null===a.status||(a.status?(b.busquedaGponline.listaCaratulaPorPropiedad=a.caratulasPorPropiedad,b.openCaratulasModal()):b.openCaratulasModal())},function(a){b.raiseErr("borrador","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.verTipoImagenHipo=function(b){var c=1==b.bis;a.go("/verInscripcionReg/hip/"+b.fojas+"/"+b.numero+"/"+b.anyo+"/"+c+"/gponline")},b.verTipoImagenProh=function(b){var c=1==b.bis;a.go("/verInscripcionReg/proh/"+b.fojas+"/"+b.numero+"/"+b.anyo+"/"+c+"/gponline")},b.stringIsNumber=function(a){return(+a).toString()===a},c(function(){void 0!==h.borrador&&b.stringIsNumber(h.borrador)&&(b.busquedaGponline.borrador=h.borrador,b.busquedaGponline.folio=h.folio,c(function(){b.buscarPorBorrador()},500)),b.doFocus("borrador")},500)}]),angular.module("aioApp").controller("BodegaCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),app.controller("CaratulasPorRutCtrl",["$scope","$window","$timeout","$log","$modal","$modalStack","$routeParams","$modalInstance","estadoModel","requirenteService","estadoService","numeroCaratula",function(a,b,c,d,e,f,g,h,i,j,k,l){a.req=i.getCaratulasPorRut(),a.dataRequirente=i.getDatosRequirente(),a.listaCaratulas=i.getListaCaratulas(),a.numeroCaratula=l,a.paginacionMaster={currentPage:1,numPerPage:10,maxSize:5,totalpaginas:0,filteredTodos:[],todos:[]},a.paginacionCaratulasPorRut=angular.copy(a.paginacionMaster),a.buscar=function(){a.buscando=!0;var b=j.getRequirenteFull(a.req.rut);b.then(function(b){b.status&&b.hayNombre?(a.dataRequirente=b,i.setDatosRequirente(b)):(a.dataRequirente=null,i.setDatosRequirente(null))},function(a){});var b=k.getCaratulasPorRut(a.req.rut,a.req.resultado);b.then(function(b){a.buscando=!1,b.status?(a.listaCaratulas=b.res.listaCaratulas,i.setListaCaratulas(b.res.listaCaratulas),a.makeTodos()):(a.listaCaratulas=[],i.setListaCaratulas([]))},function(a){})},a.caratulasPorRutConMaximo=function(){a.buscando=!0,a.listaCaratulas=[],k.getCaratulasPorRut(a.req.rut,a.req.resultado).then(function(b){a.buscando=!1,b.status?(a.listaCaratulas=b.res.listaCaratulas,i.setListaCaratulas(b.res.listaCaratulas),a.makeTodos()):(a.listaCaratulas=[],i.setListaCaratulas([]))},function(a){})},a.buscarCaratula=function(a){h.close(a)},a.cancel=function(){h.dismiss("cancel")},a.limpiar=function(){a.req.rut=null,a.dataRequirente=null,a.listaCaratulas=[]},a.makeTodos=function(){a.paginacionCaratulasPorRut=angular.copy(a.paginacionMaster),a.paginacionCaratulasPorRut.todos=a.listaCaratulas;var b=(a.paginacionCaratulasPorRut.currentPage-1)*a.paginacionCaratulasPorRut.numPerPage,c=b+a.paginacionCaratulasPorRut.numPerPage;a.paginacionCaratulasPorRut.filteredTodos=a.paginacionCaratulasPorRut.todos.slice(b,c),a.paginacionCaratulasPorRut.totalpaginas=Math.round(a.paginacionCaratulasPorRut.todos.length/a.paginacionCaratulasPorRut.numPerPage)},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},c(function(){a.doFocus("rut")},500)}]),app.controller("CartelesCtrl",["$rootScope","$scope","$timeout","$location","cartelesModel","$filter","$modal","$modalStack","$window","CartelesService",function(a,b,c,d,e,f,g,h,i,j){b.tab=e.getTab(),b.busquedaCartel=e.getBusquedaCartel(),b.busquedaMis=e.getBusquedaMis(),b.states=e.getStates(),b.listaMis={data:[],inicio:0,fin:15,offset:15},b.isActiveParent=function(a){return b.tab.parentActive===a},b.activateParent=function(a){b.tab.parentActive=a,e.setTab(b.tab),1===b.tab.parentActive?c(function(){b.doFocus("numero")},200):2===b.tab.parentActive&&(void 0!==b.busquedaMis.resultados&&0!==b.busquedaMis.resultados.length||b.buscarMis(!0))},b.verCartel=function(b){a.go("/verCartel/"+b.numero+"/"+b.mes+"/"+b.ano+"/"+b.registro+"/"+b.bis+"/"+b.tipoArchivoDTO.tipoArchivo+"/carteles")},b.limpiarFormulario=function(){b.busquedaCartel.numero=null,b.busquedaCartel.mes="",b.busquedaCartel.ano=null,b.busquedaCartel.registro=1,b.busquedaCartel.bis=!1,b.myform.$setPristine(!0),b.doFocus("numero")},b.buscarCartel=function(){var d=b.busquedaCartel.numero,e="AIO AGUAS"==a.aioParametros.sistema?1:b.busquedaCartel.mes,f=b.busquedaCartel.ano,g="AIO"==a.aioParametros.sistema?1:b.busquedaCartel.registro,h=b.busquedaCartel.bis;b.openLoadingModal("Buscando...",""),j.buscarCartel(d,e,f,g,h,null).then(function(a){b.closeModal(),null===a.status||(a.status?a.cartelDTO.hayArchivo?0===a.cartelDTO.tipoArchivoDTO.tipoArchivo?c(function(){confirm("No se ha encontrado cartel, pero si el tomo de ese MES - AÑO, desea verlo?")&&b.verCartel(a.cartelDTO)},500):1===a.cartelDTO.tipoArchivoDTO.tipoArchivo&&b.verCartel(a.cartelDTO):b.openMensajeModal("info","No existe documento para cartel buscado.",""):b.openMensajeModal("error","Problema detectado",a.msg))},function(a){b.openMensajeModal("error","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.openSolicitar=function(){b.$broadcast("sfojaIsFocused"),g.open({templateUrl:"digitalModal.html",backdrop:!0,windowClass:"modal",controller:"DigitalModalCtrl",resolve:{solicita:function(){return b.solicita}}})},b.openSolicitarMis=function(){b.resolveModal.refresca=!1;g.open({templateUrl:"solicitarModal.html",backdrop:!0,windowClass:"modal",controller:"SolicitarModalCtrl",resolve:{resolveModal:function(){return b.resolveModal}}})},b.openLoadingModal=function(a,b){g.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},b.openMensajeModal=function(a,c,d){b.closeModal(),g.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,size:"sm",windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return c},detalle:function(){return d}}})},b.columnSortMis=function(a){b.busquedaMis.sorter.reverse=b.busquedaMis.sorter.predicate==a&&!b.busquedaMis.sorter.reverse,b.busquedaMis.sorter.predicate=a},b.resetResultadoMis=function(){void 0!==b.busquedaMis.resultados&&(b.busquedaMis.resultados.length=0),void 0!==b.listaMis.data&&(b.listaMis.data.length=0),b.busquedaMis.data=null,b.busquedaMis.fecha=null,b.listaMis.inicio=0,b.listaMis.fin=b.listaMis.offset,b.cleanErr("mis")},b.openDocumentoModal=function(a){b.closeModal(),g.open({templateUrl:"documentoModal.html",backdrop:!0,keyboard:!0,size:"lg",windowClass:"modal",controller:"DocumentoModalCtrl",resolve:{url:function(){return a}}})},b.verCertificado=function(a,c){b.openDocumentoModal("../do/service/carteles?metodo=getPDF&idCertificado="+a+"&registro="+c)},b.eliminar=function(a,c,d){confirm("Desea eliminar el certificado?")&&(b.openLoadingModal("Eliminando...",""),j.eliminar(c,d).then(function(c){b.closeModal(),b.busquedaMis.resultados.splice(a,1),b.actualizandoAlgo=!1},function(a){b.actualizandoAlgo=!1}))},b.firmar=function(a,d,e){b.openLoadingModal("Firmando...",""),j.firmar(d,e).then(function(d){d.status?(b.openMensajeModal("success","Documento firmado exitosamente.",""),c(function(){b.closeModal()},2e3),b.certificados.splice(a,1)):b.openMensajeModal("error","Problema detectado firmando documento.","")},function(a){b.actualizandoAlgo=!1})},b.buscarMis=function(a){b.resetResultadoMis(),a&&b.openLoadingModal("Obteniendo certificados...",""),j.listadoCertificadosByUserInSession().then(function(c){a&&b.closeModal(),null===c.status||(c.status?(b.busquedaMis.fecha=new Date,b.busquedaMis.data=c,b.busquedaMis.resultados=f("orderBy")(c.aaData,"fechaCreacion",!0)):b.raiseErr("mis","Problema detectado",c.msg))},function(a){b.raiseErr("mis","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.doFocus=function(a){b.$broadcast(a+"IsFocused")},b.raiseErr=function(a,c,d){b.closeModal(),b.states[a].isError=!0,b.states[a].title=c,b.states[a].msg=d},b.cleanErr=function(a){b.states[a].isError=!1,b.states[a].title="",b.states[a].msg=""},b.closeModal=function(){var a=h.getTop();a&&h.dismiss(a.key)},b.archivoNacional=function(b){return!(b<a.aioParametros.anoArchivoNacional)},b.anoActual=function(a){return console.log(""+a),!(moment(new Date).year()<a)},c(function(){1===b.tab.parentActive?b.doFocus("numero"):b.tab.parentActive},200)}]),app.controller("CertificacionCtrl",["$scope","$timeout","$rootScope","$location","$anchorScroll","solicitudesModel","certificacionModel","certificacionService","caratulaService","$filter","$modal","$modalStack",function(a,b,c,d,e,f,g,h,i,j,k,l){a.busquedaCertificacion=g.getBusquedaCertificacion(),a.states=g.getStates(),a.listaResumida=g.getListaResumida(),a.tab=f.getTab(),a.solicitudStatus={ok:!1,error:!1,warning:!1,msgTitle:null,msg:null,tipo:null},a.solicita={foja:null,numero:null,ano:null,bis:!1,tipo:null,esDigital:!1,tieneRechazo:!1},h.obtenerCaratulasParaCertificar().then(function(b){null===b.status||(b.status?(a.busquedaCertificacion.data=b,a.busquedaCertificacion.resultados=b.resultado):a.setErr("data.msg",b.msg))},function(b){a.setErr("Problema contactando al servidor.","")}),a.redistribuir=function(a){console.log("url /distribucion/"+a+"/"),c.go("/distribucion/"+a+"/")},a.redistribuirCaratula=function(b){a.openLoadingModal("Redistribuyendo...",""),i.movercaratula(b.numeroCaratula,b.codSeccion).then(function(d){a.closeModal(),null===d.status||(d.status?(b.bis,console.log("url /verInscripcionCertificar/prop/"+b.numeroCaratula+"/"+b.foja+"/"+b.numero+"/"+b.ano+"/"+b.bis+"/"+b.fechaDocLong+"/"+b.idtipoFormulario+"/certificacion/"),c.go("/verInscripcionCertificar/prop/"+b.numeroCaratula+"/"+b.foja+"/"+b.numero+"/"+b.ano+"/"+b.bis+"/"+b.fechaDocLong+"/"+b.rehaceImagen+"/"+b.idtipoFormulario+"/certificacion/")):a.setErr("data.msg",d.msg))},function(b){a.setErr("Problema contactando al servidor.","")})},a.verInscripcionCertificar=function(a){a.bis,console.log("url /verInscripcionCertificar/prop/"+a.caratula+"/"+a.foja+"/"+a.numero+"/"+a.ano+"/"+a.bis+"/"+a.fechaDocLong+"/"+a.idtipoFormulario+"/certificacion/"),c.go("/verInscripcionCertificar/prop/"+a.caratula+"/"+a.foja+"/"+a.numero+"/"+a.ano+"/"+a.bis+"/"+a.fechaDocLong+"/"+a.rehaceImagen+"/"+a.idtipoFormulario+"/certificacion/")},a.refrescar=function(){a.openLoadingModal("Actualizando...",""),h.obtenerCaratulasParaCertificar().then(function(b){a.closeModal(),null===b.status||(b.status?(a.busquedaCertificacion.data=b,a.busquedaCertificacion.resultados=b.resultado):a.setErr("data.msg",b.msg))},function(b){a.setErr("Problema contactando al servidor.","")})},a.loadMorePropiedad=function(){var b=a.busquedaIndice.resultados.slice(a.listaPropiedad.inicio,a.listaPropiedad.fin);angular.forEach(b,function(b){a.listaPropiedad.data.push(b)}),a.listaPropiedad.inicio=a.listaPropiedad.inicio+a.listaPropiedad.offset,a.listaPropiedad.fin=a.listaPropiedad.fin+a.listaPropiedad.offset},a.loadMoreProhibiciones=function(){var b=a.busquedaIndice.resultadosprohibiciones.slice(a.listaProhibiciones.inicio,a.listaProhibiciones.fin);angular.forEach(b,function(b){a.listaProhibiciones.data.push(b)}),a.listaProhibiciones.inicio=a.listaProhibiciones.inicio+a.listaProhibiciones.offset,a.listaProhibiciones.fin=a.listaProhibiciones.fin+a.listaProhibiciones.offset},a.loadMoreHipoteca=function(){var b=a.busquedaIndice.resultadoshipotecas.slice(a.listaHipoteca.inicio,a.listaHipoteca.fin);angular.forEach(b,function(b){a.listaHipoteca.data.push(b)}),a.listaHipoteca.inicio=a.listaHipoteca.inicio+a.listaHipoteca.offset,a.listaHipoteca.fin=a.listaHipoteca.fin+a.listaHipoteca.offset},a.loadMoreComercio=function(){var b=a.busquedaIndice.resultadoscomercio.slice(a.listaComercio.inicio,a.listaComercio.fin);angular.forEach(b,function(b){a.listaComercio.data.push(b)}),a.listaComercio.inicio=a.listaComercio.inicio+a.listaComercio.offset,a.listaComercio.fin=a.listaComercio.fin+a.listaComercio.offset},a.resolveModal={refresca:!1},a.resetResultadoCertificacion=function(){a.busquedaIndice.data=null,a.states.buscar.isError=!1,a.busquedaIndice.buscarPorInscricionHipo=!1,a.busquedaIndice.buscarPorInscricionProh=!1,void 0!==a.busquedaIndice.resultados&&(a.busquedaIndice.resultados.length=0),void 0!==a.busquedaIndice.resultadosprohibiciones&&(a.busquedaIndice.resultadosprohibiciones.length=0),void 0!==a.busquedaIndice.resultadoshipotecas&&(a.busquedaIndice.resultadoshipotecas.length=0),void 0!==a.busquedaIndice.resultadoscomercio&&(a.busquedaIndice.resultadoscomercio.length=0),void 0!==a.listaPropiedad.data&&(a.listaPropiedad.data.length=0),a.listaPropiedad.inicio=0,a.listaPropiedad.fin=a.listaPropiedad.offset,void 0!==a.listaProhibiciones.data&&(a.listaProhibiciones.data.length=0),a.listaProhibiciones.inicio=0,a.listaProhibiciones.fin=a.listaProhibiciones.offset,void 0!==a.listaHipoteca.data&&(a.listaHipoteca.data.length=0),a.listaHipoteca.inicio=0,a.listaHipoteca.fin=a.listaHipoteca.offset,void 0!==a.listaComercio.data&&(a.listaComercio.data.length=0),a.listaComercio.inicio=0,a.listaComercio.fin=a.listaComercio.offset},a.limpiarTitulo=function(){a.resetResultadoIndice(),a.busquedaIndice.foja=null,a.busquedaIndice.numero=null,a.busquedaIndice.ano=null,a.busquedaIndice.bis=!1,a.busquedaIndice.rut=null,a.busquedaIndice.nombre=null,a.busquedaIndice.direccion=null,a.busquedaIndice.comuna=null,a.busquedaIndice.anoInscripcion=null,a.busquedaIndice.acto=null,a.busquedaIndice.tipo=null,a.myform.$setPristine(!0),a.doFocus("rutt")},a.limpiar=function(){},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openLoadingModal=function(a,b){k.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.raiseErr=function(b,c,d){a.closeModal(),a.states[b].isError=!0,a.states[b].title=c,a.states[b].msg=d},a.resetStatus=function(){a.solicitudStatus.ok=!1,a.solicitudStatus.error=!1,a.solicitudStatus.warning=!1,a.solicitudStatus.msgTitle=null,a.solicitudStatus.msg=null},a.setErr=function(b,c){a.solicitudStatus.error=!0,a.setStatusMsg(b,c)},a.setStatusMsg=function(b,c){a.solicitudStatus.msgTitle=b,a.solicitudStatus.msg=c},a.archivoNacional=function(a){return!(a<c.aioParametros.anoArchivoNacional)},a.anoActual=function(a){return!(moment(new Date).year()<a)},a.closeModal=function(){var a=l.getTop();a&&l.dismiss(a.key)},a.caratulafuera={caratula:null,status:!1,muestra:!1},a.buscarCaratulaFuera=function(){var b=a.busquedaCertificacion.caratula;a.openLoadingModal("Buscando...",""),i.obtenerCaratula(b).then(function(b){a.closeModal(),null===b.status||(b.status?(a.states.buscar.isError=!1,a.caratulafuera.caratula=b.caratula,a.caratulafuera.status=b.status,a.caratulafuera.muestra=b.muestra):a.raiseErr("buscar","Problema detectado",b.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.verEstadoCaratula=function(a){k.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})}}]),app.controller("CertificacionHipotecasCtrl",["$scope","$timeout","$rootScope","$location","$anchorScroll","solicitudesModel","certificacionModel","certificacionHipotecasService","caratulaService","$filter","$modal","$modalStack",function(a,b,c,d,e,f,g,h,i,j,k,l){a.busquedaCertificacion=g.getBusquedaCertificacion(),a.states=g.getStates(),a.listaResumida=g.getListaResumida(),a.tab=f.getTab(),a.solicitudStatus={ok:!1,error:!1,warning:!1,msgTitle:null,msg:null,tipo:null},a.solicita={foja:null,numero:null,ano:null,bis:!1,tipo:null,esDigital:!1,tieneRechazo:!1},h.obtenerCaratulasParaCertificar().then(function(b){null===b.status||(b.status?(a.busquedaCertificacion.data=b,a.busquedaCertificacion.resultados=b.resultado):a.setErr("data.msg",b.msg))},function(b){a.setErr("Problema contactando al servidor.","")}),a.redistribuir=function(a){c.go("/distribucion/"+a+"/")},a.redistribuirCaratula=function(b){a.openLoadingModal("Redistribuyendo...",""),i.movercaratula(b.numeroCaratula,b.codSeccion).then(function(d){a.closeModal(),null===d.status||(d.status?(b.bis,c.go("/verInscripcionCertificarHipo/hipo/"+b.numeroCaratula+"/"+b.foja+"/"+b.numero+"/"+b.ano+"/"+b.bis+"/"+b.fechaDocLong+"/"+b.rehaceImagen+"/"+b.idtipoFormulario+"/certificacionHipotecas/")):a.setErr("data.msg",d.msg))},function(b){a.setErr("Problema contactando al servidor.","")})},a.verInscripcionCertificar=function(a){a.bis,c.go("/verInscripcionCertificarHipo/hipo/"+a.caratula+"/"+a.foja+"/"+a.numero+"/"+a.ano+"/"+a.bis+"/"+a.fechaDocLong+"/"+a.rehaceImagen+"/"+a.idtipoFormulario+"/certificacionHipotecas/")},a.refrescar=function(){a.openLoadingModal("Actualizando...",""),h.obtenerCaratulasParaCertificar().then(function(b){a.closeModal(),null===b.status||(b.status?(a.busquedaCertificacion.data=b,a.busquedaCertificacion.resultados=b.resultado):a.setErr("data.msg",b.msg))},function(b){a.setErr("Problema contactando al servidor.","")})},a.loadMorePropiedad=function(){var b=a.busquedaIndice.resultados.slice(a.listaPropiedad.inicio,a.listaPropiedad.fin);angular.forEach(b,function(b){a.listaPropiedad.data.push(b)}),a.listaPropiedad.inicio=a.listaPropiedad.inicio+a.listaPropiedad.offset,a.listaPropiedad.fin=a.listaPropiedad.fin+a.listaPropiedad.offset},a.loadMoreProhibiciones=function(){var b=a.busquedaIndice.resultadosprohibiciones.slice(a.listaProhibiciones.inicio,a.listaProhibiciones.fin);angular.forEach(b,function(b){a.listaProhibiciones.data.push(b)}),a.listaProhibiciones.inicio=a.listaProhibiciones.inicio+a.listaProhibiciones.offset,a.listaProhibiciones.fin=a.listaProhibiciones.fin+a.listaProhibiciones.offset},a.loadMoreHipoteca=function(){var b=a.busquedaIndice.resultadoshipotecas.slice(a.listaHipoteca.inicio,a.listaHipoteca.fin);angular.forEach(b,function(b){a.listaHipoteca.data.push(b)}),a.listaHipoteca.inicio=a.listaHipoteca.inicio+a.listaHipoteca.offset,a.listaHipoteca.fin=a.listaHipoteca.fin+a.listaHipoteca.offset},a.loadMoreComercio=function(){var b=a.busquedaIndice.resultadoscomercio.slice(a.listaComercio.inicio,a.listaComercio.fin);angular.forEach(b,function(b){a.listaComercio.data.push(b)}),a.listaComercio.inicio=a.listaComercio.inicio+a.listaComercio.offset,a.listaComercio.fin=a.listaComercio.fin+a.listaComercio.offset},a.resolveModal={refresca:!1},a.resetResultadoCertificacion=function(){a.busquedaIndice.data=null,a.states.buscar.isError=!1,a.busquedaIndice.buscarPorInscricionHipo=!1,a.busquedaIndice.buscarPorInscricionProh=!1,void 0!==a.busquedaIndice.resultados&&(a.busquedaIndice.resultados.length=0),void 0!==a.busquedaIndice.resultadosprohibiciones&&(a.busquedaIndice.resultadosprohibiciones.length=0),void 0!==a.busquedaIndice.resultadoshipotecas&&(a.busquedaIndice.resultadoshipotecas.length=0),void 0!==a.busquedaIndice.resultadoscomercio&&(a.busquedaIndice.resultadoscomercio.length=0),void 0!==a.listaPropiedad.data&&(a.listaPropiedad.data.length=0),a.listaPropiedad.inicio=0,a.listaPropiedad.fin=a.listaPropiedad.offset,void 0!==a.listaProhibiciones.data&&(a.listaProhibiciones.data.length=0),a.listaProhibiciones.inicio=0,a.listaProhibiciones.fin=a.listaProhibiciones.offset,void 0!==a.listaHipoteca.data&&(a.listaHipoteca.data.length=0),a.listaHipoteca.inicio=0,a.listaHipoteca.fin=a.listaHipoteca.offset,void 0!==a.listaComercio.data&&(a.listaComercio.data.length=0),a.listaComercio.inicio=0,a.listaComercio.fin=a.listaComercio.offset},a.limpiarTitulo=function(){a.resetResultadoIndice(),a.busquedaIndice.foja=null,a.busquedaIndice.numero=null,a.busquedaIndice.ano=null,a.busquedaIndice.bis=!1,a.busquedaIndice.rut=null,a.busquedaIndice.nombre=null,a.busquedaIndice.direccion=null,a.busquedaIndice.comuna=null,a.busquedaIndice.anoInscripcion=null,a.busquedaIndice.acto=null,a.busquedaIndice.tipo=null,a.myform.$setPristine(!0),a.doFocus("rutt")},a.limpiar=function(){},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openLoadingModal=function(a,b){k.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.raiseErr=function(b,c,d){a.closeModal(),a.states[b].isError=!0,a.states[b].title=c,a.states[b].msg=d},a.resetStatus=function(){a.solicitudStatus.ok=!1,a.solicitudStatus.error=!1,a.solicitudStatus.warning=!1,a.solicitudStatus.msgTitle=null,a.solicitudStatus.msg=null},a.setErr=function(b,c){a.solicitudStatus.error=!0,a.setStatusMsg(b,c)},a.setStatusMsg=function(b,c){a.solicitudStatus.msgTitle=b,a.solicitudStatus.msg=c},a.archivoNacional=function(a){return!(a<c.aioParametros.anoArchivoNacional)},a.anoActual=function(a){return!(moment(new Date).year()<a)},a.closeModal=function(){var a=l.getTop();a&&l.dismiss(a.key)},a.caratulafuera={caratula:null,status:!1,muestra:!1},a.buscarCaratulaFuera=function(){var b=a.busquedaCertificacion.caratula;a.openLoadingModal("Buscando...",""),i.obtenerCaratula(b).then(function(b){a.closeModal(),null===b.status||(b.status?(a.states.buscar.isError=!1,a.caratulafuera.caratula=b.caratula,a.caratulafuera.status=b.status,a.caratulafuera.muestra=b.muestra):a.raiseErr("buscar","Problema detectado",b.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.verEstadoCaratula=function(a){k.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})}}]),app.controller("CertificacionProhibicionesCtrl",["$scope","$timeout","$rootScope","$location","$anchorScroll","solicitudesModel","certificacionModel","certificacionProhibicionesService","caratulaService","$filter","$modal","$modalStack",function(a,b,c,d,e,f,g,h,i,j,k,l){a.busquedaCertificacion=g.getBusquedaCertificacion(),a.states=g.getStates(),a.listaResumida=g.getListaResumida(),a.tab=f.getTab(),a.solicitudStatus={ok:!1,error:!1,warning:!1,msgTitle:null,msg:null,tipo:null},a.solicita={foja:null,numero:null,ano:null,bis:!1,tipo:null,esDigital:!1,tieneRechazo:!1},h.obtenerCaratulasParaCertificar().then(function(b){null===b.status||(b.status?(a.busquedaCertificacion.data=b,a.busquedaCertificacion.resultados=b.resultado):a.setErr("data.msg",b.msg))},function(b){a.setErr("Problema contactando al servidor.","")}),a.redistribuir=function(a){c.go("/distribucion/"+a+"/")},a.redistribuirCaratula=function(b){a.openLoadingModal("Redistribuyendo...",""),i.movercaratula(b.numeroCaratula,b.codSeccion).then(function(d){a.closeModal(),null===d.status||(d.status?(b.bis,c.go("/verInscripcionCertificarProh/proh/"+b.numeroCaratula+"/"+b.foja+"/"+b.numero+"/"+b.ano+"/"+b.bis+"/"+b.fechaDocLong+"/"+b.rehaceImagen+"/"+b.idtipoFormulario+"/certificacionProhibiciones/")):a.setErr("data.msg",d.msg))},function(b){a.setErr("Problema contactando al servidor.","")})},a.verInscripcionCertificar=function(a){a.bis,c.go("/verInscripcionCertificarProh/proh/"+a.caratula+"/"+a.foja+"/"+a.numero+"/"+a.ano+"/"+a.bis+"/"+a.fechaDocLong+"/"+a.rehaceImagen+"/"+a.idtipoFormulario+"/certificacionProhibiciones/")},a.refrescar=function(){a.openLoadingModal("Actualizando...",""),h.obtenerCaratulasParaCertificar().then(function(b){a.closeModal(),null===b.status||(b.status?(a.busquedaCertificacion.data=b,a.busquedaCertificacion.resultados=b.resultado):a.setErr("data.msg",b.msg))},function(b){a.setErr("Problema contactando al servidor.","")})},a.loadMorePropiedad=function(){var b=a.busquedaIndice.resultados.slice(a.listaPropiedad.inicio,a.listaPropiedad.fin);angular.forEach(b,function(b){a.listaPropiedad.data.push(b)}),a.listaPropiedad.inicio=a.listaPropiedad.inicio+a.listaPropiedad.offset,a.listaPropiedad.fin=a.listaPropiedad.fin+a.listaPropiedad.offset},a.loadMoreProhibiciones=function(){var b=a.busquedaIndice.resultadosprohibiciones.slice(a.listaProhibiciones.inicio,a.listaProhibiciones.fin);angular.forEach(b,function(b){a.listaProhibiciones.data.push(b)}),a.listaProhibiciones.inicio=a.listaProhibiciones.inicio+a.listaProhibiciones.offset,a.listaProhibiciones.fin=a.listaProhibiciones.fin+a.listaProhibiciones.offset},a.loadMoreHipoteca=function(){var b=a.busquedaIndice.resultadoshipotecas.slice(a.listaHipoteca.inicio,a.listaHipoteca.fin);angular.forEach(b,function(b){a.listaHipoteca.data.push(b)}),a.listaHipoteca.inicio=a.listaHipoteca.inicio+a.listaHipoteca.offset,a.listaHipoteca.fin=a.listaHipoteca.fin+a.listaHipoteca.offset},a.loadMoreComercio=function(){var b=a.busquedaIndice.resultadoscomercio.slice(a.listaComercio.inicio,a.listaComercio.fin);angular.forEach(b,function(b){a.listaComercio.data.push(b)}),a.listaComercio.inicio=a.listaComercio.inicio+a.listaComercio.offset,a.listaComercio.fin=a.listaComercio.fin+a.listaComercio.offset},a.resolveModal={refresca:!1},a.resetResultadoCertificacion=function(){a.busquedaIndice.data=null,a.states.buscar.isError=!1,a.busquedaIndice.buscarPorInscricionHipo=!1,a.busquedaIndice.buscarPorInscricionProh=!1,void 0!==a.busquedaIndice.resultados&&(a.busquedaIndice.resultados.length=0),void 0!==a.busquedaIndice.resultadosprohibiciones&&(a.busquedaIndice.resultadosprohibiciones.length=0),void 0!==a.busquedaIndice.resultadoshipotecas&&(a.busquedaIndice.resultadoshipotecas.length=0),void 0!==a.busquedaIndice.resultadoscomercio&&(a.busquedaIndice.resultadoscomercio.length=0),void 0!==a.listaPropiedad.data&&(a.listaPropiedad.data.length=0),a.listaPropiedad.inicio=0,a.listaPropiedad.fin=a.listaPropiedad.offset,void 0!==a.listaProhibiciones.data&&(a.listaProhibiciones.data.length=0),a.listaProhibiciones.inicio=0,a.listaProhibiciones.fin=a.listaProhibiciones.offset,void 0!==a.listaHipoteca.data&&(a.listaHipoteca.data.length=0),a.listaHipoteca.inicio=0,a.listaHipoteca.fin=a.listaHipoteca.offset,void 0!==a.listaComercio.data&&(a.listaComercio.data.length=0),a.listaComercio.inicio=0,a.listaComercio.fin=a.listaComercio.offset},a.limpiarTitulo=function(){a.resetResultadoIndice(),a.busquedaIndice.foja=null,a.busquedaIndice.numero=null,a.busquedaIndice.ano=null,a.busquedaIndice.bis=!1,a.busquedaIndice.rut=null,a.busquedaIndice.nombre=null,a.busquedaIndice.direccion=null,a.busquedaIndice.comuna=null,a.busquedaIndice.anoInscripcion=null,a.busquedaIndice.acto=null,a.busquedaIndice.tipo=null,a.myform.$setPristine(!0),a.doFocus("rutt")},a.limpiar=function(){},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openLoadingModal=function(a,b){k.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.raiseErr=function(b,c,d){a.closeModal(),a.states[b].isError=!0,a.states[b].title=c,a.states[b].msg=d},a.resetStatus=function(){a.solicitudStatus.ok=!1,a.solicitudStatus.error=!1,a.solicitudStatus.warning=!1,a.solicitudStatus.msgTitle=null,a.solicitudStatus.msg=null},a.setErr=function(b,c){a.solicitudStatus.error=!0,a.setStatusMsg(b,c)},a.setStatusMsg=function(b,c){a.solicitudStatus.msgTitle=b,a.solicitudStatus.msg=c},a.archivoNacional=function(a){return!(a<c.aioParametros.anoArchivoNacional)},a.anoActual=function(a){return!(moment(new Date).year()<a)},a.closeModal=function(){var a=l.getTop();a&&l.dismiss(a.key)},a.caratulafuera={caratula:null,status:!1,muestra:!1},a.buscarCaratulaFuera=function(){var b=a.busquedaCertificacion.caratula;a.openLoadingModal("Buscando...",""),i.obtenerCaratula(b).then(function(b){a.closeModal(),null===b.status||(b.status?(a.states.buscar.isError=!1,a.caratulafuera.caratula=b.caratula,a.caratulafuera.status=b.status,a.caratulafuera.muestra=b.muestra):a.raiseErr("buscar","Problema detectado",b.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})}}]),app.controller("CertificacionEnParteCtrl",["$scope","$timeout","$rootScope","$location","$anchorScroll","solicitudesModel","certificacionModel","certificacionService","caratulaService","$filter","$modal","$modalStack",function(a,b,c,d,e,f,g,h,i,j,k,l){a.busquedaCertificacion=g.getBusquedaCertificacion(),a.states=g.getStates(),a.listaResumida=g.getListaResumida(),a.tab=f.getTab(),a.solicitudStatus={ok:!1,error:!1,warning:!1,msgTitle:null,msg:null,tipo:null},a.solicita={foja:null,numero:null,ano:null,bis:!1,tipo:null,esDigital:!1,tieneRechazo:!1},h.obtenerCaratulasParaCertificarEnParte().then(function(b){null===b.status||(b.status?(a.busquedaCertificacion.data=b,a.busquedaCertificacion.resultados=b.resultado):a.setErr("data.msg",b.msg))},function(b){a.setErr("Problema contactando al servidor.","")}),a.redistribuir=function(a){console.log("url /distribucion/"+a+"/"),c.go("/distribucion/"+a+"/")},a.redistribuirCaratula=function(b){a.openLoadingModal("Redistribuyendo...",""),a.closeModal(),b.bis,console.log("url /verInscripcionCertificar/prop/"+b.numeroCaratula+"/"+b.foja+"/"+b.numero+"/"+b.ano+"/"+b.bis+"/"+b.fechaDocLong+"/"+b.idtipoFormulario+"/certificacionenparte/"),c.go("/verInscripcionCertificar/prop/"+b.numeroCaratula+"/"+b.foja+"/"+b.numero+"/"+b.ano+"/"+b.bis+"/"+b.fechaDocLong+"/"+b.rehaceImagen+"/10/certificacionenparte/")},a.verInscripcionCertificar=function(a){a.bis,console.log("url /verInscripcionCertificar/prop/"+a.caratula+"/"+a.foja+"/"+a.numero+"/"+a.ano+"/"+a.bis+"/"+a.fechaDocLong+"/"+a.idtipoFormulario+"/certificacionenparte/"),c.go("/verInscripcionCertificar/prop/"+a.caratula+"/"+a.foja+"/"+a.numero+"/"+a.ano+"/"+a.bis+"/"+a.fechaDocLong+"/"+a.rehaceImagen+"/"+a.idtipoFormulario+"/certificacionenparte/")},a.refrescar=function(){a.openLoadingModal("Actualizando...",""),h.obtenerCaratulasParaCertificarEnParte().then(function(b){a.closeModal(),null===b.status||(b.status?(a.busquedaCertificacion.data=b,a.busquedaCertificacion.resultados=b.resultado):a.setErr("data.msg",b.msg))},function(b){a.setErr("Problema contactando al servidor.","")})},a.buscarIndice=function(){var b=a.busquedaIndice.foja,c=a.busquedaIndice.numero,d=a.busquedaIndice.ano,e=a.busquedaIndice.bis,f=a.busquedaIndice.rut,g=a.busquedaIndice.nombre,h=a.busquedaIndice.direccion,i=a.busquedaIndice.propiedades,j=a.busquedaIndice.hipoteca,k=a.busquedaIndice.prohibiciones,l=a.busquedaIndice.comercio,m=a.busquedaIndice.buscarPorInscricionHipo,n=a.busquedaIndice.buscarPorInscricionProh,o=a.busquedaIndice.exacta;if(m||n||a.resetResultadoIndice(),null!=a.busquedaIndice.comuna)var p=a.busquedaIndice.comuna.codigo;if(null!=a.busquedaIndice.anoInscripcion)var q=a.busquedaIndice.anoInscripcion.codigo;if(null!=a.busquedaIndice.acto)var r=a.busquedaIndice.acto.nombre;if(null!=a.busquedaIndice.tipo)var s=a.busquedaIndice.tipo.nombre;a.openLoadingModal("Buscando...",""),indiceService.getIndicePropiedades(f,g,h,b,c,d,e,p,q,r,s,o,i,j,k,l,m,n).then(function(b){a.closeModal(),null===b.status||(b.status?(a.busquedaIndice.data=b,b.aaDataComercio.length>0&&(m||n||(a.busquedaIndice.resultadoscomercio=b.aaDataComercio,a.loadMoreComercio(),a.activateParent(4))),b.aaDataHipotecas.length>0&&(n||(a.busquedaIndice.resultadoshipotecas=b.aaDataHipotecas,a.loadMoreHipoteca(),a.activateParent(3))),b.aaDataProhibiciones.length>0&&(m||(a.busquedaIndice.resultadosprohibiciones=b.aaDataProhibiciones,a.loadMoreProhibiciones(),a.activateParent(2))),b.aaData.length>0&&(m||n||(a.busquedaIndice.resultados=b.aaData,a.loadMorePropiedad(),a.activateParent(1)))):a.raiseErr("buscar","Problema detectado",b.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.loadMorePropiedad=function(){var b=a.busquedaIndice.resultados.slice(a.listaPropiedad.inicio,a.listaPropiedad.fin);angular.forEach(b,function(b){a.listaPropiedad.data.push(b)}),a.listaPropiedad.inicio=a.listaPropiedad.inicio+a.listaPropiedad.offset,a.listaPropiedad.fin=a.listaPropiedad.fin+a.listaPropiedad.offset},a.loadMoreProhibiciones=function(){var b=a.busquedaIndice.resultadosprohibiciones.slice(a.listaProhibiciones.inicio,a.listaProhibiciones.fin);angular.forEach(b,function(b){a.listaProhibiciones.data.push(b)}),a.listaProhibiciones.inicio=a.listaProhibiciones.inicio+a.listaProhibiciones.offset,a.listaProhibiciones.fin=a.listaProhibiciones.fin+a.listaProhibiciones.offset},a.loadMoreHipoteca=function(){var b=a.busquedaIndice.resultadoshipotecas.slice(a.listaHipoteca.inicio,a.listaHipoteca.fin);angular.forEach(b,function(b){a.listaHipoteca.data.push(b)}),a.listaHipoteca.inicio=a.listaHipoteca.inicio+a.listaHipoteca.offset,a.listaHipoteca.fin=a.listaHipoteca.fin+a.listaHipoteca.offset},a.loadMoreComercio=function(){var b=a.busquedaIndice.resultadoscomercio.slice(a.listaComercio.inicio,a.listaComercio.fin);angular.forEach(b,function(b){a.listaComercio.data.push(b)}),a.listaComercio.inicio=a.listaComercio.inicio+a.listaComercio.offset,a.listaComercio.fin=a.listaComercio.fin+a.listaComercio.offset},a.resolveModal={refresca:!1},a.resetResultadoCertificacion=function(){a.busquedaIndice.data=null,a.states.buscar.isError=!1,a.busquedaIndice.buscarPorInscricionHipo=!1,a.busquedaIndice.buscarPorInscricionProh=!1,void 0!==a.busquedaIndice.resultados&&(a.busquedaIndice.resultados.length=0),void 0!==a.busquedaIndice.resultadosprohibiciones&&(a.busquedaIndice.resultadosprohibiciones.length=0),void 0!==a.busquedaIndice.resultadoshipotecas&&(a.busquedaIndice.resultadoshipotecas.length=0),void 0!==a.busquedaIndice.resultadoscomercio&&(a.busquedaIndice.resultadoscomercio.length=0),void 0!==a.listaPropiedad.data&&(a.listaPropiedad.data.length=0),a.listaPropiedad.inicio=0,a.listaPropiedad.fin=a.listaPropiedad.offset,void 0!==a.listaProhibiciones.data&&(a.listaProhibiciones.data.length=0),a.listaProhibiciones.inicio=0,a.listaProhibiciones.fin=a.listaProhibiciones.offset,void 0!==a.listaHipoteca.data&&(a.listaHipoteca.data.length=0),a.listaHipoteca.inicio=0,a.listaHipoteca.fin=a.listaHipoteca.offset,void 0!==a.listaComercio.data&&(a.listaComercio.data.length=0),a.listaComercio.inicio=0,a.listaComercio.fin=a.listaComercio.offset},a.limpiarTitulo=function(){a.resetResultadoIndice(),a.busquedaIndice.foja=null,a.busquedaIndice.numero=null,a.busquedaIndice.ano=null,a.busquedaIndice.bis=!1,a.busquedaIndice.rut=null,a.busquedaIndice.nombre=null,a.busquedaIndice.direccion=null,a.busquedaIndice.comuna=null,a.busquedaIndice.anoInscripcion=null,a.busquedaIndice.acto=null,a.busquedaIndice.tipo=null,a.myform.$setPristine(!0),a.doFocus("rutt")},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openLoadingModal=function(a,b){k.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.raiseErr=function(b,c,d){a.closeModal(),a.states[b].isError=!0,a.states[b].title=c,a.states[b].msg=d},a.resetStatus=function(){a.solicitudStatus.ok=!1,a.solicitudStatus.error=!1,a.solicitudStatus.warning=!1,a.solicitudStatus.msgTitle=null,a.solicitudStatus.msg=null},a.setErr=function(b,c){a.solicitudStatus.error=!0,a.setStatusMsg(b,c)},a.setStatusMsg=function(b,c){a.solicitudStatus.msgTitle=b,a.solicitudStatus.msg=c},a.archivoNacional=function(a){return!(a<c.aioParametros.anoArchivoNacional)},a.anoActual=function(a){return!(moment(new Date).year()<a)},a.closeModal=function(){var a=l.getTop();a&&l.dismiss(a.key)},a.caratulafuera={caratula:null,status:!1,muestra:!1},a.buscarCaratulaFuera=function(){var b=a.busquedaCertificacion.caratula;a.openLoadingModal("Buscando...",""),i.obtenerCaratula(b).then(function(b){a.closeModal(),null===b.status||(b.status?(a.caratulafuera.caratula=b.caratula,a.caratulafuera.status=b.status,a.caratulafuera.muestra=b.muestra):a.raiseErr("buscar","Problema detectado",b.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})}}]),app.controller("CitadoModalCtrl",["$log","$rootScope","$scope","$modal","$modalInstance","$modalStack","$window","$timeout","data","estadoService",function(a,b,c,d,e,f,g,h,i,j){c.data=i,c.inscripcion=angular.copy(c.data.res.caratulaDTO.citadoDTOs[0]),c.listaRegistros=[{id:1,descripcion:"Propiedad"},{id:2,descripcion:"Hipotecas"},{id:3,descripcion:"Prohibiciones"},{id:4,descripcion:"Comercio"},{id:5,descripcion:"Aguas"}],c.cancel=function(){var a=f.getTop();a&&f.dismiss(a.key)},c.guardarDatosCitado=function(){c.openLoadingModal("Guardando...",""),j.cambiarInscripcion(c.data.req.numeroCaratula,c.inscripcion).then(function(a){c.closeModal(),null==a.status||(a.status?(c.data.res.caratulaDTO.citadoDTOs[0]=c.inscripcion,c.data.res.caratulaDTO.bitacoraDTOs.unshift(a.bitacoraDTO),c.closeModal(),c.openMensajeModal("success","Datos citado modificados exitosamente","",!1,null)):c.raiseErr(a.msg))},function(a){c.raiseErr("No se ha podido establecer comunicación con el servidor.")})},c.raiseErr=function(a){c.openMensajeModal("error",a,"",!1,null)},c.doFocus=function(a){c.$broadcast(a+"IsFocused")},c.openMensajeModal=function(a,b,e,f,g){d.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return b},detalle:function(){return e}}}),f&&h(function(){c.closeModal()},1e3*g)},c.openLoadingModal=function(a,b){d.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},c.closeModal=function(){var a=f.getTop();a&&f.dismiss(a.key)},h(function(){null==c.inscripcion.registroDTO?c.doFocus("registro"):c.doFocus("foja")},500)}]),app.controller("ComentariosCaratulaModalCtrl",["$scope","$modalInstance","$log","$timeout","$window","$rootScope","data","caratulaService",function(a,b,c,d,e,f,g,h){a.dataImagen=g,a.caratula={resultados:[]},h.obtenerBitacoraCaratula(a.dataImagen.numeroCaratula).then(function(b){null===b.status||(b.status?(a.caratula.resultados=b.listabitacoras,a.status=b.status,a.doFocus("buttonClose")):a.raiseErr("No se pudo obtener bitacora caratula",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")}),a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.states={isLoading:!1,isError:!1,isOk:!1,title:null,msg:null},a.close=function(){b.dismiss("cancel")},a.raiseErr=function(b,c){a.states.isError=!0,a.states.title=b,a.states.msg=c},a.raiseOk=function(b,c){a.states.isOk=!0,a.states.title=b,a.states.msg=c}}]),app.controller("ComentariosModalCtrl",["$scope","$timeout","$modalInstance","$modalStack","repertorios",function(a,b,c,d,e){a.repertorio=e,a.cancel=function(){c.dismiss("cancel")},a.raiseErr=function(b){a.openMensajeModal("error",b,"",!1,null)},b(function(){a.doFocus("buttonComenClose")},500),a.doFocus=function(b){a.$broadcast(b+"IsFocused")}}]),app.controller("ConsultaDiablitoCtrl",["$scope","$routeParams","$rootScope","$sce","$modal","$timeout","solicitudService","AnotacionService","inscripcionDigitalService","indiceService","digitalModel",function(a,b,c,d,e,f,g,h,i,j,k){a.hoy=moment().format("DD/MM/YYYY"),a.data={},a.errorObj={hay:!1,level:"warning",title:"",msg:""},a.parametros={borrador:b.borrador,folio:b.folio,caratula:b.caratula},a.paginacionMaster={currentPage:1,numPerPage:10,maxSize:10,filteredTodos:[],todos:[]},a.busquedaResumen={foja:null,numero:null,ano:null,bis:null,estado:null,data:null,predicate:null,reverse:null},a.isLoadingSolicitar=!1,a.statusSolicitar={ok:!1,error:!1},a.cerrar=function(){c.go("/home")},a.setSolicitarOK=function(){a.resetStatusSolicitar(),a.statusSolicitar.ok=!0,a.setSolicitarMsg("","")},a.setSolicitarError=function(b,c){a.resetStatusSolicitar(),a.statusSolicitar.error=!0,a.setSolicitarMsg(b,c)},a.resetStatusSolicitar=function(){a.statusSolicitar.ok=!1,a.statusSolicitar.error=!1,a.statusSolicitar.msgTitle="",a.statusSolicitar.msg=""},a.setSolicitarMsg=function(b,c){a.statusSolicitar.msgTitle=b,a.statusSolicitar.msg=c},a.raiseErr=function(b,c,d){a.errorObj.hay=!0,a.errorObj.level=b,a.errorObj.title=c,a.errorObj.msg=d},a.inicia=function(){a.isLoading=!0,i.getResumenNotas(a.parametros.caratula,a.parametros.borrador,a.parametros.folio).then(function(b){null==b.status||(b.status?(a.busquedaResumen.data=b,a.makeTodos(),a.isLoading=!1):a.raiseErr("error","Error detectado.",b.msg)),a.isLoading=!1},function(b){a.isLoading=!1,a.raiseErr("error","Error detectado.","No se ha podido establecer comunicación.")})},a.inicia(),a.verInscripcion=function(b){var d=1==b.bis;c.go("/verInscripcion/prop/"+b.foja+"/"+b.numero+"/"+b.ano+"/"+d+"/consultadiablito/0/"+a.parametros.caratula+"/"+a.parametros.borrador+"/"+a.parametros.folio)},a.verEstadoCaratula=function(a){e.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})},a.verRepertorio=function(a){e.open({templateUrl:"repertorioModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"RepertorioModalCtrl",size:"lg",resolve:{numeroRepertorio:function(){return parseInt(a)}}})},a.irGpOnlineAIO=function(a,b){e.open({templateUrl:"gpOnlineModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"gpOnlineModalCtrl",size:"lg",resolve:{borrador:function(){return parseInt(a)},folio:function(){return parseInt(b)}}})},a.makeTodos=function(){a.paginacionResumen=angular.copy(a.paginacionMaster),a.paginacionResumen.todos=a.busquedaResumen.data.anotaciones;var b=(a.paginacionResumen.currentPage-1)*a.paginacionResumen.numPerPage,c=b+a.paginacionResumen.numPerPage;a.paginacionResumen.filteredTodos=a.paginacionResumen.todos.slice(b,c)},a.$watch("filterExpr",function(b,c){if(void 0!=b&&void 0!=c){a.filtered=filterFilter(a.busquedaTareas.data.caratulas,b),a.paginacionResumen.todos=a.filtered,a.paginacionResumen.currentPage=1;var d=(a.paginacionResumen.currentPage-1)*a.paginacionResumen.numPerPage,e=d+a.paginacionResumen.numPerPage;a.paginacionResumen.filteredTodos=a.paginacionResumen.todos.slice(d,e)}},!0)}]),app.controller("CtaCteModalCtrl",["$log","$rootScope","$scope","$modal","$route","$modalInstance","$modalStack","$window","$timeout","ctaCte","mantenedorService",function(a,b,c,d,e,f,g,h,i,j,k){c.ctaCte={},void 0!=j&&angular.copy(j,c.ctaCte),c.cancel=function(){var a=g.getTop();a&&g.dismiss(a.key)},c.guardarCtaCte=function(){c.openLoadingModal("Guardando...",""),k.guardarCtaCte(JSON.stringify(c.ctaCte)).then(function(a){c.closeModal(),null===a.status||(a.status?(c.closeModal(),c.ctaCte.codigo?(c.openMensajeModal("success","Cuenta corriente actualizada exitosamente","",!1,null),angular.copy(c.ctaCte,j)):(c.openMensajeModal("success","Cuenta corriente ingresada exitosamente","",!1,null),i(function(){c.closeModal(),e.reload()},2e3))):c.raiseErr(a.msg))},function(a){c.raiseErr("No se ha podido establecer comunicación con el servidor.")})},c.raiseErr=function(a){c.openMensajeModal("error",a,"",!1,null)},c.doFocus=function(a){c.$broadcast(a+"IsFocused")},c.openMensajeModal=function(a,b,e,f,g){d.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return b},detalle:function(){return e}}}),f&&i(function(){c.closeModal()},1e3*g)},c.openLoadingModal=function(a,b){d.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},c.closeModal=function(){var a=g.getTop();a&&g.dismiss(a.key)},i(function(){c.doFocus("institucion")},500)}]),app.controller("DatosFormularioModalCtrl",["$log","$rootScope","$scope","$modal","$modalInstance","$modalStack","$window","$timeout","data","estadoService",function(a,b,c,d,e,f,g,h,i,j){switch(c.data=i,c.myv={},c.listaEstados=[{id:"p",descripcion:"En Proceso"},{id:"d",descripcion:"Despachada"},{id:"w",descripcion:"Auditoría"},{id:"d",descripcion:"Aprobada"}],c.data.res.caratulaDTO.datosFormularioDTO.estado){case"p":c.myv.estadoCaratula={id:"p",descripcion:"En Proceso"};break;case"d":c.myv.estadoCaratula={id:"d",descripcion:"Despachada"};break;case"w":c.myv.estadoCaratula={id:"w",descripcion:"Auditoria"}}c.cancel=function(){var a=f.getTop();a&&f.dismiss(a.key)},c.guardarEstadoFormulario=function(){c.openLoadingModal("Cambiando estado...",""),j.cambiarEstado(c.data.req.numeroCaratula,c.myv.estadoCaratula.id,c.myv.estadoCaratula.descripcion).then(function(a){c.closeModal(),null===a.status||(a.status?(c.data.res.caratulaDTO.datosFormularioDTO.estado=c.myv.estadoCaratula.id,c.data.res.caratulaDTO.bitacoraDTOs.unshift(a.bitacoraDTO),c.closeModal(),"Aprobada"==c.myv.estadoCaratula.descripcion&&c.refrescarEstados(),c.openMensajeModal("success","Estado carátula modificado exitosamente","",!1,null)):c.raiseErr(a.msg))},function(a){c.raiseErr("No se ha podido establecer comunicación con el servidor.")})},c.refrescarEstados=function(){j.getEstado(c.data.res.caratulaDTO.datosFormularioDTO.numeroCaratula).then(function(a){null===a.status||(a.status?(c.data.res.caratulaDTO.movimientoDTOs=a.res.caratulaDTO.movimientoDTOs,c.data.res.caratulaDTO.estadoActualDTO=a.res.caratulaDTO.estadoActualDTO):c.raiseErr(a.msg))},function(a){c.raiseErr("No se ha podido establecer comunicación con el servidor.")})},c.raiseErr=function(a){c.openMensajeModal("error",a,"",!1,null)},c.doFocus=function(a){c.$broadcast(a+"IsFocused")},c.openMensajeModal=function(a,b,e,f,g){d.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return b},detalle:function(){return e}}}),f&&h(function(){c.closeModal()},1e3*g)},c.openLoadingModal=function(a,b){d.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},c.closeModal=function(){var a=f.getTop();a&&f.dismiss(a.key)},h(function(){c.doFocus("estado")},500)}]),app.controller("DesbloqueoCtrl",["$scope","$rootScope","$timeout","localStorageService","$log","$modal","$modalStack","$routeParams","desbloqueoService",function(a,b,c,d,e,f,g,h,i){a.req={foja:null,numero:null,ano:null,bis:null},a.buscar=function(){a.openLoadingModal("Buscando...",""),i.buscar(a.req).then(function(b){a.closeModal(),null===b.estado||(b.estado?a.data=b:(a.raiseErr(b.msg),a.limpiar()))},function(b){a.raiseErr("No se ha podido establecer comunicacion con el servidor.")})},a.desbloquear=function(b){a.openLoadingModal("Desbloqueando...",""),i.desbloquear(b,JSON.stringify(a.data.listaSolicitudes)).then(function(b){a.closeModal(),null===b.estado||(b.estado?a.data.listaSolicitudes=b.listaSolicitudes:a.raiseErr(b.msg))},function(b){a.raiseErr("No se ha podido establecer comunicacion con el servidor.")})},a.limpiar=function(){a.reset(),a.req.foja=null,a.req.numero=null,a.req.ano=null,a.req.bis=null,a.doFocus("foja")},a.reset=function(){a.data={}},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.raiseErr=function(b){a.openMensajeModal("error",b,"",!1,null)},a.raiseSuccess=function(b){a.openMensajeModal("success",b,"",!1,null)},a.openMensajeModal=function(b,d,e,g,h){f.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return b},titulo:function(){return d},detalle:function(){return e}}}),g&&c(function(){a.closeModal()},1e3*h)},a.openLoadingModal=function(a,b){f.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.openRechazoModal=function(){var b={numeroCaratula:a.req.numeroCaratula};f.open({templateUrl:"rechazoModal.html",backdrop:"static",keyboard:!1,windowClass:"modal",controller:"RechazoModalCtrl",resolve:{dataRechazo:function(){return b}}})},a.closeModal=function(){var a=g.getTop();a&&g.dismiss(a.key)},a.stringIsNumber=function(a){return(+a).toString()===a},void 0!==h.foja&&void 0!==h.numero&&void 0!==h.ano&&a.stringIsNumber(h.foja)&&a.stringIsNumber(h.numero)&&a.stringIsNumber(h.ano)&&(a.req.foja=h.foja,a.req.numero=h.numero,a.req.ano=h.ano,c(function(){console.log("buscar por parametros"),a.buscar()},500)),c(function(){a.doFocus("foja")},500)}]),app.controller("DespachoCuadernilloCtrl",["$scope","$timeout","$rootScope","$location","inscripcionDigitalService","$modal","$modalStack","$routeParams","filterFilter",function(a,b,c,d,e,f,g,h,i){a.fechahoy=(new Date).toJSON().split("T")[0],a.despachoCuadernillo={resultados:[],fechaDesde:a.fechahoy,fechaHasta:a.fechahoy},a.paginacionMaster={currentPage:1,numPerPage:10,maxSize:10,todos:[]},a.paginacion=angular.copy(a.paginacionMaster),a.paginacion.todos=a.despachoCuadernillo.resultados,a.buscar=function(){e.getDespachoCuadernillos(a.despachoCuadernillo.fechaDesde,a.despachoCuadernillo.fechaHasta).then(function(b){null===b.status||(b.status?(a.despachoCuadernillo.resultados=b.listaCuadernillos,a.despachoCuadernillo.data=b,angular.forEach(a.despachoCuadernillo.resultados,function(a){a.selected=!1}),a.makeTodos(a.despachoCuadernillo.resultados)):a.setErr("data.msg","data.msg"))},function(b){a.setErr("Problema contactando al servidor.","")})},a.asignarUsuario=function(b){var c=[];angular.forEach(a.paginacion.todos,function(a,b){a.selected&&c.push(a.id)}),a.openLoadingModal("Reasignando cuadernillos",""),e.reasignarCuadernillos(JSON.stringify(c),b).then(function(b){a.closeModal(),null===b.status||(b.status?a.openMensajeModal("success","Todos los cuadernillos fueron reasignados","",!0,3):a.openMensajeModal("error","No se pudieron reasignar todos los cuadernillos","",!0,3)),angular.forEach(a.paginacion.todos,function(a){a.selected&&angular.forEach(b.listaOK,function(b){a.id==b.id&&(a.selected=!1,a.usuario=b.usuario,a.fecha=b.fecha)})}),a.validarSelected()},function(b){a.closeModal(),cuadernillosError++})},a.buscar(),a.limpiar=function(){a.despachoCuadernillo.fechaDesde=null,a.despachoCuadernillo.fechaHasta=null,a.despachoCuadernillo.resultados=null,a.formListaCuadernillo.$setPristine(!0)},a.openLoadingModal=function(a,b){f.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.openMensajeModal=function(c,d,e,g,h){var i=f.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return c},titulo:function(){return d},detalle:function(){return e}}});g&&b(function(){a.closeModal()},1e3*h),i.result.then(function(){a.doFocus("caratula")},function(){a.doFocus("caratula")})},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.closeModal=function(){var a=g.getTop();a&&g.dismiss(a.key)},a.raiseErr=function(b,c,d){a.closeModal(),a.states[b].isError=!0,a.states[b].title=c,a.states[b].msg=d},a.makeTodos=function(b){a.paginacion=angular.copy(a.paginacionMaster),a.paginacion.todos=b,a.filtrar()},a.validarSelected=function(){a.paginacion.todos.length>0&&(a.someSelected=!1,a.allSelected=!0,angular.forEach(a.paginacion.todos,function(b){a.someSelected=a.someSelected||b.selected,a.allSelected=a.allSelected&&b.selected}))},a.checkAll=function(){a.allSelected?a.allSelected=!1:a.allSelected=!0,a.someSelected=a.allSelected,angular.forEach(a.paginacion.todos,function(b){b.selected=a.allSelected})},a.$watch("filterExpr",function(b,c){a.filtrar(),a.validarSelected()},!0),a.filtrar=function(){a.filtered=i(a.despachoCuadernillo.resultados,a.filterExpr),a.paginacion.todos=a.filtered,a.paginacion.currentPage=1}}]),app.controller("DigitalCtrl",["$rootScope","$scope","$timeout","$location","digitalModel","$filter","$modal","$modalStack","inscripcionDigitalService","solicitudService",function(a,b,c,d,e,f,g,h,i,j){b.tab=e.getTab(),b.busquedaTitulo=e.getBusquedaTitulo(),b.busquedaMis=e.getBusquedaMis(),b.states=e.getStates(),b.listaMis={data:[],inicio:0,fin:15,offset:15},b.resolveModal={refresca:!1,origen:"digital"},b.solicita={foja:null,numero:null,ano:null,bis:!1,origen:"digital",consultaDocumentoDTO:{},estado:{},solicitudDTO:null},b.$watchCollection("resolveModal",function(){b.resolveModal.refresca&&b.buscarMis(!1)}),b.promiseUpdateSolicitudMis=null,b.isActiveParent=function(a){return b.tab.parentActive===a},b.activateParent=function(a){b.tab.parentActive=a,e.setTab(b.tab),1===b.tab.parentActive?c(function(){b.doFocus("foja")},200):2===b.tab.parentActive&&(void 0!==b.busquedaMis.resultados&&0!==b.busquedaMis.resultados.length||b.buscarMis(!0))},b.verTitulo=function(b){var c=1==b.bis;a.go("/verInscripcion/prop/"+b.foja+"/"+b.numero+"/"+b.ano+"/"+c+"/digital")},b.limpiarTitulo=function(){b.busquedaTitulo.foja=null,b.busquedaTitulo.numero=null,b.busquedaTitulo.ano=null,b.busquedaTitulo.bis=!1,b.myform.$setPristine(!0),b.doFocus("foja")},b.esMalCitadaDesde=function(){return!b.solicita.estado.fna&&b.busquedaTitulo.ano>=a.aioParametros.anoDigitalPropiedades},b.buscarTitulo=function(){var a=b.busquedaTitulo.foja,c=b.busquedaTitulo.numero,d=b.busquedaTitulo.ano,f=b.busquedaTitulo.bis,g=!0===b.busquedaTitulo.bis?1:0;b.states.titulo.isLoading=!0,b.openLoadingModal("Buscando...",""),i.getInscripcion(a,c,d,f).then(function(f){b.closeModal(),null===f.status||(f.status?(b.solicita.foja=f.inscripcionDigitalDTO.foja,b.solicita.numero=f.inscripcionDigitalDTO.numero,b.solicita.ano=f.inscripcionDigitalDTO.ano,b.solicita.bis=f.inscripcionDigitalDTO.bis,b.solicita.consultaDocumentoDTO=f.consultaDocumentoDTO,b.solicita.estado=f.estado,f.estado.tieneRechazo?(b.solicita.solicitudDTO=f.solicitudDTO,b.openSolicitar()):!f.consultaDocumentoDTO.hayDocumento&&!b.esMalCitadaDesde()||f.consultaDocumentoDTO.hayDocumento&&(9===f.consultaDocumentoDTO.tipoDocumento||10===f.consultaDocumentoDTO.tipoDocumento)?b.openSolicitar():f.consultaDocumentoDTO.hayDocumento&&8===f.consultaDocumentoDTO.tipoDocumento?(e.setDataState(f),b.verTitulo({foja:a,numero:c,ano:d,bis:g})):b.verTitulo({foja:a,numero:c,ano:d,bis:g})):b.raiseErr("titulo","Problema detectado",f.msg))},function(a){b.openMensajeModal("error","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.openSolicitar=function(){b.$broadcast("sfojaIsFocused"),g.open({templateUrl:"digitalModal.html",backdrop:!0,windowClass:"modal",controller:"DigitalModalCtrl",resolve:{solicita:function(){return b.solicita},servicio:function(){return j},origen:function(){return b.solicita.origen}}})},b.openSolicitarMis=function(){b.resolveModal.refresca=!1;g.open({templateUrl:"solicitarModal.html",backdrop:!0,windowClass:"modal",controller:"SolicitarModalCtrl",resolve:{resolveModal:function(){return b.resolveModal},servicio:function(){return j}}})},b.openLoadingModal=function(a,b){g.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},b.openMensajeModal=function(a,c,d){b.closeModal(),g.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,size:"sm",windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return c},detalle:function(){return d}}})},b.columnSortMis=function(a){b.busquedaMis.sorter.reverse=b.busquedaMis.sorter.predicate==a&&!b.busquedaMis.sorter.reverse,b.busquedaMis.sorter.predicate=a},b.resetResultadoMis=function(){void 0!==b.busquedaMis.resultados&&(b.busquedaMis.resultados.length=0),void 0!==b.listaMis.data&&(b.listaMis.data.length=0),b.busquedaMis.data=null,b.busquedaMis.fecha=null,b.listaMis.inicio=0,b.listaMis.fin=b.listaMis.offset,b.cleanErr("mis")},b.buscarMis=function(a){b.resetResultadoMis(),a&&b.openLoadingModal("Obteniendo solicitudes...",""),j.getByUserInSession().then(function(c){a&&b.closeModal(),null===c.status||(c.status?(b.busquedaMis.fecha=new Date,b.busquedaMis.data=c,b.busquedaMis.resultados=f("orderBy")(c.aaData,"idSolicitud",!0)):b.raiseErr("mis","Problema detectado",c.msg))},function(a){b.raiseErr("mis","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.loadMoreMis=function(){var a=b.busquedaMis.resultados.slice(b.listaMis.inicio,b.listaMis.fin);angular.forEach(a,function(a){b.listaMis.data.push(a)}),b.listaMis.inicio=b.listaMis.inicio+b.listaMis.offset,b.listaMis.fin=b.listaMis.fin+b.listaMis.offset},b.hayDataEnTablaMis=function(){var a=f("filter")(b.busquedaMis.resultados,b.isSolicitudRevisada,!0);return void 0!==a&&a.length>0},b.accionSolicitud=function(a,c){if(5==c.estadoDTO.idEstado){var d=1==c.bis;b.verTitulo({foja:c.foja,numero:c.numero,ano:c.ano,bis:d})}else{var e="";2==c.estadoDTO.idEstado?e="remove-ok":3==c.estadoDTO.idEstado&&(e="remove-rechazo"),b[a]=j.actualizar(c.idSolicitud,e),b[a].then(function(a){if(null==a.status);else if(a.status&&(c.fechaEstado=a.fechaEstado,c.estadoDTO={idEstado:a.idEstado,descripcion:a.descripcionEstado},"remove-ok"==e)){var d=1==c.bis;b.verTitulo({foja:c.foja,numero:c.numero,ano:c.ano,bis:d})}},function(a){})}},b.doFocus=function(a){b.$broadcast(a+"IsFocused")},b.raiseErr=function(a,c,d){b.closeModal(),b.states[a].isError=!0,b.states[a].title=c,b.states[a].msg=d},b.cleanErr=function(a){b.states[a].isError=!1,b.states[a].title="",b.states[a].msg=""},b.closeModal=function(){var a=h.getTop();a&&h.dismiss(a.key)},b.isSolicitudRevisada=function(a){return 6!==a.estadoDTO.idEstado},b.archivoNacional=function(b){return!(b<a.aioParametros.anoArchivoNacional)},b.anoActual=function(a){return!(moment(new Date).year()<a)},c(function(){1===b.tab.parentActive?b.doFocus("foja"):b.tab.parentActive},200)}]),app.controller("DigitalHipotecasCtrl",["$rootScope","$scope","$timeout","$location","digitalHipotecasModel","$filter","$modal","$modalStack","inscripcionDigitalHipotecasService","solicitudHipotecasService",function(a,b,c,d,e,f,g,h,i,j){b.tab=e.getTab(),b.busquedaTitulo=e.getBusquedaTitulo(),b.busquedaMis=e.getBusquedaMis(),b.states=e.getStates(),b.listaMis={data:[],inicio:0,fin:15,offset:15},b.resolveModal={refresca:!1,origen:"digital"},b.solicita={foja:null,numero:null,ano:null,bis:!1,origen:"digitalHipotecas",consultaDocumentoDTO:{},estado:{}},b.$watchCollection("resolveModal",function(){b.resolveModal.refresca&&b.buscarMis(!1)}),b.promiseUpdateSolicitudMis=null,b.isActiveParent=function(a){return b.tab.parentActive===a},b.activateParent=function(a){b.tab.parentActive=a,e.setTab(b.tab),1===b.tab.parentActive?c(function(){b.doFocus("foja")},200):2===b.tab.parentActive&&(void 0!==b.busquedaMis.resultados&&0!==b.busquedaMis.resultados.length||b.buscarMis(!0))},b.verTitulo=function(c){var d=1==c.bis;a.go("/verInscripcion/hip/"+c.foja+"/"+c.numero+"/"+c.ano+"/"+d+"/"+b.solicita.origen)},b.limpiarTitulo=function(){b.busquedaTitulo.foja=null,b.busquedaTitulo.numero=null,b.busquedaTitulo.ano=null,b.busquedaTitulo.bis=!1,b.myform.$setPristine(!0),b.doFocus("foja")},b.esMalCitadaDesde=function(){return!b.solicita.estado.fna&&b.busquedaTitulo.ano>=a.aioParametros.anoDigitalHipotecas},b.buscarTitulo=function(){var a=b.busquedaTitulo.foja,c=b.busquedaTitulo.numero,d=b.busquedaTitulo.ano,f=b.busquedaTitulo.bis,g=!0===b.busquedaTitulo.bis?1:0;b.states.titulo.isLoading=!0,b.openLoadingModal("Buscando...",""),i.getInscripcion(a,c,d,f).then(function(f){b.closeModal(),null===f.status||(f.status?(b.solicita.foja=f.inscripcionDigitalDTO.foja,b.solicita.numero=f.inscripcionDigitalDTO.numero,b.solicita.ano=f.inscripcionDigitalDTO.ano,b.solicita.bis=f.inscripcionDigitalDTO.bis,b.solicita.consultaDocumentoDTO=f.consultaDocumentoDTO,b.solicita.estado=f.estado,f.estado.tieneRechazo?b.openSolicitar():!f.consultaDocumentoDTO.hayDocumento&&!b.esMalCitadaDesde()||f.consultaDocumentoDTO.hayDocumento&&(9===f.consultaDocumentoDTO.tipoDocumento||10===f.consultaDocumentoDTO.tipoDocumento)?b.openSolicitar():f.consultaDocumentoDTO.hayDocumento&&8===f.consultaDocumentoDTO.tipoDocumento?(e.setDataState(f),b.verTitulo({foja:a,numero:c,ano:d,bis:g})):b.verTitulo({foja:a,numero:c,ano:d,bis:g})):b.raiseErr("titulo","Problema detectado",f.msg))},function(a){b.openMensajeModal("error","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.openSolicitar=function(){b.$broadcast("sfojaIsFocused"),g.open({templateUrl:"digitalModal.html",backdrop:!0,windowClass:"modal",controller:"DigitalModalCtrl",resolve:{solicita:function(){return b.solicita},servicio:function(){return j},origen:function(){return b.solicita.origen}}})},b.openSolicitarMis=function(){b.resolveModal.refresca=!1;g.open({templateUrl:"solicitarModal.html",backdrop:!0,windowClass:"modal",controller:"SolicitarModalCtrl",resolve:{resolveModal:function(){return b.resolveModal},servicio:function(){return j}}})},b.openLoadingModal=function(a,b){g.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},b.openMensajeModal=function(a,c,d){b.closeModal(),g.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,size:"sm",windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return c},detalle:function(){return d}}})},b.columnSortMis=function(a){b.busquedaMis.sorter.reverse=b.busquedaMis.sorter.predicate==a&&!b.busquedaMis.sorter.reverse,b.busquedaMis.sorter.predicate=a},b.resetResultadoMis=function(){void 0!==b.busquedaMis.resultados&&(b.busquedaMis.resultados.length=0),void 0!==b.listaMis.data&&(b.listaMis.data.length=0),b.busquedaMis.data=null,b.busquedaMis.fecha=null,b.listaMis.inicio=0,b.listaMis.fin=b.listaMis.offset,b.cleanErr("mis")},b.buscarMis=function(a){b.resetResultadoMis(),a&&b.openLoadingModal("Obteniendo solicitudes...",""),j.getByUserInSession().then(function(c){a&&b.closeModal(),null===c.status||(c.status?(b.busquedaMis.fecha=new Date,b.busquedaMis.data=c,b.busquedaMis.resultados=f("orderBy")(c.aaData,"idSolicitud",!0)):b.raiseErr("mis","Problema detectado",c.msg))},function(a){b.raiseErr("mis","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.loadMoreMis=function(){var a=b.busquedaMis.resultados.slice(b.listaMis.inicio,b.listaMis.fin);angular.forEach(a,function(a){b.listaMis.data.push(a)}),b.listaMis.inicio=b.listaMis.inicio+b.listaMis.offset,b.listaMis.fin=b.listaMis.fin+b.listaMis.offset},b.hayDataEnTablaMis=function(){var a=f("filter")(b.busquedaMis.resultados,b.isSolicitudRevisada,!0);return void 0!==a&&a.length>0},b.accionSolicitud=function(a,c){if(5==c.estadoDTO.idEstado){var d=1==c.bis;b.verTitulo({foja:c.foja,numero:c.numero,ano:c.ano,bis:d})}else{var e="";2==c.estadoDTO.idEstado?e="remove-ok":3==c.estadoDTO.idEstado&&(e="remove-rechazo"),b[a]=j.actualizar(c.idSolicitud,e),b[a].then(function(a){if(null==a.status);else if(a.status&&(c.fechaEstado=a.fechaEstado,c.estadoDTO={idEstado:a.idEstado,descripcion:a.descripcionEstado},"remove-ok"==e)){var d=1==c.bis;b.verTitulo({foja:c.foja,numero:c.numero,ano:c.ano,bis:d})}},function(a){})}},b.doFocus=function(a){b.$broadcast(a+"IsFocused")},b.raiseErr=function(a,c,d){b.closeModal(),b.states[a].isError=!0,b.states[a].title=c,b.states[a].msg=d},b.cleanErr=function(a){b.states[a].isError=!1,b.states[a].title="",b.states[a].msg=""},b.closeModal=function(){var a=h.getTop();a&&h.dismiss(a.key)},b.isSolicitudRevisada=function(a){return 6!==a.estadoDTO.idEstado&&5!==a.estadoDTO.idEstado},b.archivoNacional=function(b){return!(b<a.aioParametros.anoArchivoNacional)},b.anoActual=function(a){return!(moment(new Date).year()<a)},c(function(){1===b.tab.parentActive?b.doFocus("foja"):b.tab.parentActive},200)}]),app.controller("DigitalModalCtrl",["$rootScope","$scope","$modalStack","$modalInstance","$window","$log","solicita","$timeout","servicio","origen",function(a,b,c,d,e,f,g,h,i,j){b.verObj={foja:g.foja,numero:g.numero,ano:g.ano,bis:g.bis},b.solicitudStatus={ok:!1,error:!1,warning:!1,msgTitle:null,msg:null},b.isLoadingSolicitar=!1,b.solicita=g,b.solicitar=function(){b.resetStatus(),b.isLoadingSolicitar=!0,i.saveSingle(g.foja,g.numero,g.ano,g.bis).then(function(a){null===a.status?e.location.href=e.location.protocol+"//"+e.location.host+e.location.pathname:a.status?(b.solicitudStatus.ok=!0,b.solicita.consultaDocumentoDTO.hayDocumento?b.isLoadingSolicitar=!1:h(function(){b.cancel()},2e3)):(b.isLoadingSolicitar=!1,b.setErr("Problema detectado.","No se ha guardado la solicitud."))},function(a){b.isLoadingSolicitar=!1,b.setErr("Problema contactando al servidor.","No se ha guardado la solicitud.")})},b.cancel=function(){var a=c.getTop();a&&c.dismiss(a.key)},b.limpiar=function(){b.resetSolicita(),b.resetStatus(),b.resetVerObj(),b.$broadcast("sfojaIsFocused")},b.archivoNacional=function(b){return!(b<a.aioParametros.anoArchivoNacional)},b.anoActual=function(a){return!(moment(new Date).year()<a)},b.verInscripcion=function(){"digitalProhibiciones"==j?a.go("/verInscripcion/proh/"+b.verObj.foja+"/"+b.verObj.numero+"/"+b.verObj.ano+"/"+b.verObj.bis+"/"+j):"digitalHipotecas"==j?a.go("/verInscripcion/hip/"+b.verObj.foja+"/"+b.verObj.numero+"/"+b.verObj.ano+"/"+b.verObj.bis+"/"+j):a.go("/verInscripcion/prop/"+b.verObj.foja+"/"+b.verObj.numero+"/"+b.verObj.ano+"/"+b.verObj.bis+"/"+j)},b.setErr=function(a,c){b.solicitudStatus.error=!0,b.solicitudStatus.msgTitle=a,b.solicitudStatus.msg=c},b.resetStatus=function(){b.solicitudStatus.ok=!1,b.solicitudStatus.error=!1,b.solicitudStatus.warning=!1,b.solicitudStatus.msgTitle=null,b.solicitudStatus.msg=null},b.resetVerObj=function(){b.verObj.foja=null,b.verObj.numero=null,b.verObj.ano=null,b.verObj.bis=!1},b.resetSolicita=function(){b.solicita.foja=null,b.solicita.numero=null,b.solicita.ano=null,b.solicita.bis=!1,b.solicita.tipo=null,b.solicita.estado={},b.solicita.consultaDocumentoDTO={}},b.tieneRechazo=function(){return b.solicita.estado.tieneRechazo},b.esSolicitableSinImagen=function(){return!b.solicita.estado.tieneRechazo&&!b.solicita.consultaDocumentoDTO.hayDocumento},b.esSolicitableConImagen=function(){return!b.solicita.estado.tieneRechazo&&b.solicita.consultaDocumentoDTO.hayDocumento&&(9===b.solicita.consultaDocumentoDTO.tipoDocumento||10===b.solicita.consultaDocumentoDTO.tipoDocumento)},b.esVersionado=function(){return!b.solicita.estado.tieneRechazo&&b.solicita.consultaDocumentoDTO.hayDocumento&&8===b.solicita.consultaDocumentoDTO.tipoDocumento},b.existeIndice=function(){return"digitalProhibiciones"==j&&(!b.solicita.estado.fna&&!b.solicita.consultaDocumentoDTO.hayDocumento)},h(function(){b.$broadcast("sfojaIsFocused")},100)}]),app.controller("DigitalProhibicionesCtrl",["$rootScope","$scope","$timeout","$location","digitalProhibicionesModel","$filter","$modal","$modalStack","inscripcionDigitalProhibicionesService","solicitudProhibicionesService",function(a,b,c,d,e,f,g,h,i,j){b.tab=e.getTab(),b.busquedaTitulo=e.getBusquedaTitulo(),b.busquedaMis=e.getBusquedaMis(),b.states=e.getStates(),b.listaMis={data:[],inicio:0,fin:15,offset:15},b.resolveModal={refresca:!1,origen:"digital"},b.solicita={foja:null,numero:null,ano:null,bis:!1,origen:"digitalProhibiciones",consultaDocumentoDTO:{},estado:{}},b.$watchCollection("resolveModal",function(){b.resolveModal.refresca&&b.buscarMis(!1)}),b.promiseUpdateSolicitudMis=null,b.isActiveParent=function(a){return b.tab.parentActive===a},b.activateParent=function(a){b.tab.parentActive=a,e.setTab(b.tab),1===b.tab.parentActive?c(function(){b.doFocus("foja")},200):2===b.tab.parentActive&&(void 0!==b.busquedaMis.resultados&&0!==b.busquedaMis.resultados.length||b.buscarMis(!0))},b.verTitulo=function(c){var d=1==c.bis;a.go("/verInscripcion/proh/"+c.foja+"/"+c.numero+"/"+c.ano+"/"+d+"/"+b.solicita.origen)},b.limpiarTitulo=function(){b.busquedaTitulo.foja=null,b.busquedaTitulo.numero=null,b.busquedaTitulo.ano=null,b.busquedaTitulo.bis=!1,b.myform.$setPristine(!0),b.doFocus("foja")},b.esMalCitadaDesde=function(){return!b.solicita.estado.fna&&b.busquedaTitulo.ano>=a.aioParametros.anoDigitalProhibiciones&&b.busquedaTitulo.foja>=a.aioParametros.fojasDigitalProhibiciones},b.buscarTitulo=function(){var a=b.busquedaTitulo.foja,c=b.busquedaTitulo.numero,d=b.busquedaTitulo.ano,f=b.busquedaTitulo.bis,g=!0===b.busquedaTitulo.bis?1:0;b.states.titulo.isLoading=!0,b.openLoadingModal("Buscando...",""),i.getInscripcion(a,c,d,f).then(function(f){b.closeModal(),null===f.status||(f.status?(b.solicita.foja=f.inscripcionDigitalDTO.foja,b.solicita.numero=f.inscripcionDigitalDTO.numero,b.solicita.ano=f.inscripcionDigitalDTO.ano,b.solicita.bis=f.inscripcionDigitalDTO.bis,b.solicita.consultaDocumentoDTO=f.consultaDocumentoDTO,b.solicita.estado=f.estado,f.estado.tieneRechazo?b.openSolicitar():!f.consultaDocumentoDTO.hayDocumento&&!b.esMalCitadaDesde()||f.consultaDocumentoDTO.hayDocumento&&(9===f.consultaDocumentoDTO.tipoDocumento||10===f.consultaDocumentoDTO.tipoDocumento)?b.openSolicitar():f.consultaDocumentoDTO.hayDocumento&&8===f.consultaDocumentoDTO.tipoDocumento?(e.setDataState(f),b.verTitulo({foja:a,numero:c,ano:d,bis:g})):b.verTitulo({foja:a,numero:c,ano:d,bis:g})):b.raiseErr("titulo","Problema detectado",f.msg))},function(a){b.openMensajeModal("error","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.openSolicitar=function(){b.$broadcast("sfojaIsFocused"),g.open({templateUrl:"digitalModal.html",backdrop:!0,windowClass:"modal",controller:"DigitalModalCtrl",resolve:{solicita:function(){return b.solicita},servicio:function(){return j},origen:function(){return b.solicita.origen}}})},b.openSolicitarMis=function(){b.resolveModal.refresca=!1;g.open({templateUrl:"solicitarModal.html",backdrop:!0,windowClass:"modal",controller:"SolicitarModalCtrl",resolve:{resolveModal:function(){return b.resolveModal},servicio:function(){return j}}})},b.openLoadingModal=function(a,b){g.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},b.openMensajeModal=function(a,c,d){b.closeModal(),g.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,size:"sm",windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return c},detalle:function(){return d}}})},b.columnSortMis=function(a){b.busquedaMis.sorter.reverse=b.busquedaMis.sorter.predicate==a&&!b.busquedaMis.sorter.reverse,b.busquedaMis.sorter.predicate=a},b.resetResultadoMis=function(){void 0!==b.busquedaMis.resultados&&(b.busquedaMis.resultados.length=0),void 0!==b.listaMis.data&&(b.listaMis.data.length=0),b.busquedaMis.data=null,b.busquedaMis.fecha=null,b.listaMis.inicio=0,b.listaMis.fin=b.listaMis.offset,b.cleanErr("mis")},b.buscarMis=function(a){b.resetResultadoMis(),a&&b.openLoadingModal("Obteniendo solicitudes...",""),j.getByUserInSession().then(function(c){a&&b.closeModal(),null===c.status||(c.status?(b.busquedaMis.fecha=new Date,b.busquedaMis.data=c,b.busquedaMis.resultados=f("orderBy")(c.aaData,"idSolicitud",!0)):b.raiseErr("mis","Problema detectado",c.msg))},function(a){b.raiseErr("mis","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.loadMoreMis=function(){var a=b.busquedaMis.resultados.slice(b.listaMis.inicio,b.listaMis.fin);angular.forEach(a,function(a){b.listaMis.data.push(a)}),b.listaMis.inicio=b.listaMis.inicio+b.listaMis.offset,b.listaMis.fin=b.listaMis.fin+b.listaMis.offset},b.hayDataEnTablaMis=function(){var a=f("filter")(b.busquedaMis.resultados,b.isSolicitudRevisada,!0);return void 0!==a&&a.length>0},b.accionSolicitud=function(a,c){if(5==c.estadoDTO.idEstado){var d=1==c.bis;b.verTitulo({foja:c.foja,numero:c.numero,ano:c.ano,bis:d})}else{var e="";2==c.estadoDTO.idEstado?e="remove-ok":3==c.estadoDTO.idEstado&&(e="remove-rechazo"),b[a]=j.actualizar(c.idSolicitud,e),b[a].then(function(a){if(null==a.status);else if(a.status&&(c.fechaEstado=a.fechaEstado,c.estadoDTO={idEstado:a.idEstado,descripcion:a.descripcionEstado},"remove-ok"==e)){var d=1==c.bis;b.verTitulo({foja:c.foja,numero:c.numero,ano:c.ano,bis:d})}},function(a){})}},b.doFocus=function(a){b.$broadcast(a+"IsFocused")},b.raiseErr=function(a,c,d){b.closeModal(),b.states[a].isError=!0,b.states[a].title=c,b.states[a].msg=d},b.cleanErr=function(a){b.states[a].isError=!1,b.states[a].title="",b.states[a].msg=""},b.closeModal=function(){var a=h.getTop();a&&h.dismiss(a.key)},b.isSolicitudRevisada=function(a){return 6!==a.estadoDTO.idEstado&&5!==a.estadoDTO.idEstado},b.archivoNacional=function(b){return!(b<a.aioParametros.anoArchivoNacional)},b.anoActual=function(a){return!(moment(new Date).year()<a)},c(function(){1===b.tab.parentActive?b.doFocus("foja"):b.tab.parentActive},200)}]),app.controller("DistribucionCtrl",["$scope","$filter","$routeParams","$modalStack","$modal","$timeout","distribucionService",function(a,b,c,d,e,f,g){if(a.secciones=[],a.responsables=[],a.responsableSel={},a.caratulas=[],a.caratula={},a.formulario={numero:"",seccion:{}},a.buscarCaratula=function(b){if(void 0!==b)for(var c in b)a.openLoadingModal("Buscando...",""),g.getCaratula(b[c]).then(function(b){a.closeModal(),void 0===b.status?a.openMensajeModal("warn","Inicie sesión nuevamente.",""):b.status?(a.formulario.numero="",a.doFocus("numero"),a.caratula=b.res.caratulaDTO,a.caratulas.push(b.res.caratulaDTO)):(a.doFocus("numero"),a.openMensajeModal("info","No se ha encontrado carátula.",""))},function(b){a.openMensajeModal("error","Problema detectado","No se ha podido establecer comunicación con el servidor.")});else a.existe(a.formulario.numero)?a.openMensajeModal("info","Carátula ya ingresada.",""):(a.openLoadingModal("Buscando...",""),g.getCaratula(a.formulario.numero).then(function(b){a.closeModal(),void 0===b.status?a.openMensajeModal("warn","Inicie sesión nuevamente.",""):b.status?(a.formulario.numero="",a.doFocus("numero"),a.caratula=b.res.caratulaDTO,a.caratulas.push(b.res.caratulaDTO)):(a.doFocus("numero"),a.openMensajeModal("info","No se ha encontrado carátula.",""))},function(b){a.openMensajeModal("error","Problema detectado","No se ha podido establecer comunicación con el servidor.")}))},a.existe=function(b){for(var c=0;c<a.caratulas.length;c++)if(a.caratulas[c].datosFormularioDTO.numeroCaratula==b)return!0;return!1},a.selectCaratula=function(b){a.caratula=b},a.isSelected=function(b){return!!a.caratula.datosFormularioDTO&&a.caratula.datosFormularioDTO.numeroCaratula==b},a.eliminar=function(b,c){if(confirm("Desea eliminar la carátula "+c.datosFormularioDTO.numeroCaratula+" ?")){var d=c.datosFormularioDTO.numeroCaratula;a.caratulas.splice(b,1),a.caratula.datosFormularioDTO&&a.caratula.datosFormularioDTO.numeroCaratula==d&&(a.caratula={})}},a.distribuir=function(){a.responsableSel={},a.openLoadingModal("Distribuyendo...",""),g.getResponsables(a.formulario.seccion.codigo).then(function(b){a.closeModal(),void 0===b.status?a.openMensajeModal("warn","Inicie sesión nuevamente.",""):b.status?(a.responsables=b.funcionarios,0===a.responsables.length?a.openMensajeModal("info","No se ha encontrado responsable para distribuir",""):1===a.responsables.length?a.doDistribucion(a.responsables[0]):a.openDistribucionModal(a.formulario.seccion,a.responsables)):(a.doFocus("numero"),a.openMensajeModal("info","No se han encontrado responsables.",""))},function(b){a.openMensajeModal("error","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.openDistribucionModal=function(b,c){e.open({templateUrl:"distribucionModal.html",backdrop:!0,keyboard:!1,size:"sm",windowClass:"modal",controller:"DistribucionModalCtrl",resolve:{seccion:function(){return b},responsables:function(){return c}}}).result.then(function(b){a.doDistribucion(b)},function(){console.log("Modal dismissed at: "+new Date)})},a.doDistribucion=function(b){for(var c=[],d=0;d<a.caratulas.length;d++)c.push({numero:a.caratulas[d].datosFormularioDTO.numeroCaratula});a.openLoadingModal("Distribuyendo...",""),g.distribuir(c,a.formulario.seccion.codigo,b).then(function(b){a.closeModal(),void 0===b.status?a.openMensajeModal("warn","Inicie sesión nuevamente.",""):b.status?(a.doFocus("numero"),a.caratulas=[],a.caratula={}):a.openMensajeModal("error","Problema detectado","Error en servidor.")},function(b){a.openMensajeModal("error","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.openLoadingModal=function(a,b){e.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.openMensajeModal=function(b,c,d){a.closeModal(),e.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,size:"sm",windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return b},titulo:function(){return c},detalle:function(){return d}}})},a.closeModal=function(){var a=d.getTop();a&&d.dismiss(a.key)},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},f(function(){a.doFocus("numero")},200),g.getSecciones().then(function(b){b.status?a.secciones=b.secciones:a.openMensajeModal("warn","No se han encontrado secciones.","")},function(b){a.openMensajeModal("error","Problema detectado","No se ha podido establecer comunicación con el servidor.")}),a.stringIsNumber=function(a){return(+a).toString()===a},void 0!==c.caratulas){var h=JSON.parse(c.caratulas);f(function(){a.buscarCaratula(h)},500)}void 0!==c.caratula&&a.stringIsNumber(c.caratula)&&c.caratula.length<=10&&(a.formulario.numero=c.caratula,f(function(){a.buscarCaratula()},500))}]),app.controller("DistribucionModalCtrl",["$rootScope","$scope","$modalInstance","seccion","responsables",function(a,b,c,d,e){b.seccion=d,b.responsables=e,b.cancel=function(){c.dismiss("cancel")},b.seleccionarResponsable=function(a){c.close(a)}}]),app.controller("DocumentoModalCtrl",["$rootScope","$scope","$modalInstance","url",function(a,b,c,d){b.url=d,b.cancel=function(){c.dismiss("cancel")}}]),angular.module("aioApp").controller("DocumentosCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),app.controller("documentoEntregaModalCtrl",["$scope","$timeout","estadoService","$modal","$modalStack","$routeParams","$rootScope","data",function(a,b,c,d,e,f,g,h){var i={parentActive:1};a.tab=i,a.req={numeroCaratula:null,simpleMode:!1},a.documentos={escrituras:[],terminada:null},a.isActiveParent=function(b){return a.tab.parentActive===b},a.activateParent=function(b){a.tab.parentActive=b,1===a.tab.parentActive||a.tab.parentActive},a.reset=function(){a.data={},a.documentos={escrituras:[],terminada:null}},a.verDocumento=function(b){c.existeDocumento(b).then(function(c){null==c.success||(c.success?location.href="http://192.168.100.164/documentos/do/fileService?metodo=download&idDocumentop="+b.idDocumento+"&idDetalleDocumentop="+b.idDetalleDocumento+"&caratulap="+b.caratula+"&versionp="+b.version+"&idTipoDocumentop="+b.idTipoDocumento+"&idRegp="+b.idReg+"&esVersionp="+b.esVersion+"&esPrincipalp="+b.esPrincipal+"&esDetallep="+b.esDetalle:a.raiseErr(c.errormsg))},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.buscar=function(){a.reset(),a.openLoadingModal("Buscando #"+a.req.numeroCaratula+"...",""),c.getDocumentosEntrega(a.req.numeroCaratula).then(function(b){a.closeModal(),null===b.status||(b.status?a.data=b:a.raiseErr(b.msg))},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.raiseErr=function(b){a.openMensajeModal("error",b,"",!1,null)},a.raiseSuccess=function(b){a.openMensajeModal("success",b,"",!1,null)},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openMensajeModal=function(c,e,f,g,h){d.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return c},titulo:function(){return e},detalle:function(){return f}}}),g&&b(function(){a.closeModal()},1e3*h)},a.openLoadingModal=function(a,b){d.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.closeModal=function(){var a=e.getTop();a&&e.dismiss(a.key)},a.stringIsNumber=function(a){return(+a).toString()===a},b(function(){if(void 0!==f.caratula)a.stringIsNumber(f.caratula)&&f.caratula.length<=10?(a.req.numeroCaratula=f.caratula,b(function(){a.buscar()},500)):"limpiar"===f.caratula&&a.limpiarCache();else if("true"!=a.req.simpleMode){var d=c.getCaratulaSesion();d.then(function(b){null===b.status||b.status&&(a.req.numeroCaratula=b.numeroCaratula,a.buscar())},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})}a.doFocus("numeroCaratula")},500),a.verTipoImagenHipo=function(a){var b=1==a.bis;g.go("/verInscripcionReg/hip/"+a.foja+"/"+a.numero+"/"+a.ano+"/"+b+"/estado")},a.verTipoImagenProh=function(a){var b=1==a.bis;g.go("/verInscripcionReg/proh/"+a.foja+"/"+a.numero+"/"+a.ano+"/"+b+"/estado")},a.verTitulo=function(a){var b=1==a.bis;g.go("/verInscripcion/prop/"+a.foja+"/"+a.numero+"/"+a.ano+"/"+b+"/estado/0")},a.verDocumentoEstudio=function(b){g.go("/verEscrituraEstudio/"+a.req.numeroCaratula+"/"+b.version+"/estado")},a.dejarDocumentoNoVigente=function(b){c.dejarDocumentoNoVigente(b.codArchivoAlpha).then(function(b){null===b.status||(b.status?a.closeModal():a.raiseErr(b.msg))},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.cancel=function(){var a=e.getTop();a&&e.dismiss(a.key)}}]),app.controller("DocumentosEntregaModalCtrl",["$log","$rootScope","$scope","$modal","$modalInstance","$modalStack","$window","$timeout","data","estadoService",function(a,b,c,d,e,f,g,h,i,j){c.data=i,c.documentoEntrega={caratula:null},c.cancel=function(){var a=f.getTop();a&&f.dismiss(a.key)},c.vincular=function(){c.openLoadingModal("Vinculando...",""),j.getEstado(c.documentoEntrega.caratula).then(function(a){if(c.closeModal(),null===a.status);else if(a.status){var b=j.vincularCaratula(c.documentoEntrega.caratula,c.data.req.numeroCaratula);b.then(function(a){if(c.closeModal(),null===a.status);else if(a.status){c.data.res.caratulaDTO.bitacoraDTOs.unshift(a.bitacoraDTO);var b=j.getDocumentosEntrega(c.data.req.numeroCaratula);b.then(function(a){null===a.status||(a.status?c.data.res.entregaEnLineaDTO=a.res.entregaEnLineaDTO:c.raiseErr(a.msg))},function(a){c.raiseErr("No se ha podido establecer comunicación con el servidor.")}),c.openMensajeModal("success","Caratula vinculada","",!0,2)}else c.raiseErr(a.msg)},function(a){c.raiseErr("No se ha podido establecer comunicación con el servidor.")})}else c.raiseErr(a.msg)},function(a){c.raiseErr("No se ha podido establecer comunicación con el servidor.")})},c.raiseErr=function(a){c.openMensajeModal("error",a,"",!1,null)},c.doFocus=function(a){c.$broadcast(a+"IsFocused")},c.openMensajeModal=function(a,b,e,f,g){d.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return b},detalle:function(){return e}}}),f&&h(function(){c.closeModal()},1e3*g)},c.openLoadingModal=function(a,b){d.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},c.closeModal=function(){var a=f.getTop();a&&f.dismiss(a.key)},h(function(){c.doFocus("numeroCaratula")},500)}]),app.controller("EmbargoModalCtrl",["$scope","$modalInstance","embargos",function(a,b,c){a.embargos=c,a.cancel=function(){b.dismiss("cancel")}}]),app.controller("escrituraElectronicaModalCtrl",["$scope","$modal","$modalStack","$timeout","tareasService","reingresoService","sol",function(a,b,c,d,e,f,g){a.sol=g,a.solicitudStatus={ok:!1,error:!1,warning:!1,msgTitle:null,msg:null},a.cancel=function(){var a=c.getTop();a&&c.dismiss(a.key)},a.getListaNotarios=function(a){return f.getListaNotarios(a).then(function(a){return a})},a.escritura={caratula:null,idnotario:null,codescritura:null},a.raiseErr=function(b){a.openMensajeModal("error",b,"",!1,null)},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.closeModal=function(){var a=c.getTop();a&&c.dismiss(a.key)},a.buscarDocumento=function(){a.openLoadingModal("Buscando Documento...",""),e.buscarDocumento(a.escritura.notario.idNotario,a.escritura.codescritura,a.escritura.notario.empresa,a.escritura.caratula).then(function(b){a.closeModal(),null===b.estado||(b.status?(a.solicitudStatus.ok=!0,d(function(){a.closeModal()},2e3)):a.raiseErr(b.msg))},function(b){a.closeModal(),a.raiseErr("No se ha podido establecer comunicacion con el servidor.")})},d(function(){a.escritura.caratula=a.sol.numeroCaratula,0==a.sol.codigoDocumentoElectronico?a.escritura.codescritura="":a.escritura.codescritura=a.sol.codigoDocumentoElectronico,a.doFocus("caratula")},500),a.openLoadingModal=function(a,c){b.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return c}}})},a.openMensajeModal=function(c,e,f,g,h){b.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return c},titulo:function(){return e},detalle:function(){return f}}}),g&&d(function(){a.closeModal()},1e3*h)}}]),app.controller("EstadoCtrl",["$scope","$http","$window","$location","$timeout","localStorageService","$log","estadoService","reingresoService","inscripcionDigitalService","$modal","$modalStack","$route","$routeParams","Usuario","$rootScope","escrituraService","Modal",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s={parentActive:1};if(a.tab=s,a.req={numeroCaratula:null,simpleMode:!1},a.documentos={escrituras:[],terminada:null},a.isActiveParent=function(b){return a.tab.parentActive===b},a.activateParent=function(b){a.tab.parentActive=b,1===a.tab.parentActive||a.tab.parentActive},a.limpiarCache=function(){f.remove("rawScreens")},a.colapsar=function(b){if("Documentos Entrega"==b.title&&!a.data.res.entregaEnLineaDTO&&b.collapsed){h.getDocumentosEntrega(a.req.numeroCaratula).then(function(b){null===b.status||(b.status?a.data.res.entregaEnLineaDTO=b.res.entregaEnLineaDTO:a.raiseErr(b.msg))},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})}b.collapsed?b.collapsed=!1:b.collapsed=!0,f.set("rawScreens",a.rawScreens)},a.defaultRawScreens=[[{title:"Datos formulario",url:"views/estado/datos_formulario.html",collapsed:!1},{title:"Requirente",url:"views/estado/requirente.html",collapsed:!1},{title:"Cuenta Corriente",url:"views/estado/cuenta_corriente.html",collapsed:!1},{title:"Observaciones",url:"views/estado/observaciones.html",collapsed:!1},{title:"Documentos Entrega",url:"views/estado/documentos_entrega.html",collapsed:!0},{title:"Escrituras",url:"views/estado/escritura.html",collapsed:!1}],[{title:"Estado Actual",url:"views/estado/estado_actual.html",collapsed:!1},{title:"Citado",url:"views/estado/citado.html",collapsed:!1},{title:"Tareas",url:"views/estado/tareas.html",collapsed:!1},{title:"Movimientos",url:"views/estado/movimientos.html",collapsed:!1},{title:"Ingresos - Egresos",url:"views/estado/ingresos_egresos.html",collapsed:!1},{title:"Solicitud Web",url:"views/estado/solicitud_web.html",collapsed:!1},{title:"Repertorios",url:"views/estado/repertorio.html",collapsed:!1}]],a.rawScreens=f.get("rawScreens"),null===a.rawScreens)a.rawScreens=a.defaultRawScreens,f.set("rawScreens",a.rawScreens);else{for(var t=0;t<a.defaultRawScreens.length;t++)for(var u=0;u<a.defaultRawScreens[t].length;u++){for(var v=!1,w=0;w<a.rawScreens.length;w++)for(var x=0;x<a.rawScreens[w].length;x++)a.defaultRawScreens[t][u].title==a.rawScreens[w][x].title&&(v=!0);v||a.rawScreens[t].splice(u,0,a.defaultRawScreens[t][u])}for(var t=0;t<a.rawScreens.length;t++)for(var u=0;u<a.rawScreens[t].length;u++){for(var v=!1,w=0;w<a.defaultRawScreens.length;w++)for(var x=0;x<a.defaultRawScreens[w].length;x++)a.rawScreens[t][u].title==a.defaultRawScreens[w][x].title&&(v=!0);v||a.rawScreens[t].splice(u,1)}f.set("rawScreens",a.rawScreens)}a.sortableOptions={containment:"body",placeholder:"placeholder-estado",handle:".handle",opacity:.9,connectWith:".apps-container",forcePlaceholderSize:!0,update:function(b,c){"screen-1"!==b.target.id&&"screen-1"===c.item.sortable.droptarget.attr("id")&&1===a.rawScreens[0].length&&c.item.sortable.cancel(),"screen-0"!==b.target.id&&"screen-0"===c.item.sortable.droptarget.attr("id")&&1===a.rawScreens[1].length&&c.item.sortable.cancel()},stop:function(b,c){f.set("rawScreens",a.rawScreens)}},a.reset=function(){a.data={},a.documentos={escrituras:[],terminada:null}},a.verDocumentoTerminado=function(){a.verDocumentoEstudio(a.documentos.terminada)},a.limpiar=function(){a.reset(),a.req.numeroCaratula=null,a.doFocus("numeroCaratula")},a.openDatosFormularioModal=function(){k.open({templateUrl:"datos_formularioModal.html",backdrop:!0,windowClass:"modal",controller:"DatosFormularioModalCtrl",resolve:{data:function(){return a.data}}})},a.openRequirenteModal=function(){k.open({templateUrl:"requirenteModal.html",backdrop:!0,windowClass:"modal",controller:"RequirenteModalCtrl",resolve:{data:function(){return a.data}}})},a.openCitadoModal=function(){k.open({templateUrl:"citadoModal.html",backdrop:!0,windowClass:"modal",controller:"CitadoModalCtrl",resolve:{data:function(){return a.data}}})},a.openMovimientosModal=function(){var b={caratulaDTO:a.data.res.caratulaDTO};k.open({templateUrl:"movimientosModal.html",backdrop:!0,windowClass:"modal",controller:"MovimientosModalCtrl",resolve:{caratula:function(){return b}}})},a.openTareasModal=function(b,c){k.open({templateUrl:"tareasModal.html",backdrop:!0,windowClass:"modal",controller:"TareasModalCtrl",resolve:{data:function(){return a.data},operacion:function(){return b},tareaDTO:function(){return c}}})},a.abrirCaratulasPorRutModal=function(){k.open({templateUrl:"caratulasPorRutModal.html",backdrop:!0,windowClass:"modal",controller:"CaratulasPorRutCtrl",resolve:{numeroCaratula:function(){return a.req.numeroCaratula}}}).result.then(function(b){a.req.numeroCaratula=b,a.buscar()},function(){})},a.openObservacionesModal=function(b,c){k.open({templateUrl:"observacionesModal.html",backdrop:!0,windowClass:"modal",controller:"ObservacionesModalCtrl",resolve:{data:function(){return a.data},operacion:function(){return b},tareaDTO:function(){return c}}})},a.openDocumentosEntregaModal=function(){k.open({templateUrl:"documentos_entregaModal.html",backdrop:!0,windowClass:"modal",controller:"DocumentosEntregaModalCtrl",resolve:{data:function(){return a.data}}})},a.buscar=function(){a.reset(),a.openLoadingModal("Buscando #"+a.req.numeroCaratula+"...",""),h.getEstado(a.req.numeroCaratula).then(function(b){if(a.closeModal(),null==b.status);else if(b.status){a.data=b,a.anulada="Anulada"==b.res.caratulaDTO.estadoActualDTO.descripcionEnFlujo;for(var c=0;c<a.rawScreens.length;c++)for(var d=0;d<a.rawScreens[c].length;d++)"Documentos Entrega"!=a.rawScreens[c][d].title&&"Escrituras"!=a.rawScreens[c][d].title||(a.rawScreens[c][d].collapsed=!0);if("Finalizada"==b.res.caratulaDTO.estadoActualDTO.descripcionEnFlujo){var e=h.getDocumentosEntrega(a.req.numeroCaratula);e.then(function(b){if(null===b.status);else if(b.status){a.data.statusDocumentosEntrega=b.status,a.data.res.entregaEnLineaDTO=b.res.entregaEnLineaDTO;for(var c=0;c<a.rawScreens.length;c++)for(var d=0;d<a.rawScreens[c].length;d++)"Documentos Entrega"==a.rawScreens[c][d].title&&(a.rawScreens[c][d].collapsed=!1)}else a.raiseErr(b.msg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})}else a.data.statusDocumentosEntrega=!0;var e=h.getRepertorios(a.req.numeroCaratula);e.then(function(b){if(null===b.status);else if(b.status){a.data.statusRepertorios=b.status,a.data.res.caratulaDTO.repertorioDTOs=b.res.repertorioDTOs;for(var c in a.data.res.caratulaDTO.repertorioDTOs)if(0==a.data.res.caratulaDTO.repertorioDTOs[c].vigente){a.openComentariosModal(a.data.res.caratulaDTO.repertorioDTOs[c]);break}}else a.raiseErr(b.msg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")});var e=h.getIngresosEgresos(a.req.numeroCaratula);if(e.then(function(b){null===b.status||(b.status?(a.data.statusIngresosEgresos=b.status,a.data.res.caratulaDTO.ingresoEgresoDTOs=b.res.ingresoEgresoDTOs):a.raiseErr(b.msg))},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")}),null!=a.data.res.caratulaDTO.datosFormularioDTO.codigo&&0!=a.data.res.caratulaDTO.datosFormularioDTO.codigo){var e=h.getCuentaCorriente(a.data.res.caratulaDTO.datosFormularioDTO.codigo);e.then(function(b){null===b.status||(b.status?(a.data.statusCuentaCorriente=b.status,a.data.res.caratulaDTO.cuentaCorrienteDTO=b.res.cuentaCorrienteDTO):a.raiseErr(b.msg))},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})}else a.data.statusCuentaCorriente=!0;if(null!=a.data.res.caratulaDTO.productoWebDTO.idUsuarioWeb&&0!=a.data.res.caratulaDTO.productoWebDTO.idUsuarioWeb){var e=h.getProductoWeb(a.data.res.caratulaDTO.productoWebDTO);e.then(function(b){null===b.status||(b.status?(a.data.statusProductoWeb=b.status,a.data.res.caratulaDTO.productoWebDTO=b.res.productoWebDTO):a.raiseErr(b.msg))},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})}else a.data.statusProductoWeb=!0;a.buscarEscrituras();var e=h.getDocumentos(a.req.numeroCaratula,"TERMINADAS");e.then(function(b){null===b.status||(b.success?(a.data.res.caratulaDTO.documentos={},void 0!=b.children[0]&&void 0!=b.children[0].children[0]&&(a.documentos.terminada=b.children[0].children[0]),a.data.statusDocumentosTerminado=b.success):a.raiseErr(b.errormsg))},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})}else a.limpiar(),a.raiseErr(b.msg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.buscarEscrituras=function(){h.getDocumentos(a.req.numeroCaratula,"ESCRITURAS").then(function(b){if(null===b.status);else if(b.success){a.data.res.caratulaDTO.documentos={},a.documentos.escrituras=[];for(var c=0;c<b.children.length;c++)a.documentos.escrituras.splice(a.documentos.escrituras.length,0,b.children[c].children[0]);a.data.statusDocumentos=b.success}else a.raiseErr(b.errormsg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.reingresarCaratula=function(){var b=a.data.res.caratulaDTO.datosFormularioDTO.tipoFormularioDTO.id;if(1==b||2==b){a.openLoadingModal("Reingresando carátula #"+a.req.numeroCaratula+"...","");var c=i.getCaratula(a.req.numeroCaratula);c.then(function(b){null===b.estado||(b.estado?(c=i.reingresarCaratula(b.caratulaDTO,b.caratulaDTO,"reingreso desde AIO Estado",null,null,null),c.then(function(b){a.closeModal(),null===b.estado||(b.estado?(a.raiseSuccess(b.msg),a.data.res.caratulaDTO.bitacoraDTOs.splice(0,0,b.bitacoraDTO)):a.raiseErr("No se puedo reingresar la caratula. Reintente desde modulo de Reingreso"))},function(b){a.raiseErr("No se ha podido establecer comunicacion con el servidor.")})):a.raiseErr("No se puedo reingresar la caratula. Reintente desde modulo de Reingreso"))},function(b){a.raiseErr("No se ha podido establecer comunicacion con el servidor.")})}else d.path("/reingreso")},a.exportarPDF=function(b){k.open({templateUrl:"verExportarPDF.html",backdrop:"static",keyboard:!1,size:"lg",windowClass:"modal",controller:"VerExportarPDFCtrl",resolve:{nc:function(){return a.req.numeroCaratula}}})},a.muestraRechazo=function(){return void 0!==a.data&&void 0!==a.data.res&&null!==a.data.res.caratulaDTO.estadoActualDTO&&null!==a.data.res.caratulaDTO.estadoActualDTO.seccionDTO&&!("10"===a.data.res.caratulaDTO.estadoActualDTO.seccionDTO.id||"08"===a.data.res.caratulaDTO.estadoActualDTO.seccionDTO.id)},a.raiseErr=function(b){a.openMensajeModal("error",b,"",!1,null)},a.raiseSuccess=function(b){a.openMensajeModal("success",b,"",!1,null)},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openMensajeModal=function(b,c,d,f,g){k.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return b},titulo:function(){return c},detalle:function(){return d}}}),f&&e(function(){a.closeModal()},1e3*g)},a.openLoadingModal=function(a,b){k.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.openSolicitar=function(){a.$broadcast("sfojaIsFocused")},a.openRechazoModal=function(){var b={numeroCaratula:a.req.numeroCaratula};k.open({templateUrl:"rechazoCertificacionModal.html",backdrop:"static",keyboard:!1,windowClass:"modal",controller:"RechazoCertificacionModalCtrl",resolve:{dataRechazo:function(){return b},origen:function(){return"estado"}}})},a.closeModal=function(){var a=l.getTop();a&&l.dismiss(a.key)},a.stringIsNumber=function(a){return(+a).toString()===a},e(function(){if(void 0!==n.caratula)a.stringIsNumber(n.caratula)&&n.caratula.length<=10?(a.req.numeroCaratula=n.caratula,e(function(){a.buscar()},500)):"limpiar"===n.caratula&&a.limpiarCache();else if("true"!=a.req.simpleMode){var b=h.getCaratulaSesion();b.then(function(b){null===b.status||b.status&&(a.req.numeroCaratula=b.numeroCaratula)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})}a.doFocus("numeroCaratula")},500),a.verTipoImagenHipo=function(a){var b=1==a.bis;p.go("/verInscripcion/hip/"+a.foja+"/"+a.numero+"/"+a.ano+"/"+b+"/estado")},a.verTipoImagenProh=function(a){var b=1==a.bis;p.go("/verInscripcion/proh/"+a.foja+"/"+a.numero+"/"+a.ano+"/"+b+"/estado")},a.verTitulo=function(a){var b=1==a.bis;p.go("/verInscripcion/prop/"+a.foja+"/"+a.numero+"/"+a.ano+"/"+b+"/estado/0")},a.downloadBoleta=function(b){var d={nombreArchivo:b.numero+".pdf",idTipoDocumento:12,idReg:0};h.existeDocumento(d).then(function(b){b.hayDocumento?c.location.href=c.location.protocol+"//"+c.location.host+"/aio/do/service/estado?metodo=downloadDocumento&documento="+encodeURIComponent(JSON.stringify(d)):a.raiseErr(b.errormsg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.downloadFirma=function(b){var d={nombreArchivo:b.nombreArchivoVersion,fechaDocumento:b.fechaFirma,rutFirmador:b.usuario};h.existeFirma(d).then(function(b){b.hayDocumento?c.location.href=c.location.protocol+"//"+c.location.host+"/aio/do/service/estado?metodo=downloadFirma&documento="+encodeURIComponent(JSON.stringify(d)):a.raiseErr(b.errormsg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.verDocumentoEstudio=function(b){var d={nombreArchivo:b.nombreArchivoVersion,idTipoDocumento:b.idTipoDocumento,idReg:b.idReg,fechaDocumento:b.fechaProcesa};h.existeDocumento(d).then(function(d){d.hayDocumento?c.open("../do/service/escritura?metodo=verDocumentoEstudio&caratula="+a.req.numeroCaratula+"&version="+b.version+"&idTipoDocumento="+b.idTipoDocumento+"&type=uri","","width=800,height=600"):a.raiseErr(d.errormsg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.vincularDocumentos=function(){},a.removeVersion=r.confirm.delete(function(b){a.openLoadingModal("Eliminando version de escritura...",""),q.eliminarDocumento(b.idDocumento,a.req.numeroCaratula,b.version).then(function(b){a.closeModal(),null===b.estado||(b.status?(a.raiseSuccess("Se ha eliminado la version de Escritura"),a.buscarEscrituras()):a.raiseErr(b.msg))},function(b){a.statesDescarga.ok=!1,a.statesDescarga.msg="no se ha podido establecer comunicacion con el servidor."})}),a.openComentariosModal=function(a){k.open({templateUrl:"comentariosModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"ComentariosModalCtrl",resolve:{repertorios:function(){return a}}})}}]),app.controller("EstadoIndiceModalCtrl",["$scope","$window","$timeout","$log","$modal","$modalStack","$routeParams","$modalInstance","numeroCaratula",function(a,b,c,d,e,f,g,h,i){a.numeroCaratula=i,a.cancel=function(){h.dismiss("cancel")}}]),app.controller("generaTicketCtrl",["$scope","$rootScope","$timeout","$routeParams","$modalInstance","colilla","tramites","registro","foja","numero","ano","requirente","rutrequirente","titulos","colillacanvas","email",function(a,b,c,d,e,f,g,h,i,k,l,m,n,o,p,q){a.fechahoy=(new Date).toJSON().split("T")[0];var r=new Date;a.colilla=f,a.tramites=g,a.registro=h,a.foja=i,a.numero=k,a.ano=l,a.requirente=m,a.usuario=b.userLoginSinCBRS,a.rutrequirente=n,a.titulos=o,a.colillacanvas=p,a.email=q,a.generaTicket=function(a,b,c,d,e,f,g,h,i,k){if(""!=i)for(j in i){var l=a[j],m="",n="",o=new BWIPJS,p=n.split(" ");n={};for(var q=0;q<p.length;q++)if(p[q]){var r=p[q].indexOf("=");-1==r?n[p[q]]=o.value(!0):n[p[q].substr(0,r)]=o.value(p[q].substr(r+1))}m&&(n.alttext=o.value(m)),n.inkspread=o.value(0),!needyoffset.code39ext||n.textxalign||n.textyalign||n.alttext||void 0!==n.textyoffset||(n.textyoffset=o.value(-10)),o.bitmap(new Bitmap);var s=1;o.scale(s,s);var t=document.getElementById("output");t&&(t.innerHTML=""),o.push(l),o.push(n);try{o.call("code39ext"),o.bitmap().show("canvas"+i[j].numero+i[j].anio,"N")}catch(a){var u="";a.fileName&&(u+=a.fileName+" "),a.lineNumber&&(u+="[line "+a.lineNumber+"] "),alert(u+(u?": ":"")+a.message)}}else{var l=a,m="",n="",o=new BWIPJS,p=n.split(" ");n={};for(var q=0;q<p.length;q++)if(p[q]){var r=p[q].indexOf("=");-1==r?n[p[q]]=o.value(!0):n[p[q].substr(0,r)]=o.value(p[q].substr(r+1))}m&&(n.alttext=o.value(m)),n.inkspread=o.value(0),!needyoffset.code39ext||n.textxalign||n.textyalign||n.alttext||void 0!==n.textyoffset||(n.textyoffset=o.value(-10)),o.bitmap(new Bitmap);var s=1;o.scale(s,s);var t=document.getElementById("output");t&&(t.innerHTML=""),o.push(l),o.push(n);try{o.call("code39ext"),o.bitmap().show("canvas","N")}catch(a){var u="";a.fileName&&(u+=a.fileName+" "),a.lineNumber&&(u+="[line "+a.lineNumber+"] "),alert(u+(u?": ":"")+a.message)}}},a.printDiv=function(b){if(""!=o){var d=window.open("","_blank","width=100,height=100");d.document.open();var e='<html><head><link rel="stylesheet" type="text/css" href="style.css" /></head><body onload="window.print()"><div style=" max-width: 290px; padding: 19px 15px 10px 15px;  margin: 0 auto 20px; border: 1px solid #ccc; -webkit-border-radius: 2px; -moz-border-radius: 2px;  border-radius: 2px;-moz-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); ">';e+='<h4 style="text-align:center;font-family:arial;">Solicitud Caratula</h4>';for(j in o){var f=document.getElementById("canvas"+o[j].numero+o[j].anio),h=f.toDataURL("image/png");e+='<div style="text-align:center">',e=e+'<img width=230 height=100 src="'+h+'"/>',e+="</div>",e+="<ul>",e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;">Numero Colilla: '+a.colilla[j]+"</li>",e=e+'<br><li style="font-family:arial;font-weight: normal;font-size: 14px;">Registro: '+a.registro+"</li>",e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;">Foja: '+o[j].foja+" Numero: "+o[j].numero+" Año: "+o[j].anio+"</li>";for(var i=g[j],k=0;k<i.length;k++)e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;">'+i[k].nombre+"</li>",""!=i[k].obs&&(e=e+'<li style="word-wrap: break-word;font-family:arial;font-weight: normal;font-size: 14px;">'+i[k].obs+"</li>"),e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;"> Valor $'+i[k].valor+"</li>";e+="</ul>",e+='<hr style="margin-bottom:7px;">'}var l=r.getMonth()+1;e=e+'<label style="font-family:arial;font-weight: normal;font-size: 14px;">Fecha Solicitud: '+r.getDate()+"-"+l+"-"+r.getFullYear()+" "+r.getHours()+":"+r.getMinutes()+"</label><br>",e=e+'<label style="font-family:arial;font-weight: normal;font-size: 14px;">Rut Req.: '+a.rutrequirente.substring(0,a.rutrequirente.length-1)+"-"+a.rutrequirente.substring(a.rutrequirente.length-1,a.rutrequirente.length)+"</label><br>",e=e+'<label style="word-wrap: break-word;font-family:arial;font-weight: normal;font-size: 14px;">Requirente: '+a.requirente+"</label><br>",e=e+'<label style="word-wrap: break-word;font-family:arial;font-weight: normal;font-size: 14px;">Email: '+a.email+"</label>",e=e+'<div style="text-align:center;font-family:arial;"><h6>'+a.usuario+"</h6></div>",e+='<div style="text-align:center;font-family:arial;"><h6>Atención de Público<br>Lunes a Viernes de 8:30 a 15:00 Hrs.<br>Morande 440, Santiago Centro<br>www.conservador.cl</h6></div>',e+="</div></body></html>"}else{var f=document.getElementById("canvas"),h=f.toDataURL("image/png"),d=window.open("","_blank","width=100,height=100");d.document.open();var e='<html><head><link rel="stylesheet" type="text/css" href="style.css" /></head><body onload="window.print()"><div style=" max-width: 290px; padding: 19px 15px 10px 15px;  margin: 0 auto 20px; border: 1px solid #ccc; -webkit-border-radius: 2px; -moz-border-radius: 2px;  border-radius: 2px;-moz-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); ">';e+='<h4 style="text-align:center;font-family:arial;">Solicitud Caratula</h4>',e+='<div style="text-align:center">',e=e+'<img width=230 height=100 src="'+h+'"/>',e+="</div>",e+="<ul>",e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;">Numero Colilla: '+a.colilla+"</li>";var l=r.getMonth()+1;e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;">Fecha Solicitud: '+r.getDate()+"-"+l+"-"+r.getFullYear()+" "+r.getHours()+":"+r.getMinutes()+"</li>",e=e+'<label style="font-family:arial;font-weight: normal;font-size: 14px;">Rut Req.: '+a.rutrequirente.substring(0,a.rutrequirente.length-1)+"-"+a.rutrequirente.substring(a.rutrequirente.length-1,a.rutrequirente.length)+"</label><br>",e=e+'<label style="word-wrap: break-word;font-family:arial;font-weight: normal;font-size: 14px;">Requirente: '+a.requirente+"</label><br>",e=e+'<label style="word-wrap: break-word;font-family:arial;font-weight: normal;font-size: 14px;">Email: '+a.email+"</label>",e=e+'<br><li style="font-family:arial;font-weight: normal;font-size: 14px;">Registro: '+a.registro+"</li>",e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;">Foja: '+a.foja+" Numero: "+a.numero+" Año: "+a.ano+"</li>";for(var k=0;k<g.length;k++)e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;">'+g[k].nombre+"</li>",""!=g[k].obs&&(e=e+'<li style="word-wrap: break-word;font-family:arial;font-weight: normal;font-size: 14px;">'+g[k].obs+"</li>"),e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;"> Valor $'+g[k].valor+"</li>";e+="</ul>",e+='<hr style="margin-bottom:7px;">',e=e+'<div style="text-align:center;font-family:arial;"><h6>'+a.usuario+"</h6></div>",e+='<div style="text-align:center;font-family:arial;"><h6>Atención de Público<br>Lunes a Viernes de 8:30 a 15:00 Hrs.<br>Morande 440, Santiago Centro<br>www.conservador.cl</h6></div>',e+="</div></body></html>"}d.document.write(e),d.document.close(),c(function(){d.close()},500)},c(function(){a.generaTicket(f,g,h,i,k,l,m,n,o)},1e3),c(function(){a.printDiv("paraimprimir"),a.cancel()},1e3),a.cancel=function(){e.dismiss("cancel")}}]),app.controller("gpOnlineModalCtrl",["$scope","$window","$timeout","$log","$modal","$modalStack","$routeParams","$modalInstance","borrador","folio",function(a,b,c,d,e,f,g,h,i,j){a.borrador=i,a.folio=j,a.cancelModal=function(){console.log(a),h.dismiss("cancel")}}]),app.controller("GponlineCtrl",["$rootScope","$scope","$timeout","$location","$http","$filter","$modal","$modalStack","$routeParams","gponlineModel","gponlineService","indiceService",function(a,b,c,d,e,f,g,h,i,j,k,l){b.fechahoy=(new Date).toJSON().split("T")[0],b.tab=j.getTab(),b.mostrar=j.getMostrar(),b.busquedaGponline=j.getBusquedaGponline(),b.busquedaCaratula=j.getBusquedaCaratula(),b.busquedaInscripcion=j.getBusquedaInscripcion(),b.busquedaPlanos=j.getBusquedaPlanos(),b.states=j.getStates(),b.gpAutomatico=null,b.req={simpleMode:!1},b.isActiveParent=function(a){return b.tab.parentActive===a},b.activateParent=function(a){b.tab.parentActive=a,j.setTab(b.tab),1===b.tab.parentActive?c(function(){b.doFocus("borrador")},200):2===b.tab.parentActive?c(function(){b.doFocus("caratula")},200):3===b.tab.parentActive&&c(function(){b.doFocus("foja")},200)},b.buscarFolio=function(){k.buscarFolios(b.busquedaGponline.borrador).then(function(a){b.closeModal(),null===a.status||(a.status?1==a.resultado.length?(b.busquedaGponline.folio=a.resultado[0].folio,b.buscarPorBorrador()):(b.busquedaGponline.folios=a.resultado,b.openfolioModal()):b.raiseErr("borrador","Problema detectado",a.msg))},function(a){b.raiseErr("borrador","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.buscarPorBorrador=function(){null!=b.busquedaGponline.fecha&&""!=b.busquedaGponline.fecha||(b.busquedaGponline.fecha=(new Date).toJSON().split("T")[0]),null!=b.busquedaGponline.anos&&""!=b.busquedaGponline.anos||(b.busquedaGponline.anos=80);var a=b.busquedaGponline.borrador,c=b.busquedaGponline.folio,d=b.busquedaGponline.fecha,e=b.busquedaGponline.anos;if(b.resetResultadoBorrador(),b.states.borrador.isLoading=!0,b.openLoadingModal("Realizando Busqueda...",""),""===c||null==c)b.buscarFolio();else{k.buscarBorrador(a,c,d,e).then(function(a){if(b.closeModal(),null===a.status);else if(a.status){if(b.busquedaGponline.duenyos=a.duenyos,b.busquedaGponline.datosPropiedad=a.datosPropiedad,b.busquedaGponline.hipoteca=a.hipotecasVigentes,b.busquedaGponline.prohibicion=a.prohibicionesVigentes,b.busquedaGponline.roles=a.listaRoles,b.busquedaGponline.fechaUltimoGP=a.fechaUltimoGP,a.gp.length>0&&(b.busquedaGponline.codigoAlpha=a.gp[0].codigoAlpha),b.busquedaGponline.gp=a.gp,b.busquedaGponline.data=a,b.busquedaGponline.eventos=a.eventos,b.busquedaGponline.numeroEventos=a.numeroEventos,b.busquedaGponline.tieneNoVigenteProp=a.tieneNoVigenteProp,b.busquedaGponline.tieneNoVigenteProh=a.tieneNoVigenteProh,b.busquedaGponline.tieneNoVigenteHipo=a.tieneNoVigenteHipo,null!=a.listaQuiebras&&a.listaQuiebras.length>0){for(var c="",d=0;d<a.listaQuiebras.length;d++)c+=a.listaQuiebras[d].tipo+" a Fojas: "+a.listaQuiebras[d].foja+" Numero: "+a.listaQuiebras[d].numero+" Año: "+a.listaQuiebras[d].ano+" "+a.listaQuiebras[d].nombres+"<br/>";b.openMensajeModal("warn","",c)}b.gpAutomatico&&a.gp.length>0&&(b.gpAutomatico=!1,b.verGPModal(b.busquedaGponline))}else b.raiseErr("borrador","Problema detectado",a.msg)},function(a){b.raiseErr("borrador","Problema detectado","No se ha podido establecer comunicación con el servidor.")})}},b.buscarCaratula=function(){var a=b.busquedaCaratula.caratula;b.resetResultadoBorrador(),b.states.borrador.isLoading=!0,b.openLoadingModal("Realizando Busqueda...",""),k.buscarBorradorPorCaratula(a).then(function(a){b.closeModal(),null===a.status||(a.status?1==a.listaBorradores.length?(b.busquedaGponline.borrador=a.listaBorradores[0].borrador,b.busquedaGponline.folio=a.listaBorradores[0].folio,b.buscarPorBorrador()):(b.busquedaGponline.folios=a.listaBorradores,b.openfolioModal()):b.raiseErr("borrador","Problema detectado",a.msg))},function(a){b.raiseErr("borrador","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.buscarBorradorPorInscripcion=function(){var a=b.busquedaInscripcion.fojas,c=b.busquedaInscripcion.numero,d=b.busquedaInscripcion.ano,e=b.busquedaInscripcion.bis,f=b.busquedaInscripcion.registro;b.resetResultadoBorrador(),b.states.borrador.isLoading=!0,b.openLoadingModal("Realizando Busqueda...",""),k.buscarBorradorPorInscripcionRegistro(a,c,d,e,f).then(function(a){b.closeModal(),null===a.status||(a.status?1==a.listaBorradores.length?(b.busquedaGponline.borrador=a.listaBorradores[0].borrador,b.busquedaGponline.folio=a.listaBorradores[0].folio,b.buscarPorBorrador()):(b.busquedaGponline.folios=a.listaBorradores,b.openfolioModal()):b.raiseErr("borrador","Problema detectado",a.msg))},function(a){b.raiseErr("borrador","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.buscarPlanos=function(){b.busquedaGponline.urls="";for(var a="[",c=0;c<b.busquedaGponline.duenyos.length;c++)a+='{"fojasProp":"'+b.busquedaGponline.duenyos[c].fojas+'", "numeroProp":"'+b.busquedaGponline.duenyos[c].numero+'", "anyoProp":"'+b.busquedaGponline.duenyos[c].anyo+'", "bisProp":"'+b.busquedaGponline.duenyos[c].bis+'"}';a+="]",b.busquedaGponline.res=a,k.buscarPlano(b.busquedaGponline.res).then(function(a){null===a.status||(a.status?(a.tienePlanos&&(b.busquedaGponline.urls=a.urls),b.busquedaPlanos.tienePlanos=a.tienePlanos,b.busquedaPlanos.data=a):b.raiseErr("borrador","Problema detectado",a.msg))},function(a){b.raiseErr("borrador","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.buscarSegunFolio=function(a){b.busquedaGponline.borrador=a.borrador,b.busquedaGponline.folio=a.folio,b.buscarPorBorrador(),b.cancel()},b.verTitulo=function(b){var c=1==b.bis;a.go("/verInscripcion/prop/"+b.fojas+"/"+b.numero+"/"+b.anyo+"/"+c+"/gponline/0")},b.verInscripcion=function(b,c){var d=1==b.bis;a.go("/verInscripcion/"+c+"/"+b.fojas+"/"+b.numero+"/"+b.anyo+"/"+d+"/gponline/0")},b.resetResultadoBorrador=function(){b.busquedaGponline.data=null,b.busquedaGponline.datosPropiedad=null,void 0!==b.busquedaGponline.duenyos&&(b.busquedaGponline.duenyos.length=0),void 0!==b.busquedaGponline.hipoteca&&(b.busquedaGponline.hipoteca.length=0),void 0!==b.busquedaGponline.prohibicion&&(b.busquedaGponline.prohibicion.length=0),void 0!==b.busquedaGponline.roles&&(b.busquedaGponline.roles.length=0),b.busquedaGponline.urls="",b.busquedaPlanos.data=null,b.busquedaPlanos.tienePlanos=null,b.mostrar.mostrarInactivosProp=!1,b.mostrar.mostrarInactivosProh=!1,b.mostrar.mostrarInactivosHipo=!1,b.cleanErr("borrador")},b.limpiarBorrador=function(){b.resetResultadoBorrador(),b.busquedaGponline.borrador=null,b.busquedaGponline.folio="",b.busquedaGponline.fecha=null,b.busquedaGponline.anos=null,b.doFocus("borrador")},b.limpiarCaratula=function(){b.resetResultadoBorrador(),b.busquedaCaratula.caratula=null,b.doFocus("caratula")},b.limpiarInscripcion=function(){b.resetResultadoBorrador(),b.busquedaInscripcion.fojas=null,b.busquedaInscripcion.numero=null,b.busquedaInscripcion.ano=null,b.doFocus("foja")},b.doFocus=function(a){b.$broadcast(a+"IsFocused")},b.raiseErr=function(a,c,d){b.closeModal(),b.states[a].isError=!0,b.states[a].title=c,b.states[a].msg=d},b.cleanErr=function(a){b.states[a].isError=!1,b.states[a].title="",b.states[a].msg=""},b.openMensajeModal=function(a,d,e,f,h){g.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return d},detalle:function(){return e}}}),f&&c(function(){b.closeModal()},1e3*h)},b.openLoadingModal=function(a,b){g.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},b.openfolioModal=function(){g.open({templateUrl:"foliosModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"GponlineCtrl",resolve:{busquedaGponline:function(){return b.busquedaGponline}}})},b.openGpCertfEmitModal=function(){g.open({templateUrl:"gpCertificadoEmitidoModal.html",backdrop:"static",keyboard:!1,size:"lg",windowClass:"modal",controller:"GponlineCtrl",resolve:{busquedaGponline:function(){return b.busquedaGponline}}})},b.openEventosModal=function(){g.open({templateUrl:"gpEventosModal.html",backdrop:"static",keyboard:!1,size:"lg",windowClass:"modal",controller:"GponlineCtrl",resolve:{busquedaGponline:function(){return b.busquedaGponline}}})},b.openCaratulasModal=function(){g.open({templateUrl:"gpCaratulasModal.html",backdrop:"static",keyboard:!1,size:"lg",windowClass:"modal",controller:"GponlineCtrl",resolve:{busquedaGponline:function(){return b.busquedaGponline}}})},b.verEstadoCaratula=function(a){g.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})},b.closeModal=function(){var a=h.getTop();a&&h.dismiss(a.key)},b.anos=function(a){return!(a>80)},c(function(){1===b.tab.parentActive?b.doFocus("borrador"):2===b.tab.parentActive?b.doFocus("caratula"):3===b.tab.parentActive&&b.doFocus("foja")},200),b.archivoNacional=function(b){return!(b<a.aioParametros.anoArchivoNacional)},b.anoActual=function(a){return!(moment(new Date).year()<a)},b.cancel=function(){var a=h.getTop();a&&h.dismiss(a.key)},b.vertodoProp=function(){b.mostrar.mostrarInactivosProp?b.mostrar.mostrarInactivosProp=!1:b.mostrar.mostrarInactivosProp=!0},b.vertodoProh=function(){b.mostrar.mostrarInactivosProh?b.mostrar.mostrarInactivosProh=!1:b.mostrar.mostrarInactivosProh=!0},b.vertodoHipo=function(){b.mostrar.mostrarInactivosHipo?b.mostrar.mostrarInactivosHipo=!1:b.mostrar.mostrarInactivosHipo=!0},b.verGP=function(){var c=b.busquedaGponline.codigoAlpha;a.go("/verGP/"+c+"/gponline")},b.verGPModal=function(a){g.open({templateUrl:"views/verGP.html",backdrop:"static",keyboard:!1,size:"lg",windowClass:"modal modal-dialog-xl",controller:"VerGPCtrl",resolve:{codigoAlphap:function(){return a.codigoAlpha},origenp:function(){return"gponline"}}})},b.buscarCaratulas=function(){var a="[";angular.forEach(b.busquedaGponline.duenyos,function(b,c){a+='{"fojasProp":"'+b.fojas+'", "numeroProp":"'+b.numero+'", "anyoProp":"'+b.anyo+'", "bisProp":"'+b.bis+'"}'}),a+="]",k.buscarCaratulas(b.busquedaGponline.borrador,b.busquedaGponline.folio,a).then(function(a){null===a.status||(a.status?(b.busquedaGponline.listaCaratulaPorPropiedad=a.caratulasPorPropiedad,b.openCaratulasModal()):b.openCaratulasModal())},function(a){b.raiseErr("borrador","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.verTipoImagenHipo=function(c){var d=1==c.bis;if("AIO AGUAS"==a.aioParametros.sistema)a.go("/verInscripcion/hip/"+c.fojas+"/"+c.numero+"/"+c.anyo+"/"+d+"/gponline");else{e.get("../do/service/inscripcionDigital?metodo=existeDocumentoReg&foja="+c.fojas+"&numero="+c.numero+"&ano="+c.anyo+"&bis="+c.bis+"&registro=hip").then(function(e){e.data.hayDocumento?a.go("/verInscripcionReg/hip/"+c.fojas+"/"+c.numero+"/"+c.anyo+"/"+d+"/gponline"):b.openMensajeModal("warn","","No existe documento para Foja "+c.fojas+" N&uacute;mero "+c.numero+" A&ntilde;o "+c.anyo)},function(a){b.raiseErr("borrador","Problema detectado",a.data.statusText)})}},b.verTipoImagenProh=function(c){var d=1==c.bis;if("AIO AGUAS"==a.aioParametros.sistema)a.go("/verInscripcion/proh/"+c.fojas+"/"+c.numero+"/"+c.anyo+"/"+d+"/gponline");else{e.get("../do/service/inscripcionDigital?metodo=existeDocumentoReg&foja="+c.fojas+"&numero="+c.numero+"&ano="+c.anyo+"&registro=proh").then(function(e){e.data.hayDocumento?a.go("/verInscripcionReg/proh/"+c.fojas+"/"+c.numero+"/"+c.anyo+"/"+d+"/gponline"):b.openMensajeModal("warn","","No existe documento para Foja "+c.fojas+" N&uacute;mero "+c.numero+" A&ntilde;o "+c.anyo)},function(a){b.raiseErr("borrador","Problema detectado",a.data.statusText)})}},b.stringIsNumber=function(a){return(+a).toString()===a},c(function(){void 0!==i.borrador&&null==b.busquedaGponline.borrador&&b.stringIsNumber(i.borrador)&&(b.busquedaGponline.borrador=i.borrador,b.busquedaGponline.folio=null!=i.folio?i.folio:"",b.busquedaGponline.anos=null!=i.anyos?i.anyos:"",c(function(){b.buscarPorBorrador()},500)),1==i.gp&&null==b.gpAutomatico&&(b.gpAutomatico=!0),b.doFocus("borrador")},500),b.openSolicitar=function(a,c){var d=null,e=null,f=null;d=a.fojas,e=a.numero,f=a.anyo;g.open({templateUrl:"indiceModal.html",backdrop:!0,windowClass:"modal",controller:"IndiceModalCtrl",resolve:{resolveModal:function(){return b.resolveModal},foja:function(){return d},numero:function(){return e},ano:function(){return f},registro:function(){return c},indice:function(){return a},origen:function(){return"gp"},titulos:function(){return""}}})},b.ticket=function(a,c){var d=null,e=null,f=null,h=null,i=null,j=!1,k=!1,m=!1,n=!1;"prop"==c||"com"==c?(d=a.fojas,e=a.numero,f=a.anyo,h="false","prop"==c?(a.nombre,a.dir,a.comuna,j=!0):"com"==c&&(a.nombreSociedad,n=!0)):"hip"==c?(d=a.fojas,e=a.numero,f=a.anyo,h="false",a.nombre,k=!0):"proh"==c&&(d=a.fojas,e=a.numero,f=a.anyo,h="false",a.nombre,m=!0),l.getIndicePropiedades(null,null,null,d,e,f,h,null,null,null,null,null,j,k,m,n,null,null,null).then(function(a){if(null===a.status);else if(a.status){if("prop"==c)for(var h in a.aaData){i=a.aaData[h];break}else if("hip"==c)for(var h in a.aaData){i=a.aaData[h];break}else if("proh"==c)for(var h in a.aaData){i=a.aaData[h];break}g.open({templateUrl:"TicketInformacion.html",backdrop:!0,windowClass:"modal",controller:"TicketInformacionCtrl",resolve:{resolveModal:function(){return b.resolveModal},foja:function(){return d},numero:function(){return e},ano:function(){return f},nombre:function(){return i.nombre},direccion:function(){return i.dir},comuna:function(){return i.comuna},registro:function(){return c},titulos:function(){return""}}})}else b.raiseErr("buscar","Problema detectado",a.msg)},function(a){b.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})}}]),app.controller("HomeCtrl",["$scope","$routeParams","$modal","$rootScope","$timeout",function(a,b,c,d,e){a.tipo=b.tipo,a.cartel={bienvenido:!1,sinAcceso:!1},"b"===a.tipo&&(a.cartel.bienvenido=!0),"sa"===a.tipo&&(a.cartel.sinAcceso=!0),a.openPerfilesModal=function(){c.open({templateUrl:"perfilesModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"PerfilesModalCtrl"})},d.$watch("perfiles",function(){void 0!==d.perfiles&&void 0==d.perfil&&e(function(){a.openPerfilesModal()},500)})}]),app.controller("IndiceCtrl",["$scope","$timeout","$window","$rootScope","$location","$anchorScroll","solicitudesModel","indiceModel","indiceService","solicitudService","inscripcionDigitalService","RutHelper","$filter","$modal","$modalStack","$routeParams",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(a.busquedaIndice=h.getBusquedaIndice(),a.states=h.getStates(),a.listaPropiedad=h.getListaPropiedad(),a.listaProhibiciones=h.getListaProhibiciones(),a.listaHipoteca=h.getListaHipoteca(),a.listaComercio=h.getListaComercio(),a.tab=g.getTab(),a.rowHighilited=function(b){a.busquedaIndice.selectedRow=b},a.solicitudStatus={ok:!1,error:!1,warning:!1,msgTitle:null,msg:null,tipo:null},a.solicita={foja:null,numero:null,ano:null,bis:!1,tipo:null,esDigital:!1,tieneRechazo:!1},a.paginacionMaster={currentPage:1,numPerPage:10,maxSize:10,filteredTodos:[],todos:[]},a.datosSesion={rut:null,requirente:null},a.contador={usuario:null,total:null},void 0==a.busquedaIndice.listaactos||0==a.busquedaIndice.listaactos.length){var q=i.obtenerActos();q.then(function(b){null===b.status||(b.status?a.busquedaIndice.listaactos=b.actos:a.setErr("data.msg",b.msg))},function(b){a.setErr("Problema contactando al servidor.","")})}if(void 0==a.busquedaIndice.listatipos||0==a.busquedaIndice.listatipos.length){var q=i.obtenerTipos();q.then(function(b){null===b.status||(b.status?a.busquedaIndice.listatipos=b.tipos:a.setErr("data.msg",b.msg))},function(b){a.setErr("Problema contactando al servidor.","")})}if(void 0==a.busquedaIndice.listaconservadores||0==a.busquedaIndice.listaconservadores.length){var q=i.obtenerCBRSDisponibles();q.then(function(b){null===b.status||(b.status?a.busquedaIndice.listaconservadores=b.conservadores:a.raiseErr("buscar","Problema detectado",b.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})}if(a.buscarporregistro=function(b){var c=a.busquedaIndice.buscarPorInscricionHipo,d=a.busquedaIndice.buscarPorInscricionProh;0==b?(void 0!==a.listaHipoteca.data&&(a.listaHipoteca.data.length=0),a.listaHipoteca.inicio=0,a.listaHipoteca.fin=a.listaHipoteca.offset,c?a.buscarIndice():a.buscarIndiceHipoteca()):1==b&&(void 0!==a.listaProhibiciones.data&&(a.listaProhibiciones.data.length=0),a.listaProhibiciones.inicio=0,a.listaProhibiciones.fin=a.listaProhibiciones.offset,d?a.buscarIndice():a.buscarIndiceProhibiciones())},a.buscarIndiceHipoteca=function(){var b=a.busquedaIndice.foja,c=a.busquedaIndice.numero,d=a.busquedaIndice.ano,e=a.busquedaIndice.bis,f=a.busquedaIndice.rut,g=a.busquedaIndice.nombre,h=a.busquedaIndice.direccion,j=a.busquedaIndice.propiedades,k=a.busquedaIndice.hipoteca,l=a.busquedaIndice.prohibiciones,m=a.busquedaIndice.comercio,n=a.busquedaIndice.buscarPorInscricionHipo,o=a.busquedaIndice.buscarPorInscricionProh,p=a.busquedaIndice.exacta;if(null!=a.busquedaIndice.comuna)var q=a.busquedaIndice.comuna.codigo;if(null!=a.busquedaIndice.anoInscripcion)var r=a.busquedaIndice.anoInscripcion.codigo;if(null!=a.busquedaIndice.conservador){var s=a.busquedaIndice.conservador.ip;a.busquedaIndice.conservadorelegido=a.busquedaIndice.conservador}else a.busquedaIndice.conservadorelegido=null;a.openLoadingModal("Buscando...",""),i.getIndicePropiedades(f,g,h,b,c,d,e,q,r,"","",p,j,k,l,m,n,o,s).then(function(b){a.closeModal(),null===b.status||(b.status?(a.busquedaIndice.data=b,b.aaDataHipotecas.length>0&&(o||(a.busquedaIndice.resultadoshipotecas=b.aaDataHipotecas,a.loadMoreHipoteca(),a.activateParent(3)))):a.raiseErr("buscar","Problema detectado",b.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.buscarIndiceProhibiciones=function(){var b=a.busquedaIndice.foja,c=a.busquedaIndice.numero,d=a.busquedaIndice.ano,e=a.busquedaIndice.bis,f=a.busquedaIndice.rut,g=a.busquedaIndice.nombre,h=a.busquedaIndice.direccion,j=a.busquedaIndice.propiedades,k=a.busquedaIndice.hipoteca,l=a.busquedaIndice.prohibiciones,m=a.busquedaIndice.comercio,n=a.busquedaIndice.buscarPorInscricionHipo,o=a.busquedaIndice.buscarPorInscricionProh,p=a.busquedaIndice.exacta;if(null!=a.busquedaIndice.comuna)var q=a.busquedaIndice.comuna.codigo;if(null!=a.busquedaIndice.anoInscripcion)var r=a.busquedaIndice.anoInscripcion.codigo;if(null!=a.busquedaIndice.conservador){var s=a.busquedaIndice.conservador.ip;a.busquedaIndice.conservadorelegido=a.busquedaIndice.conservador}else a.busquedaIndice.conservadorelegido=null;a.openLoadingModal("Buscando...",""),i.getIndicePropiedades(f,g,h,b,c,d,e,q,r,"","",p,j,k,l,m,n,o,s).then(function(b){a.closeModal(),null===b.status||(b.status?(a.busquedaIndice.data=b,b.aaDataProhibiciones.length>0&&(n||(a.busquedaIndice.resultadosprohibiciones=b.aaDataProhibiciones,a.loadMoreProhibiciones(),a.activateParent(2)))):a.raiseErr("buscar","Problema detectado",b.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.buscarIndice=function(){var b=a.busquedaIndice.foja,c=a.busquedaIndice.numero,d=a.busquedaIndice.ano,e=a.busquedaIndice.bis,f=a.busquedaIndice.rut,g=a.busquedaIndice.nombre,h=a.busquedaIndice.direccion,j=a.busquedaIndice.propiedades,k=a.busquedaIndice.hipoteca,l=a.busquedaIndice.prohibiciones,m=a.busquedaIndice.comercio,n=a.busquedaIndice.buscarPorInscricionHipo,o=a.busquedaIndice.buscarPorInscricionProh,p=a.busquedaIndice.exacta;if(n||o||a.resetResultadoIndice(),null!=a.busquedaIndice.comuna)var q=a.busquedaIndice.comuna.codigo;if(null!=a.busquedaIndice.anoInscripcion)var r=a.busquedaIndice.anoInscripcion.codigo;if(null!=a.busquedaIndice.acto)var s=a.busquedaIndice.acto.nombre;if(null!=a.busquedaIndice.tipo)var t=a.busquedaIndice.tipo.nombre;if(null!=a.busquedaIndice.conservador){var u=a.busquedaIndice.conservador.ip;a.busquedaIndice.conservadorelegido=a.busquedaIndice.conservador}else a.busquedaIndice.conservadorelegido=null;a.openLoadingModal("Buscando...",""),i.getIndicePropiedades(f,g,h,b,c,d,e,q,r,s,t,p,j,k,l,m,n,o,u).then(function(b){a.closeModal(),null===b.status||(b.status?(a.busquedaIndice.data=b,b.aaDataComercio.length>0&&(n||o||(a.busquedaIndice.resultadoscomercio=b.aaDataComercio,a.loadMoreComercio(),a.activateParent(4))),b.aaDataHipotecas.length>0&&(o||(a.busquedaIndice.resultadoshipotecas=b.aaDataHipotecas,a.loadMoreHipoteca(),a.activateParent(3))),b.aaDataProhibiciones.length>0&&(n||(a.busquedaIndice.resultadosprohibiciones=b.aaDataProhibiciones,a.loadMoreProhibiciones(),a.activateParent(2))),b.aaData.length>0&&(n||o||(a.busquedaIndice.resultados=b.aaData,a.loadMorePropiedad(),a.activateParent(1))),a.makeTodos()):a.raiseErr("buscar","Problema detectado",b.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.loadMorePropiedad=function(){var b=a.busquedaIndice.resultados.slice(a.listaPropiedad.inicio,a.listaPropiedad.fin);angular.forEach(b,function(b){a.listaPropiedad.data.push(b)}),a.listaPropiedad.inicio=a.listaPropiedad.inicio+a.listaPropiedad.offset,a.listaPropiedad.fin=a.listaPropiedad.fin+a.listaPropiedad.offset},a.loadMoreProhibiciones=function(){var b=a.busquedaIndice.resultadosprohibiciones.slice(a.listaProhibiciones.inicio,a.listaProhibiciones.fin);angular.forEach(b,function(b){a.listaProhibiciones.data.push(b)}),a.listaProhibiciones.inicio=a.listaProhibiciones.inicio+a.listaProhibiciones.offset,a.listaProhibiciones.fin=a.listaProhibiciones.fin+a.listaProhibiciones.offset},a.loadMoreHipoteca=function(){var b=a.busquedaIndice.resultadoshipotecas.slice(a.listaHipoteca.inicio,a.listaHipoteca.fin);angular.forEach(b,function(b){a.listaHipoteca.data.push(b)}),a.listaHipoteca.inicio=a.listaHipoteca.inicio+a.listaHipoteca.offset,a.listaHipoteca.fin=a.listaHipoteca.fin+a.listaHipoteca.offset},a.loadMoreComercio=function(){var b=a.busquedaIndice.resultadoscomercio.slice(a.listaComercio.inicio,a.listaComercio.fin);angular.forEach(b,function(b){a.listaComercio.data.push(b)}),a.listaComercio.inicio=a.listaComercio.inicio+a.listaComercio.offset,a.listaComercio.fin=a.listaComercio.fin+a.listaComercio.offset},a.resolveModal={refresca:!1},a.resetResultadoIndice=function(){a.busquedaIndice.data=null,a.states.buscar.isError=!1,a.busquedaIndice.buscarPorInscricionHipo=!1,a.busquedaIndice.buscarPorInscricionProh=!1,void 0!==a.busquedaIndice.resultados&&(a.busquedaIndice.resultados.length=0),void 0!==a.busquedaIndice.resultadosprohibiciones&&(a.busquedaIndice.resultadosprohibiciones.length=0),void 0!==a.busquedaIndice.resultadoshipotecas&&(a.busquedaIndice.resultadoshipotecas.length=0),void 0!==a.busquedaIndice.resultadoscomercio&&(a.busquedaIndice.resultadoscomercio.length=0),void 0!==a.listaPropiedad.data&&(a.listaPropiedad.data.length=0),a.listaPropiedad.inicio=0,a.listaPropiedad.fin=a.listaPropiedad.offset,void 0!==a.listaProhibiciones.data&&(a.listaProhibiciones.data.length=0),a.listaProhibiciones.inicio=0,a.listaProhibiciones.fin=a.listaProhibiciones.offset,void 0!==a.listaHipoteca.data&&(a.listaHipoteca.data.length=0),a.listaHipoteca.inicio=0,a.listaHipoteca.fin=a.listaHipoteca.offset,void 0!==a.listaComercio.data&&(a.listaComercio.data.length=0),a.listaComercio.inicio=0,a.listaComercio.fin=a.listaComercio.offset},a.limpiarTitulo=function(){a.resetResultadoIndice(),a.busquedaIndice.foja=null,a.busquedaIndice.numero=null,a.busquedaIndice.ano=null,a.busquedaIndice.bis=!1,a.busquedaIndice.rut=null,a.busquedaIndice.nombre=null,a.busquedaIndice.direccion=null,a.busquedaIndice.comuna=null,a.busquedaIndice.anoInscripcion=null,a.busquedaIndice.acto=null,a.busquedaIndice.tipo=null,a.busquedaIndice.conservador=null,a.myform.$setPristine(!0),a.doFocus("nombre"),a.indicebusqueda=!1},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.archivoNacional=function(a){return!(a<d.aioParametros.anoArchivoNacional)},a.anoActual=function(a){return!(moment(new Date).year()<a)},a.openLoadingModal=function(a,b){n.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.closeModal=function(){var a=o.getTop();a&&o.dismiss(a.key)},a.raiseErr=function(b,c,d){a.closeModal(),a.states[b].isError=!0,a.states[b].title=c,a.states[b].msg=d},a.reingresar=function(b,c,e){i.guardaensesion(b.foja,b.num,b.ano,b.bis,c,e).then(function(b){null===b.status||(b.status?d.go("/reingreso"):a.raiseErr("buscar","Problema detectado",b.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.openSolicitar=function(b,c){a.rowHighilited(b.id),a.resolveModal.refresca=!1;var d=null,e=null,f=null;"prop"==c||"com"==c?(d=b.foja,e=b.num,f=b.ano):"hip"==c?(d=b.fojah,e=b.numh,f=b.anoh):(d=b.fojaph,e=b.numph,f=b.anoph),n.open({templateUrl:"indiceModal.html",backdrop:!0,windowClass:"modal",controller:"IndiceModalCtrl",resolve:{resolveModal:function(){return a.resolveModal},foja:function(){return d},numero:function(){return e},ano:function(){return f},registro:function(){return c},indice:function(){return b},origen:function(){return"indice"},titulos:function(){return""}}}).result.then(function(){console.log(a.resolveModal.refresca),a.resolveModal.refresca},function(){console.log(a.resolveModal.refresca),a.resolveModal.refresca})},a.masInfo=function(b){a.rowHighilited(b.id),a.resolveModal.refresca=!1,n.open({templateUrl:"masInfoindiceModal.html",backdrop:!0,windowClass:"modal",controller:"masinfoindiceModalCtrl",resolve:{resolveModal:function(){return a.resolveModal},titulo:function(){return b},foja:function(){return b.foja},numero:function(){return b.num},ano:function(){return b.ano},caratula:function(){return b.caratula}}}).result.then(function(){console.log(a.resolveModal.refresca),a.resolveModal.refresca},function(){console.log(a.resolveModal.refresca),a.resolveModal.refresca})},a.solicitar=function(b){a.resetStatus(),a.isLoadingSolicitar=!0;var c=b.foja,d=b.num,e=b.ano;j.saveSingle(c,d,e,"false").then(function(c){null===c.status||(c.status?(a.solicitudStatus.ok=!0,b.button_clicked=!0,a.isLoadingSolicitar=!1):(a.isLoadingSolicitar=!1,a.setErr("Problema detectado.","No se ha guardado la solicitud.")))},function(b){a.isLoadingSolicitar=!1,a.setErr("Problema contactando al servidor.","No se ha guardado la solicitud.")})},a.verTitulo=function(b){a.rowHighilited(b.id);var c=1==b.bis;d.go("/verInscripcion/prop/"+b.foja+"/"+b.num+"/"+b.ano+"/"+c+"/indice/0")},a.verTipoImagenHipo=function(b){a.rowHighilited(b.id);var c=1==b.bis;d.go("/verInscripcionReg/hip/"+b.fojah+"/"+b.numh+"/"+b.anoh+"/"+c+"/indice")},a.verTipoImagenProh=function(b){a.rowHighilited(b.id);var c=1==b.bis;d.go("/verInscripcionReg/proh/"+b.fojaph+"/"+b.numph+"/"+b.anoph+"/"+c+"/indice")},a.verTipoImagenCom=function(b){a.rowHighilited(b.id);var c=1==b.bis;d.go("/verInscripcionReg/com/"+b.foja+"/"+b.num+"/"+b.ano+"/"+c+"/indice")},a.resetStatus=function(){a.solicitudStatus.ok=!1,a.solicitudStatus.error=!1,a.solicitudStatus.warning=!1,a.solicitudStatus.msgTitle=null,a.solicitudStatus.msg=null},a.verTipoImagen=function(b){a.rowHighilited(b.id);var c=1==b.bis;a.openLoadingModal("Buscando...",""),k.getInscripcionJPG(b.foja,b.num,b.ano,c).then(function(c){a.closeModal(),null===c.status||(c.status?c.res.tienerechazo?(b.tipodocumento=0,a.openVerInscripcion(b),a.pasoPreSolicitar=!1):(b.esDigital=c.res.anodigital,c.res.consultaDocumentoDTO.hayDocumento?8!=c.res.consultaDocumentoDTO.tipoDocumento?(9==c.res.consultaDocumentoDTO.tipoDocumento?b.tipodocumento=2:10==c.res.consultaDocumentoDTO.tipoDocumento&&(b.tipodocumento=4),a.openVerInscripcion(b),a.pasoPreSolicitar=!1):a.verTitulo(b):(b.tipodocumento=1,a.openVerInscripcion(b),a.pasoPreSolicitar=!1)):a.raiseErr("buscar","Problema detectado",c.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.openVerInscripcion=function(b){a.$broadcast("sfojaIsFocused"),a.resolveModal.refresca=!1,n.open({templateUrl:"solicitarIndiceModal.html",backdrop:!0,windowClass:"modal",controller:"SolicitarIndiceModalCtrl",resolve:{resolveModal:function(){return a.resolveModal},titulo:function(){return b}}}).result.then(function(){console.log(a.resolveModal.refresca),a.resolveModal.refresca},function(){console.log(a.resolveModal.refresca),a.resolveModal.refresca})},a.isActiveParent=function(b){return a.tab.parentActive===b},a.activateParent=function(b){a.tab.parentActive=b,g.setTab(a.tab)},void 0!=a.busquedaIndice.comunas&&0!=a.busquedaIndice.comunas.length||(a.busquedaIndice.comunas=[{codigo:23,descripcion:"Cerrillos"},{codigo:15,descripcion:"Cerro Navia"},{codigo:22,descripcion:"Colina"},{codigo:26,descripcion:"Conchali"},{codigo:13,descripcion:"Estacion Central"},{codigo:12,descripcion:"Huechuraba"},{codigo:11,descripcion:"Independencia"},{codigo:9,descripcion:"La Florida"},{codigo:25,descripcion:"La Reina"},{codigo:20,descripcion:"Lampa"},{codigo:3,descripcion:"Las Condes"},{codigo:5,descripcion:"Lo Barnechea"},{codigo:16,descripcion:"Lo Prado"},{codigo:7,descripcion:"Macul"},{codigo:14,descripcion:"Maipu"},{codigo:6,descripcion:"Ñuñoa"},{codigo:8,descripcion:"Peñalolen"},{codigo:2,descripcion:"Providencia"},{codigo:17,descripcion:"Pudahuel"},{codigo:19,descripcion:"Quilicura"},{codigo:24,descripcion:"Quinta Normal"},{codigo:10,descripcion:"Recoleta"},{codigo:18,descripcion:"Renca"},{codigo:1,descripcion:"Santiago"},{codigo:21,descripcion:"Til til"},{codigo:4,descripcion:"Vitacura"}]),void 0==a.busquedaIndice.anosInscripciones||0==a.busquedaIndice.anosInscripciones.length)for(var r=(new Date).getFullYear(),s=r-80;s<=r;s++)a.busquedaIndice.anosInscripciones.push({codigo:s,descripcion:s});a.setErr=function(b,c){a.solicitudStatus.error=!0,a.setStatusMsg(b,c)},a.setStatusMsg=function(b,c){a.solicitudStatus.msgTitle=b,a.solicitudStatus.msg=c},a.ticket=function(b,c){a.rowHighilited(b.id),a.resolveModal.refresca=!1;var d=null,e=null,f=null,g=null,h=null,i=null;"prop"==c||"com"==c?(d=b.foja,e=b.num,f=b.ano,"false","prop"==c?(g=b.nombre,h=b.dir,i=b.comuna):"com"==c&&(g=b.nombreSociedad)):"hip"==c?(d=b.fojah,e=b.numh,f=b.anoh,"false",g=b.nombre):(d=b.fojaph,e=b.numph,f=b.anoph,"false",g=b.nombre);n.open({templateUrl:"TicketInformacion.html",backdrop:!0,windowClass:"modal",controller:"TicketInformacionCtrl",resolve:{resolveModal:function(){return a.resolveModal},foja:function(){return d},numero:function(){return e},ano:function(){return f},nombre:function(){return g},direccion:function(){return h},comuna:function(){return i},registro:function(){return c},titulos:function(){return""}}})},a.exportarExcel=function(){var b=a.busquedaIndice.foja,d=a.busquedaIndice.numero,e=a.busquedaIndice.ano,f=a.busquedaIndice.bis,g=a.busquedaIndice.rut,h=a.busquedaIndice.nombre,i=a.busquedaIndice.direccion,j=a.busquedaIndice.propiedades,k=a.busquedaIndice.hipoteca,l=a.busquedaIndice.prohibiciones,m=a.busquedaIndice.comercio,n=a.busquedaIndice.buscarPorInscricionHipo,o=a.busquedaIndice.buscarPorInscricionProh,p=a.busquedaIndice.exacta;if(n||o||a.resetResultadoIndice(),null!=a.busquedaIndice.comuna)var q=a.busquedaIndice.comuna.codigo;if(null!=a.busquedaIndice.anoInscripcion)var r=a.busquedaIndice.anoInscripcion.codigo;if(null!=a.busquedaIndice.acto)var s=a.busquedaIndice.acto.nombre;if(null!=a.busquedaIndice.tipo)var t=a.busquedaIndice.tipo.nombre;if(null!=a.busquedaIndice.conservador){var u=a.busquedaIndice.conservador.ip;a.busquedaIndice.conservadorelegido=a.busquedaIndice.conservador}else a.busquedaIndice.conservadorelegido=null;c.location.href=c.location.protocol+"//"+c.location.host+"/aio/do/service/indice?metodo=exportarExcel&rut="+g+"&apellidos="+h+"&direccion="+i+"&foja="+b+"&numero="+d+"&ano="+e+"&bis="+f+"&comuna="+q+"&anoInscripcion="+r+"&acto="+s+"&tipo="+t+"&exacta="+p+"&regPropiedades="+j+"&regHipoteca="+k+"&regProhibiciones="+l+"&regComercio="+m+"&buscarPorInscricionHipo="+n+"&buscarPorInscricionProh="+o+"&conservador="+u},a.contarAtencion=function(){n.open({templateUrl:"ingresaRutModal.html",backdrop:!0,windowClass:"modal",controller:"ingresaRutModalCtrl"}).result.then(function(){i.getRutSesion().then(function(b){null===b.status||b.status&&(a.datosSesion.rut=l.format(b.rut),a.datosSesion.requirente=b.requirente,a.obtenerAtencionPorDia())},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},function(){i.getRutSesion().then(function(b){null===b.status||b.status&&(a.datosSesion.rut=l.format(b.rut),a.datosSesion.requirente=b.requirente,a.obtenerAtencionPorDia())},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})})},a.paginacion=angular.copy(a.paginacionMaster),a.paginacioncom=angular.copy(a.paginacionMaster),a.paginacionproh=angular.copy(a.paginacionMaster),a.paginacionhipo=angular.copy(a.paginacionMaster),a.paginacion.todos=a.busquedaIndice.resultados,a.paginacioncom.todos=a.busquedaIndice.resultadoscomercio,a.paginacionhipo.todos=a.busquedaIndice.resultadoshipotecas,a.paginacionproh.todos=a.busquedaIndice.resultadosprohibiciones,a.makeTodos=function(){a.paginacion=angular.copy(a.paginacionMaster),a.paginacioncom=angular.copy(a.paginacionMaster),a.paginacionproh=angular.copy(a.paginacionMaster),a.paginacionhipo=angular.copy(a.paginacionMaster),a.paginacion.todos=a.busquedaIndice.resultados,a.paginacioncom.todos=a.busquedaIndice.resultadoscomercio,a.paginacionhipo.todos=a.busquedaIndice.resultadoshipotecas,a.paginacionproh.todos=a.busquedaIndice.resultadosprohibiciones;var b=(a.paginacion.currentPage-1)*a.paginacion.numPerPage,c=b+a.paginacion.numPerPage,d=(a.paginacioncom.currentPage-1)*a.paginacioncom.numPerPage,e=d+a.paginacioncom.numPerPage,f=(a.paginacionproh.currentPage-1)*a.paginacionproh.numPerPage,g=f+a.paginacionproh.numPerPage,h=(a.paginacionhipo.currentPage-1)*a.paginacionhipo.numPerPage,i=h+a.paginacionhipo.numPerPage;a.paginacion.filteredTodos=a.paginacion.todos.slice(b,c),a.paginacioncom.filteredTodos=a.paginacioncom.todos.slice(d,e),a.paginacionproh.filteredTodos=a.paginacionproh.todos.slice(f,g),a.paginacionhipo.filteredTodos=a.paginacionhipo.todos.slice(h,i),a.busquedaIndice.indicebusqueda=!0},a.$watch("paginacion.currentPage + paginacion.numPerPage",function(){var b=(a.paginacion.currentPage-1)*a.paginacion.numPerPage,c=b+a.paginacion.numPerPage;a.paginacion.filteredTodos=a.paginacion.todos.slice(b,c)}),a.$watch("paginacioncom.currentPage + paginacioncom.numPerPage",function(){var b=(a.paginacioncom.currentPage-1)*a.paginacioncom.numPerPage,c=b+a.paginacioncom.numPerPage;a.paginacioncom.filteredTodos=a.paginacioncom.todos.slice(b,c)}),a.$watch("paginacionproh.currentPage + paginacionproh.numPerPage",function(){var b=(a.paginacionproh.currentPage-1)*a.paginacionproh.numPerPage,c=b+a.paginacionproh.numPerPage;a.paginacionproh.filteredTodos=a.paginacionproh.todos.slice(b,c)}),a.$watch("paginacionhipo.currentPage + paginacionhipo.numPerPage",function(){var b=(a.paginacionhipo.currentPage-1)*a.paginacionhipo.numPerPage,c=b+a.paginacionhipo.numPerPage;a.paginacionhipo.filteredTodos=a.paginacionhipo.todos.slice(b,c)}),a.colapsar=function(){a.busquedaIndice.indicebusqueda?a.busquedaIndice.indicebusqueda=!1:a.busquedaIndice.indicebusqueda=!0},a.colapsarnuevabusqueda=function(){a.busquedaIndice.indicebusqueda=!1,a.limpiarTitulo(),b(function(){a.doFocus("nombre")},200)},a.obtenerAtencionPorDia=function(){i.obtenerAtencionPorDia().then(function(b){null===b.status||b.status&&(a.contador.total=b.contadores.total)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},b(function(){i.getRutSesion().then(function(b){null===b.status||b.status&&(a.datosSesion.rut=l.format(b.rut),a.datosSesion.requirente=b.requirente)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")}),a.doFocus("nombre"),a.obtenerAtencionPorDia()},200),a.$on("eventoIndice",function(b,c){a.contarAtencion()})}]),app.controller("IndiceModalCtrl",["$rootScope","$routeParams","$scope","$modal","$modalInstance","$modalStack","$window","$timeout","caratulaService","indiceService","resolveModal","RutHelper","foja","numero","ano","registro","indice","origen","titulos",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){c.foja=m,c.numero=n,c.ano=o,c.registro=p,c.indice=q,c.origen=r,c.titulos=s,c.solicitudStatus={ok:!1,error:!1,warning:!1,msgTitle:null,msg:null},c.isLoadingSolicitar=!1,c.pasoPreSolicitar=!1,c.solicitaCaratula={rut:null,nombre:null,apep:null,apem:null,direccion:null,telefono:null,correo:null,foja:null,numero:null,ano:null,registro:null,tramite1:!1,obs1:c.indice.dir,tramite2:!1,obs2:c.indice.dir,tramite3:!1,obs3:c.indice.dir,tramite4:!1,obs4:c.indice.dir,tramite5:!1,obs5:c.indice.dir,rutConsultado:!1},c.limpiarCache=function(){localStorageService.remove("rawScreens")},h(function(){c.doFocus("rutt"),void 0===c.indice.dir&&(c.solicitaCaratula.obs1="",c.solicitaCaratula.obs2="",c.solicitaCaratula.obs3="",c.solicitaCaratula.obs4="",c.solicitaCaratula.obs5=""),j.getRutSesion().then(function(a){null===a.status||a.status&&(c.solicitaCaratula.rut=l.format(a.rut))},function(a){c.raiseErr("No se ha podido establecer comunicación con el servidor.")})},200),c.generaTicketModal=function(a,b,e,f,g,h,i,j,k){d.open({templateUrl:"views/generaTicket.html",backdrop:!0,windowClass:"modal",controller:"generaTicketCtrl",resolve:{resolveModal:function(){return c.resolveModal},colilla:function(){return a},tramites:function(){return b},registro:function(){return e},foja:function(){return f},numero:function(){return g},ano:function(){return h},requirente:function(){return c.solicitaCaratula.nombre+" "+c.solicitaCaratula.apep},rutrequirente:function(){return c.solicitaCaratula.rut},titulos:function(){return i},colillacanvas:function(){return j},email:function(){return k}}})},c.preSolicitaCaratula=function(){c.resetStatus(),c.isLoadingSolicitar=!0;var a="";c.solicitaCaratula.rut=l.clean(c.solicitaCaratula.rut),a=""!=c.titulos?i.savePreCaratulaMasiva(c.foja,c.numero,c.ano,c.solicitaCaratula.rut,c.solicitaCaratula.nombre,c.solicitaCaratula.apep,c.solicitaCaratula.apem,c.solicitaCaratula.direccion,c.solicitaCaratula.telefono,c.solicitaCaratula.correo,c.solicitaCaratula.tramite1,c.solicitaCaratula.tramite2,c.solicitaCaratula.tramite3,c.solicitaCaratula.tramite4,c.solicitaCaratula.tramite5,c.solicitaCaratula.obs1,c.solicitaCaratula.obs2,c.solicitaCaratula.obs3,c.solicitaCaratula.obs4,c.solicitaCaratula.obs5,c.registro,c.titulos):i.savePreCaratula(c.foja,c.numero,c.ano,c.solicitaCaratula.rut,c.solicitaCaratula.nombre,c.solicitaCaratula.apep,c.solicitaCaratula.apem,c.solicitaCaratula.direccion,c.solicitaCaratula.telefono,c.solicitaCaratula.correo,c.solicitaCaratula.tramite1,c.solicitaCaratula.tramite2,c.solicitaCaratula.tramite3,c.solicitaCaratula.tramite4,c.solicitaCaratula.tramite5,c.solicitaCaratula.obs1,c.solicitaCaratula.obs2,c.solicitaCaratula.obs3,c.solicitaCaratula.obs4,c.solicitaCaratula.obs5,c.registro,c.titulos),a.then(function(a){null===a.status||(a.status?(0!=a.colilla&&(""!=c.titulos?c.generaTicketModal(a.colilla,a.tramitesGeneral,a.registro,a.foja,a.numero,a.ano,c.titulos,a.colillacanvas,c.solicitaCaratula.correo):c.generaTicketModal(a.colilla,a.tramites,a.registro,a.foja,a.numero,a.ano,c.titulos,a.colillacanvas,c.solicitaCaratula.correo)),c.isLoadingSolicitar=!1,c.solicitudStatus.ok=!0,c.solicitudStatus.msg="Solicitud realizada correctamente"):(c.isLoadingSolicitar=!1,c.setErr("Problema detectado.","No se ha guardado solicitud de caratula.")))},function(a){c.isLoadingSolicitar=!1,c.setErr("Problema contactando al servidor.","No se ha guardado solicitud de caratula.")})},c.volverPreSolicita=function(){c.pasoPreSolicitar=!1,c.solicita.tipo=null,c.solicita.esDigital=!1,c.resetStatus(),h(function(){c.doFocus("rutt")},100)},c.cancel=function(){e.dismiss("cancel")},c.limpiarSolicitaCaratula=function(){c.resetSolicita(),c.resetStatus(),c.doFocus("rutt")},c.archivoNacional=function(b){return!(b<a.aioParametros.anoArchivoNacional)},c.anoActual=function(a){return!(moment(new Date).year()<a)},c.verInscripcion=function(){a.go("/verInscripcion/prop/"+c.solicita.foja+"/"+c.solicita.numero+"/"+c.solicita.ano+"/"+c.solicita.bis+"/indice/"+c.solicita.tipo)},c.setErr=function(a,b){c.solicitudStatus.error=!0,c.setStatusMsg(a,b)},c.setStatusMsg=function(a,b){c.solicitudStatus.msgTitle=a,c.solicitudStatus.msg=b},c.setOK=function(a,b){c.solicitudStatus.ok=!0,c.setStatusMsg(a,b)},c.resetStatus=function(){c.solicitudStatus.ok=!1,c.solicitudStatus.error=!1,c.solicitudStatus.warning=!1,c.solicitudStatus.msgTitle=null,c.solicitudStatus.msg=null},c.resetSolicita=function(){c.solicitaCaratula.rut=null,c.solicitaCaratula.nombre=null,c.solicitaCaratula.apep=null,c.solicitaCaratula.apem=null,c.solicitaCaratula.direccion=null,c.solicitaCaratula.telefono=null,c.solicitaCaratula.correo=null},c.closeModal=function(){var a=f.getTop();a&&f.dismiss(a.key)},c.doFocus=function(a){c.$broadcast(a+"IsFocused")},c.updateQuestionValue=function(a){c.value=c.value||[],a.checked?(c.value.push(a.value),c.value=_.uniq(c.value)):c.value=_.without(c.value,a.value)}}]),app.controller("InfoCtrl",["$scope","$interval","$timeout","$log","Usuario","$modal","$modalStack","$routeParams",function(a,b,c,d,e,f,g,h){a.busquedaInfo={tiemporefresco:2,predicate:"fechaUltimoAccesoL",reverse:!0},a.refrescar=function(){e.getUsuariosLogueados().then(function(b){null===b.estado||(b.estado?(a.busquedaInfo.resultados=b.listaUsuarios,a.busquedaInfo.numeroSesiones=b.numeroSesiones):a.raiseErr(b.msg))},function(b){a.raiseErr("No se ha podido establecer comunicacion con el servidor.")})},a.cacheAIO=function(){f.open({templateUrl:"../cacheAIO",keyboard:!0,size:"lg",windowClass:"modal modal-dialog-xl"})},a.$watch("busquedaInfo.tiemporefresco",function(){a.start()});var i;a.start=function(){a.stop(),0!=a.busquedaInfo.tiemporefresco&&(i=b(function(){a.refrescar()}.bind(this),6e4*a.busquedaInfo.tiemporefresco))},a.stop=function(){b.cancel(i)},a.start(),a.$on("$destroy",function(){a.stop()}),c(function(){a.refrescar()},500),a.raiseErr=function(b){a.openMensajeModal("error",b,"",!1,null)},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openMensajeModal=function(b,d,e,g,h){f.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return b},titulo:function(){return d},detalle:function(){return e}}}),g&&c(function(){a.closeModal()},1e3*h)},a.openLoadingModal=function(a,b){f.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.infoUsuarioModal=function(a){f.open({templateUrl:"infoUsuarioModal.html",backdrop:"static",keyboard:!1,size:"lg",windowClass:"modal",controller:"infoUsuarioModalCtrl",resolve:{usuarioDTO:function(){return a}}})},a.closeModal=function(){var a=g.getTop();a&&g.dismiss(a.key)},a.stringIsNumber=function(a){return(+a).toString()===a}}]),app.controller("infoUsuarioModalCtrl",["$scope","$window","$timeout","$log","$modal","$modalStack","$routeParams","$modalInstance","usuarioDTO",function(a,b,c,d,e,f,g,h,i){a.usuarioDTO=i,a.cancel=function(){h.dismiss("cancel")}}]),app.controller("ingresaRutModalCtrl",["$scope","$modalStack","$timeout","indiceService",function(a,b,c,d){a.req={rut:null},a.cancel=function(){var a=b.getTop();a&&b.dismiss(a.key)},a.agregarNuevaAtencion=function(){d.agregarNuevaAtencion(a.req.rut).then(function(b){null===b.status||(b.status?a.cancel():a.setErr("Problema detectado.","No se ha podido registrar nueva atencion."))},function(b){a.setErr("Problema contactando al servidor.","No se ha guardado la nueva atencion.")})},c(function(){a.$broadcast("rutIsFocused")},200),a.setErr=function(b,c){a.solicitudStatus.error=!0,a.setStatusMsg(b,c)},a.setStatusMsg=function(b,c){a.solicitudStatus.msgTitle=b,a.solicitudStatus.msg=c}}]),app.controller("LiquidacionCtrl",["$scope","$window","$timeout","$rootScope","$modal","$modalStack","$routeParams","tareasService","estadoService","caratulaService","$filter",function(a,b,c,d,e,f,g,h,i,j,k){a.nuevoDocumento={nombre:null,valor:null,caratula:null},a.bitacora={resultado:[]},c(function(){a.doFocus("caratula")},500),a.buscarCaratula=function(){var b=a.caratula;a.openLoadingModal("Buscando...",""),h.getCaratulaLiquidacion(b).then(function(b){if(a.closeModal(),null===b.estado);else if(b.status){a.liquidacionCaratula=b.liquidacionCaratula,a.liquidacionCaratula.caratulaDTO.diferencia=a.liquidacionCaratula.caratulaDTO.valorReal-a.liquidacionCaratula.caratulaDTO.valorPagado,a.liquidacionCaratula.status=b.status,a.liquidacionCaratula.estaIngresadaCtaCte=b.estaIngresadaCtaCte,a.liquidacionCaratula.puedeLiquidar=b.puedeLiquidar,a.liquidacionCaratula.caratulaLiquidada=b.caratulaLiquidada,a.liquidacionCaratula.caratulaPendienteEntregaDoc=b.caratulaPendienteEntregaDoc,a.liquidacionCaratula.documentosLiquidacion=b.documentosLiquidacion,a.liquidacionCaratula.busqueda=!0,a.contadorPapel=0;for(var c=0;c<a.liquidacionCaratula.papeles.length;c++){var d=a.liquidacionCaratula.papeles[c];null!=d&&null!=d.codArchivoAlpha&&(d.glosaCobroCertificado=a.getGlosa(d))}}else a.raiseErr(b.msg)},function(b){a.closeModal(),a.raiseErr("No se ha podido establecer comunicacion con el servidor.")}),a.obtenerBitacoraCaratula(),a.buscarEscritura()},a.obtenerBitacoraCaratula=function(){j.obtenerBitacoraCaratula(a.caratula).then(function(b){null===b.status||(b.status?(a.bitacora.resultado=b.listabitacoras,a.ultimaLiquidacion=k("filter")(b.listabitacoras,{observacion:"Liquidacion de caratula aprobada"})[0],a.ultimaAnulacion=k("filter")(b.listabitacoras,{observacion:"Se elimino caratula de lista pendientes a Entrega Documentos"})[0]):a.raiseErr("No se pudo obtener bitacora caratula",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.getGlosa=function(b){h.getGlosaDocumento(b.codArchivoAlpha).then(function(c){null===c.status||(c.status?(b.glosaCobroCertificado=c.glosaDocumento,a.contadorPapel++):a.raiseErr("No se pudo obtener glosa documento",c.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.buscarEscritura=function(){i.getDocumentos(a.caratula,"ESCRITURAS").then(function(b){if(null===b.status);else if(b.success){if(b.children.length>0)for(var c=0;c<b.children.length;c++)if(b.children[c].children[0].vigente){a.escritura=b.children[c].children[0];break}a.statusEscritura=b.success}else a.raiseErr(b.errormsg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.limpiar=function(){a.liquidacionCaratula=null,a.bitacora.resultado=null,a.caratula=null,a.doFocus("caratula")},a.verDocumentoEstudio=function(c){var d={nombreArchivo:c.nombreArchivoVersion,idTipoDocumento:c.idTipoDocumento,idReg:c.idReg,fechaDocumento:c.fechaProcesa};i.existeDocumento(d).then(function(d){d.hayDocumento?b.open("../do/service/escritura?metodo=verDocumentoEstudio&caratula="+a.caratula+"&version="+c.version+"&idTipoDocumento="+c.idTipoDocumento+"&type=uri","popup","width=800,height=600"):a.raiseErr(d.errormsg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.masInfoLiquidacion=function(a){e.open({templateUrl:"masInfoLiquidacionModal.html",backdrop:!0,windowClass:"modal",controller:"masInfoLiquidacionModalCtrl",resolve:{caratula:function(){return a}}})},a.verEstadoCaratula=function(a){e.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})},a.raiseErr=function(b){a.openMensajeModal("error",b,"",!1,null)},a.raiseWarn=function(b){a.openMensajeModal("warn",b,"",!1,null)},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openMensajeModal=function(b,d,f,g,h){var i=e.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return b},titulo:function(){return d},detalle:function(){return f}}});g&&c(function(){a.closeModal()},1e3*h),i.result.then(function(){a.doFocus("caratula")},function(){a.doFocus("caratula")})},a.openLoadingModal=function(a,b){e.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.closeModal=function(){var a=f.getTop();a&&f.dismiss(a.key)},a.obtenerEscritura=function(b){e.open({templateUrl:"escrituraelectronicaModal.html",backdrop:!0,windowClass:"modal",controller:"escrituraElectronicaModalCtrl",resolve:{sol:function(){return b}}}).result.then(function(){a.buscarLiquidaciones()},function(){a.buscarLiquidaciones()})},a.obtenerEscrituraPorFuera=function(b){e.open({templateUrl:"escrituraelectronicaModal.html",backdrop:!0,windowClass:"modal",controller:"escrituraElectronicaModalCtrl",resolve:{sol:function(){return b}}}).result.then(function(){a.buscarLiquidaciones()},function(){a.buscarLiquidaciones()})},a.aprobarCaratula=function(){a.openLoadingModal("procesando...","");var b=a.liquidacionCaratula.estaIngresadaCtaCte,c=a.liquidacionCaratula.caratulaDTO.idCanal,e=51;d.subPermisos.liquidacion.indexOf("LIQUIDADOR_HIPOTECA")>=0?e=53:d.subPermisos.liquidacion.indexOf("LIQUIDADOR_PROHIBICIONES")>=0&&(e=54),h.aprobarCaratula(a.liquidacionCaratula.caratulaDTO.numeroCaratula,a.liquidacionCaratula.caratulaDTO.idCanal,JSON.stringify(a.liquidacionCaratula.papeles),a.getTotalPapeles(),b,e).then(function(b){a.closeModal(),null===b.estado||(b.status?(a.limpiar(),1==c?a.openMensajeModal("success","Carátula liquidada, pero pendiente de envio a Entrega Documentos","",!0,3):a.openMensajeModal("success","Carátula liquidada exitosamente","",!0,3),b.warn&&a.raiseWarn(b.msg)):a.raiseErr(b.msg))},function(b){a.closeModal(),a.raiseErr("No se ha podido establecer comunicacion con el servidor.")})},a.downloadFirma=function(c){var d={nombreArchivo:c.nombreArchivoVersion,idTipoDocumento:3,fechaDocumento:c.fechaPdf,rutFirmador:c.usuario};i.existeFirma(d).then(function(c){c.hayDocumento?b.open(b.location.protocol+"//"+b.location.host+"/aio/do/service/estado?metodo=downloadFirma&documento="+JSON.stringify(d)+"&download=false","popupDoc","width=800,height=600"):a.raiseErr(c.errormsg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.downloadBoleta=function(c){var d={nombreArchivo:c+".pdf",idTipoDocumento:12,idReg:0};i.existeDocumento(d).then(function(c){c.hayDocumento?b.location.href=b.location.protocol+"//"+b.location.host+"/aio/do/service/estado?metodo=downloadDocumento&documento="+JSON.stringify(d):a.raiseErr(c.errormsg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.getTotalPapeles=function(){for(var b=0,c=0;c<a.liquidacionCaratula.papeles.length;c++){var d=a.liquidacionCaratula.papeles[c];null!=d&&null!=d.valorDocumento&&(b+=parseInt(d.valorDocumento))}for(var c=0;c<a.liquidacionCaratula.documentosLiquidacion.length;c++){var e=a.liquidacionCaratula.documentosLiquidacion[c];null!=e&&null!=e.valor&&(b+=parseInt(e.valor))}a.redondeoInferior=!1,a.redondeoSuperior=!1;var f=Number(b.toString().split("").pop());return 0!=f&&(f<=5?(b-=f,a.redondeoInferior=!0):(b+=10-f,a.redondeoSuperior=!0)),b},a.agregarDocumento=function(b,c,d){var e={nombre:b,valor:c,caratula:d};a.openLoadingModal("Agregando documento",""),h.agregarDocumentoLiquidacion(e).then(function(b){a.closeModal(),b.status?(a.liquidacionCaratula.documentosLiquidacion.push(angular.copy(b.documentoLiquidacion)),a.resetNuevoDocumento(),b.warn&&a.raiseWarn(b.msg)):a.raiseErr(b.msg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")}),a.doFocus("descripcion")},a.eliminarDocumento=function(b){a.openLoadingModal("Eliminando documento",""),h.anularDocumento(b.codArchivoAlpha,b.tipoDocumentoDTO.descripcion,a.liquidacionCaratula.caratulaDTO.numeroCaratula).then(function(c){a.closeModal(),c.status?(a.openMensajeModal("success","Documento anulado","",!0,2),a.eliminarDocumentoLista(b),c.warn&&a.raiseWarn(c.msg)):a.raiseErr(c.msg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.eliminarDocumentoLiquidacion=function(b){a.openLoadingModal("Eliminando documento",""),h.eliminarDocumentoLiquidacion(b).then(function(c){a.closeModal(),c.status?(a.openMensajeModal("success","Documento eliminado","",!0,2),a.eliminarDocumentoLiquidacionLista(b),c.warn&&a.raiseWarn(c.msg)):a.raiseErr(c.msg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.eliminarDocumentoLiquidacionLista=function(b){a.liquidacionCaratula.documentosLiquidacion.splice(a.liquidacionCaratula.documentosLiquidacion.indexOf(b),1)},a.eliminarDocumentoLista=function(b){a.liquidacionCaratula.papeles.splice(a.liquidacionCaratula.papeles.indexOf(b),1)},a.resetNuevoDocumento=function(){a.nuevoDocumento={caratula:null,nombre:null,valor:null}},a.verTransaccion=function(a){e.open({templateUrl:"transaccionModal.html",backdrop:!0,windowClass:"modal",controller:"transaccionModalCtrl",resolve:{caratulaDTO:function(){return a}}})},a.verListadoPendiente=function(){e.open({templateUrl:"listadoPendienteModal.html",backdrop:!0,windowClass:"modal",controller:"listadoPendienteCtrl"})},a.colapsar=function(){a.liquidacionCaratula.busqueda?a.liquidacionCaratula.busqueda=!1:a.liquidacionCaratula.busqueda=!0},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.myRightButton=function(){alert("!!! first function call!")},a.stringIsNumber=function(a){return(+a).toString()===a},c(function(){void 0!==g.caratula&&a.stringIsNumber(g.caratula)&&g.caratula.length<=10&&(a.caratula=g.caratula,c(function(){a.buscarCaratula()},500)),a.doFocus("numeroCaratula")},500)}]),app.controller("listadoPendienteCtrl",["$scope","$modal","$modalStack","$modalInstance","caratulaService",function(a,b,c,d,e){a.listadoPendiente={resultados:[],data:null,secciones:null,seccion:null},a.caratulas={caratula:null,esctacte:null},a.verMisCaratulas=!0,a.selectedAll=!0,a.envioExitoso=!1,a.eliminacionExitosa=!1,a.envioEnProceso=!1,a.envioError=!1,a.mensaje="",a.filterExprLiquidacion="",a.filterExprLiquidacion={valor:""},a.raiseErr=function(b,c,d){a.errorObj.hay=!0,a.errorObj.level=b,a.errorObj.title=c,a.errorObj.msg=d},a.errorObj={hay:!1,level:"warning",title:"",msg:""},a.verListadoPendienteUsuario=function(){a.openLoadingModal("Buscando...",""),a.verMisCaratulas=!0,e.getListadoCaratulasPendientesPorUsuario().then(function(b){a.closeModal(),null===b.estado||(b.status?(a.limpiar(),a.listadoPendiente.data=b,a.listadoPendiente.resultados=b.listacaratulas,angular.forEach(a.listadoPendiente.resultados,function(b){b.id.Selected=a.selectedAll})):a.raiseErr(b.msg))},function(b){a.closeModal(),a.raiseErr("No se ha podido establecer comunicacion con el servidor.")})},a.verListadoPendienteSeccion=function(b){a.openLoadingModal("Buscando...",""),a.verMisCaratulas=!1,e.getListadoCaratulasPendientesPorSeccion(b).then(function(b){a.closeModal(),null===b.estado||(b.status?(a.limpiar(),a.listadoPendiente.data=b,a.listadoPendiente.resultados=b.listacaratulas,angular.forEach(a.listadoPendiente.resultados,function(b){b.id.Selected=a.selectedAll})):a.raiseErr(b.msg))},function(b){a.closeModal(),a.raiseErr("No se ha podido establecer comunicacion con el servidor.")})},a.openLoadingModal=function(a,c){b.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return c}}})},a.limpiar=function(){a.listadoPendiente.resultados=null,a.selectedAll=!0},a.limpiarmensajes=function(){a.envioExitoso=!1,a.envioEnProceso=!1,a.envioError=!1,a.mensaje=""},a.closeModal=function(){var a=c.getTop();a&&c.dismiss(a.key)},a.cancel=function(){d.dismiss("cancel")},a.checkAll=function(){a.selectedAll?a.selectedAll=!1:a.selectedAll=!0,angular.forEach(a.listadoPendiente.resultados,function(b){b.id.Selected=a.selectedAll})},a.enviarEntregaDoc=function(){a.limpiarmensajes();var b=!0;a.envioEnProceso=!0,e.movercaratulaLiquidacion(a.listadoPendiente.resultados).then(function(c){null===c.status||(c.status?(a.envioExitoso=!0,a.envioEnProceso=!1,a.verListadoPendienteUsuario()):(a.envioError=!0,a.mensaje=c.msg,b=!1,a.envioEnProceso=!1))},function(c){a.envioError=!0,a.mensaje="No se ha podido establecer comunicación con el servidor",b=!1,a.envioEnProceso=!1})},a.eliminarCaratulaPendiente=function(b){a.limpiarmensajes();var c=!0;a.envioEnProceso=!0,e.eliminarCaratulaPendiente(b).then(function(b){null===b.status||(b.status?(a.eliminacionExitosa=!0,a.envioEnProceso=!1,a.verListadoPendienteUsuario()):(a.envioError=!0,a.mensaje=b.msg,c=!1,a.envioEnProceso=!1))},function(b){a.envioError=!0,a.mensaje="No se ha podido establecer comunicación con el servidor",c=!1,a.envioEnProceso=!1})},a.raiseErr=function(b){a.openMensajeModal("error",b,"",!1,null)},a.openMensajeModal=function(c,d,e,f,g){b.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return c},titulo:function(){return d},detalle:function(){return e}}});f&&$timeout(function(){a.closeModal()},1e3*g)},a.$watch("filterExprLiquidacion.valor",function(b,c){a.selectedAll=""!=b,a.checkAll()},!0),a.verListadoPendienteUsuario()}]),app.filter("startFrom",function(){return function(a,b){return a?(b=+b,a.slice(b)):[]}}),app.controller("ListadoCtaCteCtrl",["$scope","$timeout","solicitudesModel","certificacionModel","caratulaService","$modal","$modalStack","filterFilter",function(a,b,c,d,e,f,g,h){a.fechahoy=(new Date).toJSON().split("T")[0],a.busquedaCtaCte={fechaDesde:a.fechahoy,fechaHasta:a.fechahoy,resultados:[],cuenta:null,estado:null},a.states=d.getStates(),a.tab=c.getTab(),a.solicitudStatus={ok:!1,error:!1,warning:!1,msgTitle:null,msg:null,tipo:null},a.solicita={foja:null,numero:null,ano:null,bis:!1,tipo:null,esDigital:!1,tieneRechazo:!1},a.paginacionMaster={currentPage:1,numPerPage:10,maxSize:10,filteredTodos:[],todos:[]},a.paginacion=angular.copy(a.paginacionMaster),a.paginacion.todos=a.busquedaCtaCte.resultados,a.refrescar=function(){if(a.openLoadingModal("Cargando Listado...",""),null!=a.busquedaCtaCte.estado)var b=a.busquedaCtaCte.estado.codigo;e.getListadoCaratulasPorCtaCte(a.busquedaCtaCte.fechaDesde,a.busquedaCtaCte.fechaHasta,a.busquedaCtaCte.cuenta,b).then(function(b){null===b.status||(b.status?(a.busquedaCtaCte.data=b,a.busquedaCtaCte.resultados=b.listacaratulas,a.makeTodos(),a.closeModal()):(a.setErr("data.msg",b.msg),a.closeModal()))},function(b){a.setErr("Problema contactando al servidor.",""),a.closeModal()})},a.resolveModal={refresca:!1},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openLoadingModal=function(a,b){f.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.verEstadoCaratula=function(a){f.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})},a.raiseErr=function(b,c,d){a.closeModal(),a.states[b].isError=!0,a.states[b].title=c,a.states[b].msg=d},a.resetStatus=function(){a.solicitudStatus.ok=!1,a.solicitudStatus.error=!1,a.solicitudStatus.warning=!1,a.solicitudStatus.msgTitle=null,a.solicitudStatus.msg=null},a.setErr=function(b,c){a.solicitudStatus.error=!0,a.setStatusMsg(b,c)},a.setStatusMsg=function(b,c){a.solicitudStatus.msgTitle=b,a.solicitudStatus.msg=c},a.closeModal=function(){var a=g.getTop();a&&g.dismiss(a.key)},void 0!=a.busquedaCtaCte.estados&&0!=a.busquedaCtaCte.estados.length||(a.busquedaCtaCte.estados=[{codigo:0,descripcion:"En Proceso"},{codigo:2,descripcion:"Rechazadas"},{codigo:1,descripcion:"Finalizadas"}]),a.makeTodos=function(){a.paginacion=angular.copy(a.paginacionMaster),a.paginacion.todos=a.busquedaCtaCte.resultados;var b=(a.paginacion.currentPage-1)*a.paginacion.numPerPage,c=b+a.paginacion.numPerPage;a.paginacion.filteredTodos=a.paginacion.todos.slice(b,c)},a.$watch("filterExpr",function(b,c){a.filtered=h(a.busquedaCtaCte.resultados,b),a.paginacion.todos=a.filtered,a.paginacion.currentPage=1;var d=(a.paginacion.currentPage-1)*a.paginacion.numPerPage,e=d+a.paginacion.numPerPage;a.paginacion.filteredTodos=a.paginacion.todos.slice(d,e)},!0),a.limpiarTitulo=function(){a.busquedaCtaCte.data=null,a.states.buscar.isError=!1,a.busquedaCtaCte.predicate=null,void 0!==a.busquedaCtaCte.resultados&&(a.busquedaCtaCte.resultados.length=0),a.busquedaCtaCte.fechaDesde=a.fechahoy,a.busquedaCtaCte.fechaHasta=a.fechahoy,a.busquedaCtaCte.cuenta=null,a.busquedaCtaCte.estado=null,a.formctacte.$setPristine(!0)}}]),app.controller("ListadoRepertorioCtrl",["$scope","$timeout","$rootScope","$interval","$location","$anchorScroll","solicitudesModel","certificacionModel","repertorioService","$filter","$modal","$modalStack",function(a,b,c,d,e,f,g,h,i,j,k,l){a.fechahoy=(new Date).toJSON().split("T")[0],a.busquedaCertificacion={fechaDesde:a.fechahoy,fechaHasta:a.fechahoy,tiemporefresco:2},a.states=h.getStates(),a.tab=g.getTab(),a.solicitudStatus={ok:!1,error:!1,warning:!1,msgTitle:null,msg:null,tipo:null},a.solicita={foja:null,numero:null,ano:null,bis:!1,tipo:null,esDigital:!1,tieneRechazo:!1},a.refrescar=function(){a.openLoadingModal("Cargando Listado...",""),i.getListadoRepertorio(a.busquedaCertificacion.fechaDesde,a.busquedaCertificacion.fechaHasta).then(function(b){null===b.status||(b.status?(a.busquedaCertificacion.data=b,a.busquedaCertificacion.resultados=b.resultado,a.closeModal()):(a.setErr("data.msg",b.msg),a.closeModal()))},function(b){a.setErr("Problema contactando al servidor.",""),a.closeModal()})},a.resolveModal={refresca:!1},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openLoadingModal=function(a,b){k.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.verEstadoCaratula=function(a){k.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})},a.raiseErr=function(b,c,d){a.closeModal(),a.states[b].isError=!0,a.states[b].title=c,a.states[b].msg=d},a.resetStatus=function(){a.solicitudStatus.ok=!1,a.solicitudStatus.error=!1,a.solicitudStatus.warning=!1,a.solicitudStatus.msgTitle=null,a.solicitudStatus.msg=null},a.setErr=function(b,c){a.solicitudStatus.error=!0,a.setStatusMsg(b,c)},a.setStatusMsg=function(b,c){a.solicitudStatus.msgTitle=b,a.solicitudStatus.msg=c},a.closeModal=function(){var a=l.getTop();a&&l.dismiss(a.key)},a.$watch("busquedaCertificacion.tiemporefresco",function(){a.start()}),b(function(){a.refrescar()},500);var m;a.start=function(){a.stop(),0!=a.busquedaCertificacion.tiemporefresco&&(m=d(function(){a.refrescar()}.bind(this),6e4*a.busquedaCertificacion.tiemporefresco))},a.stop=function(){d.cancel(m)},a.start(),a.$on("$destroy",function(){a.stop()})}]),app.controller("llamarClienteModalCtrl",["$rootScope","$scope","$modalStack","$timeout","socketService",function(a,b,c,d,e){b.llamar={nombre:""},b.cancel=function(){var a=c.getTop();a&&c.dismiss(a.key)},b.llamarCliente=function(){a.nombreCliente=b.llamar.nombre,e.disponible()},d(function(){b.$broadcast("nombreIsFocused")},200),b.setErr=function(a,c){b.solicitudStatus.error=!0,b.setStatusMsg(a,c)},b.setStatusMsg=function(a,c){b.solicitudStatus.msgTitle=a,b.solicitudStatus.msg=c}}]),app.controller("LoadingModalCtrl",["$rootScope","$scope","$modalInstance","titulo","detalle",function(a,b,c,d,e){b.titulo=d,b.detalle=e,b.cancel=function(){c.dismiss("cancel")}}]),app.controller("MantenedorCertificaCtrl",["$scope","$timeout","$rootScope","$location","$anchorScroll","mantenedorCertificaModel","mantenedorService","$filter","$modal","$modalStack","$routeParams",function(a,b,c,d,e,f,g,h,i,j,k){a.busquedaUsuario=f.getBusquedaUsuario(),a.states=f.getStates(),a.obtenerUsuarios=function(){g.obtenerUsuarios().then(function(b){null===b.status||(b.status?a.busquedaUsuario.resultados=b.usuarios:a.setErr("data.msg","data.msg"))},function(b){a.setErr("Problema contactando al servidor.","")})},a.obtenerUsuarios(),a.cambiaEstadoUsuario=function(b,c){a.openLoadingModal("Actualizando...",""),g.cambiaEstadoUsuario(b.usuario,c,b.perfil).then(function(d){a.closeModal(),null===d.status||(d.status?b.estado=c:a.raiseErr("buscar","Problema detectado",d.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.redistribuirCaratulas=function(b){a.openLoadingModal("Redistribuyendo Caratulas...",""),g.redistribuirCaratulas(b.usuario,b.perfil).then(function(b){a.closeModal(),null===b.status||(b.status?a.obtenerUsuarios():a.raiseErr("buscar","Problema detectado",b.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.miPerfil=function(b){var d=!1;return angular.forEach(a.busquedaUsuario.resultados,function(a,e){("DESARROLLO AIO"===c.perfil.toUpperCase()||a.usuario.toUpperCase().trim()==c.userLoginSinCBRS.toUpperCase().trim()&&b.perfil.toUpperCase().trim()==a.perfil.toUpperCase().trim())&&(d=!0)}),d},a.openLoadingModal=function(a,b){i.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.closeModal=function(){var a=j.getTop();a&&j.dismiss(a.key)},a.raiseErr=function(b,c,d){a.closeModal(),a.states[b].isError=!0,a.states[b].title=c,a.states[b].msg=d}}]),app.controller("MantenedorCtasCtesCtrl",["$scope","$timeout","$rootScope","$location","mantenedorService","mantenedorCertificaModel","$modal","$modalStack","$routeParams","filterFilter",function(a,b,c,d,e,f,g,h,i,j){a.busquedaUsuario=f.getBusquedaUsuario(),a.states=f.getStates(),a.listaCtasCtes=[],a.paginacionMaster={currentPage:1,numPerPage:10,maxSize:10,filteredTodos:[],todos:[]},a.paginacion=angular.copy(a.paginacionMaster),a.paginacion.todos=a.listaCtasCtes,a.obtenerCtasCtes=function(){e.getCtasCtes().then(function(b){null===b.status||(b.status?(a.listaCtasCtes=b.listaCtasCtes,a.makeTodos(b.listaCtasCtes)):a.setErr("data.msg","data.msg"))},function(b){a.setErr("Problema contactando al servidor.","")})},a.obtenerCtasCtes(),a.editarCtaCte=function(b){a.openCtaCteModal(b)},a.openCtaCteModal=function(a){g.open({templateUrl:"ctaCteModal.html",backdrop:!1,windowClass:"modal",controller:"CtaCteModalCtrl",resolve:{ctaCte:function(){return a}}})},a.openLoadingModal=function(a,b){g.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.closeModal=function(){var a=h.getTop();a&&h.dismiss(a.key)},a.raiseErr=function(b,c,d){a.closeModal(),a.states[b].isError=!0,a.states[b].title=c,a.states[b].msg=d},a.makeTodos=function(b){a.paginacion=angular.copy(a.paginacionMaster),a.paginacion.todos=b;var c=(a.paginacion.currentPage-1)*a.paginacion.numPerPage,d=c+a.paginacion.numPerPage;a.paginacion.filteredTodos=a.paginacion.todos.slice(c,d)},a.$watch("filterExpr",function(b,c){a.filtered=j(a.listaCtasCtes,b),a.paginacion.todos=a.filtered,a.paginacion.currentPage=1;var d=(a.paginacion.currentPage-1)*a.paginacion.numPerPage,e=d+a.paginacion.numPerPage;a.paginacion.filteredTodos=a.paginacion.todos.slice(d,e)},!0)}]),app.controller("masInfoLiquidacionModalCtrl",["$rootScope","$scope","$route","$timeout","$modalStack","$modalInstance","$modal","tareasService","caratula","estadoService","$window",function(a,b,c,d,e,f,g,h,i,j,k){b.nuevoDocumento={valorDocumento:null,tipoDocumentoDTO:{codigo:-1,descripcion:""}},d(function(){b.openLoadingModal("Obteniendo liquidación de carátula "+i.numeroCaratula,"")},500),h.getCaratulaLiquidacion(i.numeroCaratula).then(function(a){b.closeModal(),null===a.estado||(a.status?(b.liquidacionCaratula=a.liquidacionCaratula,b.liquidacionCaratula.caratulaDTO.valorReal=b.getTotalPapeles(),b.liquidacionCaratula.caratulaDTO.diferencia=b.liquidacionCaratula.caratulaDTO.valorReal-b.liquidacionCaratula.caratulaDTO.valorPagado):b.raiseErr(a.msg))},function(a){b.closeModal(),b.raiseErr("No se ha podido establecer comunicacion con el servidor.")}),b.downloadFirma=function(a){console.log(a);var c={nombreArchivo:a.nombreArchivoVersion,fechaDocumento:a.fechaFirma,rutFirmador:a.usuario};j.existeFirma(c).then(function(a){a.hayDocumento?k.location.href=k.location.protocol+"//"+k.location.host+"/aio/do/service/estado?metodo=downloadFirma&documento="+JSON.stringify(c):b.raiseErr(a.errormsg)},function(a){b.raiseErr("No se ha podido establecer comunicación con el servidor.")})},b.downloadBoleta=function(a){var c={nombreArchivo:a+".pdf",idTipoDocumento:12,idReg:0};j.existeDocumento(c).then(function(a){a.hayDocumento?k.location.href=k.location.protocol+"//"+k.location.host+"/aio/do/service/estado?metodo=downloadDocumento&documento="+JSON.stringify(c):b.raiseErr(a.errormsg)},function(a){b.raiseErr("No se ha podido establecer comunicación con el servidor.")})},b.aprobarCaratula=function(){h.aprobarCaratula(b.liquidacionCaratula.caratulaDTO.numeroCaratula,JSON.stringify(b.liquidacionCaratula.papeles),b.getTotalPapeles()).then(function(a){null===a.estado||(a.status?(b.openMensajeModal("success","Carátula liquidada exitosamente","",!1,null),d(function(){b.closeModal(),c.reload()},2e3)):b.raiseErr(a.msg))},function(a){b.closeModal(),b.raiseErr("No se ha podido establecer comunicacion con el servidor.")})},b.getTotalPapeles=function(){for(var a=0,c=0;c<b.liquidacionCaratula.papeles.length;c++){var d=b.liquidacionCaratula.papeles[c];null!=d&&null!=d.valorDocumento&&(a+=parseInt(d.valorDocumento))}return a},b.agregarDocumento=function(){b.liquidacionCaratula.papeles.push(angular.copy(b.nuevoDocumento)),b.liquidacionCaratula.caratulaDTO.valorReal=b.getTotalPapeles(),b.liquidacionCaratula.caratulaDTO.diferencia=b.liquidacionCaratula.caratulaDTO.valorReal-b.liquidacionCaratula.caratulaDTO.valorPagado,b.resetNuevoDocumento(),b.doFocus("descripcion")},b.eliminarDocumento=function(a){b.liquidacionCaratula.papeles.splice(b.liquidacionCaratula.papeles.indexOf(a),1),b.liquidacionCaratula.caratulaDTO.valorReal=b.getTotalPapeles(),b.liquidacionCaratula.caratulaDTO.diferencia=b.liquidacionCaratula.caratulaDTO.valorReal-b.liquidacionCaratula.caratulaDTO.valorPagado},b.resetNuevoDocumento=function(){b.nuevoDocumento={valorDocumento:null,tipoDocumentoDTO:{codigo:-1,descripcion:""}}},b.verEstadoCaratula=function(a){g.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})},b.verTransaccion=function(a){g.open({templateUrl:"transaccionModal.html",backdrop:!0,windowClass:"modal",controller:"transaccionModalCtrl",resolve:{caratulaDTO:function(){return a}}})},b.raiseErr=function(a){b.openMensajeModal("error",a,"",!1,null)},b.doFocus=function(a){b.$broadcast(a+"IsFocused")},b.openMensajeModal=function(a,c,e,f,h){g.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return c},detalle:function(){return e}}}),f&&d(function(){b.closeModal()},1e3*h)},b.openLoadingModal=function(a,b){g.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},b.closeModal=function(){var a=e.getTop();a&&e.dismiss(a.key)},b.cancel=function(){f.dismiss("cancel")}}]),app.controller("masinfoindiceModalCtrl",["$rootScope","$scope","$modal","$modalInstance","$modalStack","$window","$timeout","inscripcionDigitalService","masInfoindiceModel","caratulaService","borradorService","escrituraService","planosService","resolveModal","indiceModel","titulo","foja","numero","ano","caratula",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.titulo=p,b.foja=q,b.numero=r,b.ano=s,b.caratula=t,b.resolveModal={refresca:!1},b.tituloAnterior={foja:null,num:null,ano:null,bis:null,tipodocumento:null},b.states=i.getStates(),b.busquedaBorrador=i.getBusquedaBorrador(),void 0!==b.busquedaBorrador.borradores&&(b.busquedaBorrador.borradores.length=0),void 0!==b.busquedaBorrador.caratulasEnProceso&&(b.busquedaBorrador.caratulasEnProceso.length=0),void 0!==b.busquedaBorrador.caratulasTerminadas&&(b.busquedaBorrador.caratulasTerminadas.length=0),void 0!==b.busquedaBorrador.planos&&(b.busquedaBorrador.planos.length=0),void 0!==b.busquedaBorrador.titulosAnteriores&&(b.busquedaBorrador.titulosAnteriores.length=0),void 0!==b.urlPdf&&(b.urlPdf="");var u=k.obtenerCantidadBorradores(b.foja,b.numero,b.ano);u.then(function(a){null===a.status||(a.status?b.totalBorradores=a.totalBorradores:b.setErr("data.msg","data.msg"))},function(a){b.setErr("Problema contactando al servidor.","")});var u=j.obtenerCantidadCaratula(b.foja,b.numero,b.ano);u.then(function(a){null===a.status||(a.status?(b.totalCaratulasEnProceso=a.totalCaratulasEnProceso,b.totalCaratulasTerminadas=a.totalCaratulasTerminadas):b.setErr("data.msg","data.msg"))},function(a){b.setErr("Problema contactando al servidor.","")});var u=l.obtenerEscrituraPorInscripcion(b.caratula);u.then(function(a){null===a.status||(a.status?(b.totalEscrituras=a.tieneImagen,b.urlPdf=a.urlPdf):b.setErr("data.msg","data.msg"))},function(a){b.setErr("Problema contactando al servidor.","")});var u=m.obtenerPlanosPorTitulos(b.foja,b.numero,b.ano);u.then(function(a){null===a.status||(a.status?(b.totalPlanos=a.totalPlanos,b.busquedaBorrador.planos=a.listaPlanos):b.setErr("data.msg","data.msg"))},function(a){b.setErr("Problema contactando al servidor.","")});var u=k.obtenerTitulosAnteriores(b.foja,b.numero,b.ano);u.then(function(a){null===a.status||(a.status?(b.totalTitulosAnteriores=a.totalTitulosAnteriores,b.busquedaBorrador.titulosAnteriores=a.listaTitulosAnteriores):b.setErr("data.msg","data.msg"))},function(a){b.setErr("Problema contactando al servidor.","")}),b.solicitudStatus={ok:!1,error:!1,warning:!1,msgTitle:null,msg:null},b.isLoadingSolicitar=!1,b.pasoPreSolicitar=!1,b.obtenerBorradores=function(){if(b.totalBorradores>0&&(void 0==b.busquedaBorrador.borradores||0==b.busquedaBorrador.borradores.length)){b.openLoadingModal("Buscando Borradores...","por favor espere un momento");k.obtenerBorradores(b.foja,b.numero,b.ano).then(function(a){b.closeModal(),null===a.status||(a.status?(b.busquedaBorrador.data=a,b.busquedaBorrador.borradores=a.listaBorradores):b.setErr("Problema detectado.","Problema detectado"))},function(a){b.setErr("Problema detectado.","No se ha podido establecer comunicación con el servidor.")})}},b.obtenerCaratulas=function(a){if((b.totalCaratulasEnProceso>0&&0==a||b.totalCaratulasTerminadas>0&&1==a)&&(0==b.busquedaBorrador.caratulasEnProceso.length&&0==a||0==b.busquedaBorrador.caratulasTerminadas.length&&1==a)){b.openLoadingModal("Buscando Caratulas...","por favor espere un momento");j.obtenerCaratulasPorFoja(b.foja,b.numero,b.ano,a).then(function(c){b.closeModal(),null===c.status||(c.status?(b.busquedaBorrador.data=c,0==a&&(b.busquedaBorrador.caratulasEnProceso=c.listacaratulas),1==a&&(b.busquedaBorrador.caratulasTerminadas=c.listacaratulas)):b.setErr("Problema detectado.","Problema detectado"))},function(a){b.setErr("Problema detectado.","No se ha podido establecer comunicación con el servidor.")})}},b.verEstadoCaratula=function(a){c.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})},b.verTipoImagen=function(a){var c=1==a.bis;b.openLoadingModal("Buscando...",""),h.getInscripcionJPG(a.foja,a.numero,a.ano,c).then(function(c){b.closeModal(),null===c.status||(c.status?c.res.tienerechazo?(b.titulo.tipodocumento=0,b.openVerInscripcion(a.foja,a.numero,a.ano,a.bis,b.titulo.tipodocumento),b.pasoPreSolicitar=!1):(b.titulo.esDigital=c.res.anodigital,c.res.consultaDocumentoDTO.hayDocumento?8!=c.res.consultaDocumentoDTO.tipoDocumento?(9==c.res.consultaDocumentoDTO.tipoDocumento?b.titulo.tipodocumento=2:10==c.res.consultaDocumentoDTO.tipoDocumento&&(b.titulo.tipodocumento=4),b.openVerInscripcion(a.foja,a.numero,a.ano,a.bis,b.titulo.tipodocumento),b.pasoPreSolicitar=!1):b.verTitulo(a.foja,a.numero,a.ano,a.bis):(b.titulo.tipodocumento=1,b.openVerInscripcion(a.foja,a.numero,a.ano,a.bis,b.titulo.tipodocumento),b.pasoPreSolicitar=!1)):b.raiseErr("buscar","Problema detectado",c.msg))},function(a){b.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.verTitulo=function(b,c,d,e){var e=1==e;a.go("/verInscripcion/prop/"+b+"/"+c+"/"+d+"/"+e+"/indice/0")},b.openVerInscripcion=function(a,d,e,f,g){b.tituloAnterior.foja=a,b.tituloAnterior.num=d,b.tituloAnterior.ano=e,b.tituloAnterior.bis=f,b.tituloAnterior.tipodocumento=g,b.resolveModal.refresca=!1,c.open({templateUrl:"solicitarIndiceModal.html",backdrop:"static",windowClass:"modal",controller:"SolicitarIndiceModalCtrl",resolve:{resolveModal:function(){return b.resolveModal},titulo:function(){return b.tituloAnterior}}}).result.then(function(){console.log(b.resolveModal.refresca),b.resolveModal.refresca},function(){console.log(b.resolveModal.refresca),b.resolveModal.refresca})},b.volverPreSolicita=function(){b.pasoPreSolicitar=!1,b.solicita.tipo=null,b.solicita.esDigital=!1,b.resetStatus(),g(function(){b.$broadcast("sfojaIsFocused")},100)},b.cancel=function(){d.dismiss("cancel")},b.limpiarSolicitaCaratula=function(){b.resetSolicita(),b.resetStatus(),b.$broadcast("srutIsFocused")},b.archivoNacional=function(b){return!(b<a.aioParametros.anoArchivoNacional)},b.anoActual=function(a){return!(moment(new Date).year()<a)},b.verEscritura=function(a){f.open("../do/service/escritura?metodo=verDocumento&caratula="+b.caratula+"&type=uri","","width=800,height=600")},b.setErr=function(a,c){b.solicitudStatus.error=!0,b.setStatusMsg(a,c)},b.setStatusMsg=function(a,c){b.solicitudStatus.msgTitle=a,b.solicitudStatus.msg=c},b.setOK=function(a,c){b.solicitudStatus.ok=!0,b.setStatusMsg(a,c)},b.resetStatus=function(){b.solicitudStatus.ok=!1,b.solicitudStatus.error=!1,b.solicitudStatus.warning=!1,b.solicitudStatus.msgTitle=null,b.solicitudStatus.msg=null},b.resetSolicita=function(){b.solicitaCaratula.rut=null,b.solicitaCaratula.nombre=null,b.solicitaCaratula.apep=null,b.solicitaCaratula.apem=null,b.solicitaCaratula.direccion=null,b.solicitaCaratula.telefono=null,b.solicitaCaratula.correo=null},b.openLoadingModal=function(a,b){c.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},b.closeModal=function(){var a=e.getTop();a&&e.dismiss(a.key)},g(function(){b.$broadcast("sfojaIsFocused")},100),b.raiseErr=function(a,c,d){b.closeModal(),b.states[a].isError=!0,b.states[a].title=c,b.states[a].msg=d},b.irGpOnlineAIO=function(a,b){c.open({templateUrl:"gpOnlineModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"gpOnlineModalCtrl",size:"lg",resolve:{borrador:function(){return parseInt(a)},folio:function(){return parseInt(b)}}})}}]),app.controller("masinforepertorioModalCtrl",["$rootScope","$scope","$modalStack","$modalInstance","$modal","repertorioService","repertorio",function(a,b,c,d,e,f,g){b.resultadoDetalle={resultados:[],data:null},f.consultaDetalleRepertorio(g.caratula,g.repertorio,g.anorepertorio).then(function(a){null===a.status||(a.status?(b.resultadoDetalle.resultados=a.resultado,b.resultadoDetalle.data=a):b.setErr("data.msg",a.msg))},function(a){b.raiseErr("No se ha podido establecer comunicación con el servidor.")}),b.closeModal=function(){var a=c.getTop();a&&c.dismiss(a.key)},b.cancel=function(){d.dismiss("cancel")},b.verEstadoCaratula=function(a){e.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})}}]),app.controller("MensajeModalCtrl",["$rootScope","$scope","$modalInstance","tipo","titulo","detalle",function(a,b,c,d,e,f){b.tipo=d,b.titulo=e,b.detalle=f,b.cancel=function(){c.dismiss("cancel")}}]),app.controller("ModificaAnotacionModalCtrl",["$rootScope","$scope","$sce","$modalInstance","$timeout","$window","$modalStack","taOptions","inscripcionDigitalService","inscripcionDigitalHipotecasService","inscripcionDigitalProhibicionesService","AnotacionService","AnotacionHipotecasService","AnotacionProhibicionesService","nota","inscripcionDigitalDTO","anotaciones","notas","origen","paginacionNotas",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.servicioAnotacion="digital"==s?l:"digitalHipotecas"==s?m:n,b.servicioInscripcion="digital"==s?i:"digitalHipotecas"==s?j:k,h.toolbar=[["h4","h5","h6","p"],["redo","undo"],["justifyLeft","justifyCenter","justifyRight"]],b.paginacionMaster={currentPage:1,numPerPage:10,maxSize:2,totalpaginas:0,filteredTodos:[],todos:[],filterExprNotas:""},b.savingAnotacion=!1,b.anotacionStatus={ok:!1,error:!1,msg:null},b.anotacion={caratula:null,texto:null,version:null},b.loaders={borradores:{isLoading:!1,error:!1},enProceso:{isLoading:!1,error:!1},terminadas:{isLoading:!1,error:!1},anotaciones:{isLoading:!1,error:!1},notas:{isLoading:!1,error:!1}},b.anotacion.texto=o.texto,b.anotacion.caratula=o.caratula;var u=o.caratulaMatriz.split("-");u.length>1&&(b.anotacion.version=u[1]),b.doFocus=function(a,c){a?e(function(){b.$broadcast(c+"IsFocused")},100):b.$broadcast(c+"IsFocused")},b.closeAnotacion=function(){g.getTop()&&d.dismiss("cancel")},b.modificarAnotacion=function(){b.savingAnotacion=!0,b.anotacionStatus={ok:!1,error:!1,msg:null},b.servicioAnotacion.modificaAnotacion(b.anotacion.texto,b.anotacion.caratula,b.anotacion.version,o.idAnotacion).then(function(a){if(null===a.status)f.location.href=f.location.protocol+"//"+f.location.host+f.location.pathname;else if(a.status){if(b.anotacionStatus.ok=!0,"digital"==s)b.buscaNotas();else{var c=b.servicioInscripcion.getInscripcion(p.foja,p.numero,p.ano,p.bis);c.then(function(a){q.length=0,r.length=0,angular.forEach(a.inscripcionDigitalDTO.anotacionsForIdInscripcionDestino,function(a){3===a.tipoAnotacionDTO.idTipoAnotacion?q.push(a):1!==a.tipoAnotacionDTO.idTipoAnotacion&&2!==a.tipoAnotacionDTO.idTipoAnotacion||7===a.estadoAnotacionDTO.idEstado||r.push(a)})},function(a){}),b.makeTodos()}b.salirSave()}else b.savingAnotacion=!1,b.anotacionStatus.error=!0,b.anotacionStatus.msg=a.msg},function(a){b.savingAnotacion=!1,b.anotacionStatus.error=!0,b.anotacionStatus.msg="Problemas contactando al servidor."})},b.salirSave=function(){e(function(){b.savingAnotacion=!1,b.closeAnotacion()},2e3)},b.doFocus(!0,"texto"),b.buscaNotas=function(){b.loaders.anotaciones.isLoading=!0,b.loaders.notas.isLoading=!0;var a=p.foja,c=p.numero,d=p.ano,e=p.bis;b.servicioInscripcion.getNotas(a,c,d,e).then(function(a){null==a.status||(a.status?(q.length=0,r.length=0,angular.forEach(a.anotaciones,function(a){1!==a.tipoAnotacionDTO.idTipoAnotacion&&2!==a.tipoAnotacionDTO.idTipoAnotacion||7===a.estadoAnotacionDTO.idEstado?3===a.tipoAnotacionDTO.idTipoAnotacion&&q.push(a):r.push(a)}),b.makeTodos()):(b.raiseErr("error","Error Obteniendo Notas.",a.msg),b.loaders.anotaciones.error=!0,b.loaders.notas.error=!0)),b.loaders.anotaciones.isLoading=!1,b.loaders.notas.isLoading=!1},function(a){b.loaders.anotaciones.isLoading=!1,b.loaders.notas.isLoading=!1,b.loaders.anotaciones.error=!0,b.loaders.notas.error=!0,b.raiseErr("error","Error detectado.","No se ha podido establecer comunicación.")})},b.makeTodos=function(){t=angular.copy(b.paginacionMaster),t.todos=r;var a=(t.currentPage-1)*t.numPerPage,c=a+t.numPerPage;t.filteredTodos=t.todos.slice(a,c),t.totalpaginas=Math.round(t.todos.length/t.numPerPage)}}]),app.controller("MovimientosModalCtrl",["$log","$rootScope","$scope","$modal","$modalInstance","$modalStack","$window","$timeout","caratula","estadoService",function(a,b,c,d,e,f,g,h,i,j){c.caratulaDTO=i.caratulaDTO,c.movimiento={fechaCaja:"",horaCaja:""},c.cancel=function(){var a=f.getTop();a&&f.dismiss(a.key)},c.agregarCaja=function(){c.openLoadingModal("Agregando movimiento...",""),j.agregarCaja(c.caratulaDTO.datosFormularioDTO.numeroCaratula,c.movimiento.fechaCaja,c.movimiento.horaCaja).then(function(a){c.closeModal(),null==a.status||(a.status?(c.openMensajeModal("success","Caja agregada exitosamente","",!1,null),c.closeModal(),c.refrescar()):c.raiseErr(a.msg))},function(a){c.raiseErr("No se ha podido establecer comunicación con el servidor.")})},c.refrescar=function(){j.getEstado(c.caratulaDTO.datosFormularioDTO.numeroCaratula).then(function(a){null===a.status||(a.status?c.caratulaDTO.movimientoDTOs=a.res.caratulaDTO.movimientoDTOs:c.raiseErr(a.msg))},function(a){c.raiseErr("No se ha podido establecer comunicación con el servidor.")})},c.raiseErr=function(a){c.openMensajeModal("error",a,"",!1,null)},c.doFocus=function(a){c.$broadcast(a+"IsFocused")},c.openMensajeModal=function(a,b,e,f,g){d.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return b},detalle:function(){return e}}}),f&&h(function(){c.closeModal()},1e3*g)},c.openLoadingModal=function(a,b){d.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},c.closeModal=function(){var a=f.getTop();a&&f.dismiss(a.key)},h(function(){c.doFocus("fecha")},500)}]),app.filter("startFrom",function(){return function(a,b){return a?(b=+b,a.slice(b)):[]}}),app.controller("NominaCtaCteCtrl",["$scope","$timeout","$window","solicitudesModel","certificacionModel","caratulaService","$modal","$modalStack","filterFilter","estadoService",function(a,b,c,d,e,f,g,h,i,j){var k=new Date,l=k.getMonth();l+=1;var m=k.getFullYear();a.nominaCtaCte={mes:m+"-"+l,resultados:[],cuenta:null,tipoCierre:null,total:null,fechaInicioCierre:null,fechaFinCierre:null,numeroBoleta:null,urlBoleta:null},a.nominaCtaCte.mes,a.states=e.getStates(),a.tab=d.getTab(),a.solicitudStatus={ok:!1,error:!1,warning:!1,msgTitle:null,msg:null,tipo:null},a.solicita={foja:null,numero:null,ano:null,bis:!1,tipo:null,esDigital:!1,tieneRechazo:!1},a.paginacionMaster={currentPage:1,numPerPage:10,maxSize:10,filteredTodos:[],todos:[]},a.paginacion=angular.copy(a.paginacionMaster),a.paginacion.todos=a.nominaCtaCte.resultados,a.refrescar=function(){if(a.openLoadingModal("Cargando Listado...",""),null!=a.nominaCtaCte.estado)var b=a.nominaCtaCte.estado.codigo;f.getCierreCtaCte(a.nominaCtaCte.cuenta,a.nominaCtaCte.mes,b).then(function(b){null===b.status||(b.status?(a.nominaCtaCte.data=b,a.nominaCtaCte.resultados=b.detalleNominas,a.nominaCtaCte.total=b.total,a.nominaCtaCte.fechaInicioCierre=b.fechaInicioCierre,a.nominaCtaCte.fechaFinCierre=b.fechaFinCierre,a.nominaCtaCte.numeroBoleta=b.numeroBoleta,a.nominaCtaCte.urlBoleta=b.urlBoleta,a.makeTodos(),a.closeModal()):(a.setErr("data.msg",b.msg),a.closeModal()))},function(b){a.setErr("Problema contactando al servidor.",""),a.closeModal()})},a.downloadBoleta=function(){var b={nombreArchivo:a.nominaCtaCte.numeroBoleta+".pdf",idTipoDocumento:12,idReg:0};console.log(b),j.existeDocumento(b).then(function(d){d.hayDocumento?c.location.href=c.location.protocol+"//"+c.location.host+"/aio/do/service/estado?metodo=downloadDocumento&documento="+JSON.stringify(b):a.raiseErr(d.errormsg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.resolveModal={refresca:!1},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openLoadingModal=function(a,b){g.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.verEstadoCaratula=function(a){g.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})},a.raiseErr=function(b,c,d){a.closeModal(),a.states[b].isError=!0,a.states[b].title=c,a.states[b].msg=d},a.resetStatus=function(){a.solicitudStatus.ok=!1,a.solicitudStatus.error=!1,a.solicitudStatus.warning=!1,a.solicitudStatus.msgTitle=null,a.solicitudStatus.msg=null},a.setErr=function(b,c){a.solicitudStatus.error=!0,a.setStatusMsg(b,c)},a.setStatusMsg=function(b,c){a.solicitudStatus.msgTitle=b,a.solicitudStatus.msg=c},a.closeModal=function(){var a=h.getTop();a&&h.dismiss(a.key)},void 0!=a.nominaCtaCte.estados&&0!=a.nominaCtaCte.estados.length||(a.nominaCtaCte.estados=[{codigo:1,descripcion:"Parcial"}]),a.makeTodos=function(){a.paginacion=angular.copy(a.paginacionMaster),a.paginacion.todos=a.nominaCtaCte.resultados;var b=(a.paginacion.currentPage-1)*a.paginacion.numPerPage,c=b+a.paginacion.numPerPage;a.paginacion.filteredTodos=a.paginacion.todos.slice(b,c)},a.$watch("filterExpr",function(b,c){a.filtered=i(a.nominaCtaCte.resultados,b),a.paginacion.todos=a.filtered,a.paginacion.currentPage=1;var d=(a.paginacion.currentPage-1)*a.paginacion.numPerPage,e=d+a.paginacion.numPerPage;a.paginacion.filteredTodos=a.paginacion.todos.slice(d,e)},!0),a.limpiarTitulo=function(){a.nominaCtaCte.data=null,a.states.buscar.isError=!1,void 0!==a.nominaCtaCte.resultados&&(a.nominaCtaCte.resultados.length=0),a.nominaCtaCte.mes=m+"-"+l,a.nominaCtaCte.cuenta=null,a.nominaCtaCte.tipoCierre=null,a.nominaCtaCte.total=null,a.formctacte.$setPristine(!0),a.doFocus("cuenta")},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},b(function(){a.doFocus("cuenta")},500),a.exportarNominaExcel=function(){var b=0;null!=a.nominaCtaCte.estado&&(b=a.nominaCtaCte.estado.codigo),c.location.href=c.location.protocol+"//"+c.location.host+"/aio/do/service/caratula?metodo=exportarNominaExcel&tipoCierre="+b+"&cuenta="+a.nominaCtaCte.cuenta+"&mes="+a.nominaCtaCte.mes}}]),app.controller("ObservacionesModalCtrl",["$log","$rootScope","$scope","$modal","$modalInstance","$modalStack","$window","$timeout","data","estadoService",function(a,b,c,d,e,f,g,h,i,j){c.data=i,c.observacion={comentario:"",categoria:0,enviarCorreo:!1},c.cancel=function(){var a=f.getTop();a&&f.dismiss(a.key)},c.agregarObservacion=function(){c.openLoadingModal("Guardando...","");var a=c.observacion.enviarCorreo?i.res.caratulaDTO.requirenteDTO.email:null;j.agregarBitacora(c.data.req.numeroCaratula,c.observacion.comentario,c.observacion.categoria,a).then(function(a){c.closeModal(),null===a.status||(a.status?(c.data.res.caratulaDTO.bitacoraDTOs.unshift(a.bitacoraDTO),c.closeModal(),c.openMensajeModal("success","Comentario agregado exitosamente","",!0,2)):c.raiseErr(a.msg))},function(a){c.raiseErr("No se ha podido establecer comunicación con el servidor.")})},c.raiseErr=function(a){c.openMensajeModal("error",a,"",!1,null)},c.doFocus=function(a){c.$broadcast(a+"IsFocused")},c.openMensajeModal=function(a,b,e,f,g){d.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return b},detalle:function(){return e}}}),f&&h(function(){c.closeModal()},1e3*g)},c.openLoadingModal=function(a,b){d.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},c.closeModal=function(){var a=f.getTop();a&&f.dismiss(a.key)},h(function(){c.doFocus("email")},500)}]),app.controller("OficioCtrl",["$scope","$timeout","$window","$rootScope","$location","$anchorScroll","oficioModel","oficioService","$filter","$modal","$modalStack","$routeParams",function(a,b,c,d,e,f,g,h,i,j,k,l){a.busquedaOficio=g.getBusquedaOficio(),a.states=g.getStates(),a.listaOficio=g.getListaOficio(),a.rowHighilited=function(b){a.busquedaOficio.selectedRow=b},a.paginacionMaster={currentPage:1,numPerPage:10,maxSize:10,filteredTodos:[],todos:[]},a.datosSesion={rut:null,requirente:null},a.contador={usuario:null,total:null},a.solrSuggester=function(){angular.element.ajax({url:a.solrSuggesterUrl,data:{q:a.busquedaOficio.institucion,wt:"json",suggest:"true"},traditional:!0,cache:!0,html:!0,async:!0,dataType:"jsonp",success:function(b){a.$apply(function(){if(a.suggest=[],a.busquedaOficio.institucion,b.suggest[Object.keys(b.suggest)[0]][a.busquedaOficio.institucion].numFound>0)for(var c=0;c<b.suggest[Object.keys(b.suggest)[0]][a.busquedaOficio.institucion].numFound;c++){var d={label:b.suggest[Object.keys(b.suggest)[0]][a.busquedaOficio.institucion].suggestions[c].term.trim().replace(/\s+/g," "),value:b.suggest[Object.keys(b.suggest)[0]][a.busquedaOficio.institucion].suggestions[c].term.trim().replace(/\s+/g," ").replace(/<b>/g,"").replace(/<\/b>/g,"")},e=b.suggest[Object.keys(b.suggest)[0]][a.busquedaOficio.institucion].suggestions[c].payload.trim().replace(/\s+/g," ");if(void 0===a.busquedaOficio.ciudad||null===a.busquedaOficio.ciudad||a.busquedaOficio.ciudad==e){for(var f=!1,g=0;g<a.suggest.length;g++)if(JSON.stringify(a.suggest[g])==JSON.stringify(d)){f=!0;break}f||a.suggest.push(d)}}})},jsonp:"json.wrf"})},a.buscarOficio=function(){var b=a.busquedaOficio.caratula,c=a.busquedaOficio.institucion,d=a.busquedaOficio.requirente,e=a.busquedaOficio.estado,f=a.busquedaOficio.fechaCreacionDesde,g=a.busquedaOficio.fechaCreacionHasta,i=a.busquedaOficio.fechaEntrega,j=a.busquedaOficio.materia,k=a.busquedaOficio.rol,l=a.busquedaOficio.oficio,m=a.busquedaOficio.identificador,n=a.busquedaOficio.ciudad;a.resetResultados(),a.openLoadingModal("Buscando...",""),h.getOficios(b,c,d,e,f,g,i,j,k,l,m,n).then(function(b){a.closeModal(),null===b.status||(b.status?(a.busquedaOficio.data=b,b.aaData.length>0&&(a.busquedaOficio.resultados=b.aaData,a.loadMore()),a.makeTodos()):a.raiseErr("buscar","Problema detectado",b.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.loadMore=function(){var b=a.busquedaOficio.resultados.slice(a.listaOficio.inicio,a.listaOficio.fin);angular.forEach(b,function(b){a.listaOficio.data.push(b)}),a.listaOficio.inicio=a.listaOficio.inicio+a.listaOficio.offset,a.listaOficio.fin=a.listaOficio.fin+a.listaOficio.offset},a.resetResultados=function(){a.busquedaOficio.data=null,a.states.buscar.isError=!1,void 0!==a.busquedaOficio.resultados&&(a.busquedaOficio.resultados.length=0),void 0!==a.listaOficio.data&&(a.listaOficio.data.length=0),a.listaOficio.inicio=0,a.listaOficio.fin=a.listaOficio.offset},a.limpiarTitulo=function(){a.resetResultados(),a.busquedaOficio.caratula=null,a.busquedaOficio.institucion=null,a.busquedaOficio.requirente=null,a.busquedaOficio.estado="",a.busquedaOficio.fechaCreacionDesde=null,a.busquedaOficio.fechaCreacionHasta=null,a.busquedaOficio.fechaEntrega=null,a.busquedaOficio.materia=null,a.busquedaOficio.rol=null,a.busquedaOficio.oficio=null,a.busquedaOficio.identificador=null,a.busquedaOficio.ciudad=null,a.myform.$setPristine(!0),a.doFocus("caratula"),a.indicebusqueda=!1},a.verEstadoCaratula=function(a){j.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openLoadingModal=function(a,b){j.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.closeModal=function(){var a=k.getTop();a&&k.dismiss(a.key)},a.raiseErr=function(b,c,d){a.closeModal(),a.states[b].isError=!0,a.states[b].title=c,a.states[b].msg=d},a.setErr=function(b,c){a.setStatusMsg(b,c)},a.paginacion=angular.copy(a.paginacionMaster),a.paginacion.todos=a.busquedaOficio.resultados,a.makeTodos=function(){a.paginacion=angular.copy(a.paginacionMaster),a.paginacion.todos=a.busquedaOficio.resultados;var b=(a.paginacion.currentPage-1)*a.paginacion.numPerPage,c=b+a.paginacion.numPerPage;a.paginacion.filteredTodos=a.paginacion.todos.slice(b,c),a.busquedaOficio.indicebusqueda=!0},a.$watch("paginacion.currentPage + paginacion.numPerPage",function(){var b=(a.paginacion.currentPage-1)*a.paginacion.numPerPage,c=b+a.paginacion.numPerPage;a.paginacion.filteredTodos=a.paginacion.todos.slice(b,c)}),a.colapsar=function(){a.busquedaOficio.indicebusqueda?a.busquedaOficio.indicebusqueda=!1:a.busquedaOficio.indicebusqueda=!0},a.colapsarnuevabusqueda=function(){a.busquedaOficio.indicebusqueda=!1,a.limpiarTitulo(),b(function(){a.doFocus("caratula")},200)},b(function(){h.init().then(function(b){null===b.status||b.status&&(a.solrSuggesterUrl=b.solrSuggesterUrl,a.ciudades=b.ciudades)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},500)}]),app.controller("PerfilesModalCtrl",["$scope","$rootScope","$window","Usuario","$modalInstance","$websocket","socketService",function(a,b,c,d,e,f,g){a.data={perfil:null,otrosPerfiles:null,activoAtencion:null,modulo:null,grupo:null,userIpAddress:null},b.$watch("perfiles",function(){void 0!==b.perfiles&&(a.data.perfil=b.perfiles[0],a.perfiles=angular.copy(b.perfiles))}),a.setPerfil=function(b){a.data.perfil=b;d.setSessionAttribute("permisosUsuario",null);a.entrar()},a.entrar=function(){var f=a.data.perfil.perfil.trim();d.getPermisosUsuario(f).then(function(h){if(null==h.status)c.location.href=c.location.protocol+"//"+c.location.host+c.location.pathname;else if(h.status){b.permisos=h.permisosUsuario,b.subPermisos=d.getAllSubPermisos(b.permisos),b.perfil=f,b.idPerfil=a.data.perfil.idPerfil,b.activoAtencion=h.activoAtencion,b.modulo=h.modulo,b.grupo=h.grupo,b.userIpAddress=h.userIpAddress,b.ipSocket=h.ipSocket,b.puertoSocket=h.puertoSocket,g.conexion();var i=d.setSessionAttribute("perfil",f);i.then(function(a){null==a.estado?c.location.href=c.location.protocol+"//"+c.location.host+c.location.pathname:a.estado||alert(a.msg)},function(a){alert("No se ha podido establecer comunicacion con el servidor.")}),d.setSessionAttribute("idPerfil",a.data.perfil.idPerfil);var j=Math.ceil(parseFloat(b.permisos.length/4));b.misFilas=[];for(var k=0;k<j;k++){var l=4*k,m=4*(k+1);b.misFilas[k]=b.permisos.slice(l,m)}e.dismiss("cancel")}else alert(h.msg)},function(a){c.location.href=c.location.protocol+"//"+c.location.host+c.location.pathname})}}]),app.controller("PlantilleroCtrl",["$log","$rootScope","$scope","$modal","$timeout","$modalStack","firmaService","taOptions","certificacionService",function(a,b,c,d,e,f,g,h,i){c.fechahoy=(new Date).toJSON().split("T")[0],c.entity={fields:null},c.plantillero={tipocertificado:null,cuerpocertificado:null,copiatemplate:null,tiposcertificados:null,caratula:null,valor:null,mostrarcampotexto:!1,mostrarboton:0},c.states={isLoading:!1,isError:!1,isOk:!1,title:null,msg:null},h.toolbar=[],c.obtenerTiposCertificadosPorPerfil=function(){c.openLoadingModal("Cargando Listado...",""),g.obtenerTiposCertificadosPorPerfil(b.idPerfil).then(function(a){c.closeModal(),null===a.status||(a.status?(c.plantillero.tiposcertificados=a.listatiposCertificados,c.doFocus("caratula")):c.raiseErr("data.msg",a.msg))},function(a){c.raiseErr("Problema contactando al servidor.",""),c.closeModal()})},c.obtenertemplate=function(){c.plantillero.tipocertificado?(c.plantillero.cuerpocertificado=c.plantillero.tipocertificado.plantillas.plantillaTemplate,c.plantillero.copiatemplate=c.plantillero.tipocertificado.plantillas.plantillaTemplate,c.entity.fields=JSON.parse(c.plantillero.tipocertificado.plantillas.json),c.plantillero.valor=c.plantillero.tipocertificado.plantillas.valor):c.plantillero.cuerpocertificado="",c.reemplazaData()},c.openLoadingModal=function(a,b){d.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},c.closeModal=function(){var a=f.getTop();a&&f.dismiss(a.key)},c.limpiarPlantillero=function(){c.plantillero.tipocertificado=null,c.plantillero.cuerpocertificado=null,c.plantillero.caratula=null,c.plantillero.copiatemplate=null,c.states.isLoading=!1,c.states.isError=!1,c.states.isOk=!1,c.states.title=null,c.states.msg=null,c.myform.$setPristine(!0),c.doFocus("caratula")},c.doFocus=function(a){c.$broadcast(a+"IsFocused")},e(function(){c.obtenerTiposCertificadosPorPerfil()},200),c.reemplazaData=function(){if(c.plantillero.cuerpocertificado){var a=c.plantillero.copiatemplate;c.plantillero.caratula&&(a=a.replace("_CARATULA_",c.plantillero.caratula)),c.plantillero.valor&&(a=a.replace("_VALOR_",c.plantillero.valor)),angular.forEach(c.entity.fields,function(b,d){"button"!=b.type&&(a=b.data?"select"==b.type?a.replace("_*_",b.data.name):"date"==b.type?a.replace("_*_",c.obtenerFechaEnPalabras(b.data)):a.replace("_*_",b.data):a.replace("_*_","......."))}),c.plantillero.cuerpocertificado=a}},c.vistaPrevia=function(){c.openLoadingModal("Generando Vista Previa...",""),i.vistaprevia(c.plantillero.caratula,c.plantillero.tipocertificado.plantillas.plantillaCertificado,c.plantillero.cuerpocertificado,c.plantillero.tipocertificado.plantillas.fePDocumentoTipos.identificador,c.plantillero.valor).then(function(a){c.closeModal(),null===a.status||(a.status?(c.raiseOk("","Certificacion realizada"),c.states.isError=!1,b.go("/verVistaPreviaPlantilla/"+c.plantillero.caratula+"/"+c.plantillero.tipocertificado.plantillas.fePDocumentoTipos.identificador+"/plantillero/"),c.limpiarPlantillero()):(c.states.isOk=!1,c.raiseErr("No se pudo certificar caratula",a.msg)))},function(a){c.states.isOk=!1,c.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor."),c.closeModal()})},c.raiseErr=function(a,b){c.states.isError=!0,c.states.title=a,c.states.msg=b},c.raiseOk=function(a,b){c.states.isOk=!0,c.states.title=a,c.states.msg=b},c.multiple=function(a,b){return 0==a%b},c.add=function(a){var b={fiels:[]},d=JSON.stringify(a),e="";angular.forEach(c.entity.fields,function(a,f){if("button"==a.type){b.fiels[f-1].saltolinea=!0;var g;angular.forEach(JSON.parse(d),function(a,c){0==c&&(g=Math.floor(1e3*Math.random()+1)),a.id="A"+g,b.fiels.push(a)}),e=c.plantillero.copiatemplate,e=e.replace(a.textotemplate,a.textotemplate+" ,"+a.textotemplate),c.plantillero.copiatemplate=e,c.plantillero.cuerpocertificado=e,b.fiels.push(a)}else a.id=f,b.fiels.push(a)}),c.entity.fields=b.fiels,c.plantillero.mostrarboton=c.plantillero.mostrarboton+1,c.reemplazaData()},c.remove=function(a){var b=!0,d="";angular.forEach(c.entity.fields,function(e,f){if(b){var g=a.length;if("button"==e.type){c.entity.fields.splice(f-g,g),b=!1;c.entity.fields[f-g-1].saltolinea=!1,d=c.plantillero.copiatemplate,d=d.replace(" ,"+e.textotemplate,""),c.plantillero.copiatemplate=d,c.plantillero.cuerpocertificado=d}}}),c.plantillero.mostrarboton=c.plantillero.mostrarboton-1,c.reemplazaData()},c.obtenerFechaEnPalabras=function(a){var b=a.split("-"),c=new Array("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"),d=new Date(b[0],b[1]-1,b[2]);return d.getDate()+" de "+c[d.getMonth()]+" de "+d.getFullYear()}}]).directive("dynamicName",["$compile",function(a){return{restrict:"A",terminal:!0,priority:1e3,link:function(b,c,d){c.attr("name",b.$eval(d.dynamicName)),c.removeAttr("dynamic-name"),a(c)(b)}}}]),app.controller("RecepcionPlanosCtrl",["$scope","$interval","$timeout","$log","planosService","$modal","$modalStack","$routeParams",function(a,b,c,d,e,f,g,h){a.recepcionPlanos={resultados:[],tiemporefresco:15,predicate:"fechaRetiroL",reverse:!1},a.refrescar=function(){e.obtenerPlanosPendientes().then(function(b){null===b.estado||(b.status?a.recepcionPlanos.resultados=b.listaPlanosPendientes:a.raiseErr(b.msg))},function(b){a.raiseErr("No se ha podido establecer comunicacion con el servidor.")})},a.ingresarPlano=function(){a.recepcionPlanosModal()},a.$watch("recepcionPlanos.tiemporefresco",function(){a.start()});var i;a.start=function(){a.stop(),0!=a.recepcionPlanos.tiemporefresco&&(i=b(function(){a.refrescar()}.bind(this),6e4*a.recepcionPlanos.tiemporefresco))},a.stop=function(){b.cancel(i)},a.start(),a.$on("$destroy",function(){a.stop()}),c(function(){a.refrescar()},500),a.raiseErr=function(b){a.openMensajeModal("error",b,"",!1,null)},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openMensajeModal=function(b,d,e,g,h){f.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return b},titulo:function(){return d},detalle:function(){return e}}}),g&&c(function(){a.closeModal()},1e3*h)},a.openLoadingModal=function(a,b){f.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.recepcionPlanosModal=function(){f.open({templateUrl:"recepcionPlanosModal.html",backdrop:"static",keyboard:!1,size:"lg",windowClass:"modal",controller:"RecepcionPlanosModalCtrl",resolve:{}})},a.closeModal=function(){var a=g.getTop();a&&g.dismiss(a.key)},a.stringIsNumber=function(a){return(+a).toString()===a}}]),app.controller("RecepcionPlanosModalCtrl",["$scope","$window","$timeout","$log","$modal","$modalStack","$routeParams","$modalInstance","requirenteService",function(a,b,c,d,e,f,g,h,i){a.plano={categoria:"Ley 19.537"},a.buscarRequirente=function(){console.log("buscando rut: "+a.plano.rut),a.buscando=!0,i.getRequirenteFull(a.plano.rut).then(function(b){console.log(b),b.status&&b.hayNombre?a.dataRequirente=b:a.dataRequirente=null},function(a){})},a.cancel=function(){h.dismiss("cancel")},a.limpiar=function(){a.plano.rut=null,a.dataRequirente=null},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},c(function(){a.doFocus("rut")},500)}]),app.controller("RechazoCertificacionModalCtrl",["$scope","$route","$location","$modalInstance","$log","$timeout","$window","$rootScope","dataRechazo","caratulaService","origen",function(a,b,c,d,e,f,g,h,i,j,k){a.dataRechazo=i,a.origen=k,a.savingRechazo=!1,a.rechazado=!1,a.states={isLoading:!1,isError:!1,isOk:!1,title:null,msg:null},a.rechazo={causal:null,detalle:""},j.obtenerCausalesRechazo().then(function(b){null===b.status||(b.status?a.causales=b.listacausales:a.raiseErr("Problema detectado",b.msg))},function(b){a.raiseErr("Problema contactando al servidor.","Problema contactando al servidor.")}),a.doFocus=function(b,c){b?f(function(){a.$broadcast(c+"IsFocused")},100):a.$broadcast(c+"IsFocused")},a.saveRechazo=function(){a.rechazado=!0;var b=a.rechazo.causal.codigo,c=a.rechazo.detalle;j.rechazarCaratula(a.dataRechazo.numeroCaratula,b,c).then(function(b){null===b.status||(b.status?(a.raiseOk("",b.msg),a.salirSave()):a.raiseErr("Problema detectado",b.msg))},function(b){a.raiseErr("Problema contactando al servidor","Problema contactando al servidor.")})},a.cambioCausal=function(){var b=void 0===a.rechazo.detalle?"":a.rechazo.detalle;a.rechazo.detalle=b+a.rechazo.causal.template+"\n-------------------------\n"},a.closeRechazo=function(){d.dismiss("cancel"),c.path()!="/"+a.origen?h.go("/"+a.origen):b.reload()},a.close=function(){d.dismiss("cancel")},a.agregaRechazo=function(){},a.salirSave=function(){f(function(){a.savingRechazo=!1,a.closeRechazo()},2e3)},a.raiseErr=function(b,c){a.states.isError=!0,a.states.title=b,a.states.msg=c},a.raiseOk=function(b,c){a.states.isOk=!0,a.states.title=b,a.states.msg=c},a.doFocus(!0,"causal")}]),app.controller("RechazoModalCtrl",["$scope","$modalInstance","$log","$timeout","$window","dataRechazo","estado","estadoService","$modal","$modalStack",function(a,b,c,d,e,f,g,h,i,j){a.dataRechazo=f,a.savingRechazo=!1,a.rechazado=!1,h.obtenerCausasRechazo().then(function(b){null==b.status||(b.status?a.causales=b.rechazos:a.raiseErr(b.msg))},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")}),a.rechazo={causal:null,detalle:""},a.doFocus=function(b,c){b?d(function(){a.$broadcast(c+"IsFocused")},100):a.$broadcast(c+"IsFocused")},a.saveRechazo=function(){a.rechazado=!0,h.rechazarCaratula(a.dataRechazo.numeroCaratula,a.rechazo.causal.codigo,a.rechazo.detalle).then(function(b){null==b.status||(b.status?(a.openMensajeModal("success","Carátula rechazada exitosamente","",!1,null),a.closeModal(),g.buscar()):(a.raiseErr(b.msg),a.closeModal(),g.buscar()))},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.cambioCausal=function(){var b=void 0===a.rechazo.detalle?"":a.rechazo.detalle;a.rechazo.detalle=b+a.rechazo.causal.template+"\n-------------------------\n"},a.closeRechazo=function(){b.dismiss("cancel")},a.agregaRechazo=function(){},a.salirSave=function(){d(function(){a.savingRechazo=!1,a.closeRechazo()},2e3)},a.doFocus(!0,"causal"),a.raiseErr=function(b){a.openMensajeModal("error",b,"",!1,null)},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openMensajeModal=function(b,c,e,f,g){i.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return b},titulo:function(){return c},detalle:function(){return e}}}),f&&d(function(){a.closeModal()},1e3*g)},a.closeModal=function(){var a=j.getTop();a&&j.dismiss(a.key)}}]),app.controller("RehacerImagenModalCtrl",["$scope","$modalInstance","$modalStack","$modal","$log","$timeout","$window","$rootScope","dataImagen","servicioCertificacion",function(a,b,c,d,e,f,g,h,i,j){a.dataImagen=i,a.servicioCertificacion=j,a.states={isLoading:!1,isError:!1,isOk:!1,title:null,msg:null},a.rehacerImagen={motivo:""},a.doFocus=function(b,c){b?f(function(){a.$broadcast(c+"IsFocused")},100):a.$broadcast(c+"IsFocused")},a.saveRehacerImagen=function(){a.openLoadingModal("Enviado a Rehacer...","");var b=a.rehacerImagen.motivo;j.rehacerImagen(a.dataImagen.numeroCaratula,a.dataImagen.foja,a.dataImagen.numero,a.dataImagen.ano,a.dataImagen.bis,b).then(function(b){a.closeModal(),null===b.status||(b.status?(a.raiseOk("",b.msg),a.salirSave()):a.raiseErr("Problema detectado",b.msg))},function(b){a.raiseErr("Problema contactando al servidor","Problema contactando al servidor.")})},a.closeRehacerImagen=function(){b.dismiss("cancel"),h.go("/certificacion")},a.close=function(){b.dismiss("cancel")},a.salirSave=function(){f(function(){a.closeRehacerImagen()},2e3)},a.raiseErr=function(b,c){a.states.isError=!0,a.states.title=b,a.states.msg=c},a.raiseOk=function(b,c){a.states.isOk=!0,a.states.title=b,a.states.msg=c},a.openLoadingModal=function(a,b){d.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.closeModal=function(){var a=c.getTop();a&&c.dismiss(a.key)},a.doFocus(!0,"motivo")}]),app.controller("ReingresoCtrl",["$scope","$timeout","localStorageService","$log","reingresoService","caratulaService","$modal","$modalStack","$routeParams","$sce","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k){if(a.submitted=!1,a.req={numeroCaratula:null},b(function(){a.doFocus("numeroCaratula")},500),a.buscarCaratula=function(){a.openLoadingModal("Buscando carátula #"+a.req.numeroCaratula+"...",""),e.getCaratula(a.req.numeroCaratula).then(function(b){if(a.closeModal(),null===b.estado);else if(b.estado){a.data=b,a.dataOriginal=angular.copy(a.data),null!=b.inscripcionDigitalDTO&&(a.data.caratulaDTO.inscripcionDigitalDTO=b.inscripcionDigitalDTO);var c=e.getListas(a.data.caratulaDTO);c.then(function(b){null===b.estado||(b.estado?(a.listaRegistros=b.listaRegistros,a.listaTiposFormulario=b.listaTiposFormulario,a.listaWorkflowsJSONIns=b.listaWorkflowsJSONIns,a.listaWorkflowsJSONSolVig=b.listaWorkflowsJSONSolVig,a.listaWorkflowsJSONSolCv=b.listaWorkflowsJSONSolCv,a.listaWorkflowsJSONSolSv=b.listaWorkflowsJSONSolSv,a.llenaComboWorkFlow()):a.raiseErr(b.msg))},function(b){a.raiseErr("No se ha podido establecer comunicacion con el servidor.")}),a.obtenerBitacoraCaratula()}else a.raiseErr(b.msg),a.limpiar()},function(b){a.raiseErr("No se ha podido establecer comunicacion con el servidor.")})},a.recargaListas=function(){e.getListas(a.data.caratulaDTO).then(function(b){null===b.estado||(b.estado?a.listaTiposFormulario=b.listaTiposFormulario:a.raiseErr(b.msg))},function(b){a.raiseErr("No se ha podido establecer comunicacion con el servidor.")})},a.getListaNotarios=function(a){return e.getListaNotarios(a).then(function(a){return a})},a.reingresarCaratula=function(){if(a.openLoadingModal("Reingresando carátula #"+a.req.numeroCaratula+"...",""),a.formReingresar.$valid){e.reingresarCaratula(a.data.caratulaDTO,a.dataOriginal.caratulaDTO,a.data.observacion,a.data.workflow,a.data.codigoExtracto,a.data.notario).then(function(c){a.closeModal(),null===c.estado||(c.estado?(a.data=c,a.dataOriginal=angular.copy(a.data),c.msg&&(a.raiseSuccess(c.msg),b(function(){a.closeModal(),c.reingresoGP&&(a.verEstadoCaratula(c.reingresoGP),a.printReingresoGPCaratula(c.reingresoGP))},2e3)),a.limpiar()):a.raiseErr(c.msg))},function(b){a.raiseErr("No se ha podido establecer comunicacion con el servidor.")})}else a.formEditar.submitted=!0},a.printReingresoGPCaratula=function(c){a.openLoadingModal("Generando pdf...",""),a.urlPDF=j.trustAsResourceUrl("../do/service/reingreso?metodo=imprimirReingresoGP&caratula="+c),b(function(){a.printReingresoGP(),a.closeModal()},4e3)},a.printReingresoGP=function(){window.frames.pdfReingreso.focus(),window.frames.pdfReingreso.print()},a.limpiar=function(){a.reset(),a.req.numeroCaratula=null,a.doFocus("numeroCaratula")},a.reset=function(){a.data={},a.dataOriginal={}},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.raiseErr=function(b){a.openMensajeModal("error",b,"",!1,null)},a.raiseSuccess=function(b){a.openMensajeModal("success",b,"",!1,null)},a.openMensajeModal=function(c,d,e,f,h){g.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return c},titulo:function(){return d},detalle:function(){return e}}}),f&&b(function(){a.closeModal()},1e3*h)},a.openLoadingModal=function(a,b){g.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.openRechazoModal=function(){var b={numeroCaratula:a.req.numeroCaratula};g.open({templateUrl:"rechazoModal.html",backdrop:"static",keyboard:!1,windowClass:"modal",controller:"RechazoModalCtrl",resolve:{dataRechazo:function(){return b}}})},a.closeModal=function(){var a=h.getTop();a&&h.dismiss(a.key)},a.stringIsNumber=function(a){return(+a).toString()===a},void 0!==i.caratula)a.stringIsNumber(i.caratula)&&i.caratula.length<=10&&(a.req.numeroCaratula=i.caratula,b(function(){a.buscarCaratula()},500));else{e.getCaratulaSesion().then(function(b){null===b.status||b.status&&(a.req.numeroCaratula=b.numeroCaratula)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})}a.openComentariosModal=function(){var b={numeroCaratula:a.req.numeroCaratula};g.open({templateUrl:"comentariosCaratulaModal.html",backdrop:"static",keyboard:!1,windowClass:"modal",controller:"ComentariosCaratulaModalCtrl",resolve:{data:function(){return b}}})},a.caratula={resultados:[]},a.obtenerBitacoraCaratula=function(){f.obtenerBitacoraCaratula(a.req.numeroCaratula).then(function(b){null===b.status||(b.status?(a.caratula.resultados=b.listabitacoras,a.status=b.status,0!==a.caratula.resultados.length&&a.openComentariosModal()):a.raiseErr("No se pudo obtener bitacora caratula",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.openDocumentosEntregaModal=function(){var b={numeroCaratula:a.req.numeroCaratula};g.open({templateUrl:"documentosEntregaModal.html",backdrop:"static",keyboard:!1,windowClass:"modal",controller:"documentoEntregaModalCtrl",resolve:{data:function(){return b}}})},a.llenaComboWorkFlow=function(){void 0!=a.data&&void 0!=a.data.caratulaDTO&&(2==a.data.caratulaDTO.tipoFormularioDTO.id?a.listaWorkflow=a.listaWorkflowsJSONIns:7==a.data.caratulaDTO.tipoFormularioDTO.id?a.listaWorkflow=a.listaWorkflowsJSONSolVig:4==a.data.caratulaDTO.tipoFormularioDTO.id?(a.listaWorkflow=a.listaWorkflowsJSONSolCv,void 0!=a.listaWorkflow&&(a.data.workflow=a.listaWorkflow[0])):(a.listaWorkflow=a.listaWorkflowsJSONSolSv,void 0!=a.listaWorkflow&&(a.data.workflow=a.listaWorkflow[0])))},a.verEstadoCaratula=function(a){g.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})},a.$watch("data.caratulaDTO.tipoFormularioDTO",function(){a.llenaComboWorkFlow()})}]),app.controller("ReingresoEscrituraCtrl",["$scope","$http","$timeout","$rootScope","$location","$anchorScroll","$sce","solicitudesModel","reingresoEscrituraModel","certificacionService","caratulaService","estadoService","reingresoService","escrituraService","tareasService","$filter","$modal","$modalStack","Modal",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){a.busquedaReingreso=i.getBusquedaReingreso(),a.states=i.getStates(),a.tab=h.getTab(),a.statesEscritura=i.getStatesEscritura(),a.statesListado=i.getStatesListado(),a.statesDescarga=i.getStatesDescarga(),a.statesAnexo=i.getStatesAnexo(),a.statesDescargaFusion=i.getStatesDescargaFusion(),a.solicitudStatus={ok:!1,error:!1,warning:!1,msgTitle:null,msg:null,tipo:null},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.raiseErr=function(b){a.openMensajeModal("error",b,"",!0,2)},a.raiseSuccess=function(b){a.openMensajeModal("success",b,"",!0,2)},a.closeModal=function(){var a=r.getTop();a&&r.dismiss(a.key)},a.buscarEscriturasCaratula=function(){a.openLoadingModal("Buscando...",""),a.limpiarResultado(),l.getDocumentos(a.busquedaReingreso.caratula,"ESCRITURAS").then(function(b){if(a.closeModal(),null===b.status);else if(b.success){if(b.children.length>0)for(var c=0;c<b.children.length;c++)a.busquedaReingreso.version||b.children[c].children[0]&&b.children[c].children[0].vigente&&(a.busquedaReingreso.version=b.children[c].children[0].version),a.busquedaReingreso.escrituras.splice(a.busquedaReingreso.escrituras.length,0,b.children[c].children[0]);a.busquedaReingreso.data=b}else a.raiseErr(b.errormsg)},function(b){a.raiseErr("No se ha podido establecer comunicacion con el servidor.")})},a.verDocumentoEstudio=function(b){l.existeEscritura(b).then(function(c){c.hayDocumento?(a.busquedaReingreso.caratula,b.version,a.urlPDF=g.trustAsResourceUrl("../do/service/escritura?metodo=verDocumentoEstudio&caratula="+a.busquedaReingreso.caratula+"&version="+b.version+"&idTipoDocumento="+b.idTipoDocumento+"&type=uri")):a.raiseErr(c.errormsg)},function(b){a.raiseErr("No se ha podido establecer comunicacion con el servidor.")})},a.subirArchivo=function(c){a.openLoadingModal("Versionando...","");var d=new FormData;d.append("observacion",a.busquedaReingreso.observacion1),d.append("caratula",a.busquedaReingreso.caratula),d.append("file",c),b({withCredentials:!0,method:"POST",url:"../upload",data:d,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(b){a.closeModal(),b.data.status?(a.raiseSuccess(b.data.message),a.resetResultado()):(a.statesEscritura.ok=b.data.status,a.statesEscritura.msg=b.data.message)},function(b){a.closeModal(),a.statesEscritura.ok=b.data.status,a.statesEscritura.msg=b.data.message})},a.fusionarArchivo=function(c){a.openLoadingModal("Fusionando...","");var d=new FormData;d.append("version",a.busquedaReingreso.version),d.append("observacion",a.busquedaReingreso.observacion2),d.append("caratula",a.busquedaReingreso.caratula),d.append("file",c),b({withCredentials:!0,method:"POST",url:"../fusionUpload",data:d,headers:{"Content-Type":void 0},transformRequest:angular.identity}).then(function(b){a.closeModal(),b.data.status?(a.raiseSuccess(b.data.message),a.resetResultado()):(a.statesAnexo.ok=b.data.status,a.statesAnexo.msg=b.data.message)},function(b){a.closeModal(),a.statesAnexo.ok=b.data.status,a.statesAnexo.msg=b.data.message})},a.getListaNotarios=function(a){return m.getListaNotarios(a).then(function(a){return a})},a.buscarDocumento=function(){a.openLoadingModal("buscando documento...",""),o.buscarDocumento(a.busquedaReingreso.notario.idNotario,a.busquedaReingreso.codescritura,a.busquedaReingreso.notario.empresa,a.busquedaReingreso.caratula).then(function(b){if(a.closeModal(),null===b.estado);else if(b.status){var c=l.agregarBitacora(a.busquedaReingreso.caratula,"Reingreso Escritura Electronica",0);c.then(function(b){null===b.status||b.status||a.raiseErr(b.msg)},function(b){a.statesDescarga.ok=response.data.status,a.statesDescarga.msg="Problema en Guardar Bitacora"}),a.raiseSuccess("Descarga Archivo Exitoso y Versionado"),a.resetResultado()}else a.statesDescarga.ok=!1,a.statesDescarga.msg=b.msg},function(b){a.statesDescarga.ok=!1,a.statesDescarga.msg="no se ha podido establecer comunicacion con el servidor."})},a.buscarDocumentoFusion=function(){a.openLoadingModal("buscando documento...",""),o.buscarDocumentoFusion(a.busquedaReingreso.notario2.idNotario,a.busquedaReingreso.codescritura2,a.busquedaReingreso.notario2.empresa,a.busquedaReingreso.caratula,a.busquedaReingreso.version).then(function(b){if(a.closeModal(),null===b.estado);else if(b.status){var c=l.agregarBitacora(a.busquedaReingreso.caratula,"Reingreso Fusion Escritura Electronica",0);c.then(function(b){null===b.status||b.status||a.raiseErr(b.msg)},function(b){a.statesDescargaFusion.ok=response.data.status,a.statesDescargaFusion.msg="Problema en Guardar Bitacora"}),a.raiseSuccess("Descarga Archivo Exitoso y Fusionado"),a.resetResultado()}else a.statesDescargaFusion.ok=!1,a.statesDescargaFusion.msg=b.msg},function(b){a.statesDescargaFusion.ok=!1,a.statesDescargaFusion.msg="no se ha podido establecer comunicacion con el servidor."})},a.openLoadingModal=function(a,b){q.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.openMensajeModal=function(b,d,e,f,g){q.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return b},titulo:function(){return d},detalle:function(){return e}}}),f&&c(function(){a.closeModal()},1e3*g)},a.resetResultado=function(){a.busquedaReingreso.caratula="",a.limpiarResultado(),a.doFocus("caratula")},a.limpiarResultado=function(){a.busquedaReingreso.data=null,a.busquedaReingreso.escrituras.length=0,a.states.buscar.isError=!1,a.statesEscritura.ok=null,a.statesEscritura.msg=null,a.statesDescarga.ok=null,a.statesDescarga.msg=null,a.statesAnexo.ok=null,a.statesAnexo.msg=null,a.statesDescargaFusion.ok=null,a.statesDescargaFusion.msg=null,a.busquedaReingreso.codescritura="",a.busquedaReingreso.notario="",a.busquedaReingreso.codescritura2="",a.busquedaReingreso.notario2="",a.busquedaReingreso.observacion1="",a.busquedaReingreso.observacion2="",a.busquedaReingreso.version=null,angular.element("input[type='file']").val(null),a.urlPDF=""},a.removeVersion=s.confirm.delete(function(b){a.openLoadingModal("Eliminando version de escritura...",""),n.eliminarDocumento(b.idDocumento,a.busquedaReingreso.caratula,b.version).then(function(b){a.closeModal(),null===b.estado||(b.status?(a.raiseSuccess("Se ha eliminado la version de Escritura"),a.buscarEscriturasCaratula()):(a.statesListado.ok=!1,a.statesListado.msg=b.msg))},function(b){a.statesListado.ok=!1,a.statesListado.msg="no se ha podido establecer comunicacion con el servidor."})})}]),app.controller("RepertorioCtrl",["$scope","$timeout","$rootScope","$location","$anchorScroll","$filter","$modal","$modalStack","$routeParams","RepertorioModel","repertorioService",function(a,b,c,d,e,f,g,h,i,j,k){if(a.busquedaRepertorio=j.getBusquedaRepertorio(),a.states=j.getStates(),a.solicitudStatus={ok:!1,error:!1,warning:!1,msgTitle:null,msg:null,tipo:null},a.resolveModal={refresca:!1},a.buscar=function(){if(a.buscando=!0,null!=a.busquedaRepertorio.anoRepertorio)var b=a.busquedaRepertorio.anoRepertorio.codigo;k.getRepertorio(a.busquedaRepertorio.caratula,a.busquedaRepertorio.repertorio,b).then(function(b){a.buscando=!1,b.status?(a.busquedaRepertorio.data=b,a.busquedaRepertorio.resultados=b.resultado):a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")},function(a){})},a.verEstadoCaratula=function(a){g.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})},a.raiseErr=function(b,c,d){a.closeModal(),a.states[b].isError=!0,a.states[b].title=c,a.states[b].msg=d},a.resetStatus=function(){a.solicitudStatus.ok=!1,a.solicitudStatus.error=!1,a.solicitudStatus.warning=!1,a.solicitudStatus.msgTitle=null,a.solicitudStatus.msg=null},a.setErr=function(b,c){a.solicitudStatus.error=!0,a.setStatusMsg(b,c)},a.setStatusMsg=function(b,c){a.solicitudStatus.msgTitle=b,a.solicitudStatus.msg=c},void 0==a.busquedaRepertorio.anosRepertorios||0==a.busquedaRepertorio.anosRepertorios.length)for(var l=(new Date).getFullYear(),m=l;m>=l-80;m--)a.busquedaRepertorio.anosRepertorios.push({codigo:m,descripcion:m});a.limpiar=function(){a.resetResultadoRepertorio(),a.busquedaRepertorio.caratula=null,a.busquedaRepertorio.repertorio=null,a.busquedaRepertorio.anoRepertorio=null,a.myform.$setPristine(!0),a.doFocus("caratula")},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.resetResultadoRepertorio=function(){a.busquedaRepertorio.data=null,a.states.buscar.isError=!1,void 0!==a.busquedaRepertorio.resultados&&(a.busquedaRepertorio.resultados.length=0)},a.masInfo=function(b){a.resolveModal.refresca=!1;g.open({templateUrl:"masInfoRepertorioModal.html",backdrop:!0,windowClass:"modal",controller:"masinforepertorioModalCtrl",resolve:{resolveModal:function(){return a.resolveModal},repertorio:function(){return b}}})},a.closeModal=function(){var a=h.getTop();a&&h.dismiss(a.key)}}]),app.controller("RepertorioModalCtrl",["$scope","$window","$timeout","$log","$modal","$modalStack","$routeParams","$modalInstance","numeroRepertorio",function(a,b,c,d,e,f,g,h,i){a.numeroRepertorio=i,a.cancel=function(){h.dismiss("cancel")}}]),app.controller("RequirenteModalCtrl",["$log","$rootScope","$scope","$modal","$modalInstance","$modalStack","$window","$timeout","data","estadoService",function(a,b,c,d,e,f,g,h,i,j){c.data=i,c.requirente={email:""},c.cancel=function(){var a=f.getTop();a&&f.dismiss(a.key)},c.guardarCorreoRequirente=function(){c.openLoadingModal("Guardando...",""),j.cambiarCorreo(c.data.req.numeroCaratula,c.requirente.email).then(function(a){c.closeModal(),null===a.status||(a.status?(c.data.res.caratulaDTO.requirenteDTO.email=c.requirente.email,c.data.res.caratulaDTO.bitacoraDTOs.unshift(a.bitacoraDTO),c.closeModal(),c.openMensajeModal("success","Datos requiente modificado exitosamente","",!1,null)):c.raiseErr(a.msg))},function(a){c.raiseErr("No se ha podido establecer comunicación con el servidor.")})},c.raiseErr=function(a){c.openMensajeModal("error",a,"",!1,null)},c.doFocus=function(a){c.$broadcast(a+"IsFocused")},c.openMensajeModal=function(a,b,e,f,g){d.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return b},detalle:function(){return e}}}),f&&h(function(){c.closeModal()},1e3*g)},c.openLoadingModal=function(a,b){d.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},c.closeModal=function(){var a=f.getTop();a&&f.dismiss(a.key)},h(function(){c.doFocus("email")},500)}]),app.controller("RevisionNotasCtrl",["$scope","$timeout","$rootScope","solicitudesModel","revisionNotasModel","indiceService","solicitudService","inscripcionDigitalService","$filter","$modal","$modalStack","filterFilter",function(a,b,c,d,e,f,g,h,i,j,k,l){if(a.busquedaRevisionNotas=e.getBusquedaRevisionNotas(),a.states=e.getStates(),a.tab=d.getTab(),a.paginacionMaster={currentPage:1,numPerPage:10,maxSize:10,todos:[]},a.filtro={filterExpr:""},a.paginacion=angular.copy(a.paginacionMaster),a.paginacion.todos=a.busquedaRevisionNotas.resultados,void 0==a.busquedaRevisionNotas.anos||0==a.busquedaRevisionNotas.anos.length)for(var m=(new Date).getFullYear(),n=0,o=1937;o<=m;o++)a.busquedaRevisionNotas.anos.push({codigo:o,descripcion:o}),a.busquedaRevisionNotas.anos[n].codigo==m&&(a.busquedaRevisionNotas.ano=a.busquedaRevisionNotas.anos[n]),n++;a.buscarFojaIniFojaFinCuadernillo=function(){var b=a.busquedaRevisionNotas.cuadernillo,c=a.busquedaRevisionNotas.ano.codigo;if(b){a.openLoadingModal("Buscando Rango Cuadernillo...","");h.getFojaIniFojaFinCuadernillo(b,c).then(function(b){a.closeModal(),null===b.status||(b.status?b.fojainifojafin?(a.busquedaRevisionNotas.fojaini=b.fojainifojafin.fojaIni,a.busquedaRevisionNotas.fojafin=b.fojainifojafin.fojaFin,a.buscarNotas()):a.raiseErr("No se encontro cuadernillo"):a.raiseErr("Problema detectado"))},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})}},a.buscarNotas=function(){var b=a.busquedaRevisionNotas.fojaini,c=a.busquedaRevisionNotas.fojafin,d=a.busquedaRevisionNotas.ano.codigo,e=a.busquedaRevisionNotas.cuadernillo;a.openLoadingModal("Buscando...",""),h.getAnotacionParaRevision(b,c,d,e).then(function(b){a.closeModal(),null===b.status||(b.status?(a.busquedaRevisionNotas.resultados=b.anotaciones,a.busquedaRevisionNotas.tieneDespacho=b.tieneDespacho,a.busquedaRevisionNotas.data=b,a.busquedaRevisionNotas.resultado_cuadernillo=a.busquedaRevisionNotas.cuadernillo,a.busquedaRevisionNotas.ano_cuadernillo=d,a.busquedaRevisionNotas.resultados.length>0&&a.makeTodos(b.anotaciones)):a.raiseErr("Problema detectado"))},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.makeTodos=function(b){a.paginacion=angular.copy(a.paginacionMaster),a.paginacion.todos=b,a.filtrar()},a.aprobarNota=function(b){a.openLoadingModal("Aprobando...",""),h.actualizaEstadoAnotacion(b.idAnotacion).then(function(c){a.closeModal(),null===c.status||(c.status?(a.busquedaRevisionNotas.resultados.splice(a.busquedaRevisionNotas.resultados.indexOf(b),1),a.makeTodos(a.busquedaRevisionNotas.resultados)):a.raiseErr("Problema detectado "+c.msg))},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.despacharCuadernillo=function(){var b=a.busquedaRevisionNotas.resultado_cuadernillo,c=a.busquedaRevisionNotas.ano_cuadernillo;if(console.log(b,c),confirm("¿Está seguro que desea despachar el cuadernillo "+b+"?")&&b){a.openLoadingModal("Buscando Rango Cuadernillo...","");h.despacharCuadernillo(b,c).then(function(b){a.closeModal(),null===b.status||(b.status?(a.openMensajeModal("success","Cuadernillo despachado","",!0,2),a.busquedaRevisionNotas.tieneDespacho=!0):a.raiseErr("Problema detectado"))},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})}},a.colapsar=function(){a.busquedaRevisionNotas.indicebusqueda?a.busquedaRevisionNotas.indicebusqueda=!1:a.busquedaRevisionNotas.indicebusqueda=!0},a.colapsarnuevabusqueda=function(){a.busquedaRevisionNotas.indicebusqueda=!1,a.limpiarFormulario(),b(function(){a.doFocus("fojaini")},200)},a.limpiarFormulario=function(){a.resetResultadoFormulario(),a.busquedaRevisionNotas.fojaini=null,a.busquedaRevisionNotas.fojafin=null,a.busquedaRevisionNotas.cuadernillo=null,a.myform.$setPristine(!0),a.doFocus("fojaini")},a.resetResultadoFormulario=function(){a.busquedaRevisionNotas.data=null,a.states.buscar.isError=!1,void 0!==a.busquedaRevisionNotas.resultados&&(a.busquedaRevisionNotas.resultados.length=0)},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},b(function(){null==a.busquedaRevisionNotas.data&&a.doFocus("fojaini")},200),a.archivoNacional=function(a){return!(a<c.aioParametros.anoArchivoNacional)},a.anoActual=function(a){return!(moment(new Date).year()<a)},a.openLoadingModal=function(a,b){j.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.raiseErr=function(b){a.openMensajeModal("warning",b,"",!0,2)},a.openMensajeModal=function(c,d,e,f,g){j.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return c},titulo:function(){return d},detalle:function(){return e}}}),f&&b(function(){a.closeModal()},1e3*g)},a.closeModal=function(){var a=k.getTop();a&&k.dismiss(a.key)},a.verTitulo=function(a){a.bis;c.go("/verInscripcion/prop/"+a.foja+"/"+a.numero+"/"+a.ano+"/"+a.bis+"/revisionNotas/0")},a.$watch("filtro.filterExpr",function(b,c){a.filtrar()}),a.filtrar=function(){a.filtered=l(a.busquedaRevisionNotas.resultados,a.filtro.filterExpr),a.paginacion.todos=a.filtered,a.paginacion.currentPage=1}}]),app.controller("SidebarCtrl",["$scope","$location","localStorageService",function(a,b,c){a.colorBarra="default-color";var d=c.get("colorBarra");d&&(a.colorBarra=d),a.cambiarColor=function(b){a.colorBarra=b,c.set("colorBarra",a.colorBarra)},a.getClass=function(a){return b.path()===a},a.ocultar=function(){return b.path().indexOf("verInscripcion")>0||b.path().indexOf("verCartel")>0||b.path().indexOf("consultadiablito")>0||b.path().indexOf("verVistaPreviaPlantilla")>0}}]),app.controller("SolicitarIndiceModalCtrl",["$rootScope","$scope","$modalInstance","$modalStack","$window","$timeout","solicitudService","indiceModel","resolveModal","titulo",function(a,b,c,d,e,f,g,h,i,j){b.titulo=j,b.solicitudStatus={ok:!1,error:!1,warning:!1,msgTitle:null,msg:null},b.isLoadingSolicitar=!1,b.pasoPreSolicitar=!1,b.solicita={foja:null,numero:null,ano:null,bis:!1,tipo:null,esDigital:!1},b.preSolicitar=function(){b.resetStatus(),b.isLoadingSolicitar=!0,g.saveSingleConValidacion(b.solicita.foja,b.solicita.numero,b.solicita.ano,b.solicita.bis).then(function(a){if(null===a.status);else if(a.status)if(b.solicita.tipo=a.estado.tipo,b.solicita.esDigital=a.estado.esDigital,0===b.solicita.tipo)b.isLoadingSolicitar=!1,b.setErr("Mal citada.","Esta misma solicitud de foja, número, año y bis, ya ha sido realizada anteriormente y fue rechazada por título mal citado."),b.$broadcast("sfojaIsFocused");else if(1===b.solicita.tipo){i.refresca=!0;var c="<strong>el libro</strong> título solicitado.";b.solicita.esDigital&&(c="una <strong>imagen al día</strong> del título solicitado."),b.setOK("Solicitud creada.","Recibirá "+c),f(function(){b.closeModal()},4e3)}else 2===b.solicita.tipo?(b.isLoadingSolicitar=!1,b.pasoPreSolicitar=!0):3===b.solicita.tipo&&(b.isLoadingSolicitar=!1,b.pasoPreSolicitar=!0);else b.isLoadingSolicitar=!1,b.setErr("Problema detectado.","No se ha guardado la solicitud.")},function(a){b.isLoadingSolicitar=!1,b.setErr("Problema contactando al servidor.","No se ha guardado la solicitud.")})},b.volverPreSolicita=function(){b.pasoPreSolicitar=!1,b.solicita.tipo=null,b.solicita.esDigital=!1,b.resetStatus(),f(function(){b.$broadcast("sfojaIsFocused")},100)},b.solicitar=function(){b.resetStatus(),b.isLoadingSolicitar=!0,g.saveSingle(b.titulo.foja,b.titulo.num,b.titulo.ano,b.titulo.bis).then(function(a){null===a.status||(a.status?(b.solicitudStatus.ok=!0,1===b.solicita.tipo?(i.refresca=!0,f(function(){b.closeModal()},4e3)):(i.refresca=!0,b.isLoadingSolicitar=!1)):(b.isLoadingSolicitar=!1,b.setErr("Problema detectado.","No se ha guardado la solicitud.")))},function(a){b.isLoadingSolicitar=!1,b.setErr("Problema contactando al servidor.","No se ha guardado la solicitud.")})},b.cancel=function(){c.dismiss("cancel")},b.limpiar=function(){b.resetSolicita(),b.resetStatus(),b.$broadcast("sfojaIsFocused")},b.archivoNacional=function(b){return!(b<a.aioParametros.anoArchivoNacional)},b.anoActual=function(a){return!(moment(new Date).year()<a)},b.verInscripcion=function(){var c=1==j.bis;a.go("/verInscripcion/prop/"+b.titulo.foja+"/"+b.titulo.num+"/"+b.titulo.ano+"/"+c+"/indice/"+b.titulo.tipodocumento)},b.setErr=function(a,c){b.solicitudStatus.error=!0,b.setStatusMsg(a,c)},b.setStatusMsg=function(a,c){b.solicitudStatus.msgTitle=a,b.solicitudStatus.msg=c},b.setOK=function(a,c){b.solicitudStatus.ok=!0,b.setStatusMsg(a,c)},b.resetStatus=function(){b.solicitudStatus.ok=!1,b.solicitudStatus.error=!1,b.solicitudStatus.warning=!1,b.solicitudStatus.msgTitle=null,b.solicitudStatus.msg=null},b.resetSolicita=function(){b.solicita.foja=null,b.solicita.numero=null,b.solicita.ano=null,b.solicita.bis=!1,b.solicita.tipo=null,b.solicita.esDigital=!1},b.closeModal=function(){var a=d.getTop();a&&d.dismiss(a.key)},f(function(){b.$broadcast("sfojaIsFocused")},100)}]),app.controller("SolicitarModalCtrl",["$rootScope","$scope","$modalInstance","$modalStack","$window","$timeout","resolveModal","servicio",function(a,b,c,d,e,f,g,h){b.solicitudStatus={ok:!1,error:!1,warning:!1,msgTitle:null,msg:null},b.isLoadingSolicitar=!1,b.pasoPreSolicitar=!1,b.solicita={foja:null,numero:null,ano:null,bis:!1,tipo:null,esAnoDigital:!1},b.preSolicitar=function(){b.resetStatus(),b.isLoadingSolicitar=!0,h.saveSingleConValidacion(b.solicita.foja,b.solicita.numero,b.solicita.ano,b.solicita.bis).then(function(a){if(null===a.status);else if(a.status)if(b.solicita.tipo=a.estado.tipo,b.solicita.esAnoDigital=a.estado.esAnoDigital,-1===b.solicita.tipo)b.isLoadingSolicitar=!1,b.setErr("Mal citada.","Esta misma solicitud de foja, número, año y bis, ya ha sido realizada anteriormente y fue rechazada por título mal citado."),b.$broadcast("sfojaIsFocused");else if(7===b.solicita.tipo){g.refresca=!0;var c="<strong>el libro</strong> título solicitado.";b.solicita.esAnoDigital&&(c="una <strong>imagen al día</strong> del título solicitado."),b.setOK("Solicitud creada.","Recibirá "+c),f(function(){b.closeModal()},4e3)}else 0===b.solicita.tipo||2===b.solicita.tipo?(b.isLoadingSolicitar=!1,b.pasoPreSolicitar=!0):1===b.solicita.tipo&&(b.isLoadingSolicitar=!1,b.pasoPreSolicitar=!0);else b.isLoadingSolicitar=!1,b.setErr("Problema detectado.","No se ha guardado la solicitud.")},function(a){b.isLoadingSolicitar=!1,b.setErr("Problema contactando al servidor.","No se ha guardado la solicitud.")})},b.volverPreSolicita=function(){b.pasoPreSolicitar=!1,b.solicita.tipo=null,b.solicita.esAnoDigital=!1,b.resetStatus(),f(function(){b.$broadcast("sfojaIsFocused")},100)},b.solicitar=function(){b.resetStatus(),b.isLoadingSolicitar=!0,h.saveSingle(b.solicita.foja,b.solicita.numero,b.solicita.ano,b.solicita.bis).then(function(a){null===a.status||(a.status?(b.solicitudStatus.ok=!0,7===b.solicita.tipo?(g.refresca=!0,f(function(){b.closeModal()},4e3)):(g.refresca=!0,b.isLoadingSolicitar=!1)):(b.isLoadingSolicitar=!1,b.setErr("Problema detectado.","No se ha guardado la solicitud.")))},function(a){b.isLoadingSolicitar=!1,b.setErr("Problema contactando al servidor.","No se ha guardado la solicitud.")})},b.cancel=function(){c.dismiss("cancel")},b.limpiar=function(){b.resetSolicita(),b.resetStatus(),b.$broadcast("sfojaIsFocused")},b.archivoNacional=function(b){return!(b<a.aioParametros.anoArchivoNacional)},b.anoActual=function(a){return!(moment(new Date).year()<a)},b.verInscripcion=function(){var c=g.origen;a.go("/verInscripcion/prop/"+b.solicita.foja+"/"+b.solicita.numero+"/"+b.solicita.ano+"/"+b.solicita.bis+"/"+c)},b.setErr=function(a,c){b.solicitudStatus.error=!0,b.setStatusMsg(a,c)},b.setStatusMsg=function(a,c){b.solicitudStatus.msgTitle=a,b.solicitudStatus.msg=c},b.setOK=function(a,c){b.solicitudStatus.ok=!0,b.setStatusMsg(a,c)},b.resetStatus=function(){b.solicitudStatus.ok=!1,b.solicitudStatus.error=!1,b.solicitudStatus.warning=!1,b.solicitudStatus.msgTitle=null,b.solicitudStatus.msg=null},b.resetSolicita=function(){b.solicita.foja=null,b.solicita.numero=null,b.solicita.ano=null,b.solicita.bis=!1,b.solicita.tipo=null,b.solicita.esAnoDigital=!1},b.closeModal=function(){var a=d.getTop();a&&d.dismiss(a.key)},f(function(){b.$broadcast("sfojaIsFocused")},100)}]),app.controller("SolicitudesCtrl",["$rootScope","$scope","$timeout","$location","solicitudesModel","$filter","$modal","$modalStack","inscripcionDigitalService","indiceService","RutHelper","solicitudService",function(a,b,c,d,e,f,g,h,i,j,k,l){b.tab=e.getTab(),b.busquedaTitulo=e.getBusquedaTitulo(),b.datosSesion={rut:null,requirente:null},b.contador={usuario:null,total:null},b.solicita={foja:null,numero:null,ano:null,bis:!1,origen:"solicitudes",consultaDocumentoDTO:{},estado:{}},b.resolveModal={refresca:!1},b.$watchCollection("busquedaTitulo",function(){void 0!==b.busquedaTitulo.rut&&""!==b.busquedaTitulo.rut||(b.busquedaTitulo.nombre="")}),b.busquedaRut=e.getBusquedaRut(),b.$watchCollection("busquedaRut",function(){void 0!==b.busquedaRut.rut&&""!==b.busquedaRut.rut||(b.busquedaRut.nombre=""),$.Rut.validar(b.busquedaRut.rut)&&e.setBusquedaRut(b.busquedaRut)}),b.busquedaMis=e.getBusquedaMis(),b.states=e.getStates(),b.listaMis={data:[],inicio:0,fin:15,offset:15},b.listaRut={data:[],inicio:0,fin:15,offset:15},b.resolveModal={refresca:!1,origen:"solicitudes"},b.$watchCollection("resolveModal",function(){b.resolveModal.refresca&&b.buscarMis(!1)}),b.promiseUpdateSolicitudMis=null,b.promiseUpdateSolicitudRut=null,b.isActiveParent=function(a){return b.tab.parentActive===a},b.activateParent=function(a){if(b.tab.parentActive=a,e.setTab(b.tab),1===b.tab.parentActive){j.getRutSesion().then(function(a){null===a.status||a.status&&(b.busquedaTitulo.rut=k.format(a.rut))},function(a){b.raiseErr("No se ha podido establecer comunicación con el servidor.")}),null!==b.busquedaTitulo.rut?c(function(){b.doFocus("foja")},200):c(function(){b.doFocus("rutt")},200)}else 2===b.tab.parentActive?c(function(){j.getRutSesion().then(function(a){null===a.status||a.status&&(b.busquedaRut.rut=k.format(a.rut))},function(a){b.raiseErr("No se ha podido establecer comunicación con el servidor.")}),b.doFocus("rut")},200):3===b.tab.parentActive&&(void 0!==b.busquedaMis.resultados&&0!==b.busquedaMis.resultados.length||b.buscarMis(!0))},b.verTitulo=function(b){var c=1==b.bis,d=b.estadoDigitalId;a.go("/verInscripcion/prop/"+b.foja+"/"+b.numero+"/"+b.ano+"/"+c+"/solicitudes/"+d)},b.resetResultadoTitulo=function(){b.busquedaTitulo.data=null,b.busquedaTitulo.req.rut=null,b.busquedaTitulo.req.nombre="",void 0!==b.busquedaTitulo.resultados&&(b.busquedaTitulo.resultados.length=0),b.busquedaTitulo.titulosSeleccionados={},b.busquedaTitulo.checkTodo=!1},b.limpiarTitulo=function(){b.resetResultadoTitulo(),b.busquedaTitulo.rut=null,b.busquedaTitulo.nombre="",b.busquedaTitulo.foja=null,b.busquedaTitulo.numero=null,b.busquedaTitulo.ano=null,b.busquedaTitulo.bis=!1,b.busquedaTitulo.anteriores=!0,b.myform.$setPristine(!0),b.doFocus("rutt")},b.limpiarFnaTitulo=function(){b.resetResultadoTitulo(),b.busquedaTitulo.foja=null,b.busquedaTitulo.numero=null,b.busquedaTitulo.ano=null,b.busquedaTitulo.bis=!1,b.busquedaTitulo.anteriores=!0,b.myform.$setPristine(!0),b.doFocus("foja")},b.buscarTitulo=function(){var a=b.busquedaTitulo.foja,c=b.busquedaTitulo.numero,d=b.busquedaTitulo.ano,e=b.busquedaTitulo.bis,f=b.busquedaTitulo.anteriores;b.resetResultadoTitulo(),b.states.titulo.isLoading=!0,b.openLoadingModal("Buscando título...",""),b.agregarNuevaAtencion(),i.getBusquedaTitulo(a,c,d,e,f).then(function(a){b.closeModal(),null===a.status||(a.status?a.tieneRechazo?b.openMensajeModal("error","Hay rechazo","Una solicitud con los mismos antecedentes ya ha sido rechazada anteriormente."):(a.solicita,!a.fna&&a.req.ano>=2014?b.openMensajeModal("error","No está en índice","La información citada no ha sido encontrada en nuestros registros."):!a.fna&&a.req.ano<2014?(b.busquedaTitulo.req.rut=b.busquedaTitulo.rut,b.busquedaTitulo.req.nombre=b.busquedaTitulo.nombre,b.busquedaTitulo.data=a,b.buscarTituloPost()):(b.busquedaTitulo.req.rut=b.busquedaTitulo.rut,b.busquedaTitulo.req.nombre=b.busquedaTitulo.nombre,b.busquedaTitulo.data=a,b.busquedaTitulo.resultados=a.aaData.slice(0,20))):b.raiseErr("titulo","Problema detectado",a.msg))},function(a){b.raiseErr("titulo","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.openSolicitar=function(){b.$broadcast("sfojaIsFocused"),g.open({templateUrl:"digitalModal.html",backdrop:!0,windowClass:"modal",controller:"DigitalModalCtrl",resolve:{solicita:function(){return b.solicita},servicio:function(){return l},origen:function(){return b.solicita.origen}}})},b.buscarTituloPost=function(){var a=b.busquedaTitulo.foja,c=b.busquedaTitulo.numero,d=b.busquedaTitulo.ano,e=b.busquedaTitulo.bis,f=!0===b.busquedaTitulo.bis?1:0;b.states.titulo.isLoading=!0,b.openLoadingModal("Buscando...",""),i.getInscripcion(a,c,d,e).then(function(e){b.closeModal(),null===e.status||(e.status?(b.solicita.foja=e.inscripcionDigitalDTO.foja,b.solicita.numero=e.inscripcionDigitalDTO.numero,b.solicita.ano=e.inscripcionDigitalDTO.ano,b.solicita.bis=e.inscripcionDigitalDTO.bis,b.solicita.consultaDocumentoDTO=e.consultaDocumentoDTO,b.solicita.estado=e.estado,e.estado.tieneRechazo?b.openSolicitar():e.consultaDocumentoDTO.hayDocumento&&(!e.consultaDocumentoDTO.hayDocumento||9!==e.consultaDocumentoDTO.tipoDocumento&&10!==e.consultaDocumentoDTO.tipoDocumento)?e.consultaDocumentoDTO.hayDocumento&&8===e.consultaDocumentoDTO.tipoDocumento&&(digitalModel.setDataState(e),b.verTitulo({foja:a,numero:c,ano:d,bis:f})):b.openSolicitar()):b.raiseErr("titulo","Problema detectado",e.msg))},function(a){b.openMensajeModal("error","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.cerrarResultadoTitulo=function(){b.resetResultadoTitulo(),b.doFocus("foja")},b.seleccionaSingle=function(a){b.busquedaTitulo.titulosSeleccionados[a]||(b.busquedaTitulo.checkTodo=!1)},b.seleccionarTodo=function(){for(var a=0;a<b.busquedaTitulo.resultados.length;a++)7!==b.busquedaTitulo.resultados[a].tipoDocumento&&2!==b.busquedaTitulo.resultados[a].tipoDocumento&&0!==b.busquedaTitulo.resultados[a].tipoDocumento||b.busquedaTitulo.resultados[a].puedeSolicitar&&(b.busquedaTitulo.titulosSeleccionados[b.busquedaTitulo.resultados[a].firma]=b.busquedaTitulo.checkTodo)},b.solicitarTodoTitulo=function(){for(var a=[],c=0;c<b.busquedaTitulo.resultados.length;c++)b.busquedaTitulo.titulosSeleccionados[b.busquedaTitulo.resultados[c].firma]&&a.push({foja:b.busquedaTitulo.resultados[c].foja,numero:b.busquedaTitulo.resultados[c].numero,ano:b.busquedaTitulo.resultados[c].ano,bis:b.busquedaTitulo.resultados[c].bis,firma:b.busquedaTitulo.resultados[c].firma});if(a.length>0){var d=angular.toJson(a);b.promiseSaveSolicitud=l.save(d,b.busquedaTitulo.req.rut,b.busquedaTitulo.req.nombre),b.promiseSaveSolicitud.then(function(c){if(null===c.status);else if(c.status)for(var d=0;d<b.busquedaTitulo.resultados.length;d++)for(var e=0;e<a.length;e++)if(a[e].firma===b.busquedaTitulo.resultados[d].firma){b.busquedaTitulo.resultados[d].puedeSolicitar=!1,b.busquedaTitulo.titulosSeleccionados[b.busquedaTitulo.resultados[d].firma]=!1;break}},function(a){})}},b.columnSortRut=function(a){b.busquedaRut.sorter.reverse=b.busquedaRut.sorter.predicate==a&&!b.busquedaRut.sorter.reverse,b.busquedaRut.sorter.predicate=a},b.loadMoreRut=function(){var a=b.busquedaRut.resultados.slice(b.listaRut.inicio,b.listaRut.fin);angular.forEach(a,function(a){b.listaRut.data.push(a)}),b.listaRut.inicio=b.listaRut.inicio+b.listaRut.offset,b.listaRut.fin=b.listaRut.fin+b.listaRut.offset},b.resetResultadoRut=function(){void 0!==b.busquedaRut.resultados&&(b.busquedaRut.resultados.length=0),void 0!==b.listaRut.data&&(b.listaRut.data.length=0),b.busquedaRut.data=null,b.busquedaRut.fecha=null,b.listaRut.inicio=0,b.listaRut.fin=b.listaRut.offset,b.cleanErr("rut")},b.limpiarRut=function(){b.busquedaRut.rut=null,b.busquedaRut.nombre="",b.resetResultadoRut(),b.myformRut.$setPristine(!0),b.doFocus("rut")},b.cerrarResultadoRut=function(){b.resetResultadoRut(),b.doFocus("rut")},b.buscarRut=function(a){b.resetResultadoRut(),b.openLoadingModal("Buscando...",""),l.getByRut(a).then(function(a){console.log(a),b.closeModal(),null===a.status||(a.status?(b.busquedaRut.fecha=new Date,b.busquedaRut.data=a,b.busquedaRut.resultados=f("orderBy")(a.aaData,"idSolicitud",!0)):b.raiseErr("rut","Problema detectado",a.msg))},function(a){b.raiseErr("rut","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.hayDataEnTablaRut=function(){var a=f("filter")(b.busquedaRut.resultados,b.isSolicitudRevisada,!0);return void 0!==a&&a.length>0},b.openSolicitarEnMis=function(){g.open({templateUrl:"solicitarModal.html",backdrop:!0,windowClass:"modal",controller:"SolicitarModalCtrl",resolve:{resolveModal:function(){return b.resolveModal},servicio:function(){return l}}})},b.columnSortMis=function(a){b.busquedaMis.sorter.reverse=b.busquedaMis.sorter.predicate==a&&!b.busquedaMis.sorter.reverse,b.busquedaMis.sorter.predicate=a},b.resetResultadoMis=function(){void 0!==b.busquedaMis.resultados&&(b.busquedaMis.resultados.length=0),void 0!==b.listaMis.data&&(b.listaMis.data.length=0),b.busquedaMis.data=null,b.busquedaMis.fecha=null,b.listaMis.inicio=0,b.listaMis.fin=b.listaMis.offset,b.cleanErr("mis")},b.buscarMis=function(a){b.resetResultadoMis(),a&&b.openLoadingModal("Obteniendo solicitudes...",""),l.getByUserInSession().then(function(c){a&&b.closeModal(),null===c.status||(c.status?(b.busquedaMis.fecha=new Date,b.busquedaMis.data=c,b.busquedaMis.resultados=f("orderBy")(c.aaData,"idSolicitud",!0)):b.raiseErr("mis","Problema detectado",c.msg))},function(a){b.raiseErr("mis","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.loadMoreMis=function(){var a=b.busquedaMis.resultados.slice(b.listaMis.inicio,b.listaMis.fin);angular.forEach(a,function(a){b.listaMis.data.push(a)}),b.listaMis.inicio=b.listaMis.inicio+b.listaMis.offset,b.listaMis.fin=b.listaMis.fin+b.listaMis.offset},b.hayDataEnTablaMis=function(){var a=f("filter")(b.busquedaMis.resultados,b.isSolicitudRevisada,!0);return void 0!==a&&a.length>0},b.accionSolicitud=function(c,d){if(5==d.estadoDTO.idEstado){var e=1==d.bis;a.go("/verInscripcion/prop/"+d.foja+"/"+d.numero+"/"+d.ano+"/"+e+"/solicitudes/3")}else{var f="";2==d.estadoDTO.idEstado?f="remove-ok":3==d.estadoDTO.idEstado&&(f="remove-rechazo"),b[c]=l.actualizar(d.idSolicitud,f),b[c].then(function(b){if(null==b.status);else if(b.status&&(d.fechaEstado=b.fechaEstado,d.estadoDTO={idEstado:b.idEstado,descripcion:b.descripcionEstado},"remove-ok"==f)){var c=1==d.bis;a.go("/verInscripcion/prop/"+d.foja+"/"+d.numero+"/"+d.ano+"/"+c+"/solicitudes/3")}},function(a){})}},b.doFocus=function(a){b.$broadcast(a+"IsFocused")},b.raiseErr=function(a,c,d){b.closeModal(),b.states[a].isError=!0,b.states[a].title=c,b.states[a].msg=d},b.cleanErr=function(a){b.states[a].isError=!1,b.states[a].title="",b.states[a].msg=""},b.openMensajeModal=function(a,d,e,f,h){g.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return d},detalle:function(){return e}}}),f&&c(function(){b.closeModal()},1e3*h)},b.openLoadingModal=function(a,b){g.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},b.closeModal=function(){var a=h.getTop();a&&h.dismiss(a.key)},b.isSolicitudRevisada=function(a){return 6!==a.estadoDTO.idEstado},b.archivoNacional=function(b){return!(b<a.aioParametros.anoArchivoNacional)},b.anoActual=function(a){return!(moment(new Date).year()<a)},c(function(){if(1===b.tab.parentActive){var a=j.getRutSesion();a.then(function(a){null===a.status||a.status&&(b.busquedaTitulo.rut=k.format(a.rut))},function(a){b.raiseErr("No se ha podido establecer comunicación con el servidor.")}),null!==b.busquedaTitulo.rut?(b.doFocus("foja"),$.Rut.validar(b.busquedaTitulo.rut)||(b.busquedaTitulo.rut="",b.doFocus("rutt"))):b.doFocus("rutt")}else if(2===b.tab.parentActive){var a=j.getRutSesion();a.then(function(a){null===a.status||a.status&&(b.busquedaRut.rut=k.format(a.rut))},function(a){b.raiseErr("No se ha podido establecer comunicación con el servidor.")}),b.doFocus("rut"),$.Rut.validar(b.busquedaRut.rut)||(b.busquedaRut.rut="")}},200),b.contarAtencion=function(){g.open({templateUrl:"ingresaRutModal.html",backdrop:!0,windowClass:"modal",controller:"ingresaRutModalCtrl"}).result.then(function(){j.getRutSesion().then(function(a){null===a.status||a.status&&(b.datosSesion.rut=k.format(a.rut),b.datosSesion.requirente=a.requirente,b.busquedaTitulo.rut=k.format(a.rut),b.busquedaRut.rut=k.format(a.rut),b.obtenerAtencionPorDia())},function(a){b.raiseErr("No se ha podido establecer comunicación con el servidor.")})},function(){j.getRutSesion().then(function(a){null===a.status||a.status&&(b.datosSesion.rut=k.format(a.rut),b.datosSesion.requirente=a.requirente,b.busquedaTitulo.rut=k.format(a.rut),b.busquedaRut.rut=k.format(a.rut),b.obtenerAtencionPorDia())},function(a){b.raiseErr("No se ha podido establecer comunicación con el servidor.")})})},b.obtenerAtencionPorDia=function(){j.obtenerAtencionPorDia().then(function(a){null===a.status||a.status&&(b.contador.total=a.contadores.total)},function(a){b.raiseErr("No se ha podido establecer comunicación con el servidor.")})},b.agregarNuevaAtencion=function(){j.agregarNuevaAtencion(b.busquedaTitulo.rut).then(function(a){null===a.status||a.status||b.setErr("Problema detectado.","No se ha podido registrar nueva atencion.")},function(a){b.setErr("Problema contactando al servidor.","No se ha guardado la nueva atencion.")})}}]),app.controller("SolicitudesHipotecasCtrl",["$rootScope","$scope","$timeout","$location","solicitudesHipotecasModel","$filter","$modal","$modalStack","inscripcionDigitalService","solicitudService",function(a,b,c,d,e,f,g,h,i,j){b.tab=e.getTab(),b.busquedaTitulo=e.getBusquedaTitulo(),b.$watchCollection("busquedaTitulo",function(){void 0!==b.busquedaTitulo.rut&&""!==b.busquedaTitulo.rut||(b.busquedaTitulo.nombre="")}),b.busquedaRut=e.getBusquedaRut(),b.$watchCollection("busquedaRut",function(){void 0!==b.busquedaRut.rut&&""!==b.busquedaRut.rut||(b.busquedaRut.nombre=""),$.Rut.validar(b.busquedaRut.rut)&&e.setBusquedaRut(b.busquedaRut)}),b.busquedaMis=e.getBusquedaMis(),b.states=e.getStates(),b.listaMis={data:[],inicio:0,fin:15,offset:15},b.listaRut={data:[],inicio:0,fin:15,offset:15},b.resolveModal={refresca:!1,origen:"solicitudes"},b.$watchCollection("resolveModal",function(){b.resolveModal.refresca&&b.buscarMis(!1)}),b.promiseUpdateSolicitudMis=null,b.promiseUpdateSolicitudRut=null,b.isActiveParent=function(a){return b.tab.parentActive===a},b.activateParent=function(a){b.tab.parentActive=a,e.setTab(b.tab),1===b.tab.parentActive?null!==b.busquedaTitulo.rut?c(function(){b.doFocus("foja")},200):c(function(){b.doFocus("rutt")},200):2===b.tab.parentActive?c(function(){b.doFocus("rut")},200):3===b.tab.parentActive&&(void 0!==b.busquedaMis.resultados&&0!==b.busquedaMis.resultados.length||b.buscarMis(!0))},b.verTitulo=function(b){var c=1==b.bis,d=b.estadoDigitalId;a.go("/verInscripcion/prop/"+b.foja+"/"+b.numero+"/"+b.ano+"/"+c+"/solicitudes/"+d)},b.resetResultadoTitulo=function(){b.busquedaTitulo.data=null,b.busquedaTitulo.req.rut=null,b.busquedaTitulo.req.nombre="",void 0!==b.busquedaTitulo.resultados&&(b.busquedaTitulo.resultados.length=0),b.busquedaTitulo.titulosSeleccionados={},b.busquedaTitulo.checkTodo=!1},b.limpiarTitulo=function(){b.resetResultadoTitulo(),b.busquedaTitulo.rut=null,b.busquedaTitulo.nombre="",b.busquedaTitulo.foja=null,b.busquedaTitulo.numero=null,b.busquedaTitulo.ano=null,b.busquedaTitulo.bis=!1,b.busquedaTitulo.anteriores=!0,b.myform.$setPristine(!0),b.doFocus("rutt")},b.limpiarFnaTitulo=function(){b.resetResultadoTitulo(),b.busquedaTitulo.foja=null,b.busquedaTitulo.numero=null,b.busquedaTitulo.ano=null,b.busquedaTitulo.bis=!1,b.busquedaTitulo.anteriores=!0,b.myform.$setPristine(!0),b.doFocus("foja")},b.buscarTitulo=function(){var a=b.busquedaTitulo.foja,c=b.busquedaTitulo.numero,d=b.busquedaTitulo.ano,e=b.busquedaTitulo.bis,f=b.busquedaTitulo.anteriores;b.resetResultadoTitulo(),b.states.titulo.isLoading=!0,b.openLoadingModal("Buscando título...",""),i.getBusquedaTitulo(a,c,d,e,f).then(function(a){b.closeModal(),null===a.status||(a.status?a.tieneRechazo?b.openMensajeModal("error","Hay rechazo","Una solicitud con los mismos antecedentes ya ha sido rechazada anteriormente."):(a.solicita,!a.fna&&a.req.ano>=2014?b.openMensajeModal("error","No está en índice","La información citada no ha sido encontrada en nuestros registros."):!a.fna&&a.req.ano<2014?(b.openMensajeModal("warn","No está en índice","La información citada no ha sido encontrada en nuestros registros. <br>Si está seguro de los datos citados puede continuar."),b.busquedaTitulo.req.rut=b.busquedaTitulo.rut,b.busquedaTitulo.req.nombre=b.busquedaTitulo.nombre,b.busquedaTitulo.data=a,b.busquedaTitulo.resultados=a.aaData.slice(0,20)):(b.busquedaTitulo.req.rut=b.busquedaTitulo.rut,b.busquedaTitulo.req.nombre=b.busquedaTitulo.nombre,b.busquedaTitulo.data=a,b.busquedaTitulo.resultados=a.aaData.slice(0,20))):b.raiseErr("titulo","Problema detectado",a.msg))},function(a){b.raiseErr("titulo","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.cerrarResultadoTitulo=function(){b.resetResultadoTitulo(),b.doFocus("foja")},b.seleccionaSingle=function(a){b.busquedaTitulo.titulosSeleccionados[a]||(b.busquedaTitulo.checkTodo=!1)},b.seleccionarTodo=function(){for(var a=0;a<b.busquedaTitulo.resultados.length;a++)7!==b.busquedaTitulo.resultados[a].tipoDocumento&&2!==b.busquedaTitulo.resultados[a].tipoDocumento&&0!==b.busquedaTitulo.resultados[a].tipoDocumento||b.busquedaTitulo.resultados[a].puedeSolicitar&&(b.busquedaTitulo.titulosSeleccionados[b.busquedaTitulo.resultados[a].firma]=b.busquedaTitulo.checkTodo)},b.solicitarTodoTitulo=function(){for(var a=[],c=0;c<b.busquedaTitulo.resultados.length;c++)b.busquedaTitulo.titulosSeleccionados[b.busquedaTitulo.resultados[c].firma]&&a.push({foja:b.busquedaTitulo.resultados[c].foja,numero:b.busquedaTitulo.resultados[c].numero,ano:b.busquedaTitulo.resultados[c].ano,bis:b.busquedaTitulo.resultados[c].bis,firma:b.busquedaTitulo.resultados[c].firma});if(a.length>0){var d=angular.toJson(a);b.promiseSaveSolicitud=j.save(d,b.busquedaTitulo.req.rut,b.busquedaTitulo.req.nombre),b.promiseSaveSolicitud.then(function(c){if(null===c.status);else if(c.status)for(var d=0;d<b.busquedaTitulo.resultados.length;d++)for(var e=0;e<a.length;e++)if(a[e].firma===b.busquedaTitulo.resultados[d].firma){b.busquedaTitulo.resultados[d].puedeSolicitar=!1,b.busquedaTitulo.titulosSeleccionados[b.busquedaTitulo.resultados[d].firma]=!1;break}},function(a){})}},b.columnSortRut=function(a){b.busquedaRut.sorter.reverse=b.busquedaRut.sorter.predicate==a&&!b.busquedaRut.sorter.reverse,b.busquedaRut.sorter.predicate=a},b.loadMoreRut=function(){var a=b.busquedaRut.resultados.slice(b.listaRut.inicio,b.listaRut.fin);angular.forEach(a,function(a){b.listaRut.data.push(a)}),b.listaRut.inicio=b.listaRut.inicio+b.listaRut.offset,b.listaRut.fin=b.listaRut.fin+b.listaRut.offset},b.resetResultadoRut=function(){void 0!==b.busquedaRut.resultados&&(b.busquedaRut.resultados.length=0),void 0!==b.listaRut.data&&(b.listaRut.data.length=0),b.busquedaRut.data=null,b.busquedaRut.fecha=null,b.listaRut.inicio=0,b.listaRut.fin=b.listaRut.offset,b.cleanErr("rut")},b.limpiarRut=function(){b.busquedaRut.rut=null,b.busquedaRut.nombre="",b.resetResultadoRut(),b.myformRut.$setPristine(!0),b.doFocus("rut")},b.cerrarResultadoRut=function(){b.resetResultadoRut(),b.doFocus("rut")},b.buscarRut=function(a){b.resetResultadoRut(),b.openLoadingModal("Buscando...",""),j.getByRut(a).then(function(a){b.closeModal(),null===a.status||(a.status?(b.busquedaRut.fecha=new Date,b.busquedaRut.data=a,b.busquedaRut.resultados=f("orderBy")(a.aaData,"idSolicitud",!0)):b.raiseErr("rut","Problema detectado",a.msg))},function(a){b.raiseErr("rut","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.hayDataEnTablaRut=function(){var a=f("filter")(b.busquedaRut.resultados,b.isSolicitudRevisada,!0);return void 0!==a&&a.length>0},b.openSolicitarEnMis=function(){b.$broadcast("sfojaIsFocused"),b.resolveModal.refresca=!1,g.open({templateUrl:"solicitarModal.html",backdrop:!0,windowClass:"modal",controller:"SolicitarModalCtrl",resolve:{resolveModal:function(){return b.resolveModal}}}).result.then(function(){console.log(b.resolveModal.refresca),b.resolveModal.refresca},function(){console.log(b.resolveModal.refresca),b.resolveModal.refresca})},b.columnSortMis=function(a){b.busquedaMis.sorter.reverse=b.busquedaMis.sorter.predicate==a&&!b.busquedaMis.sorter.reverse,b.busquedaMis.sorter.predicate=a},b.resetResultadoMis=function(){void 0!==b.busquedaMis.resultados&&(b.busquedaMis.resultados.length=0),void 0!==b.listaMis.data&&(b.listaMis.data.length=0),b.busquedaMis.data=null,b.busquedaMis.fecha=null,b.listaMis.inicio=0,b.listaMis.fin=b.listaMis.offset,b.cleanErr("mis")},b.buscarMis=function(a){b.resetResultadoMis(),a&&b.openLoadingModal("Obteniendo solicitudes...",""),j.getByUserInSession().then(function(c){a&&b.closeModal(),null===c.status||(c.status?(b.busquedaMis.fecha=new Date,b.busquedaMis.data=c,b.busquedaMis.resultados=f("orderBy")(c.aaData,"idSolicitud",!0)):b.raiseErr("mis","Problema detectado",c.msg))},function(a){b.raiseErr("mis","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.loadMoreMis=function(){var a=b.busquedaMis.resultados.slice(b.listaMis.inicio,b.listaMis.fin);angular.forEach(a,function(a){b.listaMis.data.push(a)}),b.listaMis.inicio=b.listaMis.inicio+b.listaMis.offset,b.listaMis.fin=b.listaMis.fin+b.listaMis.offset},b.hayDataEnTablaMis=function(){var a=f("filter")(b.busquedaMis.resultados,b.isSolicitudRevisada,!0);return void 0!==a&&a.length>0},b.accionSolicitud=function(c,d){if(5==d.estadoDTO.idEstado){var e=1==d.bis;a.go("/verInscripcion/prop/"+d.foja+"/"+d.numero+"/"+d.ano+"/"+e+"/solicitudes/3")}else{var f="";2==d.estadoDTO.idEstado?f="remove-ok":3==d.estadoDTO.idEstado&&(f="remove-rechazo"),b[c]=j.actualizar(d.idSolicitud,f),b[c].then(function(b){if(null==b.status);else if(b.status&&(d.fechaEstado=b.fechaEstado,d.estadoDTO={idEstado:b.idEstado,descripcion:b.descripcionEstado},"remove-ok"==f)){var c=1==d.bis;a.go("/verInscripcion/prop/"+d.foja+"/"+d.numero+"/"+d.ano+"/"+c+"/solicitudes/3")}},function(a){})}},b.doFocus=function(a){b.$broadcast(a+"IsFocused")},b.raiseErr=function(a,c,d){b.closeModal(),b.states[a].isError=!0,b.states[a].title=c,b.states[a].msg=d},b.cleanErr=function(a){b.states[a].isError=!1,b.states[a].title="",b.states[a].msg=""},b.openMensajeModal=function(a,d,e,f,h){g.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return d},detalle:function(){return e}}}),f&&c(function(){b.closeModal()},1e3*h)},b.openLoadingModal=function(a,b){g.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},b.closeModal=function(){var a=h.getTop();a&&h.dismiss(a.key)},b.isSolicitudRevisada=function(a){return 6!==a.estadoDTO.idEstado},b.archivoNacional=function(b){return!(b<a.aioParametros.anoArchivoNacional)},b.anoActual=function(a){return!(moment(new Date).year()<a)},c(function(){1===b.tab.parentActive?null!==b.busquedaTitulo.rut?(b.doFocus("foja"),$.Rut.validar(b.busquedaTitulo.rut)||(b.busquedaTitulo.rut="",b.doFocus("rutt"))):b.doFocus("rutt"):2===b.tab.parentActive&&(b.doFocus("rut"),$.Rut.validar(b.busquedaRut.rut)||(b.busquedaRut.rut=""))},200)}]),app.controller("SolicitudesProhibicionesCtrl",["$rootScope","$scope","$timeout","$location","solicitudesProhibicionesModel","$filter","$modal","$modalStack","inscripcionDigitalService","solicitudService",function(a,b,c,d,e,f,g,h,i,j){b.tab=e.getTab(),b.busquedaTitulo=e.getBusquedaTitulo(),b.$watchCollection("busquedaTitulo",function(){void 0!==b.busquedaTitulo.rut&&""!==b.busquedaTitulo.rut||(b.busquedaTitulo.nombre="")}),b.busquedaRut=e.getBusquedaRut(),b.$watchCollection("busquedaRut",function(){void 0!==b.busquedaRut.rut&&""!==b.busquedaRut.rut||(b.busquedaRut.nombre=""),$.Rut.validar(b.busquedaRut.rut)&&e.setBusquedaRut(b.busquedaRut)}),b.busquedaMis=e.getBusquedaMis(),b.states=e.getStates(),b.listaMis={data:[],inicio:0,fin:15,offset:15},b.listaRut={data:[],inicio:0,fin:15,offset:15},b.resolveModal={refresca:!1,origen:"solicitudes"},b.$watchCollection("resolveModal",function(){b.resolveModal.refresca&&b.buscarMis(!1)}),b.promiseUpdateSolicitudMis=null,b.promiseUpdateSolicitudRut=null,b.isActiveParent=function(a){return b.tab.parentActive===a},b.activateParent=function(a){b.tab.parentActive=a,e.setTab(b.tab),1===b.tab.parentActive?null!==b.busquedaTitulo.rut?c(function(){b.doFocus("foja")},200):c(function(){b.doFocus("rutt")},200):2===b.tab.parentActive?c(function(){b.doFocus("rut")},200):3===b.tab.parentActive&&(void 0!==b.busquedaMis.resultados&&0!==b.busquedaMis.resultados.length||b.buscarMis(!0))},b.verTitulo=function(b){var c=1==b.bis,d=b.estadoDigitalId;a.go("/verInscripcion/prop/"+b.foja+"/"+b.numero+"/"+b.ano+"/"+c+"/solicitudes/"+d)},b.resetResultadoTitulo=function(){b.busquedaTitulo.data=null,b.busquedaTitulo.req.rut=null,b.busquedaTitulo.req.nombre="",void 0!==b.busquedaTitulo.resultados&&(b.busquedaTitulo.resultados.length=0),b.busquedaTitulo.titulosSeleccionados={},b.busquedaTitulo.checkTodo=!1},b.limpiarTitulo=function(){b.resetResultadoTitulo(),b.busquedaTitulo.rut=null,b.busquedaTitulo.nombre="",b.busquedaTitulo.foja=null,b.busquedaTitulo.numero=null,b.busquedaTitulo.ano=null,b.busquedaTitulo.bis=!1,b.busquedaTitulo.anteriores=!0,b.myform.$setPristine(!0),b.doFocus("rutt")},b.limpiarFnaTitulo=function(){b.resetResultadoTitulo(),b.busquedaTitulo.foja=null,b.busquedaTitulo.numero=null,b.busquedaTitulo.ano=null,b.busquedaTitulo.bis=!1,b.busquedaTitulo.anteriores=!0,b.myform.$setPristine(!0),b.doFocus("foja")},b.buscarTitulo=function(){var a=b.busquedaTitulo.foja,c=b.busquedaTitulo.numero,d=b.busquedaTitulo.ano,e=b.busquedaTitulo.bis,f=b.busquedaTitulo.anteriores;b.resetResultadoTitulo(),b.states.titulo.isLoading=!0,b.openLoadingModal("Buscando título...",""),i.getBusquedaTitulo(a,c,d,e,f).then(function(a){b.closeModal(),null===a.status||(a.status?a.tieneRechazo?b.openMensajeModal("error","Hay rechazo","Una solicitud con los mismos antecedentes ya ha sido rechazada anteriormente."):(a.solicita,!a.fna&&a.req.ano>=2014?b.openMensajeModal("error","No está en índice","La información citada no ha sido encontrada en nuestros registros."):!a.fna&&a.req.ano<2014?(b.openMensajeModal("warn","No está en índice","La información citada no ha sido encontrada en nuestros registros. <br>Si está seguro de los datos citados puede continuar."),b.busquedaTitulo.req.rut=b.busquedaTitulo.rut,b.busquedaTitulo.req.nombre=b.busquedaTitulo.nombre,b.busquedaTitulo.data=a,b.busquedaTitulo.resultados=a.aaData.slice(0,20)):(b.busquedaTitulo.req.rut=b.busquedaTitulo.rut,b.busquedaTitulo.req.nombre=b.busquedaTitulo.nombre,b.busquedaTitulo.data=a,b.busquedaTitulo.resultados=a.aaData.slice(0,20))):b.raiseErr("titulo","Problema detectado",a.msg))},function(a){b.raiseErr("titulo","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.cerrarResultadoTitulo=function(){b.resetResultadoTitulo(),b.doFocus("foja")},b.seleccionaSingle=function(a){b.busquedaTitulo.titulosSeleccionados[a]||(b.busquedaTitulo.checkTodo=!1)},b.seleccionarTodo=function(){for(var a=0;a<b.busquedaTitulo.resultados.length;a++)7!==b.busquedaTitulo.resultados[a].tipoDocumento&&2!==b.busquedaTitulo.resultados[a].tipoDocumento&&0!==b.busquedaTitulo.resultados[a].tipoDocumento||b.busquedaTitulo.resultados[a].puedeSolicitar&&(b.busquedaTitulo.titulosSeleccionados[b.busquedaTitulo.resultados[a].firma]=b.busquedaTitulo.checkTodo)},b.solicitarTodoTitulo=function(){for(var a=[],c=0;c<b.busquedaTitulo.resultados.length;c++)b.busquedaTitulo.titulosSeleccionados[b.busquedaTitulo.resultados[c].firma]&&a.push({foja:b.busquedaTitulo.resultados[c].foja,numero:b.busquedaTitulo.resultados[c].numero,ano:b.busquedaTitulo.resultados[c].ano,bis:b.busquedaTitulo.resultados[c].bis,firma:b.busquedaTitulo.resultados[c].firma});if(a.length>0){var d=angular.toJson(a);b.promiseSaveSolicitud=j.save(d,b.busquedaTitulo.req.rut,b.busquedaTitulo.req.nombre),b.promiseSaveSolicitud.then(function(c){if(null===c.status);else if(c.status)for(var d=0;d<b.busquedaTitulo.resultados.length;d++)for(var e=0;e<a.length;e++)if(a[e].firma===b.busquedaTitulo.resultados[d].firma){b.busquedaTitulo.resultados[d].puedeSolicitar=!1,b.busquedaTitulo.titulosSeleccionados[b.busquedaTitulo.resultados[d].firma]=!1;break}},function(a){})}},b.columnSortRut=function(a){b.busquedaRut.sorter.reverse=b.busquedaRut.sorter.predicate==a&&!b.busquedaRut.sorter.reverse,b.busquedaRut.sorter.predicate=a},b.loadMoreRut=function(){var a=b.busquedaRut.resultados.slice(b.listaRut.inicio,b.listaRut.fin);angular.forEach(a,function(a){b.listaRut.data.push(a)}),b.listaRut.inicio=b.listaRut.inicio+b.listaRut.offset,b.listaRut.fin=b.listaRut.fin+b.listaRut.offset},b.resetResultadoRut=function(){void 0!==b.busquedaRut.resultados&&(b.busquedaRut.resultados.length=0),void 0!==b.listaRut.data&&(b.listaRut.data.length=0),b.busquedaRut.data=null,b.busquedaRut.fecha=null,b.listaRut.inicio=0,b.listaRut.fin=b.listaRut.offset,b.cleanErr("rut")},b.limpiarRut=function(){b.busquedaRut.rut=null,b.busquedaRut.nombre="",b.resetResultadoRut(),b.myformRut.$setPristine(!0),b.doFocus("rut")},b.cerrarResultadoRut=function(){b.resetResultadoRut(),b.doFocus("rut")},b.buscarRut=function(a){b.resetResultadoRut(),b.openLoadingModal("Buscando...",""),j.getByRut(a).then(function(a){b.closeModal(),null===a.status||(a.status?(b.busquedaRut.fecha=new Date,b.busquedaRut.data=a,b.busquedaRut.resultados=f("orderBy")(a.aaData,"idSolicitud",!0)):b.raiseErr("rut","Problema detectado",a.msg))},function(a){b.raiseErr("rut","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.hayDataEnTablaRut=function(){var a=f("filter")(b.busquedaRut.resultados,b.isSolicitudRevisada,!0);return void 0!==a&&a.length>0},b.openSolicitarEnMis=function(){b.$broadcast("sfojaIsFocused"),b.resolveModal.refresca=!1,g.open({templateUrl:"solicitarModal.html",backdrop:!0,windowClass:"modal",controller:"SolicitarModalCtrl",resolve:{resolveModal:function(){return b.resolveModal}}}).result.then(function(){console.log(b.resolveModal.refresca),b.resolveModal.refresca},function(){console.log(b.resolveModal.refresca),b.resolveModal.refresca})},b.columnSortMis=function(a){b.busquedaMis.sorter.reverse=b.busquedaMis.sorter.predicate==a&&!b.busquedaMis.sorter.reverse,b.busquedaMis.sorter.predicate=a},b.resetResultadoMis=function(){void 0!==b.busquedaMis.resultados&&(b.busquedaMis.resultados.length=0),void 0!==b.listaMis.data&&(b.listaMis.data.length=0),b.busquedaMis.data=null,b.busquedaMis.fecha=null,b.listaMis.inicio=0,b.listaMis.fin=b.listaMis.offset,b.cleanErr("mis")},b.buscarMis=function(a){b.resetResultadoMis(),a&&b.openLoadingModal("Obteniendo solicitudes...",""),j.getByUserInSession().then(function(c){a&&b.closeModal(),null===c.status||(c.status?(b.busquedaMis.fecha=new Date,b.busquedaMis.data=c,b.busquedaMis.resultados=f("orderBy")(c.aaData,"idSolicitud",!0)):b.raiseErr("mis","Problema detectado",c.msg))},function(a){b.raiseErr("mis","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.loadMoreMis=function(){var a=b.busquedaMis.resultados.slice(b.listaMis.inicio,b.listaMis.fin);angular.forEach(a,function(a){b.listaMis.data.push(a)}),b.listaMis.inicio=b.listaMis.inicio+b.listaMis.offset,b.listaMis.fin=b.listaMis.fin+b.listaMis.offset},b.hayDataEnTablaMis=function(){var a=f("filter")(b.busquedaMis.resultados,b.isSolicitudRevisada,!0);return void 0!==a&&a.length>0},b.accionSolicitud=function(c,d){if(5==d.estadoDTO.idEstado){var e=1==d.bis;a.go("/verInscripcion/prop/"+d.foja+"/"+d.numero+"/"+d.ano+"/"+e+"/solicitudes/3")}else{var f="";2==d.estadoDTO.idEstado?f="remove-ok":3==d.estadoDTO.idEstado&&(f="remove-rechazo"),b[c]=j.actualizar(d.idSolicitud,f),b[c].then(function(b){if(null==b.status);else if(b.status&&(d.fechaEstado=b.fechaEstado,d.estadoDTO={idEstado:b.idEstado,descripcion:b.descripcionEstado},"remove-ok"==f)){var c=1==d.bis;a.go("/verInscripcion/prop/"+d.foja+"/"+d.numero+"/"+d.ano+"/"+c+"/solicitudes/3")}},function(a){})}},b.doFocus=function(a){b.$broadcast(a+"IsFocused")},b.raiseErr=function(a,c,d){b.closeModal(),b.states[a].isError=!0,b.states[a].title=c,b.states[a].msg=d},b.cleanErr=function(a){b.states[a].isError=!1,b.states[a].title="",b.states[a].msg=""},b.openMensajeModal=function(a,d,e,f,h){g.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return d},detalle:function(){return e}}}),f&&c(function(){b.closeModal()},1e3*h)},b.openLoadingModal=function(a,b){g.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},b.closeModal=function(){var a=h.getTop();a&&h.dismiss(a.key)},b.isSolicitudRevisada=function(a){return 6!==a.estadoDTO.idEstado},b.archivoNacional=function(b){return!(b<a.aioParametros.anoArchivoNacional)},b.anoActual=function(a){return!(moment(new Date).year()<a)},c(function(){1===b.tab.parentActive?null!==b.busquedaTitulo.rut?(b.doFocus("foja"),$.Rut.validar(b.busquedaTitulo.rut)||(b.busquedaTitulo.rut="",b.doFocus("rutt"))):b.doFocus("rutt"):2===b.tab.parentActive&&(b.doFocus("rut"),$.Rut.validar(b.busquedaRut.rut)||(b.busquedaRut.rut=""))},200)}]),app.filter("startFrom",function(){return function(a,b){return a?(b=+b,a.slice(b)):[]}}),app.controller("TareasCtrl",["$scope","$timeout","$rootScope","$location","$interval","$filter","$modal","$window","$modalStack","$routeParams","tareasService","estadoService","tareasModel","caratulaService","filterFilter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.busquedaTareas=m.getBusquedaTareas(),a.paginacionMaster={currentPage:1,numPerPage:150,maxSize:10,filteredTodos:[],todos:[]},a.paginacionTareas=angular.copy(a.paginacionMaster),a.paginacionTareas.todos=[],a.buscarLiquidaciones=function(){a.openLoadingModal("Buscando carátulas...",""),k.obtenerCaratulasPorUsuario().then(function(b){a.closeModal(),null===b.estado||(b.status?(a.busquedaTareas.data=b,a.makeTodos(b.caratulas)):a.raiseErr(b.msg))},function(b){a.closeModal(),a.raiseErr("No se ha podido establecer comunicacion con el servidor.")})},a.redistribuirCaratula=function(b){a.openLoadingModal("Redistribuyendo...",""),n.movercaratula(b.numeroCaratula,b.codSeccion).then(function(d){if(a.closeModal(),null===d.status);else if(d.status){var e="C2"===b.codSeccion?10:b.idtipoFormulario;c.go("/verInscripcionCertificar/prop/"+b.numeroCaratula+"/"+b.foja+"/"+b.numero+"/"+b.ano+"/"+b.bis+"/"+b.fechaDocLong+"/"+b.rehaceImagen+"/"+e+"/tareas/")}else a.setErr("data.msg",d.msg)},function(b){a.setErr("Problema contactando al servidor.","")})},a.distribuir=function(){var b=[];for(var c in a.busquedaTareas.data.caratulas)a.busquedaTareas.data.caratulas[c].check&&b.push(a.busquedaTareas.data.caratulas[c].numeroCaratula);d.path("/distribucion/").search({caratulas:JSON.stringify(b)})},a.imprimirSeleccion=function(){var b=[];for(var c in a.busquedaTareas.data.caratulas)a.busquedaTareas.data.caratulas[c].check&&b.push(a.busquedaTareas.data.caratulas[c].numeroCaratula);var d={numeroCaratula:b.join(",")};a.imprimeCaratula(d)},a.hayCaratulaSeleccionada=function(){if(void 0!=a.busquedaTareas.data)for(var b in a.busquedaTareas.data.caratulas)if(a.busquedaTareas.data.caratulas[b].check)return!0;return!1},a.caratulafuera={caratula:null,status:!1,muestra:!1},a.buscarCaratulaFuera=function(){var b=a.busquedaTareas.caratula;a.openLoadingModal("Buscando...",""),n.obtenerCaratula(b).then(function(b){a.closeModal(),null===b.status||(b.status?(a.caratulafuera.caratula=b.caratula,a.caratulafuera.status=b.status,a.caratulafuera.muestra=b.muestra):a.raiseErr("buscar","Problema detectado",b.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.masInfoLiquidacion=function(a){g.open({templateUrl:"masInfoLiquidacionModal.html",backdrop:!0,windowClass:"modal",controller:"masInfoLiquidacionModalCtrl",resolve:{caratula:function(){return a}}})},a.verInscripcionCertificar=function(b){var d=a.busquedaTareas.data.FECHA_REHACER_IMAGEN<=b.inscripcionDigitalDTO.ano?0:1,e=b.inscripcionDigitalDTO.bis?1:0,f="C2"===b.estadoActualCaratulaDTO.seccionDTO.codigo?10:b.tipoFormularioDTO.id;c.go("/verInscripcionCertificar/prop/"+b.numeroCaratula+"/"+b.inscripcionDigitalDTO.foja+"/"+b.inscripcionDigitalDTO.numero+"/"+b.inscripcionDigitalDTO.ano+"/"+e+"/"+b.inscripcionDigitalDTO.fechaActualizacionL+"/"+d+"/"+f+"/tareas/")},a.verCbrsVisor=function(a){c.go("cbrsVisor:"+a.numeroCaratula)},a.verTitulo=function(b,c){if(null==b.registro){console.log("workaround");l.getEstado(c).then(function(c){a.closeModal(),null===c.status||(c.status?null!=c.res.caratulaDTO.citadoDTOs&&1==c.res.caratulaDTO.citadoDTOs.length&&null!=c.res.caratulaDTO.citadoDTOs[0].registroDTO&&void 0!=c.res.caratulaDTOs.citadoDTO[0].registroDTO.id?(b.registro=c.res.caratulaDTO.citadoDTOs[0].registroDTO.id,a.verInscripcion(b)):a.raiseErr("No se pudo determinar registro de la inscripción"):a.raiseErr("buscar","Problema detectado",c.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})}else a.verInscripcion(b)},a.verInscripcion=function(a){var b=1==a.bis,d="0",e="prop";switch(a.registro){case 1:e="prop";break;case 2:e="hipo";break;case 3:e="proh";break;default:e="prop"}c.go("/verInscripcion/"+e+"/"+a.foja+"/"+a.numero+"/"+a.ano+"/"+b+"/tareas/"+d)},a.verEstadoCaratula=function(a){g.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})},a.raiseErr=function(b){a.openMensajeModal("error",b,"",!1,null)},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openMensajeModal=function(c,d,e,f,h){g.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return c},titulo:function(){return d},detalle:function(){return e}}}),f&&b(function(){a.closeModal()},1e3*h)},a.openLoadingModal=function(a,b){g.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.closeModal=function(){var a=i.getTop();a&&i.dismiss(a.key)},a.obtenerEscritura=function(a){g.open({templateUrl:"escrituraelectronicaModal.html",backdrop:!0,windowClass:"modal",controller:"escrituraElectronicaModalCtrl",resolve:{sol:function(){return a}}})},a.obtenerEscrituraPorFuera=function(a){g.open({templateUrl:"escrituraelectronicaModal.html",backdrop:!0,windowClass:"modal",controller:"escrituraElectronicaModalCtrl",resolve:{sol:function(){return a}}})},a.verDocumentoEstudio=function(b){a.buscarEscritura(b.numeroCaratula)},a.editarEscritura=function(b){var c=null;l.getDocumentos(b,"ESCRITURAS").then(function(d){if(null===d.status);else if(d.success)if(void 0!=d.children&&d.children.length>0){for(var e=0;e<d.children.length;e++)if(d.children[e].children[0].vigente){c=d.children[e].children[0],location.href="cbrsVisor:"+b;break}null==c&&a.raiseErr("Carátula no tiene escritura vigente")}else a.raiseErr("Carátula no tiene escritura");else a.raiseErr(d.errormsg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.verEscritura=function(b){var c=null;l.getDocumentos(b.numeroCaratula,"ESCRITURAS").then(function(b){if(null===b.status);else if(b.success)if(void 0!=b.children&&b.children.length>0){for(var d=0;d<b.children.length;d++)if(b.children[d].children[0].vigente){c=b.children[d].children[0];var e={nombreArchivo:c.nombreArchivoVersion,idTipoDocumento:c.idTipoDocumento,idReg:c.idReg,fechaDocumento:c.fechaProcesa},f=l.existeDocumento(e);f.then(function(b){b.hayDocumento?h.open("../do/service/escritura?metodo=verDocumentoEstudio&caratula="+c.caratula+"&version="+c.version+"&idTipoDocumento="+c.idTipoDocumento+"&type=uri","","width=800,height=600"):a.raiseErr(b.errormsg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})}null==c&&a.raiseErr("Carátula no tiene escritura vigente")}else a.raiseErr("Carátula no tiene escritura");else a.raiseErr(b.errormsg)},function(b){a.raiseErr("No se ha podido establecer comunicación con el servidor.")})},a.checkAll=function(){console.log("checkAll"),a.selectedAll?a.selectedAll=!1:a.selectedAll=!0,angular.forEach(a.filtered,function(b){b.check=a.selectedAll})},a.customFilter1=function(){a.filterExpr={canalTexto:"WEB",tipoFormularioDTO:{idDescripcion:6}}},a.imprimeCaratula=function(a){g.open({templateUrl:"verImpresionCaratula.html",backdrop:!0,keyboard:!0,size:"lg",windowClass:"modal modal-dialog-xl",controller:"VerImprimeCaratulaCtrl",resolve:{nc:function(){return a.numeroCaratula}}})},a.makeTodos=function(b){a.paginacionTareas=angular.copy(a.paginacionMaster),a.paginacionTareas.todos=b;var c=(a.paginacionTareas.currentPage-1)*a.paginacionTareas.numPerPage,d=c+a.paginacionTareas.numPerPage;a.paginacionTareas.filteredTodos=a.paginacionTareas.todos.slice(c,d),a.paginacionTareas.maxSize=Math.round(a.paginacionTareas.todos.length/a.paginacionTareas.numPerPage)},a.$watch("filterExpr",function(a,b){},!0),a.$watch("busquedaTareas.tiemporefresco",function(){a.start()}),b(function(){a.buscarLiquidaciones()},500);var p;a.start=function(){a.stop(),0!=a.busquedaTareas.tiemporefresco&&(p=e(function(){a.buscarLiquidaciones()}.bind(this),6e4*a.busquedaTareas.tiemporefresco))},a.stop=function(){e.cancel(p)},a.start(),a.$on("$destroy",function(){a.stop()})}]),app.controller("TareasModalCtrl",["$log","$scope","$modal","$modalStack","$timeout","$filter","data","operacion","tareaDTO","estadoService",function(a,b,c,d,e,f,g,h,i,j){b.data=g,b.operacion=h,b.tarea={},b.tarea.tipoTarea=i,j.obtenerListaTareas().then(function(a){if(null==a.status);else if(a.status){b.listaTipoTareas=a.listaTareas;var c;for(c=0;c<b.data.res.caratulaDTO.tareaDTOs.length;c++)b.listaTipoTareas=f("filter")(b.listaTipoTareas,{id:"!"+b.data.res.caratulaDTO.tareaDTOs[c].id})}else b.raiseErr(a.msg)},function(a){b.raiseErr("No se ha podido establecer comunicación con el servidor.")}),b.cancel=function(){var a=d.getTop();a&&d.dismiss(a.key)},b.agregarTarea=function(){b.openLoadingModal("Agregando tarea...",""),j.agregarTarea(b.data.req.numeroCaratula,b.tarea.tipoTarea.id,b.tarea.tipoTarea.descripcion).then(function(a){b.closeModal(),null==a.status||(a.status?(b.data.res.caratulaDTO.tareaDTOs.push(b.tarea.tipoTarea),b.data.res.caratulaDTO.bitacoraDTOs.unshift(a.bitacoraDTO),b.closeModal(),b.openMensajeModal("success","Tarea agregada exitosamente","",!1,null)):b.raiseErr(a.msg))},function(a){b.raiseErr("No se ha podido establecer comunicación con el servidor.")})},b.eliminarTarea=function(){b.openLoadingModal("Eliminando tarea...",""),j.eliminarTarea(b.data.req.numeroCaratula,b.tarea.tipoTarea.id,b.tarea.tipoTarea.descripcion).then(function(a){b.closeModal(),null==a.status||(a.status?(b.data.res.caratulaDTO.tareaDTOs=f("filter")(b.data.res.caratulaDTO.tareaDTOs,{id:"!"+b.tarea.tipoTarea.id}),b.data.res.caratulaDTO.bitacoraDTOs.unshift(a.bitacoraDTO),b.closeModal(),b.openMensajeModal("success","Tarea eliminada exitosamente","",!1,null)):b.raiseErr(a.msg))},function(a){b.raiseErr("No se ha podido establecer comunicación con el servidor.")})},b.raiseErr=function(a){b.openMensajeModal("error",a,"",!1,null)},b.doFocus=function(a){b.$broadcast(a+"IsFocused")},b.openMensajeModal=function(a,d,f,g,h){c.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return d},detalle:function(){return f}}}),g&&e(function(){b.closeModal()},1e3*h)},b.openLoadingModal=function(a,b){c.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},b.closeModal=function(){var a=d.getTop();a&&d.dismiss(a.key)},e(function(){b.doFocus("tarea")},500)}]),app.controller("TicketInformacionCtrl",["$scope","$rootScope","$timeout","$routeParams","$modalInstance","foja","numero","ano","nombre","direccion","comuna","registro","titulos",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.nombre=i,a.direccion=j,a.comuna=k,a.foja=f,a.numero=g,a.ano=h,a.usuario=b.userLoginSinCBRS,a.titulos=m,"prop"==l?a.registro="Propiedad":"hip"==l?a.registro="Hipoteca":"proh"==l?a.registro="Prohibiciones":"com"==l&&(a.registro="Comercio"),a.printDiv=function(b){var d=window.open("","_blank","width=100,height=100");d.document.open();var e='<html><head><style>\x3c!-- @page { size:8cm 10cm; margin: 220; margin-top: 220mm;} --\x3e</style><link rel="stylesheet" type="text/css" href="style.css" /></head><body onload="window.print()"><div style=" max-width: 290px; padding: 19px 15px 10px 15px;  margin: 0 auto 20px; border: 1px solid #ccc; -webkit-border-radius: 2px; -moz-border-radius: 2px;  border-radius: 2px;-moz-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05); ">';if(e+='<h4 style="text-align:center;font-family:arial;">Para revisar por el interesado</h4>',""==a.titulos)e+="<ul>",e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;">Foja: '+a.foja+" Numero: "+a.numero+" Año: "+a.ano+"</li>","Comercio"==a.registro&&(e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;">Nombre Sociedad: '+a.nombre+"</li>"),"Propiedad"==a.registro&&(void 0!==a.direccion&&(e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;">Direccion: '+a.direccion+"</li>"),void 0!==a.comuna&&(e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;">Comuna: '+a.comuna+"</li>")),e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;">Registro: '+a.registro+"</li>",e+="</ul>";else for(var f in a.titulos){var g=a.titulos[f];e+="<ul>",e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;">Foja: '+g.foja+" Numero: "+g.num+" Año: "+g.ano+"</li>","Comercio"==a.registro&&(e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;">Nombre Sociedad: '+g.nombreSociedad+"</li>"),"Propiedad"==a.registro&&(void 0!==g.dir&&""!=g.dir&&(e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;">Direccion: '+g.dir+"</li>"),void 0!==g.comuna&&""!=g.comuna&&(e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;">Comuna: '+g.comuna+"</li>")),e=e+'<li style="font-family:arial;font-weight: normal;font-size: 14px;">Registro: '+a.registro+"</li>",e+="</ul>"}e+='<hr style="margin-bottom:7px;">',e=e+'<div style="text-align:center;font-family:arial;"><h6>'+a.usuario+"</h6></div>",e+='<div style="text-align:center;font-family:arial;"><h6>www.conservador.cl</h6></div>',e+="</div></body></html>",d.document.write(e),d.document.close(),c(function(){d.close()},2e3)},c(function(){a.printDiv("paraimprimir"),a.cancel()},500),a.cancel=function(){e.dismiss("cancel")}}]),app.controller("titulosanterioresCtrl",["$rootScope","$scope","$modal","$modalInstance","$modalStack","$window","$timeout","inscripcionDigitalService","masInfoindiceModel","borradorService","resolveModal","indiceModel","foja","numero","ano","caratula",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.foja=m,b.numero=n,b.ano=o,b.caratula=p,b.titulo={tipodocumento:null,esDigital:null},b.resolveModal={refresca:!1},b.tituloAnterior={foja:null,num:null,ano:null,bis:null,tipodocumento:null},b.states=i.getStates(),b.busquedaBorrador=i.getBusquedaBorrador(),void 0!==b.busquedaBorrador.titulosAnteriores&&(b.busquedaBorrador.titulosAnteriores.length=0),void 0!==b.urlPdf&&(b.urlPdf=""),j.obtenerTitulosAnteriores(b.foja,b.numero,b.ano).then(function(a){null===a.status||(a.status?(b.totalTitulosAnteriores=a.totalTitulosAnteriores,b.busquedaBorrador.titulosAnteriores=a.listaTitulosAnteriores):b.setErr("data.msg","data.msg"))},function(a){b.setErr("Problema contactando al servidor.","")}),b.solicitudStatus={ok:!1,error:!1,warning:!1,msgTitle:null,msg:null},b.isLoadingSolicitar=!1,b.pasoPreSolicitar=!1,b.verTipoImagen=function(a){var c=1==a.bis;b.openLoadingModal("Buscando...",""),h.getInscripcionJPG(a.foja,a.numero,a.ano,c).then(function(c){b.closeModal(),null===c.status||(c.status?c.res.tienerechazo?(b.titulo.tipodocumento=0,b.openVerInscripcion(a.foja,a.numero,a.ano,a.bis,b.titulo.tipodocumento),b.pasoPreSolicitar=!1):(b.titulo.esDigital=c.res.anodigital,c.res.consultaDocumentoDTO.hayDocumento?1!=c.res.consultaDocumentoDTO.tipoDocumento?(0==c.res.consultaDocumentoDTO.tipoDocumento?b.titulo.tipodocumento=2:2==c.res.consultaDocumentoDTO.tipoDocumento&&(b.titulo.tipodocumento=4),b.openVerInscripcion(a.foja,a.numero,a.ano,a.bis,b.titulo.tipodocumento),b.pasoPreSolicitar=!1):b.verTitulo(a.foja,a.numero,a.ano,a.bis):(b.titulo.tipodocumento=1,b.openVerInscripcion(a.foja,a.numero,a.ano,a.bis,b.titulo.tipodocumento),b.pasoPreSolicitar=!1)):b.raiseErr("buscar","Problema detectado",c.msg))},function(a){b.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},b.verTitulo=function(b,c,d,e){var e=1==e;a.go("/verInscripcion/prop/"+b+"/"+c+"/"+d+"/"+e+"/indice/0")},b.openVerInscripcion=function(a,d,e,f,g){b.tituloAnterior.foja=a,b.tituloAnterior.num=d,b.tituloAnterior.ano=e,b.tituloAnterior.bis=f,b.tituloAnterior.tipodocumento=g,b.resolveModal.refresca=!1,c.open({templateUrl:"solicitarIndiceModal.html",backdrop:"static",windowClass:"modal",controller:"SolicitarIndiceModalCtrl",resolve:{resolveModal:function(){return b.resolveModal},titulo:function(){return b.tituloAnterior}}}).result.then(function(){console.log(b.resolveModal.refresca),b.resolveModal.refresca},function(){console.log(b.resolveModal.refresca),b.resolveModal.refresca})},b.cancel=function(){d.dismiss("cancel")},b.setErr=function(a,c){b.solicitudStatus.error=!0,b.setStatusMsg(a,c)},b.setStatusMsg=function(a,c){b.solicitudStatus.msgTitle=a,b.solicitudStatus.msg=c},b.setOK=function(a,c){b.solicitudStatus.ok=!0,b.setStatusMsg(a,c)},b.resetStatus=function(){b.solicitudStatus.ok=!1,b.solicitudStatus.error=!1,b.solicitudStatus.warning=!1,b.solicitudStatus.msgTitle=null,b.solicitudStatus.msg=null},b.openLoadingModal=function(a,b){c.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},b.closeModal=function(){var a=e.getTop();a&&e.dismiss(a.key)},g(function(){b.$broadcast("sfojaIsFocused")},100),b.raiseErr=function(a,c,d){b.closeModal(),b.states[a].isError=!0,b.states[a].title=c,b.states[a].msg=d}}]),app.controller("transaccionModalCtrl",["$rootScope","$scope","$timeout","$modalStack","$modalInstance","$modal","tareasService","caratulaDTO",function(a,b,c,d,e,f,g,h){b.caratulaDTO=h,c(function(){b.openLoadingModal("Obteniendo transacción #"+b.caratulaDTO.productoWebDTO.idTransaccion,""),g.buscarTransaccion(b.caratulaDTO.productoWebDTO.idTransaccion).then(function(a){b.closeModal(),null===a.estado||(a.status?b.transaccionDTO=a.transaccionDTO:b.raiseErr(a.msg))},function(a){b.closeModal(),b.raiseErr("No se ha podido establecer comunicacion con el servidor.")})},500),b.verEstadoCaratula=function(a){f.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})},b.raiseErr=function(a){b.openMensajeModal("error",a,"",!1,null)},b.doFocus=function(a){b.$broadcast(a+"IsFocused")},b.openMensajeModal=function(a,d,e,g,h){f.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return a},titulo:function(){return d},detalle:function(){return e}}}),g&&c(function(){b.closeModal()},1e3*h)},b.openLoadingModal=function(a,b){f.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},b.closeModal=function(){var a=d.getTop();a&&d.dismiss(a.key)},b.cancel=function(){e.dismiss("cancel")}}]);var aux;app.controller("UAFCtrl",["$scope","$timeout","$rootScope","$location","$anchorScroll","$filter","$modal","$modalStack","$routeParams","UAFModel","uafService","parametrosService",function(a,b,c,d,e,f,g,h,i,j,k,l){if(a.busquedaUAF=j.getBusquedaUAF(),a.tab=j.getTab(),a.isActiveParent=function(b){return a.tab.parentActive===b},a.activateParent=function(c){a.tab.parentActive=c,j.setTab(a.tab),b(function(){a.doFocus("inscripciones")},200)},a.buscarPersonas=function(){a.openLoadingModal("Buscando personas...",""),k.buscarPersonas(a.busquedaUAF.inscripciones,a.busquedaUAF.ano).then(function(b){a.closeModal(),b.status?(a.busquedaUAF.data=b,a.busquedaUAF.listaPersonasAgrupadas=b.listaPersonasAgrupadas,a.busquedaUAF.resultadosPersonas=Object.keys(b.listaPersonasAgrupadas).length):a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")},function(a){})},a.buscarBienes=function(){a.openLoadingModal("Buscando bienes...",""),k.buscarBienes(a.busquedaUAF.inscripciones,a.busquedaUAF.ano,JSON.stringify(a.busquedaUAF.naturaleza)).then(function(b){a.closeModal(),b.status?(a.busquedaUAF.data=b,a.busquedaUAF.listaBienesAgrupados=b.listaBienesAgrupados,a.busquedaUAF.resultadosBienes=Object.keys(b.listaBienesAgrupados).length):a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")},function(a){})},a.personaEnLista=function(a,b){return angular.forEach(a,function(a){if(a.rut==b.rut)return!0}),!1},a.verEstadoCaratula=function(a){a.indexOf("-")>0&&a.substring(0,a.indexOf("-"));g.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})},a.irGpOnlineAIO=function(a){var b=a.substring(0,a.indexOf("-")),c=a.substring(a.indexOf("-")+1);g.open({templateUrl:"gpOnlineModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"gpOnlineModalCtrl",size:"lg",resolve:{borrador:function(){return parseInt(b)},folio:function(){return parseInt(c)}}})},void 0==a.busquedaUAF.anos||0==a.busquedaUAF.anos.length)for(var m=(new Date).getFullYear(),n=m;n>=m-80;n--)a.busquedaUAF.anos.push(n);if(void 0==a.busquedaUAF.naturalezas||0==a.busquedaUAF.naturalezas.length){l.getNaturalezas().then(function(b){b.estado?angular.forEach(b.listaNaturalezas,function(b){if("PR"===b.registro){var c={id:b.codNaturaleza,label:b.descNaturaleza};a.busquedaUAF.naturalezas.push(c)}}):console.log(b)},function(a){})}a.limpiar=function(){a.resetResultadoUAF(),a.busquedaUAF.inscripciones=null,a.busquedaUAF.ano=null,a.doFocus("inscripciones")},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.resetResultadoUAF=function(){a.busquedaUAF.data=null,void 0!==a.busquedaUAF.resultados&&(a.busquedaUAF.resultados.length=0)},a.raiseErr=function(b){a.openMensajeModal("error",b,"",!1,null)},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openMensajeModal=function(c,d,e,f,h){g.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return c},titulo:function(){return d},detalle:function(){return e}}}),f&&b(function(){a.closeModal()},1e3*h)},a.openLoadingModal=function(a,b){g.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.closeModal=function(){var a=h.getTop();a&&h.dismiss(a.key)}}]),app.controller("UrgenciaCtrl",["$scope","$timeout","urgenciaModel","solicitudService","$filter","$modal","$modalStack","$rootScope",function(a,b,c,d,e,f,g,h){a.busquedaTitulo=c.getBusquedaTitulo(),a.states=c.getStates(),a.buscar=function(){a.resetResultadoTitulo();var b=a.busquedaTitulo.foja,c=a.busquedaTitulo.numero,f=a.busquedaTitulo.ano,g=a.busquedaTitulo.bis;a.openLoadingModal("Buscando...",""),d.getByFojaNumeroAno(b,c,f,g).then(function(b){a.closeModal(),null===b.status||(b.status?(a.busquedaTitulo.fecha=new Date,a.busquedaTitulo.data=b,a.busquedaTitulo.resultados=e("orderBy")(b.aaData,"idSolicitud",!1)):a.raiseErr("buscar","Problema detectado",b.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.darUrgencia=function(){var b=a.busquedaTitulo.foja,c=a.busquedaTitulo.numero,e=a.busquedaTitulo.ano,f=a.busquedaTitulo.bis;a.openLoadingModal("Urgencia, en proceso...",""),d.urgenciaSolicitud(b,c,e,f).then(function(b){a.closeModal(),null===b.status||(b.status?(a.openMensajeModal("success","Urgencia Solicitud","Se ha incorporado urgencia a la solicitud.",!0,1),a.resetResultadoTitulo()):a.raiseErr("buscar","Problema detectado",b.msg))},function(b){a.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.limpiarTitulo=function(){a.resetResultadoTitulo(),a.busquedaTitulo.foja=null,a.busquedaTitulo.numero=null,a.busquedaTitulo.ano=null,a.busquedaTitulo.bis=!1,a.myform.$setPristine(!0),a.doFocus("foja")},a.resetResultadoTitulo=function(){a.busquedaTitulo.data=null,void 0!==a.busquedaTitulo.resultados&&(a.busquedaTitulo.resultados.length=0)},a.archivoNacional=function(a){return!(a<h.aioParametros.anoArchivoNacional)},a.anoActual=function(a){return!(moment(new Date).year()<a)},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openMensajeModal=function(c,d,e,g,h){f.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return c},titulo:function(){return d},detalle:function(){return e}}}),g&&b(function(){a.closeModal()},1e3*h)},a.openLoadingModal=function(a,b){f.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.closeModal=function(){var a=g.getTop();a&&g.dismiss(a.key)},a.raiseErr=function(b,c,d){a.closeModal(),a.states[b].isError=!0,a.states[b].title=c,a.states[b].msg=d}}]),app.controller("VerCartelCtrl",["$scope","$routeParams","$rootScope","$sce","$timeout","$modalStack","$modal","$filter","CartelesService","cartelesModel",function(a,b,c,d,e,f,g,h,i,j){a.isLoading=!0,a.actualizandoAlgo=!1,a.estadoDocumento=j.getEstadoDocumento(),a.hoy=moment().format("DD/MM/YYYY"),a.paginas=[],a.errorObj={hay:!1,level:"warning",title:"",msg:""},a.imagen={page:1},a.tab={parentActive:1},a.parametros={numero:b.numero,mes:b.mes,ano:b.ano,registro:b.registro,bis:b.bis,origen:b.origen,tipo:b.tipo,rehacer:b.rehacer},a.formulario={caratula:"",numero:"",mes:"",ano:"",bis:!1,paginaDesde:"",paginaHasta:""},a.certificados=[],a.isActiveParent=function(b){return a.tab.parentActive===b},a.activateParent=function(b){a.tab.parentActive=b},a.buscarCartel=function(){var b=a.parametros.numero,c=a.parametros.mes,d=a.parametros.ano,e=a.parametros.registro,f=a.parametros.bis,g=a.parametros.tipo;i.buscarCartel(b,c,d,e,f,g).then(function(f){if(a.isLoading=!1,null===f.status);else if(f.status)if(f.cartelDTO.hayArchivo){var g=i.listadoCertificadosByUserInSession();g.then(function(f){if(null===f.status);else if(f.status)for(var g=0;g<f.aaData.length;g++)f.aaData[g].mes==c&&f.aaData[g].ano==d&&f.aaData[g].numero==b&&f.aaData[g].idReg==e&&a.certificados.push(f.aaData[g]);else a.openMensajeModal("error","Problema detectado",f.msg)},function(b){a.raiseErr("mis","Problema detectado","No se ha podido establecer comunicación con el servidor.")}),a.estadoDocumento=f.cartelDTO,0===f.cartelDTO.tipoArchivoDTO.tipoArchivo?a.iniciaVisualizador():1===f.cartelDTO.tipoArchivoDTO.tipoArchivo&&a.iniciaVisualizador()}else a.openMensajeModal("info","No documento para cartel","");else a.openMensajeModal("error","Problema detectado",f.msg)},function(b){a.isLoading=!1})},a.cerrar=function(){c.go("/"+a.parametros.origen)},a.hayArchivo=function(){return a.estadoDocumento.hayArchivo},a.hayPaginas=function(){return a.estadoDocumento.cantidadPaginas>0},a.certificarCartel=function(){a.openLoadingModal("Creando certificado...","");var b,d,f,g,h=a.formulario.caratula,j=a.estadoDocumento.mes,k=a.estadoDocumento.ano,l="AIO"==c.aioParametros.sistema?1:a.estadoDocumento.registro,m=a.estadoDocumento.tipoArchivoDTO.tipoArchivo;0===m?(b=a.formulario.numero,d=a.formulario.bis,f=a.formulario.paginaDesde,g=a.formulario.paginaHasta):1===m&&(b=a.estadoDocumento.numero,d=a.estadoDocumento.bis,f=0,g=0),i.certificar(h,b,j,k,l,d,f,g,m).then(function(c){c.status?(a.openMensajeModal("info","Certificado creado exitosamente.",""),e(function(){a.closeModal()},2e3),a.certificados.push({idCertificado:c.idCertificado,caratula:h,numero:b,mes:j,ano:k,idReg:l,bis:d,pdesde:f,phasta:g,tipo:m}),a.limpiarFormulario()):a.openMensajeModal("error","Problema detectado creando certificado.","")},function(b){a.closeModal()})},a.irRehacer=function(a){c.go("/verCartel/"+a.numero+"/"+a.mes+"/"+a.ano+"/"+a.registro+"/"+a.bis+"/0/carteles/true")},a.rehacer=function(){a.openLoadingModal("Regenerando cartel...","");var b=a.formulario.numero,d=a.estadoDocumento.mes,f=a.estadoDocumento.ano,g=a.estadoDocumento.registro,h=a.formulario.bis,j=a.formulario.paginaDesde,k=a.formulario.paginaHasta;i.rehacer(b,d,f,g,h,j,k).then(function(i){i.status?(a.limpiarFormulario(),a.openMensajeModal("info","Cartel generado exitosamente","Redireccionando..."),e(function(){a.closeModal(),c.go("/verCartel/"+b+"/"+d+"/"+f+"/"+g+"/"+h+"/1/carteles/")},2e3)):a.openMensajeModal("error","Problema detectado regenerando cartel.",""),a.actualizandoAlgo=!1},function(b){a.openMensajeModal("error","Problema detectado regenerando cartel.","")})},a.eliminar=function(b,c,d){confirm("Desea eliminar el certificado?")&&(a.actualizandoAlgo=!0,i.eliminar(c,d).then(function(c){a.certificados.splice(b,1),a.actualizandoAlgo=!1},function(b){a.actualizandoAlgo=!1}))},a.firmar=function(b,c,d){a.openLoadingModal("Firmando...",""),i.firmar(c,d).then(function(c){c.status?(a.openMensajeModal("success","Documento firmado exitosamente.",""),e(function(){a.closeModal()},2e3),a.certificados.splice(b,1)):a.openMensajeModal("error","Problema detectado firmando documento.","")},function(b){a.closeModal()})},a.openMensajeModal=function(b,c,d){a.closeModal(),g.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,size:"sm",windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return b},titulo:function(){return c},detalle:function(){return d}}})},a.iniciaVisualizador=function(){if(a.isLoading=!1,a.estadoDocumento.hayArchivo)for(var b=a.estadoDocumento.numero,c=a.estadoDocumento.mes,e=a.estadoDocumento.ano,f=a.estadoDocumento.registro,g=a.estadoDocumento.bis,h=a.estadoDocumento.tipoArchivoDTO,i=0;i<a.estadoDocumento.cantidadPaginas;i++){var j=new Date,k=j.getTime(),l=i+1,m="../do/service/carteles?v="+k+"&metodo=getJPG&pagina="+l+"&numero="+b+"&mes="+c+"&ano="+e+"&registro="+f+"&bis="+g+"&tipoArchivo="+h.tipoArchivo,n=d.trustAsResourceUrl(m);a.paginas.push({pagina:i+1,numero:b,mes:c,ano:e,bis:g,tipoArchivo:h.tipoArchivo,url:n})}},a.openDocumentoModal=function(b){a.closeModal(),g.open({templateUrl:"documentoModal.html",backdrop:!0,keyboard:!0,size:"lg",windowClass:"modal",controller:"DocumentoModalCtrl",resolve:{url:function(){return b}}})},a.openLoadingModal=function(a,b){g.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.openMensajeModal=function(b,c,d){a.closeModal(),g.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,size:"sm",windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return b},titulo:function(){return c},detalle:function(){return d}}})},a.verCertificado=function(b,c){a.openDocumentoModal("../do/service/carteles?metodo=getPDF&idCertificado="+b+"&registro="+c)},a.closeModal=function(){var a=f.getTop();a&&f.dismiss(a.key)},a.limpiarFormulario=function(){a.formulario.caratula="",a.formulario.numero="",a.formulario.mes="",a.formulario.ano="",a.formulario.bis=!1,a.formulario.paginaDesde="",a.formulario.paginaHasta="",a.doFocus("caratula")},a.archivoNacional=function(a){return!(a<c.aioParametros.anoArchivoNacional)},a.anoActual=function(a){return!(moment(new Date).year()<a)},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.buscarCartel()}]),app.controller("VerEscrituraCtrl",["$scope","$routeParams","$rootScope","$sce","escrituraService",function(a,b,c,d,e){a.parametros={caratula:b.caratula,origen:b.origen},a.buscar=function(){var b=a.parametros.caratula;a.urlPDF=d.trustAsResourceUrl("../do/service/escritura?metodo=verDocumento&caratula="+b+"&type=uri")},a.cerrar=function(){c.go("/"+a.parametros.origen)},a.buscar()}]),app.controller("VerEscrituraEstudioCtrl",["$scope","$routeParams","$rootScope","$sce","escrituraService",function(a,b,c,d,e){a.parametros={caratula:b.caratula,version:b.version,origen:b.origen},a.buscar=function(){var b=a.parametros.caratula,c=a.parametros.version,e=a.parametros.idTipoDocumento;a.urlPDF=d.trustAsResourceUrl("../do/service/escritura?metodo=verDocumentoEstudio&caratula="+b+"&version="+c+"&idTipoDocumento="+e+"&type=uri")},a.cerrar=function(){c.go("/"+a.parametros.origen)},a.buscar()}]),app.controller("VerExportarPDFCtrl",["$scope","$routeParams","$sce","$modalStack","nc",function(a,b,c,d,e){a.caratula=e,a.buscar=function(){var b=a.caratula;a.urlPDF=c.trustAsResourceUrl("../do/service/estado?metodo=getEstadoReporte&ingresoEgreso=true&tipo=pdf&nc="+b)},a.cerrar=function(){var a=d.getTop();a&&d.dismiss(a.key)},a.buscar()}]),app.controller("VerGPCtrl",["$scope","$routeParams","$rootScope","$sce","$modalStack","escrituraService","codigoAlphap","origenp",function(a,b,c,d,e,f,g,h){a.parametros={codigoAlpha:b.codigoAlpha,origen:b.origen},a.buscar=function(){var b=a.parametros.codigoAlpha;""!=g&&(b=g),a.urlPDF=d.trustAsResourceUrl("../do/service/gponline?metodo=verGP&codigoAlpha="+b)},a.cerrar=function(){if(""!=h){var b=e.getTop();b&&e.dismiss(b.key)}else c.go("/"+a.parametros.origen)},a.buscar()}]),app.controller("VerImprimeCaratulaCtrl",["$scope","$routeParams","$sce","$timeout","$modal","$modalInstance","$modalStack","nc","$q","$http",function(a,b,c,d,e,f,g,h,i,j){a.caratula=h,a.openLoadingModal=function(a,b){e.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.closeModal=function(){var a=g.getTop();a&&g.dismiss(a.key)},a.buscar=function(){var b=a.caratula;a.openLoadingModal("Preparando Impresion...",""),j.get("../do/service/estado?metodo=getEstadoReporteFirstPage&nc="+b,{responseType:"arraybuffer"}).then(function(b){if(a.closeModal(),b.data.byteLength>0){var e=new Blob([b.data],{type:"application/pdf"}),f=URL.createObjectURL(e);a.urlPDF=c.trustAsResourceUrl(f),d(function(){a.imprimir()},500)}else a.cerrar(),a.raiseErr("Error al obtener documentos para imprimir")},function(b){a.cerrar(),a.raiseErr("Error al imprimir documentos")})},a.cerrar=function(){var a=g.getTop();a&&g.dismiss(a.key)},a.imprimir=function(){window.frames.printf.focus(),window.frames.printf.print()},a.buscar(),a.raiseErr=function(b){a.openMensajeModal("error",b,"",!1,null)},a.doFocus=function(b){a.$broadcast(b+"IsFocused")},a.openMensajeModal=function(b,c,f,g,h){e.open({templateUrl:"mensajeModal.html",backdrop:!0,keyboard:!0,windowClass:"modal",controller:"MensajeModalCtrl",resolve:{tipo:function(){return b},titulo:function(){return c},detalle:function(){return f}}}),g&&d(function(){a.closeModal()},1e3*h)}}]),app.controller("VerInscripcionCtrl",["$scope","$routeParams","$rootScope","$sce","$modal","$timeout","$filter","$window","solicitudService","solicitudHipotecasService","solicitudProhibicionesService","AnotacionService","AnotacionHipotecasService","AnotacionProhibicionesService","inscripcionDigitalService","inscripcionDigitalHipotecasService","borradorService","inscripcionDigitalProhibicionesService","indiceService","digitalModel","digitalHipotecasModel","digitalProhibicionesModel","filterFilter",function($scope,$routeParams,$rootScope,$sce,$modal,$timeout,$filter,$window,solicitudService,solicitudHipotecasService,solicitudProhibicionesService,AnotacionService,AnotacionHipotecasService,AnotacionProhibicionesService,inscripcionDigitalService,inscripcionDigitalHipotecasService,borradorService,inscripcionDigitalProhibicionesService,indiceService,digitalModel,digitalHipotecasModel,digitalProhibicionesModel,filterFilter){if($scope.reverseNotas=$routeParams.reverseNotas,$scope.hoy=moment().format("DD/MM/YYYY"),$scope.data={},$scope.anotaciones=[],$scope.embargos=[],$scope.notas=[],$scope.borradores=[],$scope.proceso=[],$scope.terminadas=[],$scope.paginas=[],$scope.titulos=[],$scope.selectedAll=!1,$scope.errorObj={hay:!1,level:"warning",title:"",msg:""},$scope.tab={parentActive:1},$scope.imagen={page:1,isPdfLoaded:!1},$scope.paginacionMaster={currentPage:1,numPerPage:10,maxSize:2,totalpaginas:0,filteredTodos:[],todos:[],filterExprNotas:""},$scope.filaTicketMasivo={foja:null,num:null,ano:null},$scope.busquedaNotas={predicate:null,reverse:null},$scope.paginacionNotas=angular.copy($scope.paginacionMaster),$scope.parametros={registro:$routeParams.registro,foja:$routeParams.foja,numero:$routeParams.numero,ano:$routeParams.ano,bis:$routeParams.bis,origen:$routeParams.origen,estado:$routeParams.estado,caratula:$routeParams.caratula,borrador:$routeParams.borrador,folio:$routeParams.folio},$scope.servicioSolicitud="prop"==$scope.parametros.registro?solicitudService:"hip"==$scope.parametros.registro?solicitudHipotecasService:solicitudProhibicionesService,$scope.servicioInscripcion="prop"==$scope.parametros.registro?inscripcionDigitalService:"hip"==$scope.parametros.registro?inscripcionDigitalHipotecasService:inscripcionDigitalProhibicionesService,$scope.servicioAnotacion="prop"==$scope.parametros.registro?AnotacionService:"hip"==$scope.parametros.registro?AnotacionHipotecasService:AnotacionProhibicionesService,$scope.modeloDigital="prop"==$scope.parametros.registro?digitalModel:"hip"==$scope.parametros.registro?digitalHipotecasModel:digitalProhibicionesModel,$scope.inscripcionDigital="prop"==$scope.parametros.registro?"inscripcionDigital":"hip"==$scope.parametros.registro?"inscripcionDigitalHipotecas":"inscripcionDigitalProhibiciones",$timeout(function(){void 0!==$rootScope.aioParametros&&($scope.anoDigital="prop"==$scope.parametros.registro?$rootScope.aioParametros.anoDigitalPropiedades:"hip"==$scope.parametros.registro?$rootScope.aioParametros.anoDigitalHipotecas:$rootScope.aioParametros.anoDigitalProhibiciones,$scope.fojasDigital="proh"==$scope.parametros.registro?$rootScope.aioParametros.fojasDigitalProhibiciones:0)},100),$scope.izquierdaStatus={anotaciones:!0,borradores:!1,borradoresLoaded:!1,proceso:!1,procesoLoaded:!1,terminadas:!1,terminadasLoaded:!1},$scope.barraDerechaStatus={nota:!0,formulario:!1},$scope.loaders={borradores:{isLoading:!1,error:!1},enProceso:{isLoading:!1,error:!1},terminadas:{isLoading:!1,error:!1},anotaciones:{isLoading:!1,error:!1},notas:{isLoading:!1,error:!1},titulosanteriores:{isLoading:!1,error:!1}},$scope.derechaStatus={notasExpanded:!1},$scope.isLoadingSolicitar=!1,$scope.statusSolicitar={ok:!1,error:!1},$scope.isActiveParent=function(a){return $scope.tab.parentActive===a},$scope.activateParent=function(a){$scope.tab.parentActive=a,2==a&&($scope.imagen.isPdfLoaded=!0)},$scope.openEmbargosModal=function(){$modal.open({templateUrl:"embargoModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EmbargoModalCtrl",size:"lg",resolve:{embargos:function(){return $scope.embargos}}})},$scope.cerrar=function(){"consultadiablito"==$scope.parametros.origen?$rootScope.go("/"+$scope.parametros.origen+"/"+$scope.parametros.caratula+"/"+$scope.parametros.borrador+"/"+$scope.parametros.folio):$rootScope.go("/"+$scope.parametros.origen)},$scope.verInscripcion=function(a){$rootScope.go("/verInscripcion/"+$scope.parametros.registro+"/"+a.foja+"/"+a.numero+"/"+a.ano+"/"+a.bis+"/"+$scope.parametros.origen)},$scope.acordionIzquierda=function(a){"anotaciones"===a?($scope.izquierdaStatus.anotaciones?$scope.izquierdaStatus.anotaciones=!1:$scope.izquierdaStatus.anotaciones=!0,$scope.izquierdaStatus.borradores=!1,$scope.izquierdaStatus.proceso=!1,$scope.izquierdaStatus.terminadas=!1):"borradores"===a?($scope.izquierdaStatus.borradores?$scope.izquierdaStatus.borradores=!1:($scope.izquierdaStatus.borradores=!0,!$scope.izquierdaStatus.borradoresLoaded&&$scope.data.contadores.borradores>0&&($scope.izquierdaStatus.borradoresLoaded=!0,$scope.loadWidgets("borradores"))),$scope.izquierdaStatus.anotaciones=!1,$scope.izquierdaStatus.proceso=!1,$scope.izquierdaStatus.terminadas=!1):"proceso"===a?($scope.izquierdaStatus.proceso?$scope.izquierdaStatus.proceso=!1:($scope.izquierdaStatus.proceso=!0,!$scope.izquierdaStatus.procesoLoaded&&$scope.data.contadores.proceso>0&&($scope.izquierdaStatus.procesoLoaded=!0,$scope.loadWidgets("enProceso"))),$scope.izquierdaStatus.anotaciones=!1,$scope.izquierdaStatus.borradores=!1,$scope.izquierdaStatus.terminadas=!1):"terminadas"===a&&($scope.izquierdaStatus.terminadas?$scope.izquierdaStatus.terminadas=!1:($scope.izquierdaStatus.terminadas=!0,!$scope.izquierdaStatus.terminadasLoaded&&$scope.data.contadores.terminadas>0&&($scope.izquierdaStatus.terminadasLoaded=!0,$scope.loadWidgets("terminadas"))),$scope.izquierdaStatus.anotaciones=!1,$scope.izquierdaStatus.borradores=!1,$scope.izquierdaStatus.proceso=!1)},$scope.acordionDerecha=function(a){"nota"===a?($scope.barraDerechaStatus.nota?$scope.barraDerechaStatus.nota=!1:$scope.barraDerechaStatus.nota=!0,$scope.barraDerechaStatus.formulario=!1):"formulario"===a&&($scope.barraDerechaStatus.formulario?($scope.barraDerechaStatus.formulario=!1,$scope.acordionNotas()):($scope.barraDerechaStatus.formulario=!0,$scope.acordionNotas(),$scope.titulosanteriores()),$scope.barraDerechaStatus.nota=!1)},$scope.esReferencial=function(){return 9===$scope.data.consultaDocumentoDTO.tipoDocumento||10==$scope.data.consultaDocumentoDTO.tipoDocumento},$scope.esVersionado=function(){return 8===$scope.data.consultaDocumentoDTO.tipoDocumento},$scope.tieneRechazo=function(){return $scope.data.estado.tieneRechazo},$scope.esMalCitadaDesde=function(){return!$scope.data.estado.fna&&$scope.data.inscripcionDigitalDTO.ano>=$scope.anoDigital&&$scope.data.inscripcionDigitalDTO.foja>=$scope.fojasDigital},$scope.hayDocumento=function(){return $scope.data.consultaDocumentoDTO.hayDocumento},$scope.hayPaginas=function(){return $scope.data.consultaDocumentoDTO.cantidadPaginas>0},$scope.acordionNotas=function(){return $scope.derechaStatus.notasExpanded=!$scope.derechaStatus.notasExpanded},$scope.loadWidgets=function(a){var b,c=$scope.data.inscripcionDigitalDTO.foja,d=$scope.data.inscripcionDigitalDTO.numero,e=$scope.data.inscripcionDigitalDTO.ano,f=$scope.data.inscripcionDigitalDTO.bis;"borradores"===a?b=$scope.servicioInscripcion.obtenerBorradores(c,d,e,f):"enProceso"===a?b=$scope.servicioInscripcion.obtenerCaratulasPorEstado(c,d,e,f,0):"terminadas"===a&&(b=$scope.servicioInscripcion.obtenerCaratulasPorEstado(c,d,e,f,1)),$scope.loaders[a].isLoading=!0,b.then(function(b){null==b.status?$window.location.href=$window.location.protocol+"//"+$window.location.host+$window.location.pathname:b.status?"borradores"===a?$scope.borradores=b.borradores:"enProceso"===a?$scope.proceso=b.caratulas:"terminadas"===a&&($scope.terminadas=b.caratulas):$scope.loaders[a].error=!0,$scope.loaders[a].isLoading=!1},function(b){$scope.loaders[a].isLoading=!1,$scope.loaders[a].error=!0})},$scope.deleteAnotacion=function(a){var b="Desea eliminar la nota?",c=!0;if(1===a.tipoAnotacionDTO.idTipoAnotacion||2===a.tipoAnotacionDTO.idTipoAnotacion?c=!0:3===a.tipoAnotacionDTO.idTipoAnotacion&&(c=!1,b="Desea eliminar la anotación?"),confirm(b)){$scope.actualizandoAlgo=!0;$scope.servicioAnotacion.deleteAnotacion(a.idAnotacion).then(function(b){null===b.status?$window.location.href=$window.location.protocol+"//"+$window.location.host+$window.location.pathname:b.status?(c?$scope.notas.splice($scope.notas.indexOf(a),1):(a.estadoAnotacionDTO.idEstado=7,a.nombreUsuarioEliminador=b.usuarioEliminador,a.fechaEliminacion=b.fechaEliminacion),$scope.actualizandoAlgo=!1):($scope.actualizandoAlgo=!1,alert("Se ha detectado un problema."))},function(a){$scope.actualizandoAlgo=!1,alert("Se ha detectado un problema en el servidor.")})}},$scope.imprimirNotas=function(){$window.open($window.location.protocol+"//"+$window.location.host+"/aio/do/service/anotacion?metodo=printNotas&fojas="+$scope.parametros.foja+"&numero="+$scope.parametros.numero+"&ano="+$scope.parametros.ano+"&bis="+$scope.parametros.bis+"&registro="+$scope.parametros.registro+"&download=false","popupNotas","width=800,height=600")},$scope.modificarAnotacion=function(a){$modal.open({templateUrl:"modificaAnotacionModal.html",backdrop:"static",keyboard:!1,windowClass:"modal",controller:"ModificaAnotacionModalCtrl",resolve:{nota:function(){return a},inscripcionDigitalDTO:function(){return $scope.data.inscripcionDigitalDTO},anotaciones:function(){return $scope.anotaciones},notas:function(){return $scope.notas},origen:function(){return $scope.parametros.origen},paginacionNotas:function(){return $scope.paginacionNotas}}})},$scope.openAnotacion=function(){$modal.open({templateUrl:"anotacionModal.html",backdrop:"static",keyboard:!1,windowClass:"modal",controller:"AnotacionModalCtrl",resolve:{idInscripcion:function(){return $scope.data.inscripcionDigitalDTO.idInscripcion},anotaciones:function(){return $scope.anotaciones},inscripcionDigitalDTO:function(){return $scope.data.inscripcionDigitalDTO},notas:function(){return $scope.notas},origen:function(){return $scope.parametros.origen},paginacionNotas:function(){return $scope.paginacionNotas}}})},$scope.irGpOnlineAIO=function(a,b){$modal.open({templateUrl:"gpOnlineModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"gpOnlineModalCtrl",size:"lg",resolve:{borrador:function(){return parseInt(a)},folio:function(){return parseInt(b)}}})},$scope.verEstadoCaratula=function(a){$modal.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})},$scope.verRepertorio=function(a){$modal.open({templateUrl:"repertorioModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"RepertorioModalCtrl",size:"lg",resolve:{numeroRepertorio:function(){return parseInt(a)}}})},$scope.solicitar=function(){var a=$scope.data.inscripcionDigitalDTO;$scope.resetStatusSolicitar(),$scope.isLoadingSolicitar=!0,$scope.servicioSolicitud.saveSingle(a.foja,a.numero,a.ano,a.bis).then(function(a){$scope.isLoadingSolicitar=!1,null===a.status?$window.location.href=$window.location.protocol+"//"+$window.location.host+$window.location.pathname:a.status?$scope.setSolicitarOK():alert("Problema detectado, no se ha guardado la solicitud")},function(a){$scope.isLoadingSolicitar=!1,alert("Problema contactando al servidor, no se ha guardado la solicitud.")})},$scope.setSolicitarOK=function(){$scope.resetStatusSolicitar(),$scope.statusSolicitar.ok=!0,$scope.setSolicitarMsg("","")},$scope.setSolicitarError=function(a,b){$scope.resetStatusSolicitar(),$scope.statusSolicitar.error=!0,$scope.setSolicitarMsg(a,b)},$scope.resetStatusSolicitar=function(){$scope.statusSolicitar.ok=!1,$scope.statusSolicitar.error=!1,$scope.statusSolicitar.msgTitle="",$scope.statusSolicitar.msg=""},$scope.setSolicitarMsg=function(a,b){$scope.statusSolicitar.msgTitle=a,$scope.statusSolicitar.msg=b},$scope.raiseErr=function(a,b,c){$scope.errorObj.hay=!0,$scope.errorObj.level=a,$scope.errorObj.title=b,$scope.errorObj.msg=c},$scope.openSolicitar=function(a,b){var c=null,d=null,e=null,f=null,g=null;c=a.foja,d=a.numero,e=a.ano,f="false",g=a.registro,indiceService.getIndicePropiedades(null,null,null,c,d,e,f,null,null,null,null,null,!0,!1,!1,!1,null,null,null).then(function(a){if(null===a.status);else if(a.status){for(var f in a.aaData){b=a.aaData[f];break}$modal.open({templateUrl:"indiceModal.html",backdrop:!0,windowClass:"modal",controller:"IndiceModalCtrl",resolve:{resolveModal:function(){return $scope.resolveModal},foja:function(){return c},numero:function(){return d},ano:function(){return e},registro:function(){return g},indice:function(){return b},origen:function(){return"verinscripcion"},titulos:function(){return""}}})}else $scope.raiseErr("buscar","Problema detectado",a.msg)},function(a){$scope.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},$scope.ticket=function(a,b){var c=null,d=null,e=null,f=null,g=null;c=a.foja,d=a.numero,e=a.ano,f="false",g=a.registro,indiceService.getIndicePropiedades(null,null,null,c,d,e,f,null,null,null,null,null,!0,!1,!1,!1,null,null,null).then(function(a){if(null===a.status);else if(a.status){for(var f in a.aaData){b=a.aaData[f];break}$modal.open({templateUrl:"TicketInformacion.html",backdrop:!0,windowClass:"modal",controller:"TicketInformacionCtrl",resolve:{resolveModal:function(){return $scope.resolveModal},foja:function(){return c},numero:function(){return d},ano:function(){return e},nombre:function(){return b.nombre},direccion:function(){return b.dir},comuna:function(){return b.comuna},registro:function(){return g},titulos:function(){return""}}})}else $scope.raiseErr("buscar","Problema detectado",a.msg)},function(a){$scope.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})},$scope.inicia=function(){if(!$scope.tieneRechazo()&&!$scope.esMalCitadaDesde()&&$scope.hayDocumento()&&$scope.hayPaginas()){for(var a=$scope.data.inscripcionDigitalDTO.foja,b=$scope.data.inscripcionDigitalDTO.numero,c=$scope.data.inscripcionDigitalDTO.ano,d=$scope.data.inscripcionDigitalDTO.bis,e=$scope.data.consultaDocumentoDTO.tipoDocumento,f=$scope.parametros.registro,g=0;g<$scope.data.consultaDocumentoDTO.cantidadPaginas;g++){var h=new Date,i=h.getTime(),j=g+1,k="../do/service/"+$scope.inscripcionDigital+"?v="+i+"&metodo=getJPG&p="+j+"&fojas="+a+"&numero="+b+"&ano="+c+"&bis="+d+"&tipoDoc="+$scope.data.consultaDocumentoDTO.tipoDocumento,l=$sce.trustAsResourceUrl(k);$scope.paginas.push({num:g+1,foja:a,numero:b,ano:c,bis:d,tipoDoc:$scope.data.consultaDocumentoDTO.tipoDocumento,url:l})}$scope.urlPDF=$sce.trustAsResourceUrl("../do/service/pdf?metodo=getInscripcion&registro="+f+"&foja="+a+"&numero="+b+"&ano="+c+"&bis="+d+"&estado="+e)}"prop"==f?$scope.buscaNotas():(8===$scope.data.consultaDocumentoDTO.tipoDocumento&&angular.forEach($scope.data.inscripcionDigitalDTO.anotacionsForIdInscripcionDestino,function(a){1!==a.tipoAnotacionDTO.idTipoAnotacion&&2!==a.tipoAnotacionDTO.idTipoAnotacion||7===a.estadoAnotacionDTO.idEstado?3===a.tipoAnotacionDTO.idTipoAnotacion&&$scope.anotaciones.push(a):($scope.notas.push(a),2!==a.tipoAnotacionDTO.idTipoAnotacion&&1!==a.tipoAnotacionDTO.idTipoAnotacion||"Prejudicial"!=a.acto&&"Embargo"!=a.acto&&"Medida Precautoria"!=a.acto&&"Medida Prejudicial Precautoria"!=a.acto&&"Quiebra"!=a.acto&&"Interdiccion"!=a.acto&&"Prohibicion Judicial"!=a.acto&&"Prohibicion Voluntaria"!=a.acto&&"Desposeimiento"!=a.acto&&"Litigio"!=a.acto&&"LIQUIDACION LEY 20720"!=a.acto||$scope.embargos.push(a))}),$scope.makeTodos(),$scope.embargos.length>0&&$timeout(function(){$scope.openEmbargosModal()},2e3))},$scope.buscar=function(a){$scope.isLoading=!0;var b=($scope.parametros.registro,$scope.parametros.foja),c=$scope.parametros.numero,d=$scope.parametros.ano,e=$scope.parametros.bis;$scope.servicioInscripcion.getInscripcion(b,c,d,e).then(function(a){null==a.status?$window.location.href=$window.location.protocol+"//"+$window.location.host+$window.location.pathname:a.status?($scope.data=a,$scope.inicia(),$scope.isLoading=!1):$scope.raiseErr("error","Error detectado.",a.msg),$scope.isLoading=!1},function(a){$scope.isLoading=!1,$scope.raiseErr("error","Error detectado.","No se ha podido establecer comunicación.")})},$scope.buscaNotas=function(){$scope.loaders.anotaciones.isLoading=!0,$scope.loaders.notas.isLoading=!0;var a=$scope.parametros.foja,b=$scope.parametros.numero,c=$scope.parametros.ano,d=$scope.parametros.bis;$scope.servicioInscripcion.getNotas(a,b,c,d).then(function(a){null==a.status||(a.status?(8===$scope.data.consultaDocumentoDTO.tipoDocumento&&angular.forEach(a.anotaciones,function(a){1!==a.tipoAnotacionDTO.idTipoAnotacion&&2!==a.tipoAnotacionDTO.idTipoAnotacion||7===a.estadoAnotacionDTO.idEstado?3===a.tipoAnotacionDTO.idTipoAnotacion&&$scope.anotaciones.push(a):($scope.notas.push(a),2!==a.tipoAnotacionDTO.idTipoAnotacion&&1!==a.tipoAnotacionDTO.idTipoAnotacion||"Prejudicial"!=a.acto&&"Embargo"!=a.acto&&"Medida Precautoria"!=a.acto&&"Medida Prejudicial Precautoria"!=a.acto&&"Quiebra"!=a.acto&&"Interdiccion"!=a.acto&&"Prohibicion Judicial"!=a.acto&&"Prohibicion Voluntaria"!=a.acto&&"Desposeimiento"!=a.acto&&"Litigio"!=a.acto&&"LIQUIDACION LEY 20720"!=a.acto||$scope.embargos.push(a))}),$scope.makeTodos(),$scope.embargos.length>0&&$timeout(function(){$scope.openEmbargosModal()},2e3)):($scope.raiseErr("error","Error Obteniendo Notas.",a.msg),$scope.loaders.anotaciones.error=!0,$scope.loaders.notas.error=!0)),$scope.loaders.anotaciones.isLoading=!1,$scope.loaders.notas.isLoading=!1},function(a){$scope.loaders.anotaciones.isLoading=!1,$scope.loaders.notas.isLoading=!1,$scope.loaders.anotaciones.error=!0,$scope.loaders.notas.error=!0,$scope.raiseErr("error","Error detectado.","No se ha podido establecer comunicación.")})},"digital"===$scope.parametros.origen){var dataState=digitalModel.getDataState();if(dataState.inscripcionDigitalDTO){var temp=dataState.inscripcionDigitalDTO.bis?"true":"false";$scope.parametros.foja==dataState.inscripcionDigitalDTO.foja&&$scope.parametros.numero==dataState.inscripcionDigitalDTO.numero&&$scope.parametros.ano==dataState.inscripcionDigitalDTO.ano&&$scope.parametros.bis==temp?($scope.data=dataState,$scope.inicia()):$scope.buscar()}else $scope.buscar()}else $scope.buscar();$scope.solicitarPreCaratulaMasiva=function(a){$scope.titulosMasivo=[],angular.forEach($scope.titulos,function(a){a.Selected&&$scope.titulosMasivo.push(a)});$modal.open({templateUrl:"indiceModal.html",backdrop:!0,windowClass:"modal",controller:"IndiceModalCtrl",resolve:{resolveModal:function(){return $scope.resolveModal},foja:function(){return""},numero:function(){return""},ano:function(){return""},registro:function(){return a},indice:function(){return""},origen:function(){return"verinscripcion"},titulos:function(){return $scope.titulosMasivo}}})},$scope.archivoNacional=function(a){return!(a<$rootScope.aioParametros.anoArchivoNacional)},$scope.anoActual=function(a){return!(moment(new Date).year()<a)},$scope.makeTodos=function(){$scope.paginacionNotas=angular.copy($scope.paginacionMaster),$scope.paginacionNotas.todos=$scope.notas;var a=($scope.paginacionNotas.currentPage-1)*$scope.paginacionNotas.numPerPage,b=a+$scope.paginacionNotas.numPerPage;$scope.paginacionNotas.filteredTodos=$scope.paginacionNotas.todos.slice(a,b),$scope.paginacionNotas.totalpaginas=Math.ceil($scope.paginacionNotas.todos.length/$scope.paginacionNotas.numPerPage)},$scope.$watch("paginacionNotas.filterExprNotas",function(a,b){if(void 0!=a&&void 0!=b){$scope.filtered=filterFilter($scope.notas,a),$scope.paginacionNotas.todos=$scope.filtered,$scope.paginacionNotas.currentPage=1;var c=($scope.paginacionNotas.currentPage-1)*$scope.paginacionNotas.numPerPage,d=c+$scope.paginacionNotas.numPerPage;$scope.paginacionNotas.filteredTodos=$scope.paginacionNotas.todos.slice(c,d)}},!0),$scope.ticketMasiva=function(a){$scope.titulosTicketMasivo=[];for(var b in $scope.titulos)!function(a){$scope.titulos[a].Selected&&indiceService.getIndicePropiedades(null,null,null,$scope.titulos[a].foja,$scope.titulos[a].numero,$scope.titulos[a].anio,$scope.titulos[a].bis,null,null,null,null,null,!0,!1,!1,!1,!1,null,null).then(function(b){if(console.debug(a),null===b.status);else if(b.status)if(b.aaData.length>0){var c=null;for(var d in b.aaData){c=b.aaData[d];break}$scope.titulosTicketMasivo[a]=c}else $scope.fila=angular.copy($scope.filaTicketMasivo),$scope.fila.foja=$scope.titulos[a].foja,$scope.fila.num=$scope.titulos[a].numero,$scope.fila.ano=$scope.titulos[a].anio,$scope.titulosTicketMasivo[a]=$scope.fila;else $scope.raiseErr("buscar","Problema detectado",b.msg)},function(a){$scope.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})}(b);$timeout(function(){$modal.open({templateUrl:"TicketInformacion.html",backdrop:!0,windowClass:"modal",controller:"TicketInformacionCtrl",resolve:{resolveModal:function(){return $scope.resolveModal},foja:function(){return""},numero:function(){return""},ano:function(){return""},nombre:function(){return""},direccion:function(){return""},comuna:function(){return""},registro:function(){return a},titulos:function(){return $scope.titulosTicketMasivo}}})},2e3)},$scope.titulosanteriores=function(){$scope.titulos=[],$scope.loaders.titulosanteriores.isLoading=!0,borradorService.obtenerTitulosAnteriores($scope.parametros.foja,$scope.parametros.numero,$scope.parametros.ano).then(function(a){if(null===a.status);else if(a.status)if($scope.totalTitulosAnteriores=a.totalTitulosAnteriores,a.listaTitulosAnteriores.length>0)for(var b=0;b<a.listaTitulosAnteriores.length;b++)a.listaTitulosAnteriores[b].vigente?$scope.titulos.push({Selected:!0,foja:a.listaTitulosAnteriores[b].foja,numero:a.listaTitulosAnteriores[b].numero,anio:a.listaTitulosAnteriores[b].ano,vigente:a.listaTitulosAnteriores[b].vigente,id:$scope.titulos.length+1}):$scope.titulos.push({Selected:!1,foja:a.listaTitulosAnteriores[b].foja,numero:a.listaTitulosAnteriores[b].numero,anio:a.listaTitulosAnteriores[b].ano,vigente:a.listaTitulosAnteriores[b].vigente,id:$scope.titulos.length+1});else $scope.titulos.push({Selected:!0,foja:$scope.foja,numero:$scope.numero,anio:$scope.anio,vigente:!1,id:"1"});else $scope.setErr("data.msg",a.msg),$scope.loaders.titulosanteriores.error=!0;$scope.loaders.titulosanteriores.isLoading=!1},function(a){$scope.setErr("Problema contactando al servidor.",""),$scope.loaders.titulosanteriores.isLoading=!1,$scope.loaders.titulosanteriores.error=!0})},$scope.addRow=function(){$scope.titulos.push({foja:$scope.foja,numero:$scope.numero,anio:$scope.anio,vigente:!1,id:$scope.titulos.length+1})},$scope.removeRow=function(name){for(var index=-1,comArr=eval($scope.titulos),i=0;i<comArr.length;i++)if(comArr[i]===name){index=i;break}-1===index&&alert("algo ocurrio"),$scope.titulos.splice(index,1)},$scope.verInscripcionDesdePreCaratula=function(a){$rootScope.go("/verInscripcion/"+$scope.parametros.registro+"/"+a.foja+"/"+a.numero+"/"+a.anio+"/"+!1+"/"+$scope.parametros.origen)},$scope.checkAll=function(){$scope.selectedAll?$scope.selectedAll=!1:$scope.selectedAll=!0,angular.forEach($scope.titulos,function(a){a.vigente||(a.Selected=$scope.selectedAll)})}}]),app.controller("VerInscripcionCertificarCtrl",["$scope","$routeParams","$rootScope","$modal","$modalStack","$sce","$timeout","inscripcionDigitalService","caratulaService","certificacionService",function(a,b,c,d,e,f,g,h,i,j){a.parametros={caratula:b.caratula,foja:b.foja,numero:b.numero,ano:b.ano,bis:b.bis,fechaDoc:b.fechaDoc,rehaceImagen:b.rehaceImagen,idtipoFormulario:b.idtipoFormulario,registro:b.registro,origen:b.origen,mostrar:null},a.states={isLoading:!1,isError:!1,isOk:!1,title:null,msg:null},a.certificacion={tipo:{}},a.anotaciones=[],a.data={},a.borradores=[],a.proceso=[],a.terminadas=[],a.izquierdaStatus={anotaciones:!0,borradores:!1,borradoresLoaded:!1,proceso:!1,procesoLoaded:!1,terminadas:!1,terminadasLoaded:!1},a.loaders={borradores:{isLoading:!1,error:!1},enProceso:{isLoading:!1,error:!1},terminadas:{isLoading:!1,error:!1},anotaciones:{isLoading:!1,error:!1}},a.derechaStatus={notasExpanded:!0},a.acordionNotas=function(){return a.derechaStatus.notasExpanded=!a.derechaStatus.notasExpanded},a.buscar=function(){a.isLoading=!0;var b=a.parametros.caratula,c=a.parametros.registro;a.urlPDF=f.trustAsResourceUrl("../do/service/inscripcionDigital?metodo=verInscripcionCertificar&caratula="+b+"&registro="+c),a.isLoading=!1,h.getInscripcion(a.parametros.foja,a.parametros.numero,a.parametros.ano,a.parametros.bis).then(function(b){null==b.status||(b.status?(a.data=b,a.inicia(),a.isLoading=!1):a.raiseErr("error","Error detectado.",b.msg)),a.isLoading=!1},function(b){a.isLoading=!1,a.raiseErr("error","Error detectado.","No se ha podido establecer comunicación.")})},a.inicia=function(){var b=!1;a.loaders.anotaciones.isLoading=!0,h.getNotas(a.parametros.foja,a.parametros.numero,a.parametros.ano,a.parametros.bis).then(function(c){null==c.status||(c.status?8===a.data.consultaDocumentoDTO.tipoDocumento&&angular.forEach(c.anotaciones,function(c){2===c.tipoAnotacionDTO.idTipoAnotacion?b=!0:3===c.tipoAnotacionDTO.idTipoAnotacion&&a.anotaciones.push(c)}):(a.raiseErr("error","Error Obteniendo Anotaciones.",c.msg),a.loaders.anotaciones.error=!0)),a.loaders.anotaciones.isLoading=!1},function(b){a.loaders.anotaciones.isLoading=!1,a.loaders.anotaciones.error=!0,a.raiseErr("error","Error detectado.","No se ha podido establecer comunicación.")}),("mfarfan"==a.userLoginSinCBRS||"jopazo"==a.userLoginSinCBRS||"hegonzalez"==a.userLoginSinCBRS)&&a.data.inscripcionDigitalDTO.ano<2014?a.parametros.rehaceImagen="1":!b&&a.data.estado.rehacerImagen&&a.data.inscripcionDigitalDTO.ano<2014?a.parametros.rehaceImagen="1":a.parametros.rehaceImagen="0",a.parametros.mostrar=a.parametros.rehaceImagen},a.cerrar=function(){c.go("/"+a.parametros.origen)},a.caratula={resultados:[]},i.obtenerBitacoraCaratula(a.parametros.caratula).then(function(b){null===b.status||(b.status?(a.caratula.resultados=b.listabitacoras,a.status=b.status,0!==a.caratula.resultados.length&&a.openComentariosModal()):a.raiseErr("No se pudo obtener bitacora caratula",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")}),a.modificaTitulo=function(){a.openLoadingModal("Modificando...",""),i.actualizarInscripcion(a.parametros.caratula,a.parametros.foja,a.parametros.numero,a.parametros.ano,a.parametros.bis).then(function(b){a.closeModal(),null===b.status||(b.status?(a.raiseOk("","Se modifico titulo"),a.salirSave()):a.raiseErr("No se pudo modificar caratula",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.obtenerInscripcionBis=function(){a.openLoadingModal("Modificando...",""),i.obtenerInscripcionBis(a.parametros.caratula,a.parametros.foja,a.parametros.numero,a.parametros.ano,a.parametros.bis).then(function(b){a.closeModal(),null===b.status||(b.status?(a.raiseOk("","Se envio inscripcion BIS"),a.salirSave()):a.raiseErr("No se pudo agregar BIS a inscripcion",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.rehacerImagen=function(){var b={numeroCaratula:a.parametros.caratula,foja:a.parametros.foja,numero:a.parametros.numero,ano:a.parametros.ano,bis:a.parametros.bis};d.open({templateUrl:"rehacerImagenModal.html",backdrop:"static",keyboard:!1,windowClass:"modal",controller:"RehacerImagenModalCtrl",resolve:{dataImagen:function(){return b},servicioCertificacion:function(){return j}}})},a.openRechazoModal=function(){var b={numeroCaratula:a.parametros.caratula};d.open({templateUrl:"rechazoCertificacionModal.html",backdrop:"static",keyboard:!1,windowClass:"modal",controller:"RechazoCertificacionModalCtrl",resolve:{dataRechazo:function(){return b},origen:function(){return"certificacion"}}})},a.openComentariosModal=function(){var b={numeroCaratula:a.parametros.caratula};d.open({templateUrl:"comentariosCaratulaModal.html",backdrop:"static",keyboard:!1,windowClass:"modal",controller:"ComentariosCaratulaModalCtrl",resolve:{data:function(){return b}}})},a.openLoadingModal=function(a,b){d.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.closeModal=function(){var a=e.getTop();a&&e.dismiss(a.key)},a.certificar=function(){a.openLoadingModal("Certificando...",""),j.certificar(a.parametros.caratula,a.parametros.foja,a.parametros.numero,a.parametros.ano,a.parametros.bis,a.certificacion.tipo.codigo).then(function(b){a.closeModal(),null===b.status||(b.status?(a.raiseOk("","Certificacion realizada"),a.salirSave()):a.raiseErr("No se pudo certificar caratula",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.distribuir=function(){a.openLoadingModal("Distribuyendo...",""),j.distribuir(a.parametros.caratula,a.certificacion.tipo.codigo).then(function(b){a.closeModal(),null===b.status||(b.status?(a.raiseOk("","Distribucion realizada"),a.salirSave()):a.raiseErr("No se pudo distribuir la caratula",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.tipoCertificacion=[{codigo:8,descripcion:"C/ VIGENCIA"},{codigo:9,descripcion:"S/ VIGENCIA"},{codigo:10,descripcion:"EN PARTE"},{codigo:11,descripcion:"CV ESCRITURA"},{codigo:12,descripcion:"SV ESCRITURA"},{codigo:13,descripcion:"ERROR DE OFICINA"}];for(var k=0;k<a.tipoCertificacion.length;k++)if(a.tipoCertificacion[k].codigo==a.parametros.idtipoFormulario){a.certificacion.tipo=a.tipoCertificacion[k];break}a.raiseErr=function(b,c){a.states.isError=!0,a.states.title=b,a.states.msg=c},a.raiseOk=function(b,c){a.states.isOk=!0,a.states.title=b,a.states.msg=c},a.closeRechazo=function(){c.go("/"+a.parametros.origen)},a.salirSave=function(){g(function(){a.closeRechazo()},2e3)},a.archivoNacional=function(a){return!(a<c.aioParametros.anoArchivoNacional)},a.anoActual=function(a){return!(moment(new Date).year()<a)},a.buscar(),a.acordionIzquierda=function(b){"anotaciones"===b?(a.izquierdaStatus.anotaciones?a.izquierdaStatus.anotaciones=!1:a.izquierdaStatus.anotaciones=!0,a.izquierdaStatus.borradores=!1,a.izquierdaStatus.proceso=!1,a.izquierdaStatus.terminadas=!1):"borradores"===b?(a.izquierdaStatus.borradores?a.izquierdaStatus.borradores=!1:(a.izquierdaStatus.borradores=!0,!a.izquierdaStatus.borradoresLoaded&&a.data.contadores.borradores>0&&(a.izquierdaStatus.borradoresLoaded=!0,a.loadWidgets("borradores"))),a.izquierdaStatus.anotaciones=!1,a.izquierdaStatus.proceso=!1,a.izquierdaStatus.terminadas=!1):"proceso"===b?(a.izquierdaStatus.proceso?a.izquierdaStatus.proceso=!1:(a.izquierdaStatus.proceso=!0,!a.izquierdaStatus.procesoLoaded&&a.data.contadores.proceso>0&&(a.izquierdaStatus.procesoLoaded=!0,a.loadWidgets("enProceso"))),a.izquierdaStatus.anotaciones=!1,a.izquierdaStatus.borradores=!1,a.izquierdaStatus.terminadas=!1):"terminadas"===b&&(a.izquierdaStatus.terminadas?a.izquierdaStatus.terminadas=!1:(a.izquierdaStatus.terminadas=!0,!a.izquierdaStatus.terminadasLoaded&&a.data.contadores.terminadas>0&&(a.izquierdaStatus.terminadasLoaded=!0,a.loadWidgets("terminadas"))),a.izquierdaStatus.anotaciones=!1,a.izquierdaStatus.borradores=!1,a.izquierdaStatus.proceso=!1)},a.loadWidgets=function(b){var c,d=a.data.inscripcionDigitalDTO.foja,e=a.data.inscripcionDigitalDTO.numero,f=a.data.inscripcionDigitalDTO.ano,g=a.data.inscripcionDigitalDTO.bis;"borradores"===b?c=h.obtenerBorradores(d,e,f,g):"enProceso"===b?c=h.obtenerCaratulasPorEstado(d,e,f,g,0):"terminadas"===b&&(c=h.obtenerCaratulasPorEstado(d,e,f,g,1)),a.loaders[b].isLoading=!0,c.then(function(c){null==c.status?$window.location.href=$window.location.protocol+"//"+$window.location.host+$window.location.pathname:c.status?"borradores"===b?a.borradores=c.borradores:"enProceso"===b?a.proceso=c.caratulas:"terminadas"===b&&(a.terminadas=c.caratulas):a.loaders[b].error=!0,a.loaders[b].isLoading=!1},function(c){a.loaders[b].isLoading=!1,a.loaders[b].error=!0})},a.irGpOnlineAIO=function(a,b){d.open({templateUrl:"gpOnlineModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"gpOnlineModalCtrl",size:"lg",resolve:{borrador:function(){return parseInt(a)},folio:function(){return parseInt(b)}}})},a.verEstadoCaratula=function(a){d.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})}}]),app.controller("VerInscripcionCertificarHipoCtrl",["$scope","$routeParams","$rootScope","$modal","$modalStack","$sce","$timeout","inscripcionDigitalHipotecasService","caratulaService","certificacionHipotecasService",function(a,b,c,d,e,f,g,h,i,j){a.parametros={caratula:b.caratula,foja:b.foja,numero:b.numero,ano:b.ano,bis:b.bis,fechaDoc:b.fechaDoc,rehaceImagen:b.rehaceImagen,idtipoFormulario:b.idtipoFormulario,registro:b.registro,origen:b.origen,mostrar:null},a.states={isLoading:!1,isError:!1,isOk:!1,title:null,msg:null},a.certificacion={tipo:{}},a.anotaciones=[],a.data={},a.borradores=[],a.proceso=[],a.terminadas=[],a.izquierdaStatus={anotaciones:!0,borradores:!1,borradoresLoaded:!1,proceso:!1,procesoLoaded:!1,terminadas:!1,terminadasLoaded:!1},a.loaders={borradores:{isLoading:!1,error:!1},enProceso:{isLoading:!1,error:!1},terminadas:{isLoading:!1,error:!1},anotaciones:{isLoading:!1,error:!1}},a.derechaStatus={notasExpanded:!0},a.acordionNotas=function(){return a.derechaStatus.notasExpanded=!a.derechaStatus.notasExpanded},a.buscar=function(){a.isLoading=!0;var b=a.parametros.caratula;a.parametros.registro;a.urlPDF=f.trustAsResourceUrl("../do/service/inscripcionDigitalHipotecas?metodo=verInscripcionCertificar&caratula="+b),a.isLoading=!1,h.getInscripcion(a.parametros.foja,a.parametros.numero,a.parametros.ano,a.parametros.bis).then(function(b){null==b.status||(b.status?(a.data=b,a.inicia(),a.isLoading=!1):a.raiseErr("error","Error detectado.",b.msg)),a.isLoading=!1},function(b){a.isLoading=!1,a.raiseErr("error","Error detectado.","No se ha podido establecer comunicación.")})},a.inicia=function(){var b=!1;a.loaders.anotaciones.isLoading=!0,h.getNotas(a.parametros.foja,a.parametros.numero,a.parametros.ano,a.parametros.bis).then(function(c){null==c.status||(c.status?8===a.data.consultaDocumentoDTO.tipoDocumento&&angular.forEach(c.anotaciones,function(c){2===c.tipoAnotacionDTO.idTipoAnotacion?b=!0:3===c.tipoAnotacionDTO.idTipoAnotacion&&a.anotaciones.push(c)}):(a.raiseErr("error","Error Obteniendo Anotaciones.",c.msg),a.loaders.anotaciones.error=!0)),a.loaders.anotaciones.isLoading=!1},function(b){a.loaders.anotaciones.isLoading=!1,a.loaders.anotaciones.error=!0,a.raiseErr("error","Error detectado.","No se ha podido establecer comunicación.")}),"jbelmar"==a.userLoginSinCBRS&&a.data.inscripcionDigitalDTO.ano<c.aioParametros.anoDigitalHipotecas?a.parametros.rehaceImagen="1":!b&&a.data.estado.rehacerImagen&&a.data.inscripcionDigitalDTO.ano<c.aioParametros.anoDigitalHipotecas?a.parametros.rehaceImagen="1":a.parametros.rehaceImagen="0",a.parametros.mostrar=a.parametros.rehaceImagen},a.cerrar=function(){c.go("/"+a.parametros.origen)},a.caratula={resultados:[]},i.obtenerBitacoraCaratula(a.parametros.caratula).then(function(b){null===b.status||(b.status?(a.caratula.resultados=b.listabitacoras,a.status=b.status,0!==a.caratula.resultados.length&&a.openComentariosModal()):a.raiseErr("No se pudo obtener bitacora caratula",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")}),a.modificaTitulo=function(){a.openLoadingModal("Modificando...",""),i.actualizarInscripcion(a.parametros.caratula,a.parametros.foja,a.parametros.numero,a.parametros.ano,a.parametros.bis).then(function(b){a.closeModal(),null===b.status||(b.status?(a.raiseOk("","Se modifico titulo"),a.salirSave()):a.raiseErr("No se pudo modificar caratula",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.obtenerInscripcionBis=function(){a.openLoadingModal("Modificando...",""),i.obtenerInscripcionBis(a.parametros.caratula,a.parametros.foja,a.parametros.numero,a.parametros.ano,a.parametros.bis).then(function(b){a.closeModal(),null===b.status||(b.status?(a.raiseOk("","Se envio inscripcion BIS"),a.salirSave()):a.raiseErr("No se pudo agregar BIS a inscripcion",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.rehacerImagen=function(){var b={numeroCaratula:a.parametros.caratula,foja:a.parametros.foja,numero:a.parametros.numero,ano:a.parametros.ano,bis:a.parametros.bis};d.open({templateUrl:"rehacerImagenModal.html",backdrop:"static",keyboard:!1,windowClass:"modal",controller:"RehacerImagenModalCtrl",resolve:{dataImagen:function(){return b},servicioCertificacion:function(){return j}}})},a.openRechazoModal=function(){var b={numeroCaratula:a.parametros.caratula};d.open({templateUrl:"rechazoCertificacionModal.html",backdrop:"static",keyboard:!1,windowClass:"modal",controller:"RechazoCertificacionModalCtrl",resolve:{dataRechazo:function(){return b},origen:function(){return"certificacion"}}})},a.openComentariosModal=function(){var b={numeroCaratula:a.parametros.caratula};d.open({templateUrl:"comentariosCaratulaModal.html",backdrop:"static",keyboard:!1,windowClass:"modal",controller:"ComentariosCaratulaModalCtrl",resolve:{data:function(){return b}}})},a.openLoadingModal=function(a,b){d.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.closeModal=function(){var a=e.getTop();a&&e.dismiss(a.key)},a.certificar=function(){a.openLoadingModal("Certificando...",""),j.certificar(a.parametros.caratula,a.parametros.foja,a.parametros.numero,a.parametros.ano,a.parametros.bis,a.certificacion.tipo.codigo).then(function(b){a.closeModal(),null===b.status||(b.status?(a.raiseOk("","Certificacion realizada"),a.salirSave()):a.raiseErr("No se pudo certificar caratula",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.distribuir=function(){a.openLoadingModal("Distribuyendo...",""),j.distribuir(a.parametros.caratula,a.certificacion.tipo.codigo).then(function(b){a.closeModal(),null===b.status||(b.status?(a.raiseOk("","Distribucion realizada"),a.salirSave()):a.raiseErr("No se pudo distribuir la caratula",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.tipoCertificacion=[{codigo:8,descripcion:"C/ VIGENCIA"},{codigo:9,descripcion:"S/ VIGENCIA"},{codigo:10,descripcion:"EN PARTE"},{codigo:11,descripcion:"CV ESCRITURA"},{codigo:12,descripcion:"SV ESCRITURA"},{codigo:13,descripcion:"ERROR DE OFICINA"}];for(var k=0;k<a.tipoCertificacion.length;k++)if(a.tipoCertificacion[k].codigo==a.parametros.idtipoFormulario){a.certificacion.tipo=a.tipoCertificacion[k];break}a.raiseErr=function(b,c){a.states.isError=!0,a.states.title=b,a.states.msg=c},a.raiseOk=function(b,c){a.states.isOk=!0,a.states.title=b,a.states.msg=c},a.closeRechazo=function(){c.go("/"+a.parametros.origen)},a.salirSave=function(){g(function(){a.closeRechazo()},2e3)},a.archivoNacional=function(a){return!(a<c.aioParametros.anoArchivoNacional)},a.anoActual=function(a){return!(moment(new Date).year()<a)},a.buscar(),a.acordionIzquierda=function(b){"anotaciones"===b?(a.izquierdaStatus.anotaciones?a.izquierdaStatus.anotaciones=!1:a.izquierdaStatus.anotaciones=!0,a.izquierdaStatus.borradores=!1,a.izquierdaStatus.proceso=!1,a.izquierdaStatus.terminadas=!1):"borradores"===b?(a.izquierdaStatus.borradores?a.izquierdaStatus.borradores=!1:(a.izquierdaStatus.borradores=!0,!a.izquierdaStatus.borradoresLoaded&&a.data.contadores.borradores>0&&(a.izquierdaStatus.borradoresLoaded=!0,a.loadWidgets("borradores"))),a.izquierdaStatus.anotaciones=!1,a.izquierdaStatus.proceso=!1,a.izquierdaStatus.terminadas=!1):"proceso"===b?(a.izquierdaStatus.proceso?a.izquierdaStatus.proceso=!1:(a.izquierdaStatus.proceso=!0,!a.izquierdaStatus.procesoLoaded&&a.data.contadores.proceso>0&&(a.izquierdaStatus.procesoLoaded=!0,a.loadWidgets("enProceso"))),a.izquierdaStatus.anotaciones=!1,a.izquierdaStatus.borradores=!1,a.izquierdaStatus.terminadas=!1):"terminadas"===b&&(a.izquierdaStatus.terminadas?a.izquierdaStatus.terminadas=!1:(a.izquierdaStatus.terminadas=!0,!a.izquierdaStatus.terminadasLoaded&&a.data.contadores.terminadas>0&&(a.izquierdaStatus.terminadasLoaded=!0,a.loadWidgets("terminadas"))),a.izquierdaStatus.anotaciones=!1,a.izquierdaStatus.borradores=!1,a.izquierdaStatus.proceso=!1)},a.loadWidgets=function(b){var c,d=a.data.inscripcionDigitalDTO.foja,e=a.data.inscripcionDigitalDTO.numero,f=a.data.inscripcionDigitalDTO.ano,g=a.data.inscripcionDigitalDTO.bis;"borradores"===b?c=inscripcionDigitalService.obtenerBorradores(d,e,f,g):"enProceso"===b?c=inscripcionDigitalService.obtenerCaratulasPorEstado(d,e,f,g,0):"terminadas"===b&&(c=inscripcionDigitalService.obtenerCaratulasPorEstado(d,e,f,g,1)),a.loaders[b].isLoading=!0,c.then(function(c){null==c.status?$window.location.href=$window.location.protocol+"//"+$window.location.host+$window.location.pathname:c.status?"borradores"===b?a.borradores=c.borradores:"enProceso"===b?a.proceso=c.caratulas:"terminadas"===b&&(a.terminadas=c.caratulas):a.loaders[b].error=!0,a.loaders[b].isLoading=!1},function(c){a.loaders[b].isLoading=!1,a.loaders[b].error=!0})},a.irGpOnlineAIO=function(a,b){d.open({templateUrl:"gpOnlineModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"gpOnlineModalCtrl",size:"lg",resolve:{borrador:function(){return parseInt(a)},folio:function(){return parseInt(b)}}})},a.verEstadoCaratula=function(a){d.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})}}]),app.controller("VerInscripcionCertificarProhCtrl",["$scope","$routeParams","$rootScope","$modal","$modalStack","$sce","$timeout","inscripcionDigitalProhibicionesService","caratulaService","certificacionProhibicionesService",function(a,b,c,d,e,f,g,h,i,j){a.parametros={caratula:b.caratula,foja:b.foja,numero:b.numero,ano:b.ano,bis:b.bis,fechaDoc:b.fechaDoc,rehaceImagen:b.rehaceImagen,idtipoFormulario:b.idtipoFormulario,registro:b.registro,origen:b.origen,mostrar:null},a.states={isLoading:!1,isError:!1,isOk:!1,title:null,msg:null},a.certificacion={tipo:{}},a.anotaciones=[],a.data={},a.borradores=[],a.proceso=[],a.terminadas=[],a.izquierdaStatus={anotaciones:!0,borradores:!1,borradoresLoaded:!1,proceso:!1,procesoLoaded:!1,terminadas:!1,terminadasLoaded:!1},a.loaders={borradores:{isLoading:!1,error:!1},enProceso:{isLoading:!1,error:!1},terminadas:{isLoading:!1,error:!1},anotaciones:{isLoading:!1,error:!1}},a.derechaStatus={notasExpanded:!0},a.acordionNotas=function(){return a.derechaStatus.notasExpanded=!a.derechaStatus.notasExpanded},a.buscar=function(){a.isLoading=!0;var b=a.parametros.caratula;a.parametros.registro;a.urlPDF=f.trustAsResourceUrl("../do/service/inscripcionDigitalProhibiciones?metodo=verInscripcionCertificar&caratula="+b),a.isLoading=!1,h.getInscripcion(a.parametros.foja,a.parametros.numero,a.parametros.ano,a.parametros.bis).then(function(b){null==b.status||(b.status?(a.data=b,a.inicia(),a.isLoading=!1):a.raiseErr("error","Error detectado.",b.msg)),a.isLoading=!1},function(b){a.isLoading=!1,a.raiseErr("error","Error detectado.","No se ha podido establecer comunicación.")})},a.inicia=function(){var b=!1;a.loaders.anotaciones.isLoading=!0,h.getNotas(a.parametros.foja,a.parametros.numero,a.parametros.ano,a.parametros.bis).then(function(c){null==c.status||(c.status?8===a.data.consultaDocumentoDTO.tipoDocumento&&angular.forEach(c.anotaciones,function(c){2===c.tipoAnotacionDTO.idTipoAnotacion?b=!0:3===c.tipoAnotacionDTO.idTipoAnotacion&&a.anotaciones.push(c)}):(a.raiseErr("error","Error Obteniendo Anotaciones.",c.msg),a.loaders.anotaciones.error=!0)),a.loaders.anotaciones.isLoading=!1},function(b){a.loaders.anotaciones.isLoading=!1,a.loaders.anotaciones.error=!0,a.raiseErr("error","Error detectado.","No se ha podido establecer comunicación.")}),"fzarzar"==a.userLoginSinCBRS&&a.data.inscripcionDigitalDTO.ano<c.aioParametros.anoDigitalProhibiciones?a.parametros.rehaceImagen="1":!b&&a.data.estado.rehacerImagen&&a.data.inscripcionDigitalDTO.ano<c.aioParametros.anoDigitalProhibiciones?a.parametros.rehaceImagen="1":a.parametros.rehaceImagen="0",a.parametros.mostrar=a.parametros.rehaceImagen},a.cerrar=function(){c.go("/"+a.parametros.origen)},a.caratula={resultados:[]},i.obtenerBitacoraCaratula(a.parametros.caratula).then(function(b){null===b.status||(b.status?(a.caratula.resultados=b.listabitacoras,a.status=b.status,0!==a.caratula.resultados.length&&a.openComentariosModal()):a.raiseErr("No se pudo obtener bitacora caratula",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")}),a.modificaTitulo=function(){a.openLoadingModal("Modificando...",""),i.actualizarInscripcion(a.parametros.caratula,a.parametros.foja,a.parametros.numero,a.parametros.ano,a.parametros.bis).then(function(b){a.closeModal(),null===b.status||(b.status?(a.raiseOk("","Se modifico titulo"),a.salirSave()):a.raiseErr("No se pudo modificar caratula",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.obtenerInscripcionBis=function(){a.openLoadingModal("Modificando...",""),i.obtenerInscripcionBis(a.parametros.caratula,a.parametros.foja,a.parametros.numero,a.parametros.ano,a.parametros.bis).then(function(b){a.closeModal(),null===b.status||(b.status?(a.raiseOk("","Se envio inscripcion BIS"),a.salirSave()):a.raiseErr("No se pudo agregar BIS a inscripcion",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.rehacerImagen=function(){var b={numeroCaratula:a.parametros.caratula,foja:a.parametros.foja,numero:a.parametros.numero,ano:a.parametros.ano,bis:a.parametros.bis};d.open({templateUrl:"rehacerImagenModal.html",backdrop:"static",keyboard:!1,windowClass:"modal",controller:"RehacerImagenModalCtrl",resolve:{dataImagen:function(){return b},servicioCertificacion:function(){return j}}})},a.openRechazoModal=function(){var b={numeroCaratula:a.parametros.caratula};d.open({templateUrl:"rechazoCertificacionModal.html",backdrop:"static",keyboard:!1,windowClass:"modal",controller:"RechazoCertificacionModalCtrl",resolve:{dataRechazo:function(){return b},origen:function(){return"certificacion"}}})},a.openComentariosModal=function(){var b={numeroCaratula:a.parametros.caratula};d.open({templateUrl:"comentariosCaratulaModal.html",backdrop:"static",keyboard:!1,windowClass:"modal",controller:"ComentariosCaratulaModalCtrl",resolve:{data:function(){return b}}})},a.openLoadingModal=function(a,b){d.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.closeModal=function(){var a=e.getTop();a&&e.dismiss(a.key)},a.certificar=function(){a.openLoadingModal("Certificando...",""),j.certificar(a.parametros.caratula,a.parametros.foja,a.parametros.numero,a.parametros.ano,a.parametros.bis,a.certificacion.tipo.codigo).then(function(b){a.closeModal(),null===b.status||(b.status?(a.raiseOk("","Certificacion realizada"),a.salirSave()):a.raiseErr("No se pudo certificar caratula",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.distribuir=function(){a.openLoadingModal("Distribuyendo...",""),j.distribuir(a.parametros.caratula,a.certificacion.tipo.codigo).then(function(b){a.closeModal(),null===b.status||(b.status?(a.raiseOk("","Distribucion realizada"),a.salirSave()):a.raiseErr("No se pudo distribuir la caratula",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.tipoCertificacion=[{codigo:8,descripcion:"C/ VIGENCIA"},{codigo:9,descripcion:"S/ VIGENCIA"},{codigo:10,descripcion:"EN PARTE"},{codigo:11,descripcion:"CV ESCRITURA"},{codigo:12,descripcion:"SV ESCRITURA"},{codigo:13,descripcion:"ERROR DE OFICINA"}];for(var k=0;k<a.tipoCertificacion.length;k++)if(a.tipoCertificacion[k].codigo==a.parametros.idtipoFormulario){a.certificacion.tipo=a.tipoCertificacion[k];break}a.raiseErr=function(b,c){a.states.isError=!0,a.states.title=b,a.states.msg=c},a.raiseOk=function(b,c){a.states.isOk=!0,a.states.title=b,a.states.msg=c},a.closeRechazo=function(){c.go("/"+a.parametros.origen)},a.salirSave=function(){g(function(){a.closeRechazo()},2e3)},a.archivoNacional=function(a){return!(a<c.aioParametros.anoArchivoNacional)},a.anoActual=function(a){return!(moment(new Date).year()<a)},a.buscar(),a.acordionIzquierda=function(b){"anotaciones"===b?(a.izquierdaStatus.anotaciones?a.izquierdaStatus.anotaciones=!1:a.izquierdaStatus.anotaciones=!0,a.izquierdaStatus.borradores=!1,a.izquierdaStatus.proceso=!1,a.izquierdaStatus.terminadas=!1):"borradores"===b?(a.izquierdaStatus.borradores?a.izquierdaStatus.borradores=!1:(a.izquierdaStatus.borradores=!0,!a.izquierdaStatus.borradoresLoaded&&a.data.contadores.borradores>0&&(a.izquierdaStatus.borradoresLoaded=!0,a.loadWidgets("borradores"))),a.izquierdaStatus.anotaciones=!1,a.izquierdaStatus.proceso=!1,a.izquierdaStatus.terminadas=!1):"proceso"===b?(a.izquierdaStatus.proceso?a.izquierdaStatus.proceso=!1:(a.izquierdaStatus.proceso=!0,!a.izquierdaStatus.procesoLoaded&&a.data.contadores.proceso>0&&(a.izquierdaStatus.procesoLoaded=!0,a.loadWidgets("enProceso"))),a.izquierdaStatus.anotaciones=!1,a.izquierdaStatus.borradores=!1,a.izquierdaStatus.terminadas=!1):"terminadas"===b&&(a.izquierdaStatus.terminadas?a.izquierdaStatus.terminadas=!1:(a.izquierdaStatus.terminadas=!0,!a.izquierdaStatus.terminadasLoaded&&a.data.contadores.terminadas>0&&(a.izquierdaStatus.terminadasLoaded=!0,a.loadWidgets("terminadas"))),a.izquierdaStatus.anotaciones=!1,a.izquierdaStatus.borradores=!1,a.izquierdaStatus.proceso=!1)},a.loadWidgets=function(b){var c,d=a.data.inscripcionDigitalDTO.foja,e=a.data.inscripcionDigitalDTO.numero,f=a.data.inscripcionDigitalDTO.ano,g=a.data.inscripcionDigitalDTO.bis;"borradores"===b?c=h.obtenerBorradores(d,e,f,g):"enProceso"===b?c=h.obtenerCaratulasPorEstado(d,e,f,g,0):"terminadas"===b&&(c=h.obtenerCaratulasPorEstado(d,e,f,g,1)),a.loaders[b].isLoading=!0,c.then(function(c){null==c.status?$window.location.href=$window.location.protocol+"//"+$window.location.host+$window.location.pathname:c.status?"borradores"===b?a.borradores=c.borradores:"enProceso"===b?a.proceso=c.caratulas:"terminadas"===b&&(a.terminadas=c.caratulas):a.loaders[b].error=!0,a.loaders[b].isLoading=!1},function(c){a.loaders[b].isLoading=!1,a.loaders[b].error=!0})},a.irGpOnlineAIO=function(a,b){d.open({templateUrl:"gpOnlineModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"gpOnlineModalCtrl",size:"lg",resolve:{borrador:function(){return parseInt(a)},folio:function(){return parseInt(b)}}})},a.verEstadoCaratula=function(a){d.open({templateUrl:"estadoIndiceModal.html",backdrop:"static",windowClass:"modal modal-dialog-xl",controller:"EstadoIndiceModalCtrl",size:"lg",resolve:{numeroCaratula:function(){return parseInt(a)}}})}}]),app.controller("VerInscripcionRegCtrl",["$scope","$routeParams","$rootScope","$sce","$modal","$timeout","$filter","indiceService","gponlineService",function($scope,$routeParams,$rootScope,$sce,$modal,$timeout,$filter,indiceService,gponlineService){$scope.parametros={foja:$routeParams.foja,numero:$routeParams.numero,agno:$routeParams.ano,bis:$routeParams.bis,registro:$routeParams.registro,origen:$routeParams.origen},$scope.raiseErr=function(a,b,c){$scope.errorObj.hay=!0,$scope.errorObj.level=a,$scope.errorObj.title=b,$scope.errorObj.msg=c},$scope.errorObj={hay:!1,level:"warning",title:"",msg:""},$scope.loaders={titulosanteriores:{isLoading:!1,error:!1}},$scope.filaTicketMasivo={foja:null,num:null,ano:null},$scope.titulos=[],$scope.buscar=function(){$scope.isLoading=!0;var a=$scope.parametros.foja,b=$scope.parametros.numero,c=$scope.parametros.agno,d=$scope.parametros.bis,e=$scope.parametros.registro;$scope.urlPDF=$sce.trustAsResourceUrl("../do/service/inscripcionDigital?metodo=verDocumentoReg&foja="+a+"&numero="+b+"&ano="+c+"&bis="+d+"&registro="+e),$scope.isLoading=!1,$scope.titulosanteriores()},$scope.cerrar=function(){$rootScope.go("/"+$scope.parametros.origen)},$scope.openSolicitar=function(a,b){var c=null,d=null,e=null;c=a.foja,d=a.numero,e=a.agno;$modal.open({templateUrl:"indiceModal.html",backdrop:!0,windowClass:"modal",controller:"IndiceModalCtrl",resolve:{resolveModal:function(){return $scope.resolveModal},foja:function(){return c},numero:function(){return d},ano:function(){return e},registro:function(){return b},indice:function(){return a},origen:function(){return"indice"},titulos:function(){return""}}})},$scope.ticket=function(a,b){var c,d,e=null,f=null,g=null,h=null,i=null;e=a.foja,f=a.numero,g=a.agno,h="false",c=a.registro,"hip"==b?(i=indiceService.getIndicePropiedades(null,null,null,e,f,g,h,null,null,null,null,null,!1,!0,!1,!1,!0,null,null),i.then(function(a){if(null===a.status);else if(a.status){for(var b in a.aaDataHipotecas){d=a.aaDataHipotecas[b];break}$modal.open({templateUrl:"TicketInformacion.html",backdrop:!0,windowClass:"modal",controller:"TicketInformacionCtrl",resolve:{resolveModal:function(){return $scope.resolveModal},foja:function(){return e},numero:function(){return f},ano:function(){return g},nombre:function(){return d.nombre},direccion:function(){return d.dir},comuna:function(){return d.comuna},registro:function(){return c},titulos:function(){return""}}})}else $scope.raiseErr("buscar","Problema detectado",a.msg)},function(a){$scope.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})):"proh"==b?(i=indiceService.getIndicePropiedades(null,null,null,e,f,g,h,null,null,null,null,null,!1,!1,!0,!1,null,!0,null),i.then(function(a){if(null===a.status);else if(a.status){for(var b in a.aaDataProhibiciones){d=a.aaDataProhibiciones[b];break}$modal.open({templateUrl:"TicketInformacion.html",backdrop:!0,windowClass:"modal",controller:"TicketInformacionCtrl",resolve:{resolveModal:function(){return $scope.resolveModal},foja:function(){return e},numero:function(){return f},ano:function(){return g},nombre:function(){return d.nombre},direccion:function(){return d.dir},comuna:function(){return d.comuna},registro:function(){return c},titulos:function(){return""}}})}else $scope.raiseErr("buscar","Problema detectado",a.msg)},function(a){$scope.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})):"com"==b&&(i=indiceService.getIndicePropiedades(null,null,null,e,f,g,h,null,null,null,null,null,!1,!1,!1,!0,null,null,null),i.then(function(a){if(null===a.status);else if(a.status){for(var b in a.aaDataComercio){d=a.aaDataComercio[b];break}$modal.open({templateUrl:"TicketInformacion.html",backdrop:!0,windowClass:"modal",controller:"TicketInformacionCtrl",resolve:{resolveModal:function(){return $scope.resolveModal},foja:function(){return e},numero:function(){return f},ano:function(){return g},nombre:function(){return d.nombreSociedad},direccion:function(){return d.dir},comuna:function(){return d.comuna},registro:function(){return c},titulos:function(){return""}}})}else $scope.raiseErr("buscar","Problema detectado",a.msg)},function(a){$scope.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")}))},$scope.addRow=function(){$scope.titulos.push({foja:$scope.foja,numero:$scope.numero,anio:$scope.anio,vigente:!1,id:$scope.titulos.length+1})},$scope.removeRow=function(name){for(var index=-1,comArr=eval($scope.titulos),i=0;i<comArr.length;i++)if(comArr[i]===name){index=i;break}-1===index&&alert("algo ocurrio"),$scope.titulos.splice(index,1)},$scope.verInscripcionDesdePreCaratula=function(a){$rootScope.go("/verInscripcionReg/"+$scope.parametros.registro+"/"+a.foja+"/"+a.numero+"/"+a.anio+"/"+!1+"/"+$scope.parametros.origen)},$scope.ticketMasiva=function(a){var b=null;$scope.titulosTicketMasivo=[];var c=$filter("orderBy"),d=0;if("com"==a){for(var e in $scope.titulos){var f=$scope.titulos[e],g=indiceService.getIndicePropiedades(null,null,null,f.foja,f.numero,f.anio,f.bis,null,null,null,null,null,!1,!1,!1,!0,null,null,null);g.then(function(a){if(null===a.status);else if(a.status){for(var c in a.aaDataComercio){b=a.aaDataComercio[c];break}$scope.titulosTicketMasivo[d]=b,d++}else $scope.raiseErr("buscar","Problema detectado",a.msg)},function(a){$scope.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})}$timeout(function(){$modal.open({templateUrl:"TicketInformacion.html",backdrop:!0,windowClass:"modal",controller:"TicketInformacionCtrl",resolve:{resolveModal:function(){return $scope.resolveModal},foja:function(){return""},numero:function(){return""},ano:function(){return""},nombre:function(){return""},direccion:function(){return""},comuna:function(){return""},registro:function(){return a},titulos:function(){return $scope.titulosTicketMasivo}}})},2e3)}else if("hip"==a){for(var h in $scope.titulos)$scope.titulos[h].Selected&&($scope.fila=angular.copy($scope.filaTicketMasivo),$scope.fila.foja=$scope.titulos[h].foja,$scope.fila.num=$scope.titulos[h].numero,$scope.fila.ano=$scope.titulos[h].anio,$scope.titulosTicketMasivo[h]=$scope.fila);$timeout(function(){$modal.open({templateUrl:"TicketInformacion.html",backdrop:!0,windowClass:"modal",controller:"TicketInformacionCtrl",resolve:{resolveModal:function(){return $scope.resolveModal},foja:function(){return""},numero:function(){return""},ano:function(){return""},nombre:function(){return""},direccion:function(){return""},comuna:function(){return""},registro:function(){return a},titulos:function(){return c($scope.titulosTicketMasivo,"-ano",!0)}}})},2e3)}else if("proh"==a){for(var h in $scope.titulos)$scope.titulos[h].Selected&&($scope.fila=angular.copy($scope.filaTicketMasivo),$scope.fila.foja=$scope.titulos[h].foja,$scope.fila.num=$scope.titulos[h].numero,$scope.fila.ano=$scope.titulos[h].anio,$scope.titulosTicketMasivo[h]=$scope.fila);$timeout(function(){$modal.open({templateUrl:"TicketInformacion.html",backdrop:!0,windowClass:"modal",controller:"TicketInformacionCtrl",resolve:{resolveModal:function(){return $scope.resolveModal},foja:function(){return""},numero:function(){return""},ano:function(){return""},nombre:function(){return""},direccion:function(){return""},comuna:function(){return""},registro:function(){return a},titulos:function(){return c($scope.titulosTicketMasivo,"-ano",!1)}}})},2e3)}else{for(var e in $scope.titulos){var f=$scope.titulos[e],g=indiceService.getIndicePropiedades(null,null,null,f.foja,f.numero,f.anio,f.bis,null,null,null,null,null,!0,!1,!1,!1,!1,null,null);g.then(function(a){if(null===a.status);else if(a.status){for(var c in a.aaData){b=a.aaData[c];break}$scope.titulosTicketMasivo[d]=b,d++}else $scope.raiseErr("buscar","Problema detectado",a.msg)},function(a){$scope.raiseErr("buscar","Problema detectado","No se ha podido establecer comunicación con el servidor.")})}$timeout(function(){$modal.open({templateUrl:"TicketInformacion.html",backdrop:!0,windowClass:"modal",controller:"TicketInformacionCtrl",resolve:{resolveModal:function(){return $scope.resolveModal},foja:function(){return""},numero:function(){return""},ano:function(){return""},nombre:function(){return""},direccion:function(){return""},comuna:function(){return""},registro:function(){return a},titulos:function(){return c($scope.titulosTicketMasivo,"-ano",!0)}}})},2e3)}},$scope.solicitarPreCaratulaMasiva=function(a){$scope.titulosMasivo=[],angular.forEach($scope.titulos,function(a){a.Selected&&$scope.titulosMasivo.push(a)});var b=$filter("orderBy");$scope.titulosMasivo=b($scope.titulosMasivo,"-anio",!1);$modal.open({templateUrl:"indiceModal.html",backdrop:!0,windowClass:"modal",controller:"IndiceModalCtrl",resolve:{resolveModal:function(){return $scope.resolveModal},foja:function(){return""},numero:function(){return""},ano:function(){return""},registro:function(){return a},indice:function(){return""},origen:function(){return"verinscripcionReg"},titulos:function(){return $scope.titulosMasivo}}})},$scope.archivoNacional=function(a){return!(a<$rootScope.aioParametros.anoArchivoNacional)},$scope.anoActual=function(a){return!(moment(new Date).year()<a)},$scope.checkAll=function(){$scope.selectedAll?$scope.selectedAll=!1:$scope.selectedAll=!0,angular.forEach($scope.titulos,function(a){a.vigente||(a.Selected=$scope.selectedAll)})},$scope.titulosanteriores=function(){var a=$scope.parametros.foja,b=$scope.parametros.numero,c=$scope.parametros.agno,d=$scope.parametros.bis,e=$scope.parametros.registro;$scope.titulos=[],$scope.data=[],$scope.loaders.titulosanteriores.isLoading=!0,gponlineService.buscarBorradorPorInscripcionRegistro(a,b,c,d,e).then(function(a){if(null===a.status);else if(a.status){if("hip"==$scope.parametros.registro?($scope.totalTitulosAnteriores=a.hipotecasVigentes.length,$scope.data=a.hipotecasVigentes):"proh"==$scope.parametros.registro&&($scope.totalTitulosAnteriores=a.prohibicionesVigentes.length,$scope.data=a.prohibicionesVigentes),$scope.data.length>0)for(var b=0;b<$scope.data.length;b++)$scope.data[b].vigente?$scope.titulos.push({Selected:!0,foja:$scope.data[b].fojas,numero:$scope.data[b].numero,anio:$scope.data[b].anyo,vigente:$scope.data[b].vigente,id:$scope.titulos.length+1}):$scope.titulos.push({Selected:!1,foja:$scope.data[b].fojas,numero:$scope.data[b].numero,anio:$scope.data[b].anyo,vigente:$scope.data[b].vigente,id:$scope.titulos.length+1});else $scope.titulos.push({Selected:!0,foja:$scope.foja,numero:$scope.numero,anio:$scope.anio,vigente:!1,id:"1"});$scope.loaders.titulosanteriores.isLoading=!1}else $scope.raiseErr("borrador","Problema Detectado",a.msg),$scope.loaders.titulosanteriores.error=!0,$scope.loaders.titulosanteriores.isLoading=!1,$scope.titulos.push({Selected:!0,foja:$scope.foja,numero:$scope.numero,anio:$scope.anio,vigente:!1,id:"1"})},function(a){$scope.raiseErr("borrador","Problema Detectado",data.msg),$scope.loaders.titulosanteriores.isLoading=!1,$scope.loaders.titulosanteriores.error=!0,$scope.titulos.push({Selected:!0,foja:$scope.foja,numero:$scope.numero,anio:$scope.anio,vigente:!1,id:"1"})})},$scope.buscar()}]),app.controller("VerVistaPreviaPlantillaCtrl",["$scope","$routeParams","$rootScope","$modal","$modalStack","$sce","$timeout","certificacionService",function(a,b,c,d,e,f,g,h){a.parametros={caratula:b.caratula,prefijo:b.prefijo,origen:b.origen},a.states={isLoading:!1,isError:!1,isOk:!1,title:null,msg:null},a.buscar=function(){a.isLoading=!0;var b=a.parametros.caratula,c=a.parametros.prefijo;a.urlPDF=f.trustAsResourceUrl("../do/service/inscripcionDigital?metodo=verCertificadoPlantilla&caratula="+b+"&prefijo="+c),a.isLoading=!1},a.cerrar=function(){c.go("/"+a.parametros.origen)},a.openLoadingModal=function(a,b){d.open({templateUrl:"loadingModal.html",backdrop:"static",keyboard:!1,size:"sm",windowClass:"modal",controller:"LoadingModalCtrl",resolve:{titulo:function(){return a},detalle:function(){return b}}})},a.closeModal=function(){var a=e.getTop();a&&e.dismiss(a.key)},a.certificar=function(){a.openLoadingModal("Certificando...",""),h.certificarvistapreviaplantilla(a.parametros.caratula,a.parametros.prefijo).then(function(b){a.closeModal(),null===b.status||(b.status?(a.raiseOk("","Certificacion realizada"),a.salirSave()):a.raiseErr("No se pudo certificar caratula",b.msg))},function(b){a.raiseErr("Problema detectado","No se ha podido establecer comunicación con el servidor.")})},a.raiseErr=function(b,c){a.states.isError=!0,a.states.title=b,a.states.msg=c},a.raiseOk=function(b,c){a.states.isOk=!0,a.states.title=b,a.states.msg=c},a.salirSave=function(){g(function(){a.cerrar()},2e3)},a.buscar()}]),app.directive("anexosDatatable",function(){return function(a,b,c){c.anexosDatatable.length>0&&a.$eval(c.anexosDatatable),$(".dataTables_wrapper .toolbar").prepend('<div style="color:red; font-weight:bold">Toolbar insert</div>'),a.$watch(c.aaData,function(b){(b||null)&&(dataTable.fnClearTable(),dataTable.fnAddData(a.$eval(c.aaData)))})}}),app.directive("autocomplete",["$timeout",function(a){return function(b,c,d){c.autocomplete({source:function(a,c){c(b.$eval(d.uiItems))},select:function(b,d){a(function(){c.trigger("input")},0)}}).data("ui-autocomplete")._renderItem=function(a,b){return $("<li></li>").data("item.autocomplete",b).append("<a>"+b.label+"</a>").appendTo(a)}}}]),app.directive("bnLazySrc",function(){return{link:function(a,b,c,d){a.$last&&setTimeout(function(){new Blazy({container:".DV-doc",success:function(a){var b=$(a).data("page");$("#np"+b).fadeOut("fast",function(){$("#np"+b).html("Pág. "+b),$("#np"+b).fadeIn(),$.waypoints("refresh")})},error:function(a){var b=$(a).data("page");$("#np"+b).fadeOut("fast",function(){$("#np"+b).html('<i class="fa fa-warning"></i> Problema cargando pág. '+b),$("#np"+b).fadeIn(),$(a).attr("src","../app/images/error-placeholder.png"),$.waypoints("refresh")})}})},1e3)}}}),app.directive("confirmDelete",["$modal","$parse",function(a,b){return{restrict:"EA",link:function(c,d,e){if(e.do){var f=e.confirmButtonText?e.confirmButtonText:"OK",g=e.cancelButtonText?e.cancelButtonText:"Cancel";d.click(function(){var d=b(e.do);if(e.confirmIf){if(!b(e.confirmIf)(c))return d(c),void c.$apply()}a.open({template:'<div class="modal-body">'+e.confirm+'</div><div class="modal-footer"><button type="button" class="btn btn-default btn-naitsirch-confirm pull-right" ng-click="$close(\'ok\')">'+f+'</button><button type="button" class="btn btn-default btn-naitsirch-cancel pull-right" ng-click="$dismiss(\'cancel\')">'+g+"</button></div>"}).result.then(function(){d(c)})})}}}}]),app.directive("dvBotonPage",function(){return{require:"ngModel",link:function(a,b,c,d){b.on("click",function(){var c=$(b).data("direccion"),e=$(b).data("total"),f=parseInt(d.$viewValue),g=0;!isNaN(f)&&f>0&&("atras"==c?g=f>1&&f<=e?f-1:1:"siguiente"==c?g=f>=1&&f<e?f+1:e:"final"==c?g=e:"inicio"==c&&(g=1),$("#np"+g).length>0&&($("#hp"+g)[0].scrollIntoView(!0),setTimeout(function(){d.$setViewValue(g),d.$render(),a.$apply()},100)))})}}}),app.directive("dvCurrentPage",function(){return{require:"ngModel",link:function(a,b,c,d){b.on("keyup",function(){setTimeout(function(){var b=parseInt(d.$viewValue);!isNaN(b)&&b>0&&(0==$("#np"+b).length?($("#np1")[0].scrollIntoView(!0),setTimeout(function(){d.$setViewValue("1"),d.$render(),a.$apply()},300)):($("#np"+b)[0].scrollIntoView(!0),setTimeout(function(){d.$setViewValue(b+""),d.$render(),a.$apply()},300)))},500)})}}}),app.directive("enterNext",function(){return{restrict:"A",link:function(a,b,c){b.bind("keydown",function(a){if(13===(a.keyCode||a.which)){a.preventDefault();var b=$("input:input, select").index(document.activeElement)+1;void 0!==$("input:input, select")[b].focus&&$("input:input, select")[b].focus(),void 0!==$("input:input, select")[b].select&&$("input:input, select")[b].select()}})}}}),app.directive("estadoIndice",function(){return{restrict:"E",replace:!0,transclude:!0,controller:"EstadoCtrl",templateUrl:"views/estado.html",link:function(a,b,c){a.req.numeroCaratula=c.numeroCaratula,a.req.simpleMode=c.simpleMode,a.buscar()}}}),app.directive("focusInput",function(){return function(a,b,c){a.$on(c.focusInput,function(a,c){var d=b[0].nodeName.toLowerCase();b[0].focus(),"input"!=d&&"textarea"!=d&&"select"!=d||b[0].select()})}}),app.directive("gpOnline",function(){return{restrict:"E",replace:!1,transclude:!0,controller:"GponlineCtrl",templateUrl:"views/gponline.html",link:function(a,b,c){a.busquedaGponline.borrador=c.borrador,a.busquedaGponline.folio=c.folio,a.req.simpleMode=c.simpleMode,a.buscarPorBorrador()}}}),app.directive("loadingState",function(){return{link:function(a,b,c){a.$watch(function(){return a.$eval(c.loadingState)},function(a){a?(b.hasClass("disabled")||b.addClass("disabled").attr("disabled","disabled"),b.data("resetText",b.html()),b.html(b.data("loading-text"))):(b.hasClass("disabled")&&b.removeClass("disabled").removeAttr("disabled"),b.html(b.data("resetText")))})}}}),app.directive("myLoad",function(){return function(a,b,c,d){b.bind("load",function(d){angular.element("#"+c.myLoad).addClass("ng-hide"),b.removeClass("ng-hide"),a.$apply(c.pgLoad)})}}),app.directive("myHeader",function(){return{restrict:"E",templateUrl:"./views/tpl/user.html",scope:{username:"@",titulo:"@",icono:"@",perfil:"@",perfiles:"@",activoAtencion:"@",modulo:"@",grupo:"@",userIpAddress:"@",moduloDisponible:"@",indisponibilidad:"@",enModal:"@",countdown:"@"},controller:["$scope","socketService","indiceService","$rootScope","$timeout","$modal",function(a,b,c,d,e,f){a.callDisponible=function(){b.disponible()},a.callOcupado=function(){b.ocupado()},a.desconectar=function(){b.desconectar()},a.contarAtencionService=function(){c.contarAtencionService(a.titulo)},a.llamarCliente=function(){b.llamarCliente()}}]}}),app.directive("myNotification",function(){return{restrict:"E",scope:{tipo:"=",titulo:"=",texto:"="},link:function(a,b,c){var d="";"warning"===a.tipo?d='<i class="fa fa-warning"></i> ':"success"===a.tipo?d='<i class="fa fa-check"></i> ':a.tipo,$.gritter.add({title:d+" "+a.titulo,text:a.texto,class_name:a.tipo})}}}),app.directive("mySidebar",["localStorageService",function(a){return function(b,c,d){var e=function(){if($(".cl-vnavigation li ul").each(function(){$(this).parent().addClass("parent")}),$(".cl-vnavigation li ul li.active").each(function(){$(this).parent().show().parent().addClass("open")}),$(".cl-vnavigation").delegate(".parent > a","click",function(a){$(".cl-vnavigation .parent.open > ul").not($(this).parent().find("ul")).slideUp(300,"swing",function(){$(this).parent().removeClass("open")}),$(this).parent().find("ul").slideToggle(300,"swing",function(){var a=$(this).parent();a.hasClass("open")?a.removeClass("open"):a.addClass("open"),$("#cl-wrapper .nscroller").nanoScroller({preventPageScrolling:!0})}),a.preventDefault()}),$(".cl-toggle").click(function(a){$(".cl-vnavigation").slideToggle(300,"swing",function(){}),a.preventDefault()}),$("#sidebar-collapse").click(function(){f()}),$("#cl-wrapper").hasClass("fixed-menu")){var b=$("#cl-wrapper .menu-space");b.addClass("nano nscroller");var c=function(){var a=$("#cl-wrapper .collapse-button"),c=a.outerHeight(),d=$("#head-nav").height(),e=$(window).height()-(a.is(":visible")?c:0)-d;b.css("height",e),$("#cl-wrapper .nscroller").nanoScroller({preventPageScrolling:!0})};$(window).resize(function(){c()}),c(),$("#cl-wrapper .nscroller").nanoScroller({preventPageScrolling:!0})}else $(window).resize(function(){});$("#pcont").height();$(document).bind("DOMSubtreeModified",function(){$("#pcont").height()}),$(".nscroller").nanoScroller(),"true"===a.get("sbCollapsed")&&f()},f=function(){var b=$("#sidebar-collapse")[0],c=$("#cl-wrapper");$(".cl-sidebar");c.hasClass("sb-collapsed")?(a.set("sbCollapsed","false"),jQuery("body").addClass("shelf-open"),$(".fa",b).addClass("fa-angle-left").removeClass("fa-angle-right"),c.removeClass("sb-collapsed")):(a.set("sbCollapsed","true"),jQuery("body").removeClass("shelf-open"),$(".fa",b).removeClass("fa-angle-left").addClass("fa-angle-right"),c.addClass("sb-collapsed"))};e()}}]),app.directive("mySubmenu",function(){return{restrict:"A",link:function(a,b,c){if(a.$last){var d=$('<div id="sub-menu-nav" style="position:fixed;z-index:9999;"></div>'),e=function(a,b){if(($("#cl-wrapper").hasClass("sb-collapsed")||$(window).width()>755&&$(window).width()<963)&&$("ul",a).length>0){$(a).removeClass("ocult");var c=$("ul",a);if(!$(".dropdown-header",a).length){var e='<li class="dropdown-header">'+$(a).children().html()+"</li>";c.prepend(e)}d.appendTo("body");var f=$(a).offset().top+8-$(window).scrollTop(),g=$(a).width();d.css({top:f,left:g+8}),d.html('<ul class="sub-menu">'+c.html()+"</ul>"),d.fadeIn("fast"),c.css("top",f)}else if($("#cl-wrapper").hasClass("sb-collapsed")||$(window).width()>755&&$(window).width()<963){$(a).removeClass("ocult");var h=$(a).clone();$(h).find("span").not(".ng-hide").remove(),$(h).find("i").remove(),$(h).find("span").removeClass("ng-hide"),$(h).find("a").addClass("parent-alone");var c="<li>"+h.html()+"</li>";d.appendTo("body");var f=$(a).offset().top+8-$(window).scrollTop(),g=$(a).width();d.css({top:f,left:g+8}),d.html('<ul class="sub-menu">'+c+"</ul>"),d.fadeIn("fast")}else d.fadeOut("fast")};$(".cl-vnavigation li").hover(function(a){e(this,a)},function(a){d.removeClass("over"),setTimeout(function(){!d.hasClass("over")&&!$(".cl-vnavigation li:hover").length>0&&d.hide()},500)}),d.hover(function(a){$(this).addClass("over")},function(){$(this).removeClass("over"),setTimeout(function(){!d.hasClass("over")&&!$(".cl-vnavigation li:hover").length>0&&d.fadeOut("fast")},500)}),$(document).click(function(){d.hide()}),d.click(function(a){a.stopPropagation()}),$(".cl-vnavigation li").click(function(a){($("#cl-wrapper").hasClass("sb-collapsed")||$(window).width()>755&&$(window).width()<963)&&$("ul",this).length>0&&!($(window).width()<755)&&(e(this,a),a.stopPropagation())})}}}}),function(){angular.module("ngTextTruncate",[]).directive("ngTextTruncate",["$compile","ValidationServices","CharBasedTruncation","WordBasedTruncation",function(a,b,c,d){return{restrict:"A",scope:{text:"=ngTextTruncate",charsThreshould:"@ngTtCharsThreshold",wordsThreshould:"@ngTtWordsThreshold",customMoreLabel:"@ngTtMoreLabel",customLessLabel:"@ngTtLessLabel"},controller:["$scope","$element","$attrs",function(a,b,c){a.toggleShow=function(){a.open=!a.open},a.useToggling=void 0===c.ngTtNoToggling}],link:function(a,e,f){a.open=!1,b.failIfWrongThreshouldConfig(a.charsThreshould,a.wordsThreshould);var g=parseInt(a.charsThreshould),h=parseInt(a.wordsThreshould);a.$watch("text",function(){e.empty(),g?a.text&&c.truncationApplies(a,g)?c.applyTruncation(g,a,e):e.append(a.text):a.text&&d.truncationApplies(a,h)?d.applyTruncation(h,a,e):e.append(a.text)})}}}]).factory("ValidationServices",function(){return{failIfWrongThreshouldConfig:function(a,b){if(!a&&!b||a&&b)throw"You must specify one, and only one, type of threshould (chars or words)"}}}).factory("CharBasedTruncation",["$compile",function(a){return{truncationApplies:function(a,b){return a.text.length>b},applyTruncation:function(b,c,d){if(c.useToggling){var e=angular.element("<span>"+c.text.substr(0,b)+"<span ng-show='!open'>...</span><span class='btn-link ngTruncateToggleText' ng-click='toggleShow()'ng-show='!open'> "+(c.customMoreLabel?c.customMoreLabel:"Ver Más")+"</span><span ng-show='open'>"+c.text.substring(b)+"<span class='btn-link ngTruncateToggleText'ng-click='toggleShow()'> "+(c.customLessLabel?c.customLessLabel:"Ocultar")+"</span></span></span>");a(e)(c),d.append(e)}else d.append(c.text.substr(0,b)+"...")}}}]).factory("WordBasedTruncation",["$compile",function(a){return{truncationApplies:function(a,b){return a.text.split(" ").length>b},applyTruncation:function(b,c,d){var e=c.text.split(" ");if(c.useToggling){var f=angular.element("<span>"+e.slice(0,b).join(" ")+" <span ng-show='!open'>...</span><span class='btn-link ngTruncateToggleText' ng-click='toggleShow()'ng-show='!open'> "+(c.customMoreLabel?c.customMoreLabel:"Ver Más")+"</span><span ng-show='open'>"+e.slice(b,e.length).join(" ")+"<span class='btn-link ngTruncateToggleText'ng-click='toggleShow()'> "+(c.customLessLabel?c.customLessLabel:"Ocultar")+"</span></span></span>");a(f)(c),d.append(f)}else d.append(e.slice(0,b).join(" ")+"...")}}}])}(),app.directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}),app.directive("nombreRequirente",["requirenteService",function(a){return{require:"ngModel",restrict:"A",link:function(b,c,d){c.on("blur",function(e){b[d.destino].nombre="",b.$apply(function(){var e=c.val();a.getNombre(e).then(function(a){a.status&&a.hayNombre&&(b[d.destino].nombre=a.nombre,"busquedaTitulo"===d.destino&&b.$broadcast("fojaIsFocused"))},function(a){})})})}}}]),app.directive("numbersOnly",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){if(void 0==a)return"";var b=a.replace(/[^0-9]/g,"");return b!=a&&(d.$setViewValue(b),d.$render()),b})}}}),app.directive("numbersOnlyNeg",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){if(void 0==a)return"";var b;return b=0!=a.indexOf("-")?a.replace(/-/g,""):"-"+a.replace(/-/g,""),b=b.replace(/[^-?0-9]/g,""),b!=a&&(d.$setViewValue(b),d.$render()),b})}}}),app.directive("popover",["$compile","$timeout",function(a,b){return{restrict:"A",link:function(c,d,e){var f=(e.content,angular.element("<div />"));f.append(e.content),a(f)(c),b(function(){d.removeAttr("popover").attr("data-content",f.html()),d.popover()})}}}]),app.directive("repertorioDigital",function(){return{restrict:"E",replace:!0,transclude:!0,controller:"RepertorioCtrl",templateUrl:"views/repertorio.html",link:function(a,b,c){a.busquedaRepertorio.repertorio=c.numeroRepertorio,a.busquedaRepertorio.simpleMode=c.simpleMode,a.buscar()}}}),app.directive("requirenteFull",["requirenteService",function(a){return{require:"ngModel",restrict:"A",link:function(b,c,d){c.on("blur",function(e){b[d.destino].nombre="",b[d.destino].apep="",b[d.destino].apem="",b[d.destino].direccion="",b[d.destino].telefono="",b[d.destino].correo="",b[d.destino].rutConsultado=!1,b.$apply(function(){var e=c.val();a.getRequirenteFull(e).then(function(a){b[d.destino].rutConsultado=!0,a.status&&a.hayNombre&&(b[d.destino].nombre=a.nombre,b[d.destino].apep=a.apep,b[d.destino].apem=a.apem,b[d.destino].direccion=a.direccion,b[d.destino].telefono=a.telefono,b[d.destino].correo=a.correo)},function(a){})})})}}}]),app.directive("resizeInscripcion",["$window",function(a){return function(b,c,d){var e=angular.element(a);b.getWindowDimensions=function(){return{h:e.height()}},b.$watch(b.getWindowDimensions,function(a,c){b.windowHeight=a.h,b.style=function(){return{height:a.h-46+"px"}},b.styleImagen=function(){return{height:a.h-72+"px"}},b.styleImagenDOC=function(){return{height:a.h-85+"px"}}},!0),e.bind("resize",function(){b.$apply()})}}]),app.directive("rutFormat",function(){return{require:"?ngModel",link:function(a,b,c,d){b.Rut({format_on:"keyup"})}}}),app.directive("scrollBubble",function(){return{link:function(a,b,c,d){$(window).ready(function(){function a(){var a=b();g.css("top",a),g.fadeIn(100),null!==c&&clearTimeout(c),c=setTimeout(function(){g.fadeOut(100)},1e3)}function b(){var a=$(h).height(),b=a/$(h)[0].scrollHeight*a,c=$(h).scrollTop()/($(h)[0].scrollHeight-a),d=c*(a-b)+b/2+g.height()/2;return d+=10,d>a&&(d=a),d}var c=null,d="ontouchstart"in window,e=0,f=0,g=$("#scrollbubble"),h=".DV-doc";$(window).bind("scrollstart",function(a){f=null}),$(window).bind("scrollstop",function(a){e=0}),d&&g.css("webkit-transition","-webkit-transform 0.2s ease-out"),$(".DV-doc").on("scroll",function(){$.waypoints("refresh"),a()}).on("resize",function(){$.waypoints("refresh"),$(".DV-doc").trigger("scroll")})})}}}),app.directive("scrollToBookmark",function(){return{link:function(a,b,c){var d=c.scrollToBookmark;b.click(function(){a.$apply(function(){var a="[scroll-bookmark='"+d+"']",b=$(a);b.length&&window.scrollTo(0,b[0].offsetTop-100)})})}}}),app.directive("scrollUp",function(){return{restrict:"E",link:function(a,b,c,d){$.scrollUp({animation:"fade",scrollImg:{active:!0,type:"background",src:"img/top.png"}})}}}),app.directive("scrollPosition",["$window",function(a){return{scope:{scroll:"=scrollPosition"},link:function(b,c,d){var e=angular.element(a),f=function(){b.scroll=e.scrollTop()};e.on("scroll",b.$apply.bind(b,f)),f()}}}]),app.directive("stickySectionHeader",function(){return{link:function(a,b,c,d){b.stickySectionHeaders({stickyClass:"sticky",headlineSelector:"strong"})}}}),app.directive("utilBorrador",function(){return{scope:{modelo:"@"},link:function(a,b,c){function d(){"true"==c.modelo?$(b).css("height",e.height()-325+"px"):$(b).css("height","0px")}var e=$(window);a.$watch("modelo",function(){d()}),e.on("resize",function(){d()})}}}),app.directive("utilDerecha",function(){return{scope:{modelod:"@"},link:function(a,b,c){var d=$(window),e=c.target,f=(c.versionado,$("#"+e+"-bar")),g=$("#"+e+"-bar-queda"),h=$("#"+e+"-bar-progress"),i=0;"nota"==e?i=210:"formulario"==e&&(i=210),a.$watch("modelod",function(){a.panelResizeder()}),d.on("resize",function(){a.panelResizeder()}),b.on("scroll",function(){a.panelMore()}),a.panelResizeder=function(){"true"==c.modelod?$(b).css("height",d.height()-i+"px"):$(b).css("height","0px"),setTimeout(function(){a.panelMore()},500)},a.panelMore=function(){var a=$(b)[0].scrollHeight,c=$(b).height(),d=$(b).scrollTop()/(a-c),e=100*d,i=Math.floor(e);c>0?0==i?(h.css("width",e+"%"),h.html(i+"%"),f.hide(),g.html('Hay más <i class="fa fa-arrow-down"></i>'),g.stop(!0,!0).fadeIn()):(g.hide(),f.show(),100==e?(h.css("width",e+"%"),h.html("Todo leído")):(h.css("width",e+"%"),h.html(i+"% leído"))):(f.hide(),g.html("&nbsp;"),g.stop(!0,!0).fadeIn())},a.panelMore()}}}),app.directive("utilIzquierda",function(){return{scope:{modelo:"@"},link:function(a,b,c){var d=$(window),e=c.target,f=c.versionado,g=$("#"+e+"-bar"),h=$("#"+e+"-bar-queda"),i=$("#"+e+"-bar-progress"),j=0;"anotacion"==e?j=312:"borrador"==e?j="true"===f?312:298:"proceso"==e?j="true"===f?312:298:"terminada"==e&&(j="true"===f?312:298),a.$watch("modelo",function(){a.panelResize()}),d.on("resize",function(){a.panelResize()}),b.on("scroll",function(){a.panelMore()}),a.panelResize=function(){"true"==c.modelo?$(b).css("height",d.height()-j+"px"):$(b).css("height","0px"),setTimeout(function(){a.panelMore()},500)},a.panelMore=function(){var a=$(b)[0].scrollHeight,c=$(b).height(),d=$(b).scrollTop()/(a-c),e=100*d,f=Math.floor(e);c>0?0==f?(i.css("width",e+"%"),i.html(f+"%"),g.hide(),h.html('Hay más <i class="fa fa-arrow-down"></i>'),h.stop(!0,!0).fadeIn()):(h.hide(),g.show(),100==e?(i.css("width",e+"%"),i.html("Todo leído")):(i.css("width",e+"%"),i.html(f+"% leído"))):(g.hide(),h.html("&nbsp;"),h.stop(!0,!0).fadeIn())},a.panelMore()}}}),app.directive("utilIzquierdaCertifica",function(){return{scope:{modelo:"@"},link:function(a,b,c){var d=$(window),e=c.target,f=c.versionado,g=$("#"+e+"-bar"),h=$("#"+e+"-bar-queda"),i=$("#"+e+"-bar-progress"),j=0;"anotacion"==e?j=500:"borrador"==e?j="true"===f?500:450:"proceso"==e?j="true"===f?500:450:"terminada"==e?j="true"===f?500:450:"nota"==e&&(j=93),a.$watch("modelo",function(){a.panelResize()}),d.on("resize",function(){a.panelResize()}),b.on("scroll",function(){a.panelMore()}),a.panelResize=function(){"true"==c.modelo?$(b).css("height",d.height()-j+"px"):$(b).css("height","0px"),setTimeout(function(){a.panelMore()},500)},a.panelMore=function(){var a=$(b)[0].scrollHeight,c=$(b).height(),d=$(b).scrollTop()/(a-c),e=100*d,f=Math.floor(e);c>0?0==f?(i.css("width",e+"%"),i.html(f+"%"),g.hide(),h.html('Hay más <i class="fa fa-arrow-down"></i>'),h.stop(!0,!0).fadeIn()):(h.hide(),g.show(),100==e?(i.css("width",e+"%"),i.html("Todo leído")):(i.css("width",e+"%"),i.html(f+"% leído"))):(g.hide(),h.html("&nbsp;"),h.stop(!0,!0).fadeIn())},a.panelMore()}}}),app.directive("utilProceso",function(){return{scope:{modelo:"@"},link:function(a,b,c){function d(){"true"==c.modelo?$(b).css("height",e.height()-325+"px"):$(b).css("height","0px")}var e=$(window);a.$watch("modelo",function(){d()}),e.on("resize",function(){d()})}}}),app.directive("utilTerminada",function(){return{scope:{modelo:"@"},link:function(a,b,c){function d(){"true"==c.modelo?$(b).css("height",e.height()-325+"px"):$(b).css("height","0px")}var e=$(window);a.$watch("modelo",function(){d()}),e.on("resize",function(){d()})}}}),app.directive("waypoint",function(){return{require:"ngModel",link:function(a,b,c,d){a.$last&&setTimeout(function(){$(".DV-waypoint").waypoint(function(b){if("down"===b){var c=$(this).data("page");$("#scrollBubbleText").html(c),d.$setViewValue(c),d.$render(),a.$apply()}},{continuous:!1,offset:"50%",context:".DV-doc"}).waypoint(function(b){if("up"===b){var c=$(this).data("page");$("#scrollBubbleText").html(c),d.$setViewValue(c),d.$render(),a.$apply()}},{continuous:!1,offset:"-50%",context:".DV-doc"})},1e3)}}}),app.factory("anexoModel",function(){var a={id:null,nombre:"",apPaterno:"",apMaterno:"",codSeccion:"",anexo:"",piso:"",correo:""};return{getAnexo:function(){return a},setAnexo:function(b){a=b}}}),app.factory("anotacionTipoModel",function(){var a={usuario:"",tipos:[]};return{getData:function(){return a},setData:function(b){a=b}}}),app.factory("auditoriaModel",function(){var a={parentActive:1},b={mostrarInactivosProp:!1,mostrarInactivosProh:!1,mostrarInactivosHipo:!1},c={borrador:null,folio:null,fecha:null,anos:null,fechaUltimoGP:null,codigoAlpha:null,gp:[],eventos:[],numeroEventos:null,datosPropiedad:null,duenyos:[],hipoteca:[],prohibicion:[],roles:[],folios:[],data:null,res:null,urls:[],tieneNoVigenteProp:!1,tieneNoVigenteProh:!1,tieneNoVigenteHipo:!1,listaCaratulaPorPropiedad:[]},d={caratula:null,data:null},e={fojas:null,numero:null,ano:null,data:null},f={tienePlanos:null,data:null},g={borrador:{isLoading:!1,isError:!1,title:"",msg:""},caratula:{isLoading:!1,isError:!1,title:"",msg:""},inscripcion:{isLoading:!1,isError:!1,title:"",msg:""}};return{getMostrar:function(){return b},setMostrar:function(a){b=a},getTab:function(){return a},setTab:function(b){a=b},getBusquedaGponline:function(){return c},setBusquedaGponline:function(a){c=a},getBusquedaCaratula:function(){return d},setBusquedaCaratula:function(a){d=a},getBusquedaInscripcion:function(){return e},setBusquedaInscripcion:function(a){e=a},getBusquedaPlanos:function(){return f},setBusquedaPlanos:function(a){f=a},getStates:function(){return g},setStates:function(a){g=a}}}),app.factory("cartelesModel",function(){var a={parentActive:1},b={numero:"",mes:"",ano:"",registro:"",bis:!1},c={resultados:[],data:null,fecha:null},d={busquedaCartel:{isLoading:!1,isError:!1,title:"",msg:""},mis:{isLoading:!1,isError:!1,title:"",msg:""}},e={numero:"",mes:"",ano:"",registro:"",bis:"",cantidadPaginas:0,hayArchivo:!1,tipoArchivoDTO:{}};return{getTab:function(){return a},setTab:function(b){a=b},getEstadoDocumento:function(){return e},setEstadoDocumento:function(a){e=a},resetEstadoDocumento:function(){e.numero="",e.mes="",e.ano="",e.registro="",e.bis="",e.cantidadPaginas=0,e.hayArchivo=!1,e.tipoArchivoDTO={}},getBusquedaCartel:function(){return b},setBusquedaCartel:function(a){b=a},getBusquedaMis:function(){return c},setBusquedaMis:function(a){c=a},getStates:function(){return d},setStates:function(a){d=a}}}),app.factory("certificacionHipotecasModel",function(){var a={caratula:null,foja:null,numero:null,ano:null,bis:!1,fechaCreacion:null,resultados:[],data:null,predicate:null,reverse:null},b={buscar:{isLoading:!1,isError:!1,title:"",msg:""},urgencia:{isLoading:!1,isError:!1,title:"",msg:""}},c={data:[],inicio:0,fin:20,offset:20};return{getBusquedaCertificacion:function(){return a},setBusquedaCertificacion:function(b){a=b},getStates:function(){return b},setStates:function(a){b=a},getListaResumida:function(){return c},setListaResumida:function(a){c=a}}}),app.factory("certificacionModel",function(){var a={caratula:null,foja:null,numero:null,ano:null,bis:!1,fechaCreacion:null,resultados:[],data:null,predicate:null,reverse:null},b={buscar:{isLoading:!1,isError:!1,title:"",msg:""},urgencia:{isLoading:!1,isError:!1,title:"",msg:""}},c={data:[],inicio:0,fin:20,offset:20};return{getBusquedaCertificacion:function(){return a},setBusquedaCertificacion:function(b){a=b},getStates:function(){return b},setStates:function(a){b=a},getListaResumida:function(){return c},setListaResumida:function(a){c=a}}}),app.factory("certificacionProhibicionesModel",function(){var a={caratula:null,foja:null,numero:null,ano:null,bis:!1,fechaCreacion:null,resultados:[],data:null,predicate:null,reverse:null},b={buscar:{isLoading:!1,isError:!1,title:"",msg:""},urgencia:{isLoading:!1,isError:!1,title:"",msg:""}},c={data:[],inicio:0,fin:20,offset:20};return{getBusquedaCertificacion:function(){return a},setBusquedaCertificacion:function(b){a=b},getStates:function(){return b},setStates:function(a){b=a},getListaResumida:function(){return c},setListaResumida:function(a){c=a}}}),app.factory("digitalHipotecasModel",function(){var a={parentActive:1},b={foja:null,numero:null,ano:null,bis:!1},c={resultados:[],data:null,fecha:null},d={titulo:{isLoading:!1,isError:!1,title:"",msg:""},mis:{isLoading:!1,isError:!1,title:"",msg:""}},e={};return{getDataState:function(){return e},setDataState:function(a){e=a},getTab:function(){return a},setTab:function(b){a=b},getBusquedaTitulo:function(){return b},setBusquedaTitulo:function(a){b=a},getBusquedaMis:function(){return c},setBusquedaMis:function(a){c=a},getStates:function(){return d},setStates:function(a){d=a}}}),app.factory("digitalModel",function(){var a={parentActive:1},b={foja:null,numero:null,ano:null,bis:!1},c={resultados:[],data:null,fecha:null},d={titulo:{isLoading:!1,isError:!1,title:"",msg:""},mis:{isLoading:!1,isError:!1,title:"",msg:""}},e={};return{getDataState:function(){return e},setDataState:function(a){e=a},getTab:function(){return a},setTab:function(b){a=b},getBusquedaTitulo:function(){return b},setBusquedaTitulo:function(a){b=a},getBusquedaMis:function(){return c},setBusquedaMis:function(a){c=a},getStates:function(){return d},setStates:function(a){d=a}}}),app.factory("digitalProhibicionesModel",function(){var a={parentActive:1},b={foja:null,numero:null,ano:null,bis:!1},c={resultados:[],data:null,fecha:null},d={titulo:{isLoading:!1,isError:!1,title:"",msg:""},mis:{isLoading:!1,isError:!1,title:"",msg:""}},e={};return{getDataState:function(){return e},setDataState:function(a){e=a},getTab:function(){return a},setTab:function(b){a=b},getBusquedaTitulo:function(){return b},setBusquedaTitulo:function(a){b=a},getBusquedaMis:function(){return c},setBusquedaMis:function(a){c=a},getStates:function(){return d},setStates:function(a){d=a}}}),app.factory("estadoModel",function(){var a={rut:null,dv:null,resultado:10},b={nombre:null,apep:null,apem:null,correo:null,telefono:null,direccion:null},c=[];return{getCaratulasPorRut:function(){return a},setCaratulasPorRut:function(b){a=b},getDatosRequirente:function(){return b},setDatosRequirente:function(a){b=a},getListaCaratulas:function(){return c},setListaCaratulas:function(a){c=a}}}),app.factory("gponlineModel",function(){var a={parentActive:1},b={mostrarInactivosProp:!1,mostrarInactivosProh:!1,mostrarInactivosHipo:!1},c={borrador:null,folio:null,fecha:null,anos:null,fechaUltimoGP:null,codigoAlpha:null,gp:[],eventos:[],numeroEventos:null,datosPropiedad:null,duenyos:[],hipoteca:[],prohibicion:[],roles:[],folios:[],data:null,res:null,urls:[],tieneNoVigenteProp:!1,tieneNoVigenteProh:!1,tieneNoVigenteHipo:!1,listaCaratulaPorPropiedad:[]},d={caratula:null,data:null},e={fojas:null,numero:null,ano:null,registro:"PROP",data:null},f={tienePlanos:null,data:null},g={borrador:{isLoading:!1,isError:!1,title:"",msg:""},caratula:{isLoading:!1,isError:!1,title:"",msg:""},inscripcion:{isLoading:!1,isError:!1,title:"",msg:""}};return{getMostrar:function(){return b},setMostrar:function(a){b=a},getTab:function(){return a},setTab:function(b){a=b},getBusquedaGponline:function(){return c},setBusquedaGponline:function(a){c=a},getBusquedaCaratula:function(){return d},setBusquedaCaratula:function(a){d=a},getBusquedaInscripcion:function(){return e},setBusquedaInscripcion:function(a){e=a},getBusquedaPlanos:function(){return f},setBusquedaPlanos:function(a){f=a},getStates:function(){return g},setStates:function(a){g=a}}}),app.factory("indiceModel",function(){var a={foja:null,numero:null,ano:null,bis:!1,esDigital:!1,tipodocumento:null,propiedades:!0,hipoteca:!1,prohibiciones:!1,buscarPorInscricionHipo:!1,buscarPorInscricionProh:!1,exacta:!1,rut:null,nombre:null,direccion:null,comuna:null,conservador:null,conservadorelegido:null,caratula:null,anoInscripcion:null,acto:null,tipo:null,button_clicked:!1,resultados:[],resultadosprohibiciones:[],resultadoshipotecas:[],resultadoscomercio:[],listaactos:[],listatipos:[],listaconservadores:[],comunas:[],anosInscripciones:[],data:null,selectedRow:null,indicebusqueda:!1},b={buscar:{isLoading:!1,isError:!1,title:"",msg:""},urgencia:{isLoading:!1,isError:!1,title:"",msg:""}},c={data:[],inicio:0,fin:20,offset:20},d={data:[],inicio:0,fin:20,offset:20},e={data:[],inicio:0,fin:20,offset:20},f={data:[],inicio:0,fin:20,offset:20};return{getBusquedaIndice:function(){return a},setBusquedaIndice:function(b){a=b},getStates:function(){return b},setStates:function(a){b=a},getListaPropiedad:function(){return c},setListaPropiedad:function(a){c=a},getListaProhibiciones:function(){return d},setListaProhibiciones:function(a){d=a},getListaHipoteca:function(){return e},setListaHipoteca:function(a){e=a},getListaComercio:function(){return f},setListaComercio:function(a){f=a},getListaActos:function(){return listaactos},setListaActos:function(a){listaactos=a},getListaTipos:function(){return listatipos},setListaTipos:function(a){listatipos=a},getListaConservadores:function(){return listaconservadores},setListaConservadores:function(a){listaconservadores=a},getListaComuna:function(){return comunas},setListaComuna:function(a){comunas=newlistaComuna},getListaAnoInscripcion:function(){return anosInscripciones},setListaAnoInscripcion:function(a){anosInscripciones=newlistaAnoInscripcion}}}),app.factory("mantenedorCertificaModel",function(){var a={seccion:null,perfil:null,resultados:[],data:null},b={buscar:{isLoading:!1,isError:!1,title:"",msg:""},urgencia:{isLoading:!1,isError:!1,title:"",msg:""}};return{getBusquedaUsuario:function(){return a},setBusquedaUsuario:function(b){a=b},getStates:function(){return b},setStates:function(a){b=a}}}),app.factory("masInfoindiceModel",function(){var a={borradores:[],caratulasEnProceso:[],caratulasTerminadas:[],planos:[],titulosAnteriores:[],data:null},b={buscar:{isLoading:!1,isError:!1,title:"",msg:""}};return{getBusquedaBorrador:function(){return a},setBusquedaBorrador:function(b){a=b},getStates:function(){return b},setStates:function(a){b=a}}}),app.factory("oficioModel",function(){var a={caratula:null,estado:"",institucion:null,requirente:null,materia:null,rol:null,oficio:null,identificador:null,fechaEntrega:null,fechaCreacion:null,button_clicked:!1,resultados:[],data:null,predicate:null,reverse:null,selectedRow:null,indicebusqueda:!1},b={buscar:{isLoading:!1,isError:!1,title:"",msg:""},urgencia:{isLoading:!1,isError:!1,title:"",msg:""}},c={data:[],inicio:0,fin:20,offset:20};return{getBusquedaOficio:function(){return a},setBusquedaOficio:function(b){a=b},getStates:function(){return b},setStates:function(a){b=a},getListaOficio:function(){return c},setListaOficio:function(a){c=a}}}),app.factory("reingresoEscrituraModel",function(){var a={caratula:null,observacion1:null,observacion2:null,escrituras:[],notario:null,codescritura:null,notario2:null,codescritura2:null,data:null,predicate:null,reverse:null,version:null},b={buscar:{isLoading:!1,isError:!1,title:"",msg:""}},c={ok:null,msg:null},d={ok:null,msg:null},e={ok:null,msg:null},f={ok:null,msg:null},g={ok:null,msg:null};return{getBusquedaReingreso:function(){return a},setBusquedaReingreso:function(b){a=b},getStates:function(){return b},setStates:function(a){b=a},getStatesEscritura:function(){return c},setStatesEscritura:function(a){c=a},getStatesDescarga:function(){return e},setStatesDescarga:function(a){e=a},getStatesListado:function(){return d},setStatesListado:function(a){d=a},getStatesAnexo:function(){return f},setStatesAnexo:function(a){f=a},getStatesDescargaFusion:function(){return g},setStatesDescargaFusion:function(a){g=a}}}),app.factory("RepertorioModel",function(){var a={caratula:null,repertorio:null,anoRepertorio:null,resultados:[],data:null,predicate:null,reverse:null,anosRepertorios:[]},b={buscar:{isLoading:!1,isError:!1,title:"",msg:""},urgencia:{isLoading:!1,isError:!1,title:"",msg:""}};return{getBusquedaRepertorio:function(){return a},setBusquedaRepertorio:function(b){a=b},getStates:function(){return b},setStates:function(a){b=a}}}),app.factory("revisionNotasModel",function(){var a={cuadernillo:null,resultado_cuadernillo:null,fojaini:null,fojafin:null,ano:null,anos:[],button_clicked:!1,resultados:[],tieneDespacho:!1,data:null,selectedRow:null,indicebusqueda:!1},b={buscar:{isLoading:!1,isError:!1,title:"",msg:""},urgencia:{isLoading:!1,isError:!1,title:"",msg:""}},c={data:[],inicio:0,fin:20,offset:20};return{getBusquedaRevisionNotas:function(){return a},setBusquedaRevisionNotas:function(b){a=b},getStates:function(){return b},setStates:function(a){b=a},getListaPropiedad:function(){return c},setListaPropiedad:function(a){c=a}}}),app.factory("solicitudesHipotecasModel",function(){var a={parentActive:1},b={rut:null,nombre:"",foja:null,numero:null,ano:null,bis:!1,anteriores:!0,checkTodo:!1,resultados:[],titulosSeleccionados:{},data:null,req:{rut:null,nombre:""}},c={rut:null,nombre:"",resultados:[],data:null,fecha:null},d={resultados:[],data:null,fecha:null},e={titulo:{isLoading:!1,isError:!1,title:"",msg:""},rut:{isLoading:!1,isError:!1,title:"",msg:""},mis:{isLoading:!1,isError:!1,title:"",msg:""}};return{getTab:function(){return a},setTab:function(b){a=b},getBusquedaTitulo:function(){return b},setBusquedaTitulo:function(a){b=a},getBusquedaRut:function(){return c},setBusquedaRut:function(a){c=a},getBusquedaMis:function(){return d},setBusquedaMis:function(a){d=a},getStates:function(){return e},setStates:function(a){e=a}}}),app.factory("solicitudesModel",function(){var a={parentActive:1},b={rut:null,nombre:"",foja:null,numero:null,ano:null,bis:!1,anteriores:!0,checkTodo:!1,resultados:[],titulosSeleccionados:{},data:null,req:{rut:null,nombre:""}},c={rut:null,nombre:"",resultados:[],data:null,fecha:null},d={resultados:[],data:null,fecha:null},e={titulo:{isLoading:!1,isError:!1,title:"",msg:""},rut:{isLoading:!1,isError:!1,title:"",msg:""},mis:{isLoading:!1,isError:!1,title:"",msg:""}};return{getTab:function(){return a},setTab:function(b){a=b},getBusquedaTitulo:function(){return b},setBusquedaTitulo:function(a){b=a},getBusquedaRut:function(){return c},setBusquedaRut:function(a){c=a},getBusquedaMis:function(){return d},setBusquedaMis:function(a){d=a},getStates:function(){return e},setStates:function(a){e=a}}}),app.factory("solicitudesProhibicionesModel",function(){var a={parentActive:1},b={rut:null,nombre:"",foja:null,numero:null,ano:null,bis:!1,anteriores:!0,checkTodo:!1,resultados:[],titulosSeleccionados:{},data:null,req:{rut:null,nombre:""}},c={rut:null,nombre:"",resultados:[],data:null,fecha:null},d={resultados:[],data:null,fecha:null},e={titulo:{isLoading:!1,isError:!1,title:"",msg:""},rut:{isLoading:!1,isError:!1,title:"",msg:""},mis:{isLoading:!1,isError:!1,title:"",msg:""}};return{getTab:function(){return a},setTab:function(b){a=b},getBusquedaTitulo:function(){return b},setBusquedaTitulo:function(a){b=a},getBusquedaRut:function(){return c},setBusquedaRut:function(a){c=a},getBusquedaMis:function(){return d},setBusquedaMis:function(a){d=a},getStates:function(){return e},setStates:function(a){e=a}}}),app.factory("tareasModel",function(){var a={caratula:null,data:null,predicate:null,reverse:null,tiemporefresco:10},b={buscar:{isLoading:!1,isError:!1,title:"",msg:""},urgencia:{isLoading:!1,isError:!1,title:"",msg:""}};return{getBusquedaTareas:function(){return a},setBusquedaTareas:function(b){a=b},getStates:function(){return b},setStates:function(a){b=a}}}),app.factory("UAFModel",function(){var a={anos:[],ano:null,naturaleza:[],naturalezas:[]},b={parentActive:1};return{getBusquedaUAF:function(){return a},getTab:function(){return b},setTab:function(a){b=a}}}),app.factory("urgenciaModel",function(){var a={foja:null,numero:null,ano:null,bis:!1,resultados:[],data:null},b={buscar:{isLoading:!1,isError:!1,title:"",msg:""},urgencia:{isLoading:!1,isError:!1,title:"",msg:""}};return{getBusquedaTitulo:function(){return a},setBusquedaTitulo:function(b){a=b},getStates:function(){return b},setStates:function(a){b=a}}}),app.factory("indiceService",["$http","$q","$modal","$rootScope",function(a,b,c,d){return{getIndicePropiedades:function(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v={metodo:"getIndicePropiedades",rut:c,apellidos:d,direccion:e,foja:f,numero:g,ano:h,bis:i,comuna:j,anoInscripcion:k,exacta:n,acto:l,tipo:m,regPropiedades:o,regHipoteca:p,regProhibiciones:q,regComercio:r,buscarPorInscricionHipo:s,buscarPorInscricionProh:t,conservador:u},w=b.defer();return a({method:"GET",url:"../do/service/indice",params:v}).success(function(a,b,c,d){w.resolve(a)}).error(function(a,b,c,d){w.reject(b)}),w.promise},obtenerActos:function(){var c={metodo:"obtenerActos"},d=b.defer();return a({method:"GET",url:"../do/service/indice",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},obtenerTipos:function(){var c={metodo:"obtenerTipos"},d=b.defer();return a({method:"GET",url:"../do/service/indice",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},obtenerCBRSDisponibles:function(){var c={metodo:"obtenerCBRSDisponibles"},d=b.defer();return a({method:"GET",url:"../do/service/indice",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},guardaensesion:function(c,d,e,f,g,h){var i={metodo:"guardaensesion",foja:c,num:d,ano:e,bis:f,registro:g,idregistro:h},j=b.defer();return a({method:"GET",url:"../do/service/indice",params:i}).success(function(a,b,c,d){j.resolve(a)}).error(function(a,b,c,d){j.reject(b)}),j.promise},exportarExcel:function(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v={metodo:"exportarExcel",rut:c,apellidos:d,direccion:e,foja:f,numero:g,ano:h,bis:i,comuna:j,anoInscripcion:k,exacta:n,acto:l,tipo:m,regPropiedades:o,regHipoteca:p,regProhibiciones:q,regComercio:r,buscarPorInscricionHipo:s,buscarPorInscricionProh:t,conservador:u},w=b.defer();return a({method:"GET",url:"../do/service/indice",params:v}).success(function(a,b,c,d){w.resolve(a)}).error(function(a,b,c,d){w.reject(b)}),w.promise},getRutSesion:function(){var c={metodo:"getRutSesion"},d=b.defer();return a({method:"GET",url:"../do/service/indice",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},agregarNuevaAtencion:function(c){var d={metodo:"agregarNuevaAtencion",rut:c},e=b.defer();return a({method:"GET",url:"../do/service/indice",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},obtenerAtencionPorDia:function(){var c={metodo:"obtenerAtencionPorDia"},d=b.defer();return a({method:"GET",url:"../do/service/indice",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},contarAtencionService:function(a){if("Índice"==a)d.$broadcast("eventoIndice",{data:"something"});else{c.open({templateUrl:"ingresaRutModal.html",backdrop:!0,windowClass:"modal",controller:"ingresaRutModalCtrl"})}}}}]),app.factory("oficioService",["$http","$q",function(a,b){return{getOficios:function(c,d,e,f,g,h,i,j,k,l,m,n){var o={metodo:"getOficios",caratula:c,institucion:d,requirente:e,estado:f,fechaCreacionDesde:g,fechaCreacionHasta:h,fechaEntrega:i,materia:j,rol:k,oficio:l,identificador:m,ciudad:n},p=b.defer();return a({method:"GET",url:"../do/service/oficio",params:o}).success(function(a,b,c,d){p.resolve(a)}).error(function(a,b,c,d){p.reject(b)}),p.promise},init:function(){var c={metodo:"init"},d=b.defer();return a({method:"GET",url:"../do/service/oficio",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise}}}]),app.factory("anexoService",["$q","$http",function(a,b){return{getAnexos:function(){var c={metodo:"getAnexos"},d=a.defer();return b({method:"GET",url:"../do/service/anexo",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},guardarAnexo:function(c){var d={metodo:"guardarAnexo",anexoReq:c},e=a.defer();return b({method:"GET",url:"../do/service/anexo",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise}}}]),app.factory("AnotacionHipotecasService",["$http","$q",function(a,b){return{addAnotacion:function(c,d,e,f,g,h){var i="metodo=addAnotacion&idInscripcion="+c+"&acto="+encodeURIComponent(d)+"&texto="+encodeURIComponent(e)+"&caratula="+f+"&repertorio="+g+"&version="+h,j=b.defer();return a({method:"POST",url:"../do/service/anotacionHipotecas",dataType:"json",data:i,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){j.resolve(a)}).error(function(a,b,c,d){j.reject(b)}),j.promise},deleteAnotacion:function(c){var d="metodo=removeAnotacion&idAnotacion="+c,e=b.defer();return a({method:"POST",url:"../do/service/anotacionHipotecas",dataType:"json",data:d,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getTipos:function(){var c=b.defer();return a({method:"POST",url:"../do/service/anotacionHipotecas",dataType:"json",data:"metodo=getTiposAnotacion",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,d,e){c.resolve(a)}).error(function(a,b,d,e){c.reject(b)}),c.promise},modificaAnotacion:function(c,d,e,f){var g="metodo=modificaAnotacion&texto="+c+"&caratula="+d+"&version="+e+"&idAnotacion="+f,h=b.defer();return a({method:"POST",url:"../do/service/anotacionHipotecas",dataType:"json",data:g,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},getRepertorioCaratula:function(c){var d="metodo=getRepertorioCaratula&caratula="+c,e=b.defer();return a({method:"POST",url:"../do/service/anotacionHipotecas",dataType:"json",data:d,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise}}}]),app.factory("AnotacionProhibicionesService",["$http","$q",function(a,b){return{addAnotacion:function(c,d,e,f,g,h,i,j){var k="metodo=addAnotacion&idInscripcion="+c+"&acto="+encodeURIComponent(d)+"&texto="+encodeURIComponent(e)+"&caratula="+f+"&repertorio="+g+"&version="+h+"&borrador="+j,l=b.defer();return a({method:"POST",url:"../do/service/anotacionProhibiciones",dataType:"json",data:k,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){l.resolve(a)}).error(function(a,b,c,d){l.reject(b)}),l.promise},deleteAnotacion:function(c){var d="metodo=removeAnotacion&idAnotacion="+c,e=b.defer();return a({method:"POST",url:"../do/service/anotacionProhibiciones",dataType:"json",data:d,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getTipos:function(){var c=b.defer();return a({method:"POST",url:"../do/service/anotacionProhibiciones",dataType:"json",data:"metodo=getTiposAnotacion",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,d,e){c.resolve(a)}).error(function(a,b,d,e){c.reject(b)}),c.promise},modificaAnotacion:function(c,d,e,f){var g="metodo=modificaAnotacion&texto="+c+"&caratula="+d+"&version="+e+"&idAnotacion="+f,h=b.defer();return a({method:"POST",url:"../do/service/anotacionProhibiciones",dataType:"json",data:g,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},getRepertorioCaratula:function(c){var d="metodo=getRepertorioCaratula&caratula="+c,e=b.defer();return a({method:"POST",url:"../do/service/anotacionProhibiciones",dataType:"json",data:d,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise}}}]),app.factory("AnotacionService",["$http","$q",function(a,b){return{addAnotacion:function(c,d,e,f,g,h,i){var j="metodo=addAnotacion&idInscripcion="+c+"&acto="+encodeURIComponent(d)+"&texto="+encodeURIComponent(e)+"&caratula="+f+"&repertorio="+g+"&version="+h+"&fechaRepertorio="+i,k=b.defer();return a({method:"POST",url:"../do/service/anotacion",dataType:"json",data:j,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){k.resolve(a)}).error(function(a,b,c,d){k.reject(b)}),k.promise},deleteAnotacion:function(c){var d="metodo=removeAnotacion&idAnotacion="+c,e=b.defer();return a({method:"POST",url:"../do/service/anotacion",dataType:"json",data:d,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getTipos:function(){var c=b.defer();return a({method:"POST",url:"../do/service/anotacion",dataType:"json",data:"metodo=getTiposAnotacion",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,d,e){c.resolve(a)}).error(function(a,b,d,e){c.reject(b)}),c.promise},modificaAnotacion:function(c,d,e,f){var g="metodo=modificaAnotacion&texto="+c+"&caratula="+d+"&version="+e+"&idAnotacion="+f,h=b.defer();return a({method:"POST",url:"../do/service/anotacion",dataType:"json",data:g,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},getRepertorioCaratula:function(c){var d="metodo=getRepertorioCaratula&caratula="+c,e=b.defer();return a({method:"POST",url:"../do/service/anotacion",dataType:"json",data:d,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise}}}]),app.factory("borradorService",["$http","$q",function(a,b){return{obtenerCantidadBorradores:function(c,d,e){var f={metodo:"obtenerCantidadBorradores",foja:c,numero:d,ano:e},g=b.defer();return a({method:"GET",url:"../do/service/borradores",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},obtenerBorradores:function(c,d,e){var f={metodo:"obtenerBorradores",foja:c,numero:d,ano:e},g=b.defer();return a({method:"GET",url:"../do/service/borradores",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},obtenerTitulosAnteriores:function(c,d,e,f){var g={metodo:"obtenerTitulosAnteriores",foja:c,numero:d,ano:e,bis:f},h=b.defer();return a({method:"GET",url:"../do/service/borradores",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise}}}]),app.factory("caratulaService",["$http","$q",function(a,b){return{savePreCaratulaMasiva:function(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){var y={metodo:"savePreCaratulaMasiva",foja:c,numero:d,ano:e,rut:f,nombre:g,apep:h,apem:i,direccion:j,telefono:k,correo:l,tramite1:m,tramite2:n,tramite3:o,tramite4:p,tramite5:q,obs1:r,obs2:s,obs3:t,obs4:u,obs5:v,registro:w,titulos:x},z=b.defer();return a({method:"GET",url:"../do/service/caratula",params:y}).success(function(a,b,c,d){z.resolve(a)}).error(function(a,b,c,d){z.reject(b)}),z.promise},savePreCaratula:function(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){var y={metodo:"savePreCaratula",foja:c,numero:d,ano:e,rut:f,nombre:g,apep:h,apem:i,direccion:j,telefono:k,correo:l,tramite1:m,tramite2:n,tramite3:o,tramite4:p,tramite5:q,obs1:r,obs2:s,obs3:t,obs4:u,obs5:v,registro:w,titulos:x},z=b.defer();return a({method:"GET",url:"../do/service/caratula",params:y}).success(function(a,b,c,d){z.resolve(a)}).error(function(a,b,c,d){z.reject(b)}),z.promise},obtenerCantidadCaratula:function(c,d,e){var f={metodo:"obtenerCantidadCaratula",foja:c,numero:d,ano:e},g=b.defer();return a({method:"GET",url:"../do/service/caratula",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},obtenerCaratulasPorFoja:function(c,d,e,f){var g={metodo:"obtenerCaratulasPorFoja",foja:c,numero:d,ano:e,estado:f},h=b.defer();return a({method:"GET",url:"../do/service/caratula",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},actualizarInscripcion:function(c,d,e,f,g){var h={metodo:"actualizarInscripcion",caratula:c,foja:d,numero:e,ano:f,bis:g},i=b.defer();return a({method:"GET",url:"../do/service/caratula",params:h}).success(function(a,b,c,d){i.resolve(a)}).error(function(a,b,c,d){i.reject(b)}),i.promise},obtenerInscripcionBis:function(c,d,e,f,g){var h=new Date,i=h.getTime(),j={v:i,metodo:"obtenerInscripcionBis",caratula:c,foja:d,numero:e,ano:f,bis:g},k=b.defer();return a({method:"GET",url:"../do/service/caratula",params:j}).success(function(a,b,c,d){k.resolve(a)}).error(function(a,b,c,d){k.reject(b)}),k.promise},obtenerCausalesRechazo:function(){var c={metodo:"obtenerCausalesRechazo"},d=b.defer();return a({method:"GET",url:"../do/service/caratula",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},rechazarCaratula:function(c,d,e){var f=new Date,g=f.getTime(),h={v:g,metodo:"rechazarCaratula",caratula:c,codigoRechazo:d,descripcionRechazo:e},i=b.defer();return a({method:"GET",url:"../do/service/caratula",params:h}).success(function(a,b,c,d){i.resolve(a)}).error(function(a,b,c,d){i.reject(b)}),i.promise},obtenerBitacoraCaratula:function(c){var d=new Date,e=d.getTime(),f={v:e,metodo:"obtenerBitacoraCaratula",caratula:c},g=b.defer();return a({method:"GET",url:"../do/service/caratula",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},obtenerCaratula:function(c){var d=new Date,e=d.getTime(),f={v:e,metodo:"obtenerCaratula",caratula:c},g=b.defer();return a({method:"GET",url:"../do/service/caratula",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},movercaratula:function(c,d){var e=new Date,f=e.getTime(),g={v:f,metodo:"moverCartulaRedistribucion",caratula:c,seccion:d},h=b.defer();return a({method:"GET",url:"../do/service/caratula",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},getListadoCaratulasPorCtaCte:function(c,d,e,f){var g=new Date,h=g.getTime(),i={v:h,metodo:"getListadoCaratulasPorCtaCte",fechaDesde:c,fechaHasta:d,numCuenta:e,estado:f},j=b.defer();return a({method:"GET",url:"../do/service/caratula",params:i}).success(function(a,b,c,d){j.resolve(a)}).error(function(a,b,c,d){j.reject(b)}),j.promise},getCierreCtaCte:function(c,d,e){var f=new Date,g=f.getTime(),h={v:g,metodo:"getCierreCtaCte",cuenta:c,fecha:d,tipoCierre:e},i=b.defer();return a({method:"GET",url:"../do/service/caratula",params:h}).success(function(a,b,c,d){i.resolve(a)}).error(function(a,b,c,d){i.reject(b)}),i.promise},getListadoCaratulasPendientesPorSeccion:function(c){var d=new Date,e=d.getTime(),f={v:e,metodo:"getListadoCaratulasPendientesPorSeccion",seccion:c},g=b.defer();return a({method:"GET",url:"../do/service/caratula",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},movercaratulaLiquidacion:function(c){var d=new Date,e=d.getTime(),f="v="+e+"&metodo=movercaratulaLiquidacion&caratulas="+JSON.stringify(c),g=b.defer();return a({method:"POST",url:"../do/service/caratula",data:f,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},getListadoCaratulasPendientesPorUsuario:function(){var c=new Date,d=c.getTime(),e={v:d,metodo:"getListadoCaratulasPendientesPorUsuario"},f=b.defer();return a({method:"GET",url:"../do/service/caratula",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},eliminarCaratulaPendiente:function(c){var d=new Date,e=d.getTime(),f={v:e,metodo:"eliminarCaratulaPendiente",caratula:c},g=b.defer();return a({method:"GET",url:"../do/service/caratula",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise}}}]),app.factory("CartelesService",["$http","$q",function(a,b){return{buscarCartel:function(c,d,e,f,g,h){var i=new Date,j=i.getTime(),k={v:j,metodo:"buscarCartel",numero:c,mes:d,ano:e,registro:f,bis:g,tipo:h},l=b.defer();return a({method:"GET",url:"../do/service/carteles",params:k}).success(function(a,b,c,d){l.resolve(a)}).error(function(a,b,c,d){l.reject(b)}),l.promise},certificar:function(c,d,e,f,g,h,i,j,k){var l=new Date,m=l.getTime(),n={v:m,metodo:"certificar",caratula:c,numero:d,mes:e,ano:f,registro:g,bis:h,pdesde:i,phasta:j,tipo:k},o=b.defer();return a({method:"GET",url:"../do/service/carteles",params:n}).success(function(a,b,c,d){o.resolve(a)}).error(function(a,b,c,d){o.reject(b)}),o.promise},listadoCertificadosByUserInSession:function(){var c={metodo:"listadoCertificadosByUserInSession"},d=b.defer();return a({method:"GET",url:"../do/service/carteles",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},firmar:function(c,d){var e={metodo:"firmar",idCertificado:c,registro:d},f=b.defer();return a({method:"GET",url:"../do/service/carteles",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},eliminar:function(c,d){var e={metodo:"eliminar",idCertificado:c,registro:d},f=b.defer();return a({method:"GET",url:"../do/service/carteles",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},rehacer:function(c,d,e,f,g,h,i){var j={metodo:"rehacer",numero:c,mes:d,ano:e,registro:f,bis:g,pdesde:h,phasta:i},k=b.defer();return a({method:"GET",url:"../do/service/carteles",params:j}).success(function(a,b,c,d){k.resolve(a)}).error(function(a,b,c,d){k.reject(b)}),k.promise}}}]),app.factory("certificacionHipotecasService",["$http","$q",function(a,b){return{obtenerCaratulasParaCertificar:function(){var c={metodo:"obtenerCaratulasParaCertificar"},d=b.defer();return a({method:"GET",url:"../do/service/certificacionHipotecas",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},obtenerCaratulasParaCertificarEnParte:function(){var c={metodo:"obtenerCaratulasParaCertificarEnParte"},d=b.defer();return a({method:"GET",url:"../do/service/certificacionHipotecas",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},certificar:function(c,d,e,f,g,h){var i=new Date,j=i.getTime(),k={v:j,metodo:"certificar",caratula:c,foja:d,numero:e,ano:f,bis:g,tipoCertificacion:h},l=b.defer();return a({method:"GET",url:"../do/service/certificacionHipotecas",params:k}).success(function(a,b,c,d){l.resolve(a)}).error(function(a,b,c,d){l.reject(b)}),l.promise},rehacerImagen:function(c,d,e,f,g,h){var i=new Date,j=i.getTime(),k={v:j,metodo:"rehacerImagen",caratula:c,foja:d,numero:e,ano:f,bis:g,motivo:h},l=b.defer();return a({method:"GET",url:"../do/service/certificacionHipotecas",params:k}).success(function(a,b,c,d){l.resolve(a)}).error(function(a,b,c,d){l.reject(b)}),l.promise},distribuir:function(c,d){var e=new Date,f=e.getTime(),g={v:f,metodo:"distribuir",caratula:c,tipoCertificacion:d},h=b.defer();return a({method:"GET",url:"../do/service/certificacionHipotecas",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},vistaprevia:function(c,d,e,f,g){var h="metodo=vistaPrevia&caratula="+c+"&titulo="+encodeURIComponent(d)+"&cuerpocertificado="+encodeURIComponent(e)+"&prefijo="+f+"&valor="+g,i=b.defer();return a({method:"POST",url:"../do/service/certificacionHipotecas",dataType:"json",data:h,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){i.resolve(a)}).error(function(a,b,c,d){i.reject(b)}),i.promise},certificarvistapreviaplantilla:function(c,d){var e=new Date,f=e.getTime(),g={v:f,metodo:"certificarvistapreviaplantilla",caratula:c,prefijo:d},h=b.defer();return a({method:"GET",url:"../do/service/certificacionHipotecas",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise}}}]),app.factory("certificacionProhibicionesService",["$http","$q",function(a,b){return{obtenerCaratulasParaCertificar:function(){var c={metodo:"obtenerCaratulasParaCertificar"},d=b.defer();return a({method:"GET",url:"../do/service/certificacionProhibiciones",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},obtenerCaratulasParaCertificarEnParte:function(){var c={metodo:"obtenerCaratulasParaCertificarEnParte"},d=b.defer();return a({method:"GET",url:"../do/service/certificacionProhibiciones",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},certificar:function(c,d,e,f,g,h){var i=new Date,j=i.getTime(),k={v:j,metodo:"certificar",caratula:c,foja:d,numero:e,ano:f,bis:g,tipoCertificacion:h},l=b.defer();return a({method:"GET",url:"../do/service/certificacionProhibiciones",params:k}).success(function(a,b,c,d){l.resolve(a)}).error(function(a,b,c,d){l.reject(b)}),l.promise},rehacerImagen:function(c,d,e,f,g,h){var i=new Date,j=i.getTime(),k={v:j,metodo:"rehacerImagen",caratula:c,foja:d,numero:e,ano:f,bis:g,motivo:h},l=b.defer();return a({method:"GET",url:"../do/service/certificacionProhibiciones",params:k}).success(function(a,b,c,d){l.resolve(a)}).error(function(a,b,c,d){l.reject(b)}),l.promise},distribuir:function(c,d){var e=new Date,f=e.getTime(),g={v:f,metodo:"distribuir",caratula:c,tipoCertificacion:d},h=b.defer();return a({method:"GET",url:"../do/service/certificacionProhibiciones",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},vistaprevia:function(c,d,e,f,g){var h="metodo=vistaPrevia&caratula="+c+"&titulo="+encodeURIComponent(d)+"&cuerpocertificado="+encodeURIComponent(e)+"&prefijo="+f+"&valor="+g,i=b.defer();return a({method:"POST",url:"../do/service/certificacionProhibiciones",dataType:"json",data:h,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){i.resolve(a)}).error(function(a,b,c,d){i.reject(b)}),i.promise},certificarvistapreviaplantilla:function(c,d){var e=new Date,f=e.getTime(),g={v:f,metodo:"certificarvistapreviaplantilla",caratula:c,prefijo:d},h=b.defer();return a({method:"GET",url:"../do/service/certificacionProhibiciones",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise}}}]),app.factory("certificacionService",["$http","$q",function(a,b){return{obtenerCaratulasParaCertificar:function(){var c={metodo:"obtenerCaratulasParaCertificar"},d=b.defer();return a({method:"GET",url:"../do/service/certificacion",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},obtenerCaratulasParaCertificarEnParte:function(){var c={metodo:"obtenerCaratulasParaCertificarEnParte"},d=b.defer();return a({method:"GET",url:"../do/service/certificacion",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},certificar:function(c,d,e,f,g,h){var i=new Date,j=i.getTime(),k={v:j,metodo:"certificar",caratula:c,foja:d,numero:e,ano:f,bis:g,tipoCertificacion:h},l=b.defer();return a({method:"GET",url:"../do/service/certificacion",params:k}).success(function(a,b,c,d){l.resolve(a)}).error(function(a,b,c,d){l.reject(b)}),l.promise},rehacerImagen:function(c,d,e,f,g,h){var i=new Date,j=i.getTime(),k={v:j,metodo:"rehacerImagen",caratula:c,foja:d,numero:e,ano:f,bis:g,motivo:h},l=b.defer();return a({method:"GET",url:"../do/service/certificacion",params:k}).success(function(a,b,c,d){l.resolve(a)}).error(function(a,b,c,d){l.reject(b)}),l.promise},distribuir:function(c,d){var e=new Date,f=e.getTime(),g={v:f,metodo:"distribuir",caratula:c,tipoCertificacion:d},h=b.defer();return a({method:"GET",url:"../do/service/certificacion",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},vistaprevia:function(c,d,e,f,g){var h="metodo=vistaPrevia&caratula="+c+"&titulo="+encodeURIComponent(d)+"&cuerpocertificado="+encodeURIComponent(e)+"&prefijo="+f+"&valor="+g,i=b.defer();return a({method:"POST",url:"../do/service/certificacion",dataType:"json",data:h,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){i.resolve(a)}).error(function(a,b,c,d){i.reject(b)}),i.promise},certificarvistapreviaplantilla:function(c,d){var e=new Date,f=e.getTime(),g={v:f,metodo:"certificarvistapreviaplantilla",caratula:c,prefijo:d},h=b.defer();return a({method:"GET",url:"../do/service/certificacion",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise}}}]),app.factory("desbloqueoService",["$q","$http",function(a,b){return{buscar:function(c){var d={metodo:"buscar",inscripcion:c},e=a.defer();return b({method:"GET",url:"../do/service/desbloqueo",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},desbloquear:function(c,d){var e={metodo:"desbloquear",solicitud:c,listaSolicitudes:d},f=a.defer();return b({method:"GET",url:"../do/service/desbloqueo",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},getInscripcionSesion:function(c){var d={metodo:"getInscripcionSesion",inscripcion:c},e=a.defer();return b({method:"GET",url:"../do/service/desbloqueo",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise}}}]),app.factory("distribucionService",["$q","$http",function(a,b){return{getCaratula:function(c){var d={metodo:"getCaratula",numeroCaratula:c},e=a.defer();return b({method:"GET",url:"../do/service/distribucion",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getSecciones:function(){var c={metodo:"getSecciones"},d=a.defer();return b({method:"GET",url:"../do/service/distribucion",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},getResponsables:function(c){var d={metodo:"getResponsables",codSeccion:c},e=a.defer();return b({method:"GET",url:"../do/service/distribucion",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},distribuir:function(c,d,e){var f={metodo:"distribuir"},g={caratulas:c,responsable:e,codSeccion:d},h=a.defer();return b({method:"POST",url:"../do/service/distribucion",params:f,data:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},getCaratulaSesion:function(){var c={metodo:"getCaratulaSesion"},d=a.defer();return b({method:"POST",url:"../do/service/distribucion",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise}}}]),app.factory("escrituraService",["$http","$q",function(a,b){return{obtenerEscrituraPorInscripcion:function(c){var d={metodo:"obtenerEscrituraPorInscripcion",caratula:c},e=b.defer();return a({method:"GET",url:"../do/service/escritura",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},verDocumento:function(c,d){var e={metodo:"verDocumento",url:c,type:d},f=b.defer();return a({method:"GET",url:"../do/service/escritura",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},eliminarDocumento:function(c,d,e){var f={metodo:"eliminarDocumento",idDocumento:c,caratula:d,version:e},g=b.defer();return a({method:"GET",url:"../do/service/escritura",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise}}}]),app.factory("estadoService",["$q","$http",function(a,b){return{getEstado:function(c){var d={metodo:"getEstado",numeroCaratula:c},e=a.defer();return b({method:"GET",url:"../do/service/estado",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},cambiarEstado:function(c,d,e){var f={metodo:"cambiarEstado",numeroCaratula:c,idEstadoFormulario:d,descEstadoFormulario:e},g=a.defer();return b({method:"GET",url:"../do/service/estado",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},cambiarCorreo:function(c,d){var e={metodo:"updateRequirente",caratula:c,correo:d},f=a.defer();return b({method:"GET",url:"../do/service/estado",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},cambiarInscripcion:function(c,d){var e={metodo:"editarDatosCitado",caratula:c,citadoDTO:d},f=a.defer();return b({method:"GET",url:"../do/service/estado",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},agregarTarea:function(c,d,e){var f={metodo:"agregarTarea",caratula:c,codTarea:d,descTarea:e},g=a.defer();return b({method:"GET",url:"../do/service/estado",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},eliminarTarea:function(c,d,e){var f={metodo:"eliminarTarea",caratula:c,codTarea:d,descTarea:e},g=a.defer();return b({method:"GET",url:"../do/service/estado",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},agregarCaja:function(c,d,e){var f={metodo:"agregarCaja",caratula:c,fechaCaja:d,horaCaja:e},g=a.defer();return b({method:"GET",url:"../do/service/estado",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},obtenerListaTareas:function(){var c={metodo:"obtenerListaTareas"},d=a.defer();return b({method:"GET",url:"../do/service/estado",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},obtenerCausasRechazo:function(){var c={metodo:"getCausalesRechazo"},d=a.defer();return b({method:"GET",url:"../do/service/estado",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},rechazarCaratula:function(c,d,e){var f={metodo:"rechazarCaratula",caratula:c,codigo:d,motivo:e},g=a.defer();return b({method:"GET",url:"../do/service/estado",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},getCaratulaSesion:function(){var c={metodo:"getCaratulaSesion"},d=a.defer();return b({method:"GET",url:"../do/service/estado",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},getDocumentosEntrega:function(c){var d={metodo:"getDocumentosEntrega",numeroCaratula:c},e=a.defer();return b({method:"GET",url:"../do/service/estado",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getRepertorios:function(c){var d={metodo:"getRepertorios",numeroCaratula:c},e=a.defer();return b({method:"GET",url:"../do/service/estado",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getIngresosEgresos:function(c){var d={metodo:"getIngresosEgresos",numeroCaratula:c},e=a.defer();return b({method:"GET",url:"../do/service/estado",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getCuentaCorriente:function(c){var d={metodo:"getCuentaCorriente",codigo:c},e=a.defer();return b({method:"GET",url:"../do/service/estado",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getProductoWeb:function(c){var d={metodo:"getProductoWeb",productoWebDTO:c},e=a.defer();return b({method:"GET",url:"../do/service/estado",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getDocumentos:function(c,d){var e={metodo:"getDocumentos",numeroCaratula:c,tipoDocumento:d},f=a.defer();return b({method:"GET",url:"../do/service/estado",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},existeEscritura:function(c){var d={metodo:"existeEscritura",escritura:c},e=a.defer();return b({method:"GET",url:"../do/service/estado",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},existeDocumento:function(c){var d={metodo:"existeDocumento",documento:c},e=a.defer();return b({method:"GET",url:"../do/service/estado",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},existeFirma:function(c){var d={metodo:"existeFirma",documento:c},e=a.defer();return b({method:"GET",url:"../do/service/estado",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getCaratulasPorRut:function(c,d){var e={metodo:"getCaratulasPorRut",rut:c,resultado:d},f=a.defer();return b({method:"GET",url:"../do/service/estado",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},agregarBitacora:function(c,d,e,f){var g={metodo:"agregarBitacora",caratula:c,comentario:d,categoria:e,correo:f},h=a.defer();return b({method:"GET",url:"../do/service/estado",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},dejarDocumentoNoVigente:function(c){var d={metodo:"dejarDocumentoNoVigente",codigoDocumento:c},e=a.defer();return b({method:"GET",url:"../do/service/estado",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},vincularCaratula:function(c,d){var e={metodo:"vincularCaratula",caratulaObj:c,caratulaSrc:d},f=a.defer();return b({method:"GET",url:"../do/service/estado",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise}}}]),app.factory("firmaService",["$http","$q",function(a,b){return{obtenerTiposCertificadosPorPerfil:function(c){var d={metodo:"obtenerTiposCertificadosPorPerfil",idPerfil:c},e=b.defer();return a({method:"GET",url:"../do/service/firma",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise}}}]),app.factory("gponlineService",["$http","$q",function(a,b){return{buscarFolios:function(c){var d={metodo:"buscarFolios",borrador:c},e=b.defer();return a({method:"GET",url:"../do/service/gponline",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},buscarBorrador:function(c,d,e,f){var g={metodo:"buscarBorrador",borrador:c,folio:d,fechaHoy:e,ano:f},h=b.defer();return a({method:"GET",url:"../do/service/gponline",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},buscarBorradorPorCaratula:function(c){var d={metodo:"buscarBorradorPorCaratula",caratula:c},e=b.defer();return a({method:"GET",url:"../do/service/gponline",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},buscarBorradorPorInscripcion:function(c,d,e){var f={metodo:"buscarBorradorPorInscripcion",foja:c,numero:d,ano:e},g=b.defer();return a({method:"GET",url:"../do/service/gponline",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},buscarPlano:function(c){var d={metodo:"buscarPlano",listaInscripcionesPlano:c},e=b.defer();return a({method:"GET",url:"../do/service/gponline",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},buscarCaratulas:function(c,d,e){var f={metodo:"buscarCaratulas",borrador:c,folio:d,listaPropiedades:e},g=b.defer();return a({method:"GET",url:"../do/service/gponline",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},buscarBorradorPorInscripcionRegistro:function(c,d,e,f,g){var h={metodo:"buscarBorradorPorInscripcionRegistro",foja:c,numero:d,ano:e,bis:f,registro:g},i=b.defer();return a({method:"GET",url:"../do/service/gponline",params:h}).success(function(a,b,c,d){i.resolve(a)}).error(function(a,b,c,d){i.reject(b)}),i.promise}}}]),app.factory("inscripcionDigitalHipotecasService",["$http","$q",function(a,b){return{getInscripcionParaDigital:function(c,d,e,f){var g=new Date,h=g.getTime(),i={v:h,metodo:"getInscripcionParaDigital",foja:c,numero:d,ano:e,bis:f},j=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalHipotecas",params:i}).success(function(a,b,c,d){j.resolve(a)}).error(function(a,b,c,d){j.reject(b)}),j.promise},getBusquedaTitulo:function(c,d,e,f,g){var h=new Date,i=h.getTime(),j={v:i,metodo:"getBusquedaTitulo",foja:c,numero:d,ano:e,bis:f,anteriores:g},k=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalHipotecas",params:j}).success(function(a,b,c,d){k.resolve(a)}).error(function(a,b,c,d){k.reject(b)}),k.promise},getInscripcion:function(c,d,e,f){var g=new Date,h=g.getTime(),i={v:h,metodo:"getInscripcion",foja:c,numero:d,ano:e,bis:f},j=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalHipotecas",params:i}).success(function(a,b,c,d){j.resolve(a)}).error(function(a,b,c,d){j.reject(b)}),j.promise},getInscripcionSimple:function(c,d,e,f){var g=new Date,h=g.getTime(),i={v:h,metodo:"getInscripcionSimple",foja:c,numero:d,ano:e,bis:f},j=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalHipotecas",params:i}).success(function(a,b,c,d){j.resolve(a)}).error(function(a,b,c,d){j.reject(b)}),j.promise},obtenerBorradores:function(c,d,e,f){var g=new Date,h=g.getTime(),i={v:h,metodo:"obtenerBorradores",foja:c,numero:d,ano:e,bis:f},j=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalHipotecas",params:i}).success(function(a,b,c,d){j.resolve(a)}).error(function(a,b,c,d){j.reject(b)}),j.promise},obtenerCaratulasPorEstado:function(c,d,e,f,g){var h=new Date,i=h.getTime(),j={v:i,metodo:"obtenerCaratulasPorEstado",foja:c,numero:d,ano:e,bis:f,estado:g},k=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalHipotecas",params:j}).success(function(a,b,c,d){k.resolve(a)}).error(function(a,b,c,d){k.reject(b)}),k.promise},getTiposAnotacion:function(){var c=b.defer();return a({method:"POST",url:"../do/inscripcionDigitalService",dataType:"json",data:"metodo=getTiposAnotacion",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,d,e){c.resolve(a)}).error(function(a,b,d,e){c.reject(b)}),c.promise},getInscripcionJPG:function(c,d,e,f){var g={metodo:"getInscripcionJPG",foja:c,numero:d,ano:e,bis:f},h=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalHipotecas",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},getAnotacionParaRevision:function(c,d,e){var f={metodo:"getAnotacionParaRevision",fojaini:c,fojafin:d,ano:e},g=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalHipotecas",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},actualizaEstadoAnotacion:function(c){var d={metodo:"actualizaEstadoAnotacion",anotacion:c},e=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalHipotecas",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getResumenNotas:function(c,d,e){var f={metodo:"getResumenNotas",caratula:c,borrador:d,folio:e},g=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalHipotecas",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},existeDocumentoReg:function(c,d,e,f){var g={metodo:"existeDocumentoReg",foja:c,numero:d,ano:e,registro:f},h=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalHipotecas",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},getNotas:function(c,d,e,f){var g={metodo:"getNotas",foja:c,numero:d,ano:e,bis:f},h=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalHipotecas",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},getFojaIniFojaFinCuadernillo:function(c,d){var e={metodo:"getFojaIniFojaFinCuadernillo",cuadernillo:c,ano:d},f=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalHipotecas",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},despacharCuadernillo:function(c){var d={metodo:"despacharCuadernillo",cuadernillo:c},e=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalHipotecas",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getDespachoCuadernillos:function(c,d){var e={metodo:"getDespachoCuadernillos",fechaIni:c,fechaFin:d},f=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalHipotecas",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},reasignarCuadernillos:function(c,d){var e={metodo:"reasignarCuadernillos",cuadernillos:c,usuario:d},f=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalHipotecas",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise}}}]),app.factory("inscripcionDigitalProhibicionesService",["$http","$q",function(a,b){return{getInscripcionParaDigital:function(c,d,e,f){var g=new Date,h=g.getTime(),i={v:h,metodo:"getInscripcionParaDigital",foja:c,numero:d,ano:e,bis:f},j=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalProhibiciones",params:i}).success(function(a,b,c,d){j.resolve(a)}).error(function(a,b,c,d){j.reject(b)}),j.promise},getBusquedaTitulo:function(c,d,e,f,g){var h=new Date,i=h.getTime(),j={v:i,metodo:"getBusquedaTitulo",foja:c,numero:d,ano:e,bis:f,anteriores:g},k=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalProhibiciones",params:j}).success(function(a,b,c,d){k.resolve(a)}).error(function(a,b,c,d){k.reject(b)}),k.promise},getInscripcion:function(c,d,e,f){var g=new Date,h=g.getTime(),i={v:h,metodo:"getInscripcion",foja:c,numero:d,ano:e,bis:f},j=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalProhibiciones",params:i}).success(function(a,b,c,d){j.resolve(a)}).error(function(a,b,c,d){j.reject(b)}),j.promise},getInscripcionSimple:function(c,d,e,f){var g=new Date,h=g.getTime(),i={v:h,metodo:"getInscripcionSimple",foja:c,numero:d,ano:e,bis:f},j=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalProhibiciones",params:i}).success(function(a,b,c,d){j.resolve(a)}).error(function(a,b,c,d){j.reject(b)}),j.promise},obtenerBorradores:function(c,d,e,f){var g=new Date,h=g.getTime(),i={v:h,metodo:"obtenerBorradores",foja:c,numero:d,ano:e,bis:f},j=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalProhibiciones",params:i}).success(function(a,b,c,d){j.resolve(a)}).error(function(a,b,c,d){j.reject(b)}),j.promise},obtenerCaratulasPorEstado:function(c,d,e,f,g){var h=new Date,i=h.getTime(),j={v:i,metodo:"obtenerCaratulasPorEstado",foja:c,numero:d,ano:e,bis:f,estado:g},k=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalProhibiciones",params:j}).success(function(a,b,c,d){k.resolve(a)}).error(function(a,b,c,d){k.reject(b)}),k.promise},getTiposAnotacion:function(){var c=b.defer();return a({method:"POST",url:"../do/inscripcionDigitalService",dataType:"json",data:"metodo=getTiposAnotacion",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,d,e){c.resolve(a)}).error(function(a,b,d,e){c.reject(b)}),c.promise},getInscripcionJPG:function(c,d,e,f){var g={metodo:"getInscripcionJPG",foja:c,numero:d,ano:e,bis:f},h=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalProhibiciones",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},getAnotacionParaRevision:function(c,d,e){var f={metodo:"getAnotacionParaRevision",fojaini:c,fojafin:d,ano:e},g=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalProhibiciones",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},actualizaEstadoAnotacion:function(c){var d={metodo:"actualizaEstadoAnotacion",anotacion:c},e=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalProhibiciones",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getResumenNotas:function(c,d,e){var f={metodo:"getResumenNotas",caratula:c,borrador:d,folio:e},g=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalProhibiciones",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},existeDocumentoReg:function(c,d,e,f){var g={metodo:"existeDocumentoReg",foja:c,numero:d,ano:e,registro:f},h=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalProhibiciones",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},getNotas:function(c,d,e,f){var g={metodo:"getNotas",foja:c,numero:d,ano:e,bis:f},h=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigitalProhibiciones",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise}}}]),app.factory("inscripcionDigitalService",["$http","$q",function(a,b){return{getInscripcionParaDigital:function(c,d,e,f){var g=new Date,h=g.getTime(),i={v:h,metodo:"getInscripcionParaDigital",foja:c,numero:d,ano:e,bis:f},j=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigital",params:i}).success(function(a,b,c,d){j.resolve(a)}).error(function(a,b,c,d){j.reject(b)}),j.promise},getBusquedaTitulo:function(c,d,e,f,g){var h=new Date,i=h.getTime(),j={v:i,metodo:"getBusquedaTitulo",foja:c,numero:d,ano:e,bis:f,anteriores:g},k=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigital",params:j}).success(function(a,b,c,d){k.resolve(a)}).error(function(a,b,c,d){k.reject(b)}),k.promise},getInscripcion:function(c,d,e,f){var g=new Date,h=g.getTime(),i={v:h,metodo:"getInscripcion",foja:c,numero:d,ano:e,bis:f},j=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigital",params:i}).success(function(a,b,c,d){j.resolve(a)}).error(function(a,b,c,d){j.reject(b)}),j.promise},getInscripcionSimple:function(c,d,e,f){var g=new Date,h=g.getTime(),i={v:h,metodo:"getInscripcionSimple",foja:c,numero:d,ano:e,bis:f},j=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigital",params:i}).success(function(a,b,c,d){j.resolve(a)}).error(function(a,b,c,d){j.reject(b)}),j.promise},obtenerBorradores:function(c,d,e,f){var g=new Date,h=g.getTime(),i={v:h,metodo:"obtenerBorradores",foja:c,numero:d,ano:e,bis:f},j=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigital",params:i}).success(function(a,b,c,d){j.resolve(a)}).error(function(a,b,c,d){j.reject(b)}),j.promise},obtenerCaratulasPorEstado:function(c,d,e,f,g){var h=new Date,i=h.getTime(),j={v:i,metodo:"obtenerCaratulasPorEstado",foja:c,numero:d,ano:e,bis:f,estado:g},k=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigital",params:j}).success(function(a,b,c,d){k.resolve(a)}).error(function(a,b,c,d){k.reject(b)}),k.promise},getTiposAnotacion:function(){var c=b.defer();return a({method:"POST",url:"../do/inscripcionDigitalService",dataType:"json",data:"metodo=getTiposAnotacion",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,d,e){c.resolve(a)}).error(function(a,b,d,e){c.reject(b)}),c.promise},getInscripcionJPG:function(c,d,e,f){var g={metodo:"getInscripcionJPG",foja:c,numero:d,ano:e,bis:f},h=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigital",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},getAnotacionParaRevision:function(c,d,e,f){var g={metodo:"getAnotacionParaRevision",fojaini:c,fojafin:d,ano:e,cuadernillo:f},h=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigital",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},actualizaEstadoAnotacion:function(c){var d={metodo:"actualizaEstadoAnotacion",anotacion:c},e=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigital",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getResumenNotas:function(c,d,e){var f={metodo:"getResumenNotas",caratula:c,borrador:d,folio:e},g=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigital",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},existeDocumentoReg:function(c,d,e,f){var g={metodo:"existeDocumentoReg",foja:c,numero:d,ano:e,registro:f},h=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigital",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},getNotas:function(c,d,e,f){var g={metodo:"getNotas",foja:c,numero:d,ano:e,bis:f},h=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigital",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},getFojaIniFojaFinCuadernillo:function(c,d){var e={metodo:"getFojaIniFojaFinCuadernillo",cuadernillo:c,ano:d},f=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigital",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},despacharCuadernillo:function(c,d){var e={metodo:"despacharCuadernillo",cuadernillo:c,ano:d},f=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigital",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},getDespachoCuadernillos:function(c,d){var e={metodo:"getDespachoCuadernillos",fechaIni:c,fechaFin:d},f=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigital",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},reasignarCuadernillos:function(c,d){var e={metodo:"reasignarCuadernillos",cuadernillos:c,usuario:d},f=b.defer();return a({method:"GET",url:"../do/service/inscripcionDigital",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise}}}]),app.factory("mantenedorService",["$http","$q",function(a,b){return{obtenerUsuarios:function(c){var d={metodo:"obtenerUsuarios",seccion:c},e=b.defer();return a({method:"GET",url:"../do/service/mantenedor",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},cambiaEstadoUsuario:function(c,d,e){var f={metodo:"cambiaEstadoUsuario",nombreUsuario:c,estado:d,perfil:e},g=b.defer();return a({method:"GET",url:"../do/service/mantenedor",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},redistribuirCaratulas:function(c,d){var e={metodo:"redistribuirCaratulas",nombreUsuario:c,perfil:d},f=b.defer();return a({method:"GET",url:"../do/service/mantenedor",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},getCtasCtes:function(){var c={metodo:"getCtasCtes"},d=b.defer();return a({method:"GET",url:"../do/service/mantenedor",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},guardarCtaCte:function(c){var d="metodo=guardarCtaCte&ctaCte="+c,e=b.defer();return a({method:"POST",url:"../do/service/mantenedor",data:d,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise}}}]),app.factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"views/genericos/eliminarModal.html",windowClass:d,scope:e})}return{confirm:{delete:function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d[0];b=c({modal:{dismissable:!0,title:"Confirmar Eliminacion",html:"<p> ¿ Esta seguro de eliminar version <strong>"+e.version+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),app.factory("parametrosService",["$q","$http",function(a,b){return{getNaturalezas:function(){var c={metodo:"getNaturalezas"},d=a.defer();return b({method:"GET",url:"../do/service/parametros",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise}}}]),app.factory("planosService",["$http","$q",function(a,b){return{obtenerPlanosPorTitulos:function(c,d,e){var f={metodo:"obtenerPlanosPorTitulos",foja:c,numero:d,ano:e},g=b.defer();return a({method:"GET",url:"../do/service/planos",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},obtenerPlanosPendientes:function(){var c={metodo:"obtenerPestamosPendientes"},d=b.defer();return a({method:"GET",url:"../do/service/planos",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise}}}]),app.factory("reingresoService",["$q","$http",function(a,b){return{getCaratula:function(c){var d={metodo:"buscarCaratula",caratula:c},e=a.defer();return b({method:"GET",url:"../do/service/reingreso",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},reingresarCaratula:function(c,d,e,f,g,h){var i={metodo:"reingresarCaratula",caratulaDTO:c,observacion:e,workflow:f,codigoExtracto:g,notario:h},j=a.defer();return b({method:"POST",url:"../do/service/reingreso",params:i}).success(function(a,b,c,d){j.resolve(a)}).error(function(a,b,c,d){j.reject(b)}),j.promise},getCaratulaSesion:function(){var c={metodo:"getCaratulaSesion"},d=a.defer();return b({method:"GET",url:"../do/service/reingreso",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},getListas:function(c){var d={metodo:"getListas",caratulaDTO:c},e=a.defer();return b({method:"GET",url:"../do/service/reingreso",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getListaNotarios:function(c){var d={metodo:"getListaNotarios",query:c},e=a.defer();return b({method:"GET",url:"../do/service/reingreso",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getListaNotariosFull:function(){var c={metodo:"getListaNotariosFull"},d=a.defer();return b({method:"GET",url:"../do/service/reingreso",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise}}}]),app.factory("repertorioService",["$q","$http",function(a,b){return{getRepertorio:function(c,d,e){var f={metodo:"getRepertorio",numCaratula:c,numRepertorio:d,anio:e},g=a.defer();return b({method:"GET",url:"../do/service/repertorio",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},consultaDetalleRepertorio:function(c,d,e){var f={metodo:"consultaDetalleRepertorio",numCaratula:c,numRepertorio:d,anio:e},g=a.defer();return b({method:"GET",url:"../do/service/repertorio",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},getListadoRepertorio:function(c,d){var e={metodo:"getListadoRepertorio",fechaDesde:c,fechaHasta:d},f=a.defer();return b({method:"GET",url:"../do/service/repertorio",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise}}}]),app.factory("requirenteService",["$q","$http",function(a,b){return{getNombre:function(c){var d={metodo:"getNombre",rut:c},e=a.defer();return b({method:"GET",url:"../do/service/requirente",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getRequirenteFull:function(c){var d={metodo:"getRequirenteFull",rut:c},e=a.defer();return b({method:"GET",url:"../do/service/requirente",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise}}}]),app.factory("socketService",["$rootScope","$websocket","$modal","$window",function(a,b,c,d){var e=null,f=!1;a.openedContador=!1;var g=null,h=null;return{conexion:function(){if(a.activoAtencion){var i="ws://"+a.ipSocket+":"+a.puertoSocket+"/atencion-publico/websocket/atencion/aio/operador/"+a.userIpAddress+"/"+a.modulo+"/"+a.grupo+"/0";e=b(i,null,{reconnectIfNotNormalClose:!0}),e.onOpen(function(){console.log("connection open")}),e.onMessage(function(b){var i=JSON.parse(b.data);if(console.log(i),"MODULO_OBTENER_ESTADO_RESPONSE"===i.evento)if(a.indisponibilidad=!1,"MODULO_DISPONIBLE"===i.message.evento){if(a.moduloDisponible=1,f)return;g=c.open({templateUrl:"atencionModal.html",backdrop:!0,keyboard:!0,windowClass:"modal, modal2",controller:"AtencionModalCtrl"}),f=!0,g.result.then(function(){f=!1,a.openedContador=!1,a.stopTimeout()},function(){var b={origen:"AIO",evento:"MODULO_OCUPADO",modulo:a.modulo,usuario:a.userLoginSinCBRS,ip:a.userIpAddress,nombreCliente:""};null!=h&&(h.close(),h=null),e.send(b),f=!1,a.openedContador=!1,a.stopTimeout()})}else"MODULO_OCUPADO"===i.message.evento?(a.moduloDisponible=0,f&&(g.close(),null!=h&&(h.close(),h=null),a.countdown=0)):"MODULO_LOGOUT"===i.message.evento&&(d.location.href="../login/logout.jsp");else"MODULO_DISPONIBLE_PRIMERO"===i.evento&&(a.moduloDisponible=2,a.openedContador||a.init())}),e.onClose(function(){console.log("connection closed",event),event.wasClean||(a.indisponibilidad=!0)})}},disponible:function(){var b={origen:"AIO",evento:"MODULO_DISPONIBLE",modulo:a.modulo,usuario:a.userLoginSinCBRS,ip:a.userIpAddress,nombreCliente:a.nombreCliente};e.send(b),a.countdown=10,a.nombreCliente=""},ocupado:function(){var b={origen:"AIO",evento:"MODULO_OCUPADO",modulo:a.modulo,usuario:a.userLoginSinCBRS,ip:a.userIpAddress,nombreCliente:""};e.send(b)},desconectar:function(){console.log("desconectar");var b={origen:"AIO",evento:"MODULO_LOGOUT",modulo:a.modulo,usuario:a.userLoginSinCBRS,ip:a.userIpAddress,nombreCliente:""};e.send(b),null!==e&&(e.close(),e=null)},llamarCliente:function(){h=c.open({templateUrl:"llamarClienteModal.html",backdrop:!0,windowClass:"modal",controller:"llamarClienteModalCtrl"})}}}]),app.factory("solicitudHipotecasService",["$http","$q",function(a,b){return{save:function(c,d,e){var f="metodo=save&rut="+d+"&nombre="+encodeURIComponent(e)+"&data="+c,g=b.defer();return a({method:"POST",url:"../do/service/solicitudHipotecas",data:f,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},getByRut:function(c){var d={metodo:"getByRut",rut:c},e=b.defer();return a({method:"GET",url:"../do/service/solicitudHipotecas",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getByUserInSession:function(){var c={metodo:"getByUserInSession"},d=b.defer();return a({method:"GET",url:"../do/service/solicitudHipotecas",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},saveSingleConValidacion:function(c,d,e,f){var g={metodo:"saveSingleConValidacion",fojaSol:c,numeroSol:d,anoSol:e,bisSol:f},h=b.defer();return a({method:"GET",url:"../do/service/solicitudHipotecas",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},saveSingle:function(c,d,e,f){var g={metodo:"saveSingle",fojaSol:c,numeroSol:d,anoSol:e,bisSol:f},h=b.defer();return a({method:"GET",url:"../do/service/solicitudHipotecas",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},actualizar:function(c,d){var e={metodo:"actualizar",idSolicitud:c,accion:d},f=b.defer();return a({method:"GET",url:"../do/service/solicitudHipotecas",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},getByFojaNumeroAno:function(c,d,e,f){var g={metodo:"getByFojaNumeroAno",foja:c,numero:d,ano:e,bis:f},h=b.defer();return a({method:"GET",url:"../do/service/solicitudHipotecas",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},urgenciaSolicitud:function(c,d,e,f){var g={metodo:"urgenciaSolicitud",foja:c,numero:d,ano:e,bis:f},h=b.defer();return a({method:"GET",url:"../do/service/solicitudHipotecas",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise}}}]),app.factory("solicitudProhibicionesService",["$http","$q",function(a,b){return{save:function(c,d,e){var f="metodo=save&rut="+d+"&nombre="+encodeURIComponent(e)+"&data="+c,g=b.defer();return a({method:"POST",url:"../do/service/solicitudProhibiciones",data:f,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},getByRut:function(c){var d={metodo:"getByRut",rut:c},e=b.defer();return a({method:"GET",url:"../do/service/solicitudProhibiciones",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getByUserInSession:function(){var c={metodo:"getByUserInSession"},d=b.defer();return a({method:"GET",url:"../do/service/solicitudProhibiciones",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},saveSingleConValidacion:function(c,d,e,f){var g={metodo:"saveSingleConValidacion",fojaSol:c,numeroSol:d,anoSol:e,bisSol:f},h=b.defer();return a({method:"GET",url:"../do/service/solicitudProhibiciones",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},saveSingle:function(c,d,e,f){var g={metodo:"saveSingle",fojaSol:c,numeroSol:d,anoSol:e,bisSol:f},h=b.defer();return a({method:"GET",url:"../do/service/solicitudProhibiciones",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},actualizar:function(c,d){var e={metodo:"actualizar",idSolicitud:c,accion:d},f=b.defer();return a({method:"GET",url:"../do/service/solicitudProhibiciones",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},getByFojaNumeroAno:function(c,d,e,f){var g={metodo:"getByFojaNumeroAno",foja:c,numero:d,ano:e,bis:f},h=b.defer();return a({method:"GET",url:"../do/service/solicitudProhibiciones",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},urgenciaSolicitud:function(c,d,e,f){var g={metodo:"urgenciaSolicitud",foja:c,numero:d,ano:e,bis:f},h=b.defer();return a({method:"GET",url:"../do/service/solicitudProhibiciones",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise}}}]),app.factory("solicitudService",["$http","$q",function(a,b){return{save:function(c,d,e){var f="metodo=save&rut="+d+"&nombre="+encodeURIComponent(e)+"&data="+c,g=b.defer();return a({method:"POST",url:"../do/service/solicitud",data:f,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},getByRut:function(c){var d={metodo:"getByRut",rut:c},e=b.defer();return a({method:"GET",url:"../do/service/solicitud",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getByUserInSession:function(){var c={metodo:"getByUserInSession"},d=b.defer();return a({method:"GET",url:"../do/service/solicitud",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},saveSingleConValidacion:function(c,d,e,f){var g={metodo:"saveSingleConValidacion",fojaSol:c,numeroSol:d,anoSol:e,bisSol:f},h=b.defer();return a({method:"GET",url:"../do/service/solicitud",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},saveSingle:function(c,d,e,f){var g={metodo:"saveSingle",fojaSol:c,numeroSol:d,anoSol:e,bisSol:f},h=b.defer();return a({method:"GET",url:"../do/service/solicitud",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},actualizar:function(c,d){var e={metodo:"actualizar",idSolicitud:c,accion:d},f=b.defer();return a({method:"GET",url:"../do/service/solicitud",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},getByFojaNumeroAno:function(c,d,e,f){var g={metodo:"getByFojaNumeroAno",foja:c,numero:d,ano:e,bis:f},h=b.defer();return a({method:"GET",url:"../do/service/solicitud",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},urgenciaSolicitud:function(c,d,e,f){var g={metodo:"urgenciaSolicitud",foja:c,numero:d,ano:e,bis:f},h=b.defer();return a({method:"GET",url:"../do/service/solicitud",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise}}}]),app.factory("tareasService",["$http","$q",function(a,b){return{obtenerCaratulasLiquidacionPorUsuario:function(){var c={metodo:"getCaratulasLiquidacionPorUsuario"},d=b.defer();return a({method:"GET",url:"../do/service/tareas",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},obtenerCaratulasPorUsuario:function(){var c={metodo:"getCaratulasPorUsuario"},d=b.defer();return a({method:"POST",url:"../do/service/tareas",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},buscarTransaccion:function(c){var d={metodo:"buscarTransaccion",idTransaccion:c},e=b.defer();return a({method:"GET",url:"../do/service/tareas",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getCaratulaLiquidacion:function(c){var d={metodo:"getCaratulaLiquidacion",numeroCaratula:c},e=b.defer();return a({method:"GET",url:"../do/service/tareas",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},aprobarCaratula:function(c,d,e,f,g,h){var i="metodo=aprobarCaratula&numeroCaratula="+c+"&canal="+d+"&papeles="+e+"&total="+f+"&actualizarCierre="+g+"&seccionDestino="+h,j=b.defer();return a({method:"POST",url:"../do/service/tareas",data:i,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(a,b,c,d){j.resolve(a)}).error(function(a,b,c,d){j.reject(b)}),j.promise},buscarDocumento:function(c,d,e,f){var g={metodo:"buscarDocumento",idNotario:c,codDocumento:d,origen:e,numeroCaratula:f},h=b.defer();return a({method:"GET",url:"../do/service/tareas",params:g}).success(function(a,b,c,d){h.resolve(a)}).error(function(a,b,c,d){h.reject(b)}),h.promise},buscarDocumentoFusion:function(c,d,e,f,g){var h={metodo:"buscarDocumentoFusion",idNotario:c,codDocumento:d,origen:e,numeroCaratula:f,version:g},i=b.defer();return a({method:"GET",url:"../do/service/tareas",params:h}).success(function(a,b,c,d){i.resolve(a)}).error(function(a,b,c,d){i.reject(b)}),i.promise},anularDocumento:function(c,d,e){var f={metodo:"anularDocumento",codArchivoAlpha:c,descripcion:d,caratula:e},g=b.defer();return a({method:"GET",url:"../do/service/tareas",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise},agregarDocumentoLiquidacion:function(c){var d={metodo:"agregarDocumentoLiquidacion",documento:c},e=b.defer();return a({method:"GET",url:"../do/service/tareas",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},eliminarDocumentoLiquidacion:function(c){var d={metodo:"eliminarDocumentoLiquidacion",documento:c},e=b.defer();return a({method:"GET",url:"../do/service/tareas",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getGlosaDocumento:function(c){var d={metodo:"getGlosaDocumento",codAlpha:c},e=b.defer();return a({method:"GET",url:"../do/service/tareas",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise}}}]),app.factory("uafService",["$q","$http",function(a,b){return{buscarPersonas:function(c,d){var e={metodo:"buscarPersonas",nInscripciones:c,ano:d},f=a.defer();return b({method:"GET",url:"../do/service/uaf",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},buscarBienes:function(c,d,e){var f={metodo:"buscarBienes",nInscripciones:c,ano:d,naturalezas:e},g=a.defer();return b({method:"GET",url:"../do/service/uaf",params:f}).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(b)}),g.promise}}}]),app.factory("Usuario",["$q","$http",function(a,b){return{tienePermiso:function(a,b){if(console.log(a),0===a.indexOf("/verInscripcion")||0===a.indexOf("/verCartel"))return!0;if(0===a.indexOf("/verEscritura"))return!0;if(0===a.indexOf("/verEscrituraEstudio"))return!0;if(0===a.indexOf("/verGP"))return!0;if(0===a.indexOf("/verInscripcionReg"))return!0;if(0===a.indexOf("/consultadiablito"))return!0;if(0===a.indexOf("/verVistaPreviaPlantilla"))return!0;if(null!=b)for(var c=0;c<b.length;c++){var d=b[c];if(d.path===a||0===a.indexOf(d.path))return!0;for(var e=d.subOpcionesDTO,f=0;f<e.length;f++){var g=e[f];if(g.path===a||0===a.indexOf(g.path))return!0}}return!1},getPermisosSinHome:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];"home"!==d.id&&b.push(d)}return b},getSubPermisos:function(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];e.id===a&&(c=e.subPermisos)}return c},getAllSubPermisos:function(a){for(var b={},c=0;c<a.length;c++)b[a[c].id]=a[c].subPermisos;return b},setPermisos:function(a){permisos=a},getUsuario:function(c){var d={metodo:"getUsuario"},e=a.defer();return b({method:"GET",url:"../do/service/usuario",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getPermisosUsuario:function(c){var d={metodo:"getPermisosUsuario",perfil:c},e=a.defer();return b({method:"GET",url:"../do/service/usuario",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},getPerfilesUsuario:function(){var c={metodo:"getPerfilesUsuario"},d=a.defer();return b({method:"GET",url:"../do/service/usuario",params:c}).success(function(a,b,c,e){d.resolve(a)}).error(function(a,b,c,e){d.reject(b)}),d.promise},getSessionAttribute:function(c){var d={metodo:"getSessionAttribute",attribute:c},e=a.defer();return b({method:"GET",url:"../do/service/usuario",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise},setSessionAttribute:function(c,d){var e={metodo:"setSessionAttribute",attribute:c,value:d},f=a.defer();return b({method:"GET",url:"../do/service/usuario",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},setSessionActiva:function(c,d){var e={metodo:"setSessionActiva",path:c,perfil:d},f=a.defer();return b({method:"GET",url:"../do/service/usuario",params:e}).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(b)}),f.promise},getUsuariosLogueados:function(c){var d={metodo:"getUsuariosLogueados",path:c},e=a.defer();return b({method:"GET",url:"../do/service/usuario",params:d}).success(function(a,b,c,d){e.resolve(a)}).error(function(a,b,c,d){e.reject(b)}),e.promise}}}]),app.filter("cut",function(){return function(a,b,c,d){if(!a)return"";if(!(c=parseInt(c,10)))return a;if(a.length<=c)return a;if(a=a.substr(0,c),b){var e=a.lastIndexOf(" ");-1!=e&&(a=a.substr(0,e))}return a+(d||" …")}}),app.filter("myCurrency",function(){return function(a){return void 0!==a?accounting.formatMoney(a,"$",0,".",",","$%v"):""}}),app.filter("myMoment",function(){return function(a,b,c){return moment(a,b).format(c)}});